C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE ACTIVITYFUNCTIONS
OBJECT MODULE PLACED IN ..\OBJ\ActivityFunctions.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\CODE\ActivityFunctions.c LARGE OBJECTADVANCED OPTIMIZE(9,SIZE) BROWSE
                    - ORDER NOAREGS INCDIR(..\HARDWARE\ds1302;..\HARDWARE\ds18b20;..\HARDWARE\lcd;..\HARDWARE\RX8010;..\HARDWARE\sht21;..\HAR
                    -DWARE\sht31;..\HARDWARE\w25x;..\SYSTEM\delay;..\SYSTEM\stc_eeprom;..\SYSTEM;..\CODE) DEBUG PRINT(.\ActivityFunctions.lst
                    -) TABS(2) OBJECT(..\OBJ\ActivityFunctions.obj)

line level    source

   1          /* VHB15AÊª»¯Æ÷*/ 
   2          
   3          #include "all.h"
   4          
   5          //2019.03.29
   6          sfr P4M0 = 0xB4; 
   7          sfr P4M1 = 0xB3;
   8          sfr P4SW = 0xBB;
   9          sfr WDT_CONTR = 0xC1;
  10          sbit EA  = (uint8_t)0xA8^(uint8_t)7;
  11          sbit EX1 = (uint8_t)0xA8^(uint8_t)2;
  12          sbit ET0 = (uint8_t)0xA8^(uint8_t)1;
  13          sfr P1M0 = 0x92; 
  14          sfr P1M1 = 0x91;
  15          //sbit P10 = (uint8_t)0x90^(uint8_t)0;
  16          sbit P10 = (uint8_t)0x90;
  17          sbit P12 = (uint8_t)0x90^(uint8_t)2;
  18          sbit P13 = (uint8_t)0x90^(uint8_t)3;
  19          sbit P17 = (uint8_t)0x90^(uint8_t)7;
  20          //sbit P20 = (uint8_t)0xA0^(uint8_t)0;
  21          sbit P20 = (uint8_t)0xA0;
  22          sbit P21 = (uint8_t)0xA0^(uint8_t)1;
  23          sbit P22 = (uint8_t)0xA0^(uint8_t)2;
  24          sbit P27 = (uint8_t)0xA0^(uint8_t)7;
  25          sfr P2M0 = 0x96;
  26          sfr P2M1 = 0x95;
  27          sbit P32 = (uint8_t)0xB0^(uint8_t)2;
  28          sbit P34 = (uint8_t)0xB0^(uint8_t)4;
  29          sbit P35 = (uint8_t)0xB0^(uint8_t)5;
  30          sbit P36 = (uint8_t)0xB0^(uint8_t)6;
  31          sbit P37 = (uint8_t)0xB0^(uint8_t)7;
  32          sfr P3M0 = 0xB2;
  33          sfr P3M1 = 0xB1; 
  34          //sbit P40 = (uint8_t)0xC0^(uint8_t)0;
  35          sbit P40 = (uint8_t)0xC0;
  36          sbit P43 = (uint8_t)0xC0^(uint8_t)3;
  37          sbit TI  = (uint8_t)0x98^(uint8_t)1;
  38          //sbit RI  = (uint8_t)0x98^(uint8_t)0;
  39          sbit RI  = (uint8_t)0x98;
  40          sbit TR0 = (uint8_t)0x88^(uint8_t)4;
  41          sbit IT1 = (uint8_t)0x88^(uint8_t)2;
  42          
  43          static void  Interrupt_EXT1(void);
  44          static void  Interrupt_Time0(void);
  45          static void  Serial (void);   //´®¿ÚÖÐ¶Ï
  46          
  47          
  48          //static enum  //heating wire mode
  49          //{ 
  50          //  Wire_Sel_Double = 0,  //double heating wire
  51          //  Wire_Sel_In_Only,     //INSP Only heating wire
  52          //  Wire_Sel_None       //Whithout heating wire
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 2   

  53          //}Wire_Mode_Sel; 
  54          static WIRE_MODE_SEL Wire_Mode_Sel=Wire_Sel_Double;
  55              
  56          //´íÎó¼ì²âºÍ±¨¾¯Ïà¹Ø±äÁ¿  
  57          uint8_t  ERR_Kind=0;//´íÎóµÄÖÖÀà//0´«¸ÐÆ÷/1¸ßÎÂ/2µÍÎÂ/3µÍÊª/4ÎÞË®/5»¼Õß´«¸ÐÆ÷/6³öÆø¿Ú´«¸ÐÆ÷/7¼ÓÈÈÅÌ´«¸ÐÆ÷ 
             -  
  58          uint8_t Wire_Mode_Mismatch ; //»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä   
  59          static uint8_t JRP_Sensor_Err=0;
  60          static uint8_t CQK_Sensor_Err=0;
  61          static uint8_t RTD_Sensor_Err=0;
  62          static uint8_t SHIDU_Sensor_Err=0;    
  63              
  64          uint8_t AlarmSoundPauseStatus = 0;//±¨¾¯ÉùÒôÔÝÍ£ 0-Õý³£±¨¾¯ 1-±¨¾¯ÉùÒôÔÝÍ£(½ö±¨¾¯Ê±ÓÐÐ§)
  65          uint8_t AlarmInfoIndex = 0;//
  66                    
  67          static uint8_t    HiTemp_Count=0;   //¸ßÎÂ¶È´ÎÊý
  68          static uint8_t    LoTemp_Count=0;     //µÍÎÂ¶È´ÎÊý
  69          static uint8_t    LoTemp_CQK_Count=0;//³öÆø¿ÚµÍÎÂ¶È´ÎÊý
  70          static uint8_t    LoHumity_Count=0;  //µÍÊª¶È´ÎÊý
  71          
  72          uint8_t No_HeatSensor_Times=0;//¼ÓÈÈÅÌÎÂ¶È´«¸ÐÆ÷ÎÞÏìÓ¦´ÎÊý
  73          static uint16_t  No_CQKSensor_Times=0;//³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷ÎÞÏìÓ¦´ÎÊý
  74          static uint16_t  CQKSensor_Hithen800_Times=0;//³¬¹ý80¶È
  75          static uint16_t  JRP_Sensor_Temp_No_Change_Times=0;// ¼ÓÈÈÅÌÎÂ¶ÈÍêÈ«²»±äµÄ´ÎÊý2014-07-03
  76          static uint16_t  CQK_Sensor_Temp_No_Change_Times=0;// ³öÆø¿ÚÎÂ¶ÈÍêÈ«²»±äµÄ´ÎÊý    
  77          static uint8_t ERR_RT_Temp_Times=0;//»¼ÕßÎÂ¶È³¬¹ý80¶È
  78          static uint8_t No_ReadData_SHIDU_Times=0;//»¼Õß¶ËÎÂ¶ÈÎÞÏìÓ¦´ÎÊý
  79          static uint16_t  RT_Temp_Not_Updated_10mS = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼ä
  80          static uint8_t No_ReadData_Temp_Times=0;//³öÆø¿ÚÎÂ¶ÈÎÞÏìÓ¦´ÎÊý
  81          static uint16_t  Nochange_Times=0;//»¼Õß¶ËÎÂÊª¶ÈÍêÈ«²»±äµÄ´ÎÊý
  82          
  83          uint8_t RT_Temp_Reach_Set_Cnt = 0;//ÈËÌåÎÂ¶È´ïµ½Éè¶¨ÎÂ¶È-1.5
  84          uint8_t CQK_Temp_Reach_Set_Cnt = 0;//³öÆø¿ÚÎÂ¶È´ïµ½30
  85          
  86          uint8_t show_str[23]; 
  87          
  88          //static uint8_t   Work_Day=0;
  89          //static uint8_t   Work_Hour=0;
  90          //static uint8_t   Work_Min=0;
  91          //static uint8_t   Work_Sec=0;
  92          
  93          //´æ´¢Ïà¹Ø
  94          struct stc_data_flash data_flash;//
  95          static uint16_t  Run_Count;
  96          uint8_t    SaveData[16];
  97                                              
  98          //´®¿ÚÏà¹Ø±äÁ¿                                    
  99          //static bit Buff_Full_flag;    
 100          //static uint8_t   Rec_Count=0;
 101          //static BYTE    Rec_Buff[21];          //½ÓÊÕµ½µÄÖ¸ÁîREAD0001[CR]-READ0200[CR];
 102                                              //Ò»ÌõÖ¸Áî¿É½ÓÊÕ256ÌõÊý¾Ý                                   
 103          //static uint16_t   Tick_20ms=0;
 104          uint8_t defalut_mode = Load_User_Pre_MODE;  //Ô¤ÉèÄ£Ê½Ñ¡Ôñ
 105          
 106          //ÊµÊ±²ÎÊý
 107          INT             RT_Temp=0;            //ÈËÌå¶ËÎÂ¶È
 108          INT             JEP_Temp=280;           //¼ÓÈÈÅÌÎÂ¶È
 109          LONG              CQK_Temp=280;           //³öÆø¿ÚÎÂ¶È
 110          static uint16_t     RT_SHIDU=0;             //ÈËÌå¶ËÊª¶È
 111          static uint16_t     CONTROL_RT_SHIDU=550;     //¿ØÖÆ¼ÓÈÈµÄÊª¶È
 112          uint16_t     Diplay_RTtemp = 0;
 113          
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 3   

 114          //Éè¶¨²ÎÊý    
 115          uint8_t         Work_Mode = Invasive_Mode; //Ä¬ÈÏ1ÎªÓÐ´´Ä£Ê½ £¬0ÎªÎÞ´´Ä£Ê½£¬2£¬¼òÒ×Ä£Ê½(ÎÞ·¢ÈÈË¿)       
 116          INT                   Set_RT_Temp=390;         //ÈËÌå¶ËÎÂ¶ÈÉè¶¨Öµ       
 117          uint16_t          Set_RT_WCTemp=340;       //ÈËÌåÎÞ´´ÎÂ¶È
 118          uint16_t          Set_RT_YCTemp=390;       //ÈËÌåÓÐ´´ÎÂ¶È
 119          uint16_t          Set_CQK_Temp=370;        //³öÆø¿ÚÎÂ¶È
 120          uint16_t          Set_CQK_WCTemp=310;      //ÈËÌåÎÞ´´ÎÂ¶È
 121          uint16_t          Set_CQK_YCTemp=370;      //ÈËÌåÓÐ´´ÎÂ¶È
 122          uint8_t         In_Exp_Ratio=4;  //InºÍExp¼ÓÈÈ·½Ê½µÄ±ÈÀý  //1-1:1 2-1:1.1 3-1:1.2 4-1:1.3 5-1:1.4 6-1:1.5
 123          
 124          //¼ÓÈÈÅÌÇý¶¯ºÍ¼ì²â
 125          uint16_t          HP_CNT_Int = 0;//¼ÓÈÈÅÌÖÐ¶Ï¼ì²â¼ÆÊý
 126          uint16_t          HP_CNT_Int_End_Rem = 0;//8S½áÊøÊ±¼ÓÈÈÅÌÖÐ¶Ï¼ì²â¼ÆÊý
 127          uint8_t         WireIn_State=0;      //¼ÓÈÈÏßIn×´Ì¬ 1-ÓÐ 0-ÎÞ
 128          uint8_t         WireOut_State=0;     //¼ÓÈÈÏßOut×´Ì¬    1-ÓÐ 0-ÎÞ
 129          uint8_t         HeaterPlate_State = 0; //¼ÓÈÈÅÌ×´Ì¬ 1-ÓÐ 0-ÎÞ
 130          
 131          uint8_t         Micro_Temp_Val=0;   //¼ÓÈÈÅÌ×î´óÎª201;×îÐ¡Îª0,1±íÊ¾10ms¼ÓÈÈÊ±¼ä
 132          uint16_t          Micro_Temp_In=0;    //½øÆøÖ§
 133          uint16_t          Micro_Temp_Out=0;   //³öÆøÖ§
 134          
 135          //¿ØÖÆ²ÎÊý
 136          //static uint16_t   Aim_SHIDU=900;  //Ä¿±êÊª¶È 
 137          static INT    JEP_Temp_Aim=400;           //¼ÓÈÈÅÌÄ¿±êÎÂ¶È
 138          static uint16_t Wire_Warm_Up_Sec;    //µ±<=300Ê±ÏÞÖÆ·¢ÈÈË¿×î´ó¼ÓÈÈ¹¦ÂÊ
 139          static uint16_t Plate_Warm_Up_Sec;   //µ±<=600Ê±ÏÞÖÆ·¢ÈÈÅÌ×î´ó¼ÓÈÈ¹¦ÂÊ
 140          static uint16_t Humidity_No_Change_Sec;//Êª¶È²»¸Ä±äµÄ¼ÆÊý£¬µ±´óÓÚ600Ê±¿ÉÄÜÌ½Í·Ê§Ð§£¬Êª¶È¿ØÖÆÊ§Ð§
 141          static uint16_t Low_Power_Mode_Flag = 0;//µÍ¹¦ÂÊÄ£Ê½Ê¹ÄÜ±êÖ¾
 142          
 143          uint8_t     Test_Mode_Dis_Jrp_Ctl=0; //´Ó²âÊÔÄ£Ê½½øÈëÕý³£Ä£Ê½¼´ÏÔÊ¾ËùÓÐ¹¤×÷Êý¾Ý 
 144          static uint8_t     Micro_Adj_Mode_Test;  //¼ÓÈÈµÄÄ£Ê½²âÊÔ
 145          uint16_t      Working_Normal=0;//Õý³£¹¤×÷¶ÁÊý£¬Ã¿Ãë¼Ó1£¬¹ÊÕÏÖØÖÃ£¬¸Ä±äÉèÖÃÒ²ÖØÖÃ
 146          
 147          static uint8_t     Enable_Save_Data=0;  //±£´æÊý¾Ý¼ÆÊý
 148          
 149          static struct 
 150          {
 151            INT Uk; //×ÜµÄ¿ØÖÆÁ¿
 152          //  int Uk1;//ÉÏ´ÎµÄ×Ü¿ØÖÆÁ¿
 153            INT Sum_error;//Îó²î×ÜÁ¿
 154            INT Ek;//µ±Ç°µÄÎó²îÁ¿
 155            INT Ek1;//Ç°Ò»´ÎµÄÎó²îÁ¿
 156            INT Ek2;//Ç°¶þ´ÎµÄÎó²îÁ¿       
 157          }Controler_temp,Controler_temp2,Controler_temp3;//¶¨ÒåÒ»¸öÎÂ¶ÈControler½á¹¹
 158          
 159          //static CONTROLLER_TEMP Controler_temp;
 160          //static CONTROLLER_TEMP Controler_temp2;
 161          //static CONTROLLER_TEMP Controler_temp3;
 162          
 163          
 164           //Ãë    ·Ö    Ê±    ÈÕ    ÔÂ  ÐÇÆÚ    Äê
 165          static BYTE   NowTime[7]= {0x00, 0x00, 0xB2, 0x01, 0x01, 0x05, 0x12};
 166          
 167          //uint8_t Alarm_time_det_10mS_cnt = 0;
 168          
 169          //================================================== 
 170          
 171          static void Store_Data(void);           //´æ·ÅÊý¾Ý
 172          static void Get_RunCount(void);         //´æ·ÅÊý¾Ý
 173          //static void Init_Erase_Flash_Data(void);//³õÊ¼»¯Ê±²Á³ýÍâ²¿FLASHÊý¾Ý
 174          //static void Init_port(void); //³õÊ¼»¯¶Ë¿Ú×´Ì¬£¬ÏÔÊ¾°æ±¾ºÅ£¬¶ÁÈ¡Êý¾Ý£¬ÆÁÄ»²âÊÔ£¬W25XÇåÊý¾Ý
 175          // void Main_Init(void);  //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý,»­¹¤×÷´°¿Ú,Ê¹ÄÜä¸Á÷³äµç,RTC¼ì²â,ÆäËü±äÁ¿³õÊ¼»¯
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 4   

 176          static void Write_Default_Setting_to_flash(void); //°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
 177          //static void LCD_Show_Verion(void);//ÏÔÊ¾°æ±¾ºÅ
 178          static void PatientTemp_NoneHeatWire_Adj(void);//ÎÞ»ØÂ··¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶Èµ÷½Ú
 179          static void Controler_Calc(void); //ControlerËã·¨
 180          static void HeatPlateTemp_Aim_Controler_Calc(void); //¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈControlerËã·¨---
 181          static void HeatPlate_Controler_Calc(void);//¼ÓÈÈÅÌµÄControlerËã·¨---
 182          
 183          
 184          static void  Clear_bit(uint8_t* Value,INT bit_num) 
 185          {
 186   1        uint8_t* pV=Value;
 187   1        (*pV) =(*pV)& (u8)( ~ ( (uint16_t)1 << (uint16_t)(bit_num) ) );
 188   1      }
 189          static void  Set_bit(uint8_t* Value,INT bit_num)
 190          {
 191   1        uint8_t* pV=Value;
 192   1        (*pV) =(*pV)| (uint8_t)( (uint16_t)1 << (uint16_t)(bit_num) );
 193   1      }
 194          
 195          uint8_t  Bit_is_one(uint8_t Value,INT bit_num)
 196          {
 197   1        return (u8)( (Value) & ((uint16_t)1<< (uint16_t)(bit_num) ) );
 198   1      }
 199          
 200          
 201          
 202          static void  Interrupt_EXT1(void)  interrupt 2  //Íâ²¿ÖÐ¶ÏEXT1
 203          {
 204   1        HP_CNT_Int++; 
 205   1      }
 206          
 207          static void  Interrupt_Time0(void)  interrupt 1  using  2  //10msÖÐ¶ÏÒ»´Î //22.1184M
 208          {   
 209   1      //  static uint16_t   Tick_20ms;
 210   1        Timer_T0_INT_Main();
 211   1      //  ++Tick_20ms;
 212   1      }
 213          
 214          static void  Serial (void) interrupt 4 using 1    //´®¿ÚÖÐ¶Ï
 215          {
 216   1        if(RI)
 217   1        {
 218   2          EUSART_Receive_ISR();
 219   2      
 220   2          RI = (bit)0;
 221   2        }
 222   1      
 223   1        if(TI)
 224   1        {     
 225   2          EUSART_Transmit_ISR();
 226   2          TI = (bit)0;
 227   2        }
 228   1      }
 229          
 230          
 231          
 232          //static UART_RECSTATE UART_RecState=UART_REC_STATE_READY;
 233          
 234          //static enum
 235          //{
 236          //  UART_REC_STATE_READY = 0, //×¼±¸½ÓÊÕ,³õÊ¼»¯¼ÆÊý,  1
 237          //  UART_REC_STATE_HEADER_DET,//¼ì²âÃüÁîÍ· "NEUNIT=1," ¹²9¸ö×Ö·û 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 5   

 238          //  UART_REC_STATE_DATA_TAIL_DET,//½ÓÊÕÃüÁî(×î¶à9¸ö×Ö·û)£¬¼ì²âÃüÁîÎ²"\CR"¹²3¸ö×Ö·û 
 239          //  UART_REC_STATE_DONE //½ÓÊÕÕýÈ·Íê³É
 240          //}UART_RecState = UART_REC_STATE_READY;
 241          
 242          
 243          static uint8_t   UART_Rec_Buf[20];//½ÓÊÕ»º³åÇø 
 244           
 245          static void UART_RecBuf_Clear_Fun(void)  //Çå¿Õ»º³åÇø
 246          {
 247   1        INT i;
 248   1      
 249   1        for(i=0;i<=19;i++)
 250   1        {
 251   2          UART_Rec_Buf[i] = 0;        
 252   2        } 
 253   1      }
 254          
 255          //½ÓÊÕÊý¾Ý
 256          //static uint8_t   DataToPc[8];
 257          void UART_RecData_Func(void)
 258          {
 259   1        typedef enum
 260   1        {
 261   1          UART_REC_STATE_READY = 0, //×¼±¸½ÓÊÕ,³õÊ¼»¯¼ÆÊý,  1
 262   1          UART_REC_STATE_HEADER_DET,//¼ì²âÃüÁîÍ· "NEUNIT=1," ¹²9¸ö×Ö·û 
 263   1          UART_REC_STATE_DATA_TAIL_DET,//½ÓÊÕÃüÁî(×î¶à9¸ö×Ö·û)£¬¼ì²âÃüÁîÎ²"\CR"¹²3¸ö×Ö·û 
 264   1          UART_REC_STATE_DONE //½ÓÊÕÕýÈ·Íê³É
 265   1        }UART_RECSTATE;
 266   1        UART_RECSTATE UART_RecState=UART_REC_STATE_READY;
 267   1        
 268   1        static uint8_t   UART_Rec_Cnt = 0;//½ÓÊÕÊý¾ÝÊýÁ¿ 
 269   1        //    static uint8_t UART_Len = 0;//½ÓÊÕµÄÊý¾Ý³¤¶È
 270   1        uint8_t   i;
 271   1        uint8_t   uart_data;    
 272   1        UINT32   Adress;
 273   1        //    uint16_t    sum;
 274   1        
 275   1        while(EUSART_DataReady!=(uint8_t)0)//»º³åÇøÓÐÊý¾Ý
 276   1        {
 277   2          uart_data = EUSART_Read(); //´Ó»º³åÇø¶ÁÒ»¸öÊý¾Ý
 278   2          
 279   2          if(Work_State == UI_STATE_DATAREADER_MODE)
 280   2          {
 281   3            UART_Rec_Cnt++;//ÊýÁ¿Ôö¼Ó
 282   3            if(UART_RecState == UART_REC_STATE_READY)//¿ªÊ¼
 283   3            {
 284   4              UART_RecState = UART_REC_STATE_HEADER_DET;           
 285   4              UART_RecBuf_Clear_Fun();//Çå¿Õ»º³åÇø
 286   4              UART_Rec_Buf[0] = uart_data;//³õÊ¼½ÓÊÕ
 287   4              UART_Rec_Cnt = (uint8_t)1; //ÊýÁ¿
 288   4              //EUSART_Write('A');
 289   4            }
 290   3            else if(UART_RecState == UART_REC_STATE_HEADER_DET)//¼ì²â½ÓÊÕÍ·
 291   3            {//×¢Òâ:×îÖÕ8¸ö×Ö½Ú´æ·ÅµÄË³ÐòÊÇÏÈÊÕµ½µÄÔÚ×îµÍÎ»£¬Àý:ÊÕµ½µÄÊÇAXXLOGET£¬´æ·ÅµÄÊÇTEGOLXXA
 292   4              UART_Rec_Buf[UART_Rec_Cnt-(u8)1] = uart_data;//´ÓµÍ×Ö½ÚÍù¸ß×Ö½Ú´æ·Å
 293   4              if(UART_Rec_Cnt>=(uint8_t)2)//½ÓÊÕµ½3¸öÊý¾Ý RD 13
 294   4              {
 295   5                if((UART_Rec_Buf[0] == (uint8_t)'R')//Í·±êÖ¾ÅÐ¶Ï
 296   5                  &&(UART_Rec_Buf[1] == (uint8_t)'D'))
 297   5                {
 298   6              //              EUSART_Write_Str("HEAR_OK",7);
 299   6                  UART_RecState = UART_REC_STATE_DATA_TAIL_DET;//±êÖ¾OK£¬½ÓÊÕÊý¾Ý
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 6   

 300   6                  UART_RecBuf_Clear_Fun();//Çå¿Õ»º³åÇø  
 301   6                  UART_Rec_Cnt = (uint8_t)0; //ÊýÁ¿
 302   6                }
 303   5                else
 304   5                {
 305   6                  UART_Rec_Cnt--;//ÍùµÍÎ»ÒÆ
 306   6                  for(i=0;i<=(uint8_t)18;i++) //Êý¾ÝÍùµÍÎ»ÒÆÒ»Î»
 307   6                  {
 308   7                     UART_Rec_Buf[i] = UART_Rec_Buf[i+(u8)1];        
 309   7                  }//×¢Òâ:×îÖÕ8¸ö×Ö½Ú´æ·ÅµÄË³ÐòÊÇÏÈÊÕµ½µÄÔÚ×îµÍÎ»£¬Àý:ÊÕµ½µÄÊÇAXXLOGET£¬´æ·ÅµÄÊÇTEGOLXXA              
             - 
 310   6                }
 311   5              } 
 312   4            }
 313   3            else if(UART_RecState == UART_REC_STATE_DATA_TAIL_DET)//¼ì²âÊý¾ÝºÍ½áÎ²
 314   3            {
 315   4              UART_Rec_Buf[UART_Rec_Cnt-(u8)1] = uart_data;//´ÓµÍ×Ö½ÚÍù¸ß×Ö½Ú´æ·Å
 316   4      
 317   4              if(UART_Rec_Cnt>=(uint8_t)3)//×î¶à´æ·Å15¸öÊý¾Ý
 318   4              { 
 319   5                UART_RecState = UART_REC_STATE_DONE;//½ÓÊÕÍê³É        
 320   5              }
 321   4            }
 322   3            else
 323   3            {
 324   4              //do nothing
 325   4            }
 326   3              
 327   3            if(UART_RecState == UART_REC_STATE_DONE)//¼ì²âµ½Î²±êÖ¾
 328   3            {
 329   4              UART_RecState = UART_REC_STATE_READY; //×¼±¸ÏÂÒ»´Î¼ì²â
 330   4              
 331   4              Adress=UART_Rec_Buf[0];
 332   4              Adress=(Adress<<8)+UART_Rec_Buf[1]-(u8)1;
 333   4              Adress=(Adress<<4)+(UINT32)0x2000;
 334   4              SPI_Read_nBytes(Adress,16,&SaveData[0]);
 335   4              EUSART_Write_Str(&SaveData[0],16);//·¢ËÍ16¸ö×Ö½Ú¸øPC
 336   4            }           
 337   3          }
 338   2        }
 339   1      }
 340          
 341          void HeaterWireModeDetFunc(void)
 342          {
 343   1        if(Wire_Mode_Sel == Wire_Sel_Double)//Ë«Ö§¼ÓÈÈ»ØÂ·µ«Êµ¼ÊÎ´¼ì²âµ½IN»òOUT          
 344   1        {
 345   2          if((WireIn_State == (uint8_t)0)||(WireOut_State == (uint8_t)0)) 
 346   2          {
 347   3            Wire_Mode_Mismatch = (uint8_t)1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 348   3          }
 349   2          else
 350   2          {
 351   3            Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 352   3          }
 353   2        } 
 354   1        else if(Wire_Mode_Sel == Wire_Sel_In_Only)  //µ¥Ö§¼ÓÈÈ»ØÂ·µ«Êµ¼ÊÎ´¼ì²âµ½IN»ò¼ì²âµ½ÓÐOUT    
 355   1        {
 356   2          if((WireIn_State == (uint8_t)0)||(WireOut_State > (uint8_t)0))  
 357   2          {
 358   3            Wire_Mode_Mismatch = (uint8_t)1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 359   3          }
 360   2          else
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 7   

 361   2          {
 362   3            Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 363   3          }
 364   2        }
 365   1        else if(Wire_Mode_Sel == Wire_Sel_None) //ÎÞ¼ÓÈÈ»ØÂ·µ«Êµ¼Ê¼ì²âµ½ÓÐIN»òOUT
 366   1        {
 367   2          if((WireIn_State > (uint8_t)0)||(WireOut_State > (uint8_t)0)) 
 368   2          {
 369   3            Wire_Mode_Mismatch = (uint8_t)1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 370   3          }
 371   2          else
 372   2          {
 373   3            Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 374   3          }
 375   2        }
 376   1        else
 377   1        {
 378   2          //do nothing
 379   2        }
 380   1      }
 381          
 382          void RefreshTempHumidyFunc(uint8_t Refresh_En)//Ë¢ÐÂÏÔÊ¾ÎÂ¶ÈºÍÊª¶È
 383          {
 384   1        static uint8_t     Refresh_WenDu_Cnt = 0; 
 385   1        static uint8_t     Alarm_WenDu_Cnt = 0; 
 386   1      
 387   1        uint16_t Disp=0,color=0;
 388   1      
 389   1        uint16_t Temp_Dis_En = 0;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 390   1        uint8_t Disp_Err;
 391   1      
 392   1        Refresh_WenDu_Cnt++;
 393   1        if(Refresh_WenDu_Cnt > (uint8_t)5)//1.2S
 394   1        {
 395   2          Refresh_WenDu_Cnt = (uint8_t)0; 
 396   2        }
 397   1        
 398   1        Alarm_WenDu_Cnt++;
 399   1        if(Alarm_WenDu_Cnt > (uint8_t)1)
 400   1        {
 401   2          Alarm_WenDu_Cnt = (uint8_t)0;
 402   2        }
 403   1          
 404   1        
 405   1        Back_Color=WHITE18; 
 406   1        Disp_Err=(uint8_t)0;
 407   1      
 408   1      //  Temp_Dis_En = 0;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 409   1        if(Refresh_En!=(uint8_t)0)
 410   1        {
 411   2          Temp_Dis_En = (uint16_t)1;//Ç¿ÖÆË¢ÐÂÒ»´Î  
 412   2        }
 413   1      
 414   1        color=BLACK18;
 415   1        if((Bit_is_one(ERR_Kind,Alarm_Const_HiTemp)!=(uint8_t)0)   //»¼Õß¶Ë¸ßÎÂºìÉ«
 416   1          &&(Display_Temp_Kind==DISPLAY_Temperature_Patient))
 417   1        {
 418   2           Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 419   2           color=RED18; 
 420   2            if(Alarm_WenDu_Cnt == (uint8_t)1)
 421   2            {
 422   3              color=WHITE18;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 8   

 423   3            }
 424   2        }
 425   1        else if(((Bit_is_one(ERR_Kind,Alarm_Const_LoTemp)!=(uint8_t)0)&&((u8)Display_Temp_Kind==(u8)0))  //»¼Õß¶Ë
             -µÍÎÂºìÉ«
 426   1               ||((LoTemp_CQK_Count>(u8)120)&&((uint8_t)Display_Temp_Kind==(uint8_t)1)))  //³öÆø¿ÚµÍÎÂºìÉ«
 427   1        {
 428   2          Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 429   2          color=RED18;
 430   2          if(Alarm_WenDu_Cnt == (uint8_t)1)
 431   2          {
 432   3            color=WHITE18;
 433   3          }
 434   2        }
 435   1        else
 436   1        {
 437   2          if(Refresh_WenDu_Cnt == (uint8_t)0)
 438   2          {
 439   3            Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 440   3          }
 441   2        }
 442   1          
 443   1        if(Temp_Dis_En == (uint16_t)1)
 444   1        {     
 445   2          if(Display_Temp_Kind==DISPLAY_Temperature_Chamber)//³öÆø¿ÚÎÂ¶È
 446   2          {
 447   3            Disp=(uint16_t)CQK_Temp;
 448   3            Disp_Err=CQK_Sensor_Err; 
 449   3          }
 450   2          else if(Display_Temp_Kind==DISPLAY_Temperature_Patient) //ÈËÌå¶ËÎÂ¶È
 451   2          {
 452   3            Disp=Diplay_RTtemp;
 453   3            Disp_Err=RTD_Sensor_Err;
 454   3          }
 455   2          else
 456   2          {
 457   3            //do nothing
 458   3          }
 459   2          
 460   2          if(Disp_Err!=(uint8_t)0)
 461   2          {
 462   3             Draw_Rectangle_Real((POS_RT_TEMP_X+4),(POS_RT_TEMP_Y),(POS_RT_TEMP_X+56),(POS_RT_TEMP_Y+103),(WHITE18)
             -);     
 463   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+29,RED18);
 464   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+63,RED18);
 465   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y+73,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+102,RED18);
 466   3             //Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,RED18); //»­µã
             -  
 467   3          }
 468   2          else  if(Disp>=(uint16_t)1000)//ÏÔÊ¾ÎÂ¶È
 469   2          {
 470   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
 471   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);   
 472   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+73,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
 473   3            Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,(uint8_t)WHITE18)
             -; //È¥µôÐ¡Êýµã
 474   3          }
 475   2          else
 476   2          {
 477   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
 478   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
 479   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+(34*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
 480   3            Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,(uint8_t)color); 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 9   

             -//»­µã
 481   3          }
 482   2         }     
 483   1           
 484   1        //ÏÔÊ¾Êª¶È
 485   1        color=BLACK18;
 486   1        if((Bit_is_one(ERR_Kind,Alarm_Const_LoHumity))!=(uint8_t)0)   //µÍÊª¶È±¨¾¯
 487   1        {
 488   2          Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 489   2          color=RED18;
 490   2          if(Alarm_WenDu_Cnt == (uint8_t)1)
 491   2          {
 492   3            color=WHITE18;
 493   3          }
 494   2        }
 495   1        else
 496   1        {
 497   2          if(Refresh_WenDu_Cnt == (uint8_t)0)
 498   2          {
 499   3            Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾  
 500   3          }     
 501   2        }
 502   1            
 503   1        if(Temp_Dis_En == (uint16_t)1)
 504   1        {
 505   2          if(RTD_Sensor_Err!=(uint8_t)0)
 506   2          {     
 507   3            Draw_Rectangle_Real(POS_RT_RH_X+4 , POS_RT_RH_Y,POS_RT_RH_X+39,POS_RT_RH_Y+35,(uint8_t)WHITE18);   
 508   3            Draw_Rectangle_Real(POS_RT_RH_X , POS_RT_RH_Y,POS_RT_RH_X+3,POS_RT_RH_Y+16,(uint8_t)RED18);     
 509   3            Draw_Rectangle_Real(POS_RT_RH_X , POS_RT_RH_Y+19,POS_RT_RH_X+3,POS_RT_RH_Y+35,(uint8_t)RED18);       
 510   3          }
 511   2          else
 512   2          { 
 513   3            DISP_RH_17X40(POS_RT_RH_X,POS_RT_RH_Y,(uint8_t)(RT_SHIDU%(u16)1000/(u16)100),(uint8_t)color);
 514   3            DISP_RH_17X40(POS_RT_RH_X,POS_RT_RH_Y+19,(u8)(RT_SHIDU%(u16)100/(u16)10),(uint8_t)color);
 515   3          }
 516   2        } 
 517   1      }
 518          
 519          //---------Ë¢ÐÂÔËÐÐÊ±¼ä
 520          void RefreshRunTimeFunc(uint8_t Refresh_En)
 521          //Refresh_En 1-Ç¿ÖÆË¢ÐÂÒ»´Î£¬·ñÔòÃ¿·ÖÖÓË¢ÐÂÒ»´Î
 522          { 
 523   1        uint8_t t=0;
 524   1      //  uint8_t refreshEn=Refresh_En;
 525   1        static uint8_t Last_Sec = 60;   
 526   1        static uint8_t   Work_Min=0;
 527   1        static uint8_t   Work_Sec=0;
 528   1        static uint8_t   Work_Day=0;
 529   1        static uint8_t   Work_Hour=0;
 530   1        
 531   1        RX8010_GetTime(NowTime);  
 532   1        t = ((uint8_t)NowTime[0]&(uint8_t)0xF)%(u8)10;
 533   1        
 534   1        if(t != Last_Sec)//Ê±¼äÃëÓÐ±ä»¯
 535   1        {
 536   2          Last_Sec = t;
 537   2          if(Work_Sec<(uint8_t)59)
 538   2          {
 539   3            Work_Sec++;
 540   3          }
 541   2          else
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 10  

 542   2          {
 543   3            Work_Sec = 0;
 544   3            t = 0xff;//Ë¢ÐÂ±êÖ¾ 
 545   3            
 546   3            Enable_Save_Data=1;//±£´æ±êÖ¾Î»
 547   3            Run_Count++;//±£´æÊý¾ÝÌõÊý
 548   3      
 549   3            if(Work_Min<(uint8_t)59)
 550   3            {
 551   4              Work_Min++;
 552   4            }
 553   3            else
 554   3            {
 555   4              Work_Min=0;
 556   4              if(Work_Hour<(uint8_t)23)
 557   4              {
 558   5                Work_Hour++;
 559   5              }else
 560   4              {
 561   5                Work_Hour=0;
 562   5                if(Work_Day<(uint8_t)99)
 563   5                {
 564   6                  Work_Day++;
 565   6                }           
 566   5              }
 567   4            }
 568   3          }
 569   2        }
 570   1        
 571   1        if((Refresh_En!=(uint8_t)0)||(t == (uint8_t)0xff))
 572   1        {
 573   2      //    Refresh_En = 0;   
 574   2          if(Work_State != UI_STATE_SCREENSAVER_MODE)
 575   2          {
 576   3            Back_Color=WHITE18;
 577   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y-5,Work_Day/(u8)10,(uint8_t)BLACK18);
 578   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+6,Work_Day%(u8)10,(uint8_t)BLACK18);
 579   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+22,Work_Hour/(u8)10,(uint8_t)BLACK18);
 580   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+33,Work_Hour%(u8)10,(uint8_t)BLACK18);
 581   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+47,Work_Min/(u8)10,(uint8_t)BLACK18);
 582   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+58,Work_Min%(u8)10,(uint8_t)BLACK18);  
 583   3          }
 584   2        }
 585   1      }
 586          
 587          //---------Ë¢ÐÂRTCÊ±ÖÓ
 588          void RefreshRTCTimeFunc(void)
 589          {
 590   1        static uint8_t Last_Min=0;
 591   1      //  uint8_t color;
 592   1        uint8_t t=0;
 593   1        static uint8_t Last_Sec = 60;
 594   1      
 595   1        
 596   1      //Ê±¼ä×ª»»=================================================
 597   1        RX8010_GetTime(NowTime);  
 598   1        t = (NowTime[0]&(BYTE)0xF)%(u8)10;
 599   1        if(t != Last_Sec)//Ê±¼äÃëÓÐ±ä»¯
 600   1        {
 601   2          Last_Sec = t;
 602   2               
 603   2          if(Last_Min!=NowTime[1])
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 11  

 604   2          {
 605   3            Last_Min=NowTime[1];
 606   3          }
 607   2      //    color=BLACK18;    
 608   2          DisPlayTime(NowTime,2); //ÏÔÊ¾Ê±¼ä
 609   2          DisPlayTime(NowTime,3); //ÏÔÊ¾Ê±¼ä
 610   2          DisPlayTime(NowTime,4); //ÏÔÊ¾Ê±¼ä
 611   2          DisPlayTime(NowTime,5); //ÏÔÊ¾Ê±¼ä
 612   2          DisPlayTime(NowTime,6); //ÏÔÊ¾Ê±¼ä
 613   2          DisPlayTime(NowTime,7); //ÏÔÊ¾Ê±¼ä
 614   2        }
 615   1      }
 616          
 617          void GetTempHumidity_PatientFunc(void)
 618          {
 619   1        static uint8_t Get_time_out = 0;//³¬Ê±£¬Êµ²â64mS£¬×î³¤¸øµ½100mS
 620   1        static BYTE       Read_Order=0; 
 621   1        uint8_t Read_SHT21_Err=0;
 622   1      
 623   1        uint8_t Read_SCL_CONF;
 624   1        UINT32 TempLong;
 625   1        uint16_t  Temp2;
 626   1      
 627   1        static uint16_t RT_Temp_Mem_L1 = 0;
 628   1        static uint16_t RT_Temp_Mem_L2 = 0;
 629   1        static uint16_t RT_Temp_Mem_L3 = 0;
 630   1        static uint8_t ReCnt=0;
 631   1        
 632   1        ReCnt++;
 633   1        if(ReCnt > (u8)50)//1S
 634   1        {
 635   2          ReCnt = 0;  
 636   2          RT_Temp_Mem_L3 = RT_Temp_Mem_L2;
 637   2          RT_Temp_Mem_L2 = RT_Temp_Mem_L1;
 638   2          RT_Temp_Mem_L1 = (uint16_t)RT_Temp; 
 639   2          Diplay_RTtemp = (RT_Temp_Mem_L3+RT_Temp_Mem_L2+RT_Temp_Mem_L1) / (u16)3;  
 640   2        }
 641   1        
 642   1        //static int Ix=0;
 643   1      
 644   1        //Ix++;
 645   1        //LCD_ShowxNum(223,30,16,5,Ix,0x80,BLUE18);//   
 646   1      
 647   1      //  LCD_ShowxNum(223,10,16,3,RT_Temp_Not_Updated_10mS ,0x80,BLUE18);//  
 648   1      //  LCD_ShowxNum(223,70,16,3,No_ReadData_Temp_Times,0x80,BLUE18);//   
 649   1      //  LCD_ShowxNum(223,100,16,3,No_ReadData_SHIDU_Times,0x80,BLUE18);// 
 650   1      //  LCD_ShowxNum(223,130,16,3,ERR_RT_Temp_Times,0x80,BLUE18);// 
 651   1        
 652   1      //  EA = 0;
 653   1        if(RT_Temp_Not_Updated_10mS < (uint16_t)4000)
 654   1        {
 655   2          RT_Temp_Not_Updated_10mS++;
 656   2        }
 657   1        
 658   1        {
 659   2          if(Read_Order==(BYTE)0)   //·¢ÎÂ¶ÈÖ¸Áî      
 660   2          {
 661   3            Read_SHT21_Err = SHT21_WriteTemp(); 
 662   3            if(Read_SHT21_Err!=(uint8_t)0)
 663   3            {
 664   4              Read_Order = 0;//½ÓÊÕ´íÎó
 665   4            }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 12  

 666   3            else
 667   3            {       
 668   4              Read_Order = 1;
 669   4              Get_time_out = 0;
 670   4            }
 671   3          }
 672   2          else if(Read_Order == (BYTE)1)  //ÎÂ¶ÈÊý¾Ý½ÓÊÕ
 673   2          {
 674   3            //SCL_INPUT_HIGH(); // set SCL I/O port as input
 675   3            Read_SCL_CONF=SCL_CONF;
 676   3            if(Read_SCL_CONF==(uint8_t)1)
 677   3            {
 678   4              Get_time_out = 0;
 679   4              TempLong =  SHT21_ReadData();
 680   4              //RT_Temp_Test = TempLong;
 681   4                //LCD_ShowxNum(223,160,16,5,TempLong,0x80,BLUE18);//  
 682   4                
 683   4              if((TempLong == (UINT32)SHT21_ERROR) || ((TempLong & (UINT32)0x8000)!=(UINT32)0)) //¶ÁÈ¡³ö´í£¬ºóÃæÎªÊ
             -ª¶È±êÖ¾Î»
 684   4              {
 685   5                //if(No_ReadData_Temp_Times<250) No_ReadData_Temp_Times++;  
 686   5                Read_Order = 0;   
 687   5              }
 688   4              else
 689   4              {         
 690   5                No_ReadData_Temp_Times = 0;
 691   5                Read_Order = 2; 
 692   5                          
 693   5                if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÎÂ¶È
 694   5                {
 695   6                  if(WireIn_State!=(uint8_t)0)    //ÓÐ¼ÓÈÈË¿Ïß½øÐÐÎÂ¶ÈÐÞÕý
 696   6                  {
 697   7                    TempLong=(TempLong*(UINT32)101/(UINT32)100)-((UINT32)4*TempLong/(UINT32)388);
 698   7                  }
 699   6                  else
 700   6                  {
 701   7                    TempLong=TempLong-((UINT32)4*TempLong/(UINT32)400); 
 702   7                  }
 703   6                     
 704   6      
 705   6                  if(TempLong>=(UINT32)350)   //ÎÂ¶ÈÐÞÕý
 706   6                  {
 707   7                    TempLong=TempLong+((UINT32)6*(TempLong-(UINT32)350)/(UINT32)45);
 708   7                  }
 709   6                    
 710   6                    
 711   6                  if(TempLong>(UINT32)800) //Èç¹ûÈËÌå¶Ë´ïµ½80ËµÃ÷ÓÐÒì³££¬³ö´í±¨¾¯ //2014-07-07 
 712   6                  {
 713   7                    if(ERR_RT_Temp_Times<(UINT32)100)
 714   7                    {
 715   8                      ERR_RT_Temp_Times++;
 716   8                    }
 717   7                  }
 718   6                  else 
 719   6                  {
 720   7                    ERR_RT_Temp_Times=0;
 721   7                    RT_Temp=(INT)TempLong;
 722   7                    RT_Temp_Not_Updated_10mS = 0;
 723   7                  }            
 724   6                }
 725   5                else
 726   5                {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 13  

 727   6                  RT_Temp=(INT)TempLong;
 728   6                  RT_Temp_Not_Updated_10mS = 0;
 729   6                }
 730   5              } 
 731   4            }
 732   3            else
 733   3            {
 734   4              //CONTROL_RT_SHIDU = 0;       
 735   4            }     
 736   3            //LCD_ShowxNum(223,150,16,3,RT_Temp,0x80,BLUE18);// 
 737   3      
 738   3          }
 739   2          else if(Read_Order==(BYTE)2)  //·¢Êª¶ÈÖ¸Áî
 740   2          {                    
 741   3            Read_SHT21_Err = SHT21_WriteRH();
 742   3            if(Read_SHT21_Err!=(uint8_t)0)
 743   3            {
 744   4              Read_Order = 2;//½ÓÊÕ´íÎó
 745   4            }
 746   3            else
 747   3            {       
 748   4              Read_Order = 3;
 749   4              Get_time_out = 0;
 750   4            }
 751   3          }     
 752   2          else  if(Read_Order == (BYTE)3)//Êª¶ÈÊý¾Ý½ÓÊÕ
 753   2          {
 754   3            //SCL_INPUT_HIGH(); // set SCL I/O port as input
 755   3            Read_SCL_CONF=SCL_CONF;
 756   3            if(Read_SCL_CONF==(uint8_t)1)
 757   3            { 
 758   4              //Read_Order = 0;
 759   4              Get_time_out = 0;
 760   4              TempLong =  SHT21_ReadData();
 761   4              //LCD_ShowxNum(223,210,16,5,TempLong,0x80,BLUE18);//  
 762   4              if((TempLong == (UINT32)SHT21_ERROR)||((TempLong & (UINT32)0x8000) ==(UINT32)0)) //¶ÁÈ¡³ö´í
 763   4              {
 764   5                if(No_ReadData_SHIDU_Times<(uint8_t)250)
 765   5                {
 766   6                  No_ReadData_SHIDU_Times++;
 767   6                }           
 768   5                CONTROL_RT_SHIDU = 0;
 769   5                Read_Order = 2; 
 770   5      
 771   5              }
 772   4              else
 773   4              {
 774   5                Read_Order = 0; 
 775   5                TempLong &= (UINT32)0x7fff;//×î¸ßÎ»ÊÇ1²ÅÊÇÊª¶È
 776   5                No_ReadData_SHIDU_Times = (uint8_t)0;
 777   5                if(TempLong > (UINT32)999)
 778   5                {
 779   6                  TempLong = 999;
 780   6                }  
 781   5                RT_SHIDU=TempLong;
 782   5                CONTROL_RT_SHIDU=TempLong;  //¿ØÖÆÊª¶È
 783   5                //75%ÒÔÉÏ½øÐÐÐ£×¼
 784   5                if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÊª¶È
 785   5                {
 786   6                  if(RT_Temp>300)
 787   6                  {                  
 788   7                    if(TempLong>(UINT32)550)
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 14  

 789   7                    {            
 790   8                      Temp2=(TempLong-(UINT32)550)*(UINT32)80/(UINT32)100; //16-05-06
 791   8                      if(Temp2>(u16)249)
 792   8                      {
 793   9                        Temp2=249;
 794   9                      }                     
 795   8                    }
 796   7                    else
 797   7                    {
 798   8                      Temp2 = 0;
 799   8                    }               
 800   7                    RT_SHIDU=TempLong + Temp2;  //2014-07-25
 801   7                  }
 802   6                  else
 803   6                  {                 
 804   7                    RT_SHIDU=TempLong;   //2014-07-18
 805   7                    //RT_SHIDU=TempLong+120;      
 806   7                  } 
 807   6                  
 808   6                  if(RT_Temp>350)
 809   6                  { 
 810   7                     RT_SHIDU=RT_SHIDU+((u16)180*((uint16_t)RT_Temp-(u16)350)/(u16)100);  //ÏÔÊ¾Êª¶È 16-05-06
 811   7                  }
 812   6                }
 813   5                else
 814   5                {
 815   6                  //do nothing
 816   6                } 
 817   5                RT_SHIDU += (u16)5; //ËÄÉáÎåÈë          
 818   5                if(RT_SHIDU>(uint16_t)999)
 819   5                {
 820   6                  RT_SHIDU=(uint16_t)999;//;  
 821   6                }            
 822   5              }
 823   4            }
 824   3            else
 825   3            {
 826   4                //do nothing
 827   4            }
 828   3          //LCD_ShowxNum(223,130,16,3,RT_SHIDU,0x80,BLUE18);//
 829   3            
 830   3          }
 831   2          else
 832   2          {
 833   3            //do nothing
 834   3          }
 835   2        
 836   2          if((Read_SHT21_Err!=(uint8_t)0)||(RT_SHIDU == (uint16_t)0))
 837   2          { 
 838   3            if(No_ReadData_SHIDU_Times<(uint8_t)100)
 839   3            {
 840   4              No_ReadData_SHIDU_Times++;
 841   4            }       
 842   3            if(No_ReadData_Temp_Times<(u8)100)
 843   3            {
 844   4              No_ReadData_Temp_Times++;
 845   4            }       
 846   3           
 847   3          }
 848   2          else  
 849   2          {
 850   3            No_ReadData_SHIDU_Times=(uint8_t)0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 15  

 851   3            No_ReadData_Temp_Times=0;
 852   3          } 
 853   2      
 854   2          Get_time_out++;
 855   2          if(Get_time_out >(u8)100)//³¬¹ý100mS
 856   2          {
 857   3            Get_time_out = 0;
 858   3            if(Read_Order == (BYTE)1)
 859   3            {
 860   4              Read_Order = 0;
 861   4            }
 862   3            else if(Read_Order == (BYTE)3)
 863   3            {
 864   4              Read_Order = 2;
 865   4            }
 866   3            else
 867   3            {
 868   4              Read_Order = 0;
 869   4            }       
 870   3          }        
 871   2        }
 872   1      }
 873          
 874          
 875          void GetTemp_HpChamberFunc(void)
 876          {
 877   1      //  bit HeaterSensorExist;
 878   1        uint8_t CQKSensorExist=0;
 879   1      
 880   1        //  static uint16_t CQK_Temp_Not_Updated_40mS = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼äS
 881   1        //  static uint16_t JRP_Temp_Not_Updated_S = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼äS
 882   1      
 883   1        uint8_t T18B20_L;
 884   1        uint8_t T18B20_H;
 885   1        uint8_t CQK_T18B20_L;
 886   1        uint8_t CQK_T18B20_H; 
 887   1      
 888   1        uint8_t T18B20_H_GET;
 889   1        uint8_t T18B20_L_GET;
 890   1        uint8_t CQK_T18B20_H_GET;
 891   1        uint8_t CQK_T18B20_L_GET;
 892   1      
 893   1      
 894   1        static uint16_t CQK_Temp_Last=0;
 895   1        uint8_t CRC8_error=0;   //checksum
 896   1        uint8_t checksum=0;   //checksum
 897   1        uint8_t DS18B20_Cdata[8];    //data array for checksum verification 
 898   1      
 899   1        uint16_t temp=0;
 900   1        static uint16_t JRP_Temp_Last=0;
 901   1      
 902   1        static uint8_t Get_Temp_Cnt=0;
 903   1      
 904   1        Get_Temp_Cnt++;
 905   1        if(Get_Temp_Cnt > (u8)3)
 906   1        {
 907   2          Get_Temp_Cnt = 0;
 908   2        }
 909   1        
 910   1        if(No_CQKSensor_Times<(u16)2000)
 911   1        {
 912   2          No_CQKSensor_Times++;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 16  

 913   2        }
 914   1        if(No_HeatSensor_Times<(u8)200)
 915   1        {
 916   2          No_HeatSensor_Times++;
 917   2        }
 918   1        
 919   1        if(Get_Temp_Cnt == (u8)0)  //
 920   1        {
 921   2          HeatingPlateSensor_Port=(bit)0;                                //Ö÷»úÀ­ÖÁµÍµçÆ½
 922   2          ChamberOutletSensor_Port=(bit)0;
 923   2          delay_us(609);                                //609
 924   2          HeatingPlateSensor_Port=(bit)1;                                //ÊÍ·Å×ÜÏßµÈµç×èÀ­¸ß×ÜÏß,²¢±£³Ö15~60us
 925   2          ChamberOutletSensor_Port=(bit)1;
 926   2          delay_us(86);                           //ÑÓÊ±70us                     //ÑÓÊ±70us
 927   2      //    HeaterSensorExist=HeatingPlateSensor_Port;                //½ÓÊÕÓ¦´ðÐÅºÅ
 928   2      //    CQKSensorExist=ChamberOutletSensor_Port;
 929   2          delay_us(488);                                //403
 930   2          DS18B20_WriteByte(0xCC);                      //Ìø¹ýROMÃüÁî
 931   2          DS18B20_WriteByte(0x44);                      //¿ªÊ¼×ª»»ÃüÁî
 932   2        }
 933   1        else if(Get_Temp_Cnt == (u8)2) //
 934   1         //½øÐÐÎÂ¶È×ª»»
 935   1        {
 936   2          HeatingPlateSensor_Port=(bit)0;                                //Ö÷»úÀ­ÖÁµÍµçÆ½
 937   2          ChamberOutletSensor_Port=(bit)0;
 938   2          delay_us(609);                                //503us
 939   2          HeatingPlateSensor_Port=(bit)1;                                //ÊÍ·Å×ÜÏßµÈµç×èÀ­¸ß×ÜÏß,²¢±£³Ö15~60us
 940   2          ChamberOutletSensor_Port=(bit)1;
 941   2          delay_us(86);                           //ÑÓÊ±70us
 942   2      //    HeaterSensorExist=HeatingPlateSensor_Port;                //½ÓÊÕÓ¦´ðÐÅºÅ
 943   2          CQKSensorExist=ChamberOutletSensor_Port;
 944   2          delay_us(488);
 945   2          DS18B20_WriteByte(0xCC);                      //Ìø¹ýROMÃüÁî
 946   2          DS18B20_WriteByte(0xBE);                      //¶ÁÔÝ´æ´æ´¢Æ÷ÃüÁî
 947   2          delay_us(10);
 948   2          DS18B20_ReadByte();                           //¶ÁÎÂ¶ÈµÍ×Ö½Ú
 949   2          T18B20_L=Read_18B20_Value;
 950   2          CQK_T18B20_L=Read_18B20_Value2;
 951   2          DS18B20_ReadByte();                           //¶ÁÎÂ¶È¸ß×Ö½Ú
 952   2          T18B20_H=Read_18B20_Value;
 953   2          CQK_T18B20_H=Read_18B20_Value2;
 954   2        
 955   2          if((CQKSensorExist==(uint8_t)0))//´íÎóÔò²»½øÐÐÐ£Ñé
 956   2          {
 957   3            DS18B20_Cdata[0] = CQK_T18B20_L;
 958   3            DS18B20_Cdata[1] = CQK_T18B20_H;
 959   3            DS18B20_ReadByte();  
 960   3            DS18B20_Cdata[2] = Read_18B20_Value2;
 961   3            DS18B20_ReadByte();  
 962   3            DS18B20_Cdata[3] = Read_18B20_Value2;
 963   3            DS18B20_ReadByte();  
 964   3            DS18B20_Cdata[4] = Read_18B20_Value2;
 965   3            DS18B20_ReadByte();  
 966   3            DS18B20_Cdata[5] = Read_18B20_Value2;
 967   3            DS18B20_ReadByte();  
 968   3            DS18B20_Cdata[6] = Read_18B20_Value2;
 969   3            DS18B20_ReadByte();  
 970   3            DS18B20_Cdata[7] = Read_18B20_Value2;
 971   3            DS18B20_ReadByte();  
 972   3            checksum = Read_18B20_Value2;     
 973   3            //Cdata[7] = 0x11; //test CRC
 974   3      
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 17  

 975   3            CRC8_error = DS18B20_CheckCrc(DS18B20_Cdata,8,checksum); 
 976   3              
 977   3            if(CRC8_error == (u8)CHECKSUM_ERROR)
 978   3            {
 979   4              CQKSensorExist = (uint8_t)1;
 980   4            }          
 981   3             
 982   3            if((CQKSensorExist==(uint8_t)0))//
 983   3            {
 984   4              CQK_T18B20_H_GET = CQK_T18B20_H;
 985   4              CQK_T18B20_L_GET = CQK_T18B20_L;
 986   4      
 987   4              CQK_T18B20_H_GET = (uint8_t)((CQK_T18B20_H_GET << 4) | (CQK_T18B20_L_GET >> 4));      //¼ÓÈÈÅÌÎÂ¶ÈÖµºÏ²¢¸
             -ßµÍÎ»´æÈëÕûÊýÎ»
 988   4              if((CQK_T18B20_H_GET&(uint8_t)0x80)!=(uint8_t)0)//ÊÇ¸ºÊý
 989   4              {
 990   5                CQK_T18B20_L_GET =(((~CQK_T18B20_L_GET)&(uint8_t)0x0F)*(u8)10)/(u8)16;
 991   5                temp=((~CQK_T18B20_H_GET)*(u16)10)+(u16)CQK_T18B20_L_GET;
 992   5              } 
 993   4              else
 994   4              {
 995   5                CQK_T18B20_L_GET = ((CQK_T18B20_L_GET&(uint8_t)0x0F)*(u8)10)/(u8)16;
 996   5                temp=(CQK_T18B20_H_GET*(u16)10)+(u16)CQK_T18B20_L_GET;
 997   5              }
 998   4          
 999   4              if((CQK_Temp_Last ==  temp) && (temp == (u16)850))  //´íÎóÊ±Ò»Ö±ÏÔÊ¾85¶È 2014-07-18
1000   4              {
1001   5                CQK_Sensor_Temp_No_Change_Times++;//2014-07-03 ³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷ÎÂ¶ÈÏàÍ¬µÄ´ÎÊý
1002   5                if(CQK_Sensor_Temp_No_Change_Times > (u16)10000)
1003   5                {
1004   6                  CQK_Sensor_Temp_No_Change_Times =10000;
1005   6                }
1006   5              }
1007   4              else
1008   4              {
1009   5                CQK_Sensor_Temp_No_Change_Times = 0;    
1010   5              }
1011   4               
1012   4              if(temp > (u16)800)
1013   4              {
1014   5              //           if(CQKSensor_Hithen800_Times < 2000) CQKSensor_Hithen800_Times++;            
1015   5              }
1016   4              else
1017   4              {
1018   5                CQKSensor_Hithen800_Times = 0;
1019   5              }         
1020   4      
1021   4              if(((CQK_Temp_Last >=  temp) && ((CQK_Temp_Last - temp) < (u16)200))
1022   4              ||((CQK_Temp_Last <=  temp) && ((temp - CQK_Temp_Last)  < (u16)200)))//EFT¶Ô²ß£ºÎÂ¶È²»ÄÜË²±ä,1S±ä»¯²»Ä
             -Ü³¬¹ý20¶È
1023   4              { 
1024   5                if((temp > (u16)0)&&(temp < (u16)850))//²»¶ÁÁã
1025   5                {
1026   6                  CQK_Temp = (LONG)temp;//ÊµÊ±ÏÔÊ¾ÎÂ¶È
1027   6                  if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÎÂ¶È
1028   6                  {
1029   7                    CQK_Temp=CQK_Temp*51/50;  
1030   7                  }
1031   6                }
1032   5              }
1033   4              else
1034   4              {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 18  

1035   5                //do nothing
1036   5              } 
1037   4              CQK_Temp_Last =  temp;  
1038   4            }
1039   3          }
1040   2           
1041   2      //    if(CQKSensorExist==1)// || CQK_Temp > 800)
1042   2      //    {
1043   2      //    //        if(No_CQKSensor_Times<2000)No_CQKSensor_Times++;          
1044   2      //    }
1045   2      //    else
1046   2          {
1047   3            No_CQKSensor_Times=0; 
1048   3          }
1049   2      
1050   2          T18B20_H_GET = T18B20_H;
1051   2          T18B20_L_GET = T18B20_L;
1052   2      
1053   2          if(Work_State == UI_STATE_SERVICE_MODE)//ÔÚ²âÊÔÄ£Ê½Ê±ÏÔÊ¾¶ÁÈ¡µÄÊý¾Ý
1054   2          {
1055   3      //      LCD_ShowxNum(10,220,24,3,T18B20_H_GET,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ¼ÓÈÈÅÌ
1056   3      //      LCD_ShowxNum(10,268,24,3,T18B20_L_GET,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾
1057   3          }    
1058   2      
1059   2      
1060   2          T18B20_H_GET = (uint8_t)((T18B20_H_GET << 4) | (T18B20_L_GET >> 4));      //¼ÓÈÈÅÌÎÂ¶ÈÖµºÏ²¢¸ßµÍÎ»´æÈëÕûÊýÎ
             -»
1061   2          if((T18B20_H_GET&(uint8_t)0x80)!=(uint8_t)0)//ÊÇ¸ºÊý
1062   2          {
1063   3            T18B20_L_GET =(((~T18B20_L_GET)&(uint8_t)0x0F)*(u8)10)/(u8)16;
1064   3            temp=((~T18B20_H_GET)*(u16)10)+(u16)T18B20_L_GET;
1065   3          } 
1066   2          else
1067   2          {
1068   3            T18B20_L_GET = ((T18B20_L_GET&(uint8_t)0x0F)*(u8)10)/(u8)16;
1069   3            temp=(T18B20_H_GET*(u16)10)+(u16)T18B20_L_GET;
1070   3          }
1071   2            
1072   2             
1073   2          if((JRP_Temp_Last ==  temp))// && (temp == 850))  //´íÎóÊ±Ò»Ö±ÏÔÊ¾85¶È 2014-07-18
1074   2          {
1075   3            JRP_Sensor_Temp_No_Change_Times++;//2014-07-03 ¼ÓÈÈÅÌÎÂ¶È´«¸ÐÆ÷ÎÂ¶ÈÏàÍ¬µÄ´ÎÊý
1076   3            if(JRP_Sensor_Temp_No_Change_Times > (u16)6000)
1077   3            {
1078   4              JRP_Sensor_Temp_No_Change_Times = 6000;
1079   4            }
1080   3          }
1081   2          else
1082   2          {
1083   3            JRP_Sensor_Temp_No_Change_Times = 0;
1084   3          }
1085   2          JRP_Temp_Last =  temp;    
1086   2      
1087   2          JEP_Temp =  (INT)temp;    //ÊµÊ±ÏÔÊ¾ÎÂ¶È
1088   2      
1089   2      //    if(HeaterSensorExist==1 || JEP_Temp>=0x0FFF || JEP_Temp > 1250)
1090   2      //    {
1091   2      ////       if(No_HeatSensor_Times<2000)No_HeatSensor_Times++; 
1092   2      //    }
1093   2      //    else
1094   2          {
1095   3            No_HeatSensor_Times=0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 19  

1096   3          }
1097   2        }
1098   1        else
1099   1        {
1100   2          //do nothing
1101   2        }
1102   1      } 
1103          
1104          
1105          static INT  Temp2_Int = 400;
1106          static uint16_t NoneWire_Heat_Sec=0;
1107          static INT  Set_CQK_Temp_Comp;//³öÆø¿ÚÐ£Õý¹ýºóµÄÄ¿±êÎÂ¶È
1108          void  HeaterPlateWireControlFunc(void)//ÎÂ¶È¿ØÖÆ
1109          {
1110   1        //    uint8_t  Temp3;
1111   1        uint16_t  Val_Calc=0;
1112   1      
1113   1        INT  Humidity_Err=0; //Î´´ïµ½Ä¿±êÊª¶ÈµÄ²îÖµ
1114   1        INT  Humidity_Comp=0;//³¬¹ýÄ¿±êÎÂ¶ÈµÄ²îÖµ 
1115   1        static uint16_t Last_Rem_Humidity=0;  
1116   1        static uint16_t   Aim_SHIDU=900;  //Ä¿±êÊª¶È 
1117   1        static INT  Temp1_Int = 260;
1118   1        
1119   1        static uint16_t WarmUp_S_Cnt=0; 
1120   1        //uint16_t  CQK_Vaul_Err;//²îÖµ
1121   1      
1122   1        if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == (u8)1))
1123   1        { //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ³öÆø¿Ú
1124   2          Back_Color=WHITE18;
1125   2          LCD_ShowxNum(POS_RT_RH_X-50,5,16,2,Micro_Adj_Mode_Test,0x80,BLACK18); //·¢ÈÈÅÌ¼ÓÈÈµÄÄ£Ê½ÏÔÊ¾
1126   2          LCD_ShowxNum(POS_RT_RH_X-50,34,16,4,(u32)JEP_Temp,0x80,BLACK18); //·¢ÈÈÅÌµÄÎÂ¶È
1127   2          LCD_ShowxNum(POS_RT_RH_X-50,73,16,3,(u32)CQK_Temp,0x80,BLACK18); //³öÆø¿ÚµÄÎÂ¶È
1128   2          LCD_ShowxNum(POS_RT_RH_X-50,107,16,3,Set_CQK_Temp,0x80,BLACK18); //³öÆø¿ÚÉè¶¨ÎÂ¶È
1129   2          LCD_ShowxNum(POS_RT_RH_X-50,141,16,3,Micro_Temp_Val,0x80,BLACK18); //·¢ÈÈÅÌµÄ¼ÓÈÈÊ±³¤
1130   2          
1131   2          LCD_ShowxNum(POS_RT_RH_X-50,185,16,3,CONTROL_RT_SHIDU,0x80,BLACK18); //ÕæÊµÏà¶ÔÊª¶È
1132   2          LCD_ShowxNum(POS_RT_RH_X-50,219,16,3,Aim_SHIDU,0x80,BLACK18); //Ä¿±êÊª¶È
1133   2          LCD_ShowxNum(POS_RT_RH_X-50,253,16,3,Micro_Temp_In,0x80,BLACK18); //In¼ÓÈÈÊ±³¤
1134   2          LCD_ShowxNum(POS_RT_RH_X-50,287,16,3,Micro_Temp_Out,0x80,BLACK18); //Exp¼ÓÈÈÊ±³¤
1135   2          
1136   2          LCD_ShowxNum(POS_RT_RH_X-33,2,16,1,(u32)Wire_Mode_Sel,0x80,BLACK18); //¼ÓÈÈË¿Ä£Ê½     
1137   2          LCD_ShowxNum(POS_RT_RH_X-33,10,16,1,WireIn_State,0x80,BLACK18); //IN¼ÓÈÈË¿×´Ì¬
1138   2          LCD_ShowxNum(POS_RT_RH_X-33,18,16,1,WireOut_State,0x80,BLACK18); //EXP¼ÓÈÈË¿×´Ì¬  
1139   2            
1140   2          //LCD_ShowxNum(POS_RT_RH_X-20,185,16,1,SHT21_Heater_State,0x80,BLACK18); //SHT¼ÓÈÈ×´Ì¬
1141   2          LCD_ShowxNum(POS_RT_RH_X-33,253,16,3,Wire_Warm_Up_Sec,0x80,BLACK18); //600S¼ÆÊ± 
1142   2          LCD_ShowxNum(POS_RT_RH_X-33,107,16,3,(u32)Set_CQK_Temp_Comp,0x80,BLACK18); //Ð£Õý¹ýºóµÄ³öÆø¿ÚÄ¿±êÊª¶È
1143   2          //LCD_ShowxNum(POS_RT_RH_X-33,141,16,3,Plate_Warm_Up_Sec,0x80,BLACK18); //600S¼ÆÊ±  
1144   2          LCD_ShowxNum(POS_RT_RH_X-33,185,16,3,Humidity_No_Change_Sec,0x80,BLACK18); //600S¼ÆÊ±     
1145   2          
1146   2          if(WireIn_State!=(u8)0) //ÓÐ·¢ÈÈË¿
1147   2          {
1148   3            LCD_ShowxNum(POS_RT_RH_X-33,34,16,4,(u32)JEP_Temp_Aim,0x80,BLACK18); //·¢ÈÈÅÌµÄÄ¿±êÎÂ¶È
1149   3            LCD_ShowxNum(POS_RT_RH_X-16,34,16,3,WarmUp_S_Cnt,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±¸Ä±äÊ±¼ä  
1150   3      
1151   3            if(Controler_temp3.Sum_error >0)
1152   3            {
1153   4              LCD_ShowxNum(POS_RT_RH_X+41,20,16,1,1,0x80,BLACK18); //
1154   4            }
1155   3            else
1156   3            {
1157   4              LCD_ShowxNum(POS_RT_RH_X+41,20,16,1,0,0x80,BLACK18); //
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 20  

1158   4            }
1159   3              
1160   3      
1161   3            LCD_ShowxNum(POS_RT_RH_X+41,34,16,4,(u32)(abs(Controler_temp3.Sum_error)),0x80,BLACK18); //
1162   3      
1163   3      
1164   3            if(Controler_temp2.Sum_error >0)
1165   3            {
1166   4              LCD_ShowxNum(POS_RT_RH_X+41,80,16,1,1,0x80,BLACK18); //
1167   4            }
1168   3            else
1169   3            {
1170   4              LCD_ShowxNum(POS_RT_RH_X+41,80,16,1,0,0x80,BLACK18); //
1171   4            }
1172   3              
1173   3      
1174   3            LCD_ShowxNum(POS_RT_RH_X+41,94,16,4,(u32)(abs(Controler_temp2.Sum_error)),0x80,BLACK18); //
1175   3          }
1176   2          else
1177   2          {
1178   3            LCD_ShowxNum(POS_RT_RH_X-33,34,16,4,(u32)Temp2_Int,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±·¢ÈÈÅÌµÄÄ¿±êÎÂ¶È
1179   3            LCD_ShowxNum(POS_RT_RH_X-16,34,16,3,NoneWire_Heat_Sec,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±¸Ä±äÊ±¼ä 
1180   3          }
1181   2            
1182   2          LCD_ShowxNum(POS_RT_RH_X+40,170,16,3,(u32)Temp1_Int,0x80,BLACK18); //¿ª»ú½¥½øÊ½ÎÂ¶ÈÄ¿±ê
1183   2          LCD_ShowxNum(POS_RT_RH_X+20,170,16,3,(u32)RT_Temp,0x80,BLACK18); //»¼Õß¶ËÎÂ¶È
1184   2          LCD_ShowxNum(POS_RT_RH_X+20,210,16,4,Nochange_Times,0x80,BLACK18); //ÎÂÊª¶ÈÁ¬Ðø²»±ä¼ÆÊý   
1185   2      
1186   2          LCD_ShowxNum(2,2,16,5,Working_Normal,0x80,BLACK18); //Õý³£¹¤×÷Ê±¼ä¼ÆÊ±  
1187   2          LCD_ShowxNum(2,60,16,5,HP_CNT_Int_End_Rem,0x80,BLACK18); //ÏÔÊ¾Ã¿4Ãë¼ÓÈÈÅÌ·½²¨µÄ´ÎÊý      
1188   2        }
1189   1      
1190   1        if(        
1191   1          ((ERR_Kind & (uint8_t)0x01)!=(uint8_t)0)//´«¸ÐÆ÷´íÎó        
1192   1          ||((ERR_Kind & (uint8_t)0x02)!=(uint8_t)0) //¸ßÎÂ
1193   1          ||((ERR_Kind & (uint8_t)0x10)!=(uint8_t)0) //ÎÞË®   
1194   1          || (Wire_Mode_Mismatch == (uint8_t)1)  //·¢ÈÈË¿Î´Ñ¡
1195   1          || (HeaterPlate_State==(uint8_t)0))//Ë®¹ÞÎ´×°ºÃ
1196   1        {
1197   2          Micro_Temp_In=0;
1198   2          Micro_Temp_Out=0;
1199   2          Micro_Temp_Val=0;  //Í£Ö¹¼ÓÈÈ
1200   2          Micro_Adj_Mode_Test = 1;//¼ÓÈÈÄ£Ê½²âÊÔ
1201   2          Wire_Warm_Up_Sec = 0; //µ±<=300Ê±ÏÞÖÆ×î´ó¼ÓÈÈ¹¦ÂÊ  
1202   2          //Plate_Warm_Up_Sec = 0;
1203   2          Humidity_No_Change_Sec = 0;     
1204   2        }
1205   1        else
1206   1        {       
1207   2          //¹ÜÄÚ·¢ÈÈË¿¹¤×÷,¿ØÖÆÎÂ¶Èµ÷½Ú==========================       
1208   2      
1209   2          if(Work_Mode==(u8)Noninvasive_Mode) //ÎÞ´´Ä£Ê½Ê±,ÈËÌå¶ËÎÂ¶È¶ÔÄ¿±êÊª¶ÈµÄ¿ØÖÆÂß¼­
1210   2          {       
1211   3            Aim_SHIDU=790;  
1212   3          }else   //ÓÐ´´Ä£Ê½Ê±,ÈËÌå¶ËÎÂ¶È¶ÔÄ¿±êÊª¶ÈµÄÓ°Ïì
1213   2          {
1214   3            Aim_SHIDU=890; //2014-11-21 
1215   3          }
1216   2      
1217   2          Val_Calc = 0;       
1218   2          //if(Boot_Start_RT_Temp_Heating_Timer_Sec > 300) //»¼Õß¶Ë¿ª»ú½¥½øÊ½¼ÓÈÈ½áÊø
1219   2          if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 21  

1220   2          {//»ØÂ··¢ÈÈË¿µÄ¿ØÖÆ
1221   3            if(WireIn_State!=(u8)0)   //µ±ÓÐ¹ÜÄÚIN·¢ÈÈË¿Ê±£¬¹ÜÄÚ·¢ÈÈË¿µÄ¼ÓÈÈÂß¼­
1222   3            {
1223   4              if(Working_Normal >= (u16)1200)
1224   4              {
1225   5                Temp1_Int = Set_RT_Temp;//20·ÖÖÓÒÔºóÎªÉè¶¨ÎÂ¶È
1226   5              }
1227   4              else
1228   4              {           
1229   5                Temp1_Int = CQK_Temp + 30;//20·ÖÖÓÒÔÇ°¸úËæ³öÆø¿ÚÎÂ¶È
1230   5              }
1231   4              if(Temp1_Int > Set_RT_Temp)
1232   4              {
1233   5                Temp1_Int = Set_RT_Temp;
1234   5              }
1235   4                
1236   4                
1237   4              //Controler_temp.Ek = Set_RT_Temp - RT_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1238   4              Controler_temp.Ek = Temp1_Int - RT_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1239   4              Controler_Calc(); 
1240   4              Val_Calc = (uint8_t)Controler_temp.Uk;  //¼ÆËã³ö¼ÓÈÈÊ±¼ä          
1241   4                
1242   4              if(WireIn_State!=(u8)0)
1243   4              {
1244   5                if (RT_Temp<(Set_RT_Temp-20))
1245   5                {
1246   6                  //do nothing
1247   6                }
1248   5                else if (RT_Temp<(Set_RT_Temp-10))
1249   5                {
1250   6                  //do nothing
1251   6                }
1252   5                else if (RT_Temp<=Set_RT_Temp)
1253   5                {
1254   6                  //do nothing
1255   6                }
1256   5                else if (RT_Temp<=(Set_RT_Temp+10))
1257   5                {
1258   6                  //do nothing
1259   6                }
1260   5                else
1261   5                {
1262   6                  Val_Calc=0; 
1263   6                }
1264   5              }
1265   4              else
1266   4              {
1267   5                     Val_Calc=0;
1268   5              }
1269   4            } 
1270   3            else    //µ±ÎÞ¹ÜÄÚ·¢ÈÈË¿Ê±
1271   3            {
1272   4              Val_Calc=0;
1273   4            }
1274   3              
1275   3            if(Working_Normal >= (u16)1200)//Õý³£¹¤×÷20·ÖÖÓÖ®ºó
1276   3            {
1277   4      
1278   4            }
1279   3            else
1280   3            {
1281   4              if(Val_Calc > (u16)160)
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 22  

1282   4              {
1283   5                Val_Calc = 160;//20·ÖÖÓÄÚÏÞÖÆ¼ÓÈÈ¹¦ÂÊ
1284   5              }
1285   4            }
1286   3              
1287   3              
1288   3            Micro_Temp_In = Val_Calc;
1289   3      
1290   3            Val_Calc=0;
1291   3            if(WireOut_State!=(u8)0)    //µ±ÓÐ¹ÜÄÚOUT·¢ÈÈË¿Ê±£¬¹ÜÄÚ·¢ÈÈË¿µÄ¼ÓÈÈÂß¼­
1292   3            {
1293   4              {
1294   5                Val_Calc = Micro_Temp_In *((u16)10+In_Exp_Ratio-(u16)1)/(u16)10;
1295   5                if(Val_Calc > (u16)195)
1296   5                {
1297   6                  Val_Calc = 195;
1298   6                }
1299   5                if(In_Exp_Ratio > (u8)1)
1300   5                { 
1301   6                  if(Val_Calc==(u16)0)
1302   6                  {
1303   7                    Val_Calc=(u16)40*((u16)10+In_Exp_Ratio-(u16)1)/(u16)10;
1304   7                  }
1305   6                }
1306   5                if (RT_Temp >= (Set_RT_Temp+10))//´óÓÚ1¶È,Í£Ö¹¼ÓÈÈ,±£»¤´ëÊ©
1307   5                {
1308   6                  Val_Calc=0; 
1309   6                }
1310   5              }          
1311   4            }
1312   3            else
1313   3            { 
1314   4              Val_Calc=0; 
1315   4            }
1316   3            Micro_Temp_Out = Val_Calc;
1317   3          }
1318   2      
1319   2          //ÓÐÎÞ´´Ä£Ê½Ê±·¢ÈÈÅÌµÄ¼ÓÈÈÂß¼­
1320   2      
1321   2          //²»Çø·Ö¼ÓÈÈÏß/////////////////////////////   
1322   2          if(CONTROL_RT_SHIDU<=Aim_SHIDU)//Ö÷ÒªÊÇÕë¶Ô´óÁ÷Á¿Ê±µÄ²¹³¥
1323   2          {
1324   3            Humidity_Err = (INT)((INT)Aim_SHIDU - (INT)CONTROL_RT_SHIDU);///2;//Êª¶ÈÎó²î¼ÆËã
1325   3            if(Humidity_Err > 100)
1326   3            {
1327   4              Humidity_Err = 100;//×î´óÏÞ¶¨Îª100
1328   4            }
1329   3          }   
1330   2          else
1331   2          {
1332   3            Humidity_Err = 0; 
1333   3          }     
1334   2                
1335   2          Humidity_Comp = (INT) ((INT)CONTROL_RT_SHIDU - (INT)Aim_SHIDU); //¿ØÖÆÊª¶ÈÒÔ¼õÉÙÀäÄýË®    
1336   2          if(Humidity_Comp > 100)
1337   2          {
1338   3            Humidity_Comp  = 100;
1339   3          }
1340   2      
1341   2          if(Last_Rem_Humidity != CONTROL_RT_SHIDU)//ÕæÊµÊª¶È¸Ä±äÔòÇåÁã
1342   2          {
1343   3            Humidity_No_Change_Sec = 0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 23  

1344   3          }
1345   2          Last_Rem_Humidity = CONTROL_RT_SHIDU;
1346   2      
1347   2          if(Humidity_No_Change_Sec >= (uint16_t)900)//¿ÉÄÜ½øÈëÀäÄý×´Ì¬
1348   2          {
1349   3            Humidity_No_Change_Sec = 901;
1350   3            Humidity_Err = 0;  //½øÈëÀäÄý×´Ì¬ÔòÊª¶È¿ØÖÆÎÞÐ§
1351   3            Humidity_Comp = 0;
1352   3          }       
1353   2                      
1354   2          if((CQK_Temp>=660) ||(JEP_Temp>=HeatingTemperature_MAX))     //³öÆø¿ÚÎÂ¶È×î¸ß66¶È
1355   2          {
1356   3             Micro_Temp_Val=0;//´óÓÚ65¶È±ØÐëÍ£Ö¹¼ÓÈÈ
1357   3             Micro_Adj_Mode_Test = 2;//¼ÓÈÈÄ£Ê½²âÊÔ          
1358   3          }       
1359   2          //´ø¼ÓÈÈÏßµÄÎÂ¶Èµ÷½Ú===========================
1360   2          else if(WireIn_State!=(uint8_t)0)
1361   2          {
1362   3            if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1363   3            {
1364   4              if(JEP_Temp>=HeatingTemperature_MAX)   //105¶È
1365   4              {
1366   5                Val_Calc = 0;
1367   5                Micro_Adj_Mode_Test = 7;//¼ÓÈÈÄ£Ê½²âÊÔ              
1368   5              }
1369   4              else
1370   4              { 
1371   5                Set_CQK_Temp_Comp = (INT)Set_CQK_Temp; //³öÆø¿ÚÉè¶¨ÎÂ¶È
1372   5                
1373   5                if(Work_Mode==(u8)Invasive_Mode)//
1374   5                { 
1375   6                  if(Humidity_Err >= (INT)50)  //µ±Ä¿±êÊª¶ÈÏà²î5%ÒÔÉÏÇÒÎªÎÞ´´Ê±£¬ÔÊÐí×î¸ß³¬¹ý¶È
1376   6                  {
1377   7                    //Set_CQK_Temp_Comp += Humidity_Err/6;//×î¸ßÔÊÐí³¬¹ý1.6¶È
1378   7                    Set_CQK_Temp_Comp += Humidity_Err/10;//×î¸ßÔÊÐí³¬¹ý1¶È
1379   7                  } 
1380   6                } 
1381   5                else
1382   5                {
1383   6                  if(Humidity_Err >= 50)  //µ±Ä¿±êÊª¶ÈÏà²î5%ÒÔÉÏÇÒÎªÎÞ´´Ê±£¬ÔÊÐí×î¸ß³¬¹ý¶È
1384   6                  {
1385   7                    Set_CQK_Temp_Comp += Humidity_Err/2;//×î¸ßÔÊÐí³¬¹ý5¶È 120L 28»·¾³ÎÂ¶È
1386   7                  }
1387   6                } 
1388   5      
1389   5                if(Humidity_Comp >= 10)
1390   5                {
1391   6                  //Set_CQK_Temp_Comp = Set_CQK_Temp_Comp - Humidity_Comp/5;//Êª¶ÈÃ¿ÉÏ1%Ôò³öÆø¿ÚÎÂ¶ÈÏÂ½µ0.2¶È£¬×î¶à2¶È
1392   6                  Set_CQK_Temp_Comp = Set_CQK_Temp_Comp - (Humidity_Comp/10);//Êª¶ÈÃ¿ÉÏ1%Ôò³öÆø¿ÚÎÂ¶ÈÏÂ½µ0.1¶È£¬×î¶à1¶
             -È
1393   6                }   
1394   5      
1395   5                if(Work_Mode==(uint8_t)Invasive_Mode)//
1396   5                { 
1397   6                  //Set_CQK_Temp_Comp -= 5;//ÓÐ´´Ê±½µµÍ0.5¶È  
1398   6                  if(Set_CQK_Temp_Comp < 320)
1399   6                  {
1400   7                    Set_CQK_Temp_Comp = 320;//×î¼«ÏÞµÄÎÂ¶È
1401   7                  }
1402   6                }
1403   5                else
1404   5                { 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 24  

1405   6                  if(Set_CQK_Temp_Comp < 300)
1406   6                  {
1407   7                    Set_CQK_Temp_Comp = 300;//×î¼«ÏÞµÄÎÂ¶È
1408   7                  }
1409   6                } 
1410   5      
1411   5                ////if(CQK_Temp < Set_CQK_Temp_Comp - 30) //  
1412   5      
1413   5                //Ëã·¨¿ªÊ¼
1414   5                if(JEP_Temp < (JEP_Temp_Aim - 20))//¼ÓÈÈÅÌÎÂ¶ÈÐ¡ÓÚ¼ÓÈÈÅÌÄ¿±êÎÂ¶È-2    
1415   5                {
1416   6                  WarmUp_S_Cnt = 0;//ÇåÁã£¬µÈ´ý´ïµ½¼ÓÈÈÄ¿±ê
1417   6                } 
1418   5                else
1419   5                {
1420   6                  WarmUp_S_Cnt++;
1421   6                  if(WarmUp_S_Cnt >= (u16)20)//Ã¿Á½·ÖÖÓµ÷ÕûÒ»´Î¼ÓÈÈÅÌÄ¿±êÎÂ¶È
1422   6                  {
1423   7                    WarmUp_S_Cnt = 0;
1424   7                    Controler_temp3.Ek = Set_CQK_Temp_Comp - CQK_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1425   7                    HeatPlateTemp_Aim_Controler_Calc();                       
1426   7      
1427   7                    JEP_Temp_Aim = JEP_Temp_Aim + Controler_temp3.Uk;//                       
1428   7                    
1429   7                    if(Work_Mode==(u8)Invasive_Mode)//
1430   7                    {
1431   8                      if(JEP_Temp_Aim < 500)
1432   8                      {
1433   9                        JEP_Temp_Aim = 500;//×îÐ¡50¶È
1434   9                      }
1435   8                    }
1436   7                    else
1437   7                    {
1438   8                      if(JEP_Temp_Aim < 400)
1439   8                      {
1440   9                        JEP_Temp_Aim = 400;//×îÐ¡50¶È
1441   9                      }
1442   8                    } 
1443   7                    
1444   7                    if(Working_Normal >= (u16)1200)
1445   7        //                    if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)//¿ª»ú20·ÖÖÓÖ®ºó
1446   7                    {
1447   8                      if(JEP_Temp_Aim > 1045)
1448   8                      {
1449   9                        JEP_Temp_Aim = 1045;//×î´ó102¶È
1450   9                      }
1451   8                    }
1452   7                    else
1453   7                    {
1454   8                      if(JEP_Temp_Aim > 980)
1455   8                      {
1456   9                        JEP_Temp_Aim = 980;//¿ª»ú20·ÖÖÓÒÔÄÚ×î´ó98¶È
1457   9                      }
1458   8                    }
1459   7                  }
1460   6                }
1461   5                      
1462   5                      
1463   5                Controler_temp2.Ek = JEP_Temp_Aim - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1464   5                HeatPlate_Controler_Calc(); 
1465   5                Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
1466   5      
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 25  

1467   5                if((CQK_Temp - Set_CQK_Temp_Comp) > 20)//³öÆø¿ÚÎÂ¶È±ÈÄ¿±êÎÂ¶È¸ß
1468   5                {
1469   6                  if(Val_Calc > (u16)20)
1470   6                  {
1471   7                    Val_Calc = 20;  
1472   7                  }
1473   6                  JEP_Temp_Aim = JEP_Temp;//¸ü¸Ä¼ÓÈÈÅÌÄ¿±êÎÂ¶È
1474   6                } 
1475   5                else if((CQK_Temp - Set_CQK_Temp_Comp) > 10)//³öÆø¿ÚÎÂ¶È±ÈÄ¿±êÎÂ¶È¸ß
1476   5                {
1477   6                  //do nothing
1478   6                }
1479   5                else
1480   5                {
1481   6                  //do nothing
1482   6                }
1483   5              }
1484   4            }          
1485   3                
1486   3                
1487   3            if(Val_Calc > (u16)195)
1488   3            {
1489   4              Val_Calc = 195; 
1490   4            }       
1491   3            if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1492   3            {
1493   4              Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
1494   4            }
1495   3                
1496   3            }
1497   2          else if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1498   2          { 
1499   3            PatientTemp_NoneHeatWire_Adj();
1500   3            //²»´ø¼ÓÈÈÏßµÄÎÂ¶Èµ÷½Ú==============================================================
1501   3          }
1502   2          else
1503   2          {
1504   3            //do nothing
1505   3          }
1506   2      
1507   2        }
1508   1      } 
1509          
1510          
1511          static void   Store_Data(void)   //´æ·ÅÊý¾ÝµØÖ·´Ó1¿ªÊ¼
1512          {
1513   1        uint16_t i;
1514   1        uint8_t N,j;
1515   1        if (Run_Count<(u16)1)
1516   1        {
1517   2      //    return;
1518   2        }
1519   1        else
1520   1        {
1521   2          i=((Run_Count-(u16)1)/(u16)8)+(u16)1;     //¼ÆËãµØÖ·
1522   2          N=(u8)(Run_Count%(u16)8);       //¼ÆËãÎ»
1523   2          if ((Run_Count!=(u16)0) && (N==(u16)0)) 
1524   2          {
1525   3            N=8;
1526   3          }
1527   2          j=(uint8_t)((uint16_t)0xFF<<N);
1528   2          SPI_Write_nBytes(i,1,&j);
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 26  

1529   2      
1530   2              //delay_us(100);
1531   2        }
1532   1      }
1533          
1534          static void  Get_RunCount(void)   //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý
1535          {
1536   1        uint16_t Start1,Start2,StartAdr;
1537   1        uint8_t N,K,j;
1538   1        Start1=0x1;
1539   1        Start2=0x2000;
1540   1        for(j=0;j<(u8)14;j++) //²éÕÒ¼ÆÊýÎ»
1541   1        {
1542   2          StartAdr=(Start1+Start2)/(u16)2;
1543   2          SPI_Read_nBytes(StartAdr,1,&N);
1544   2          delay_us(100);
1545   2          if(N==(u8)0xFF)
1546   2          {
1547   3            Start2=StartAdr;
1548   3          }else
1549   2          {
1550   3            Start1=StartAdr;
1551   3            Start2=Start1+((uint16_t)2<<((u16)12-(uint16_t)j));
1552   3            SPI_Read_nBytes(StartAdr+(u16)1,1,&K);
1553   3            if(K==(u8)0xFF)
1554   3            {  break;  }
1555   3            else
1556   3            {
1557   4              StartAdr=StartAdr+(u16)1;
1558   4              N=K;
1559   4            }
1560   3          }
1561   2        }
1562   1        Run_Count=(StartAdr-(u16)1)*(u16)8;//¼ÆËãÊ±1¸ö×Ö½Ú±í8
1563   1        for(j=0;j<(u8)8;j++)
1564   1        {
1565   2          if((((u16)0x01<<j) & (u8)N)!=(u8)0)
1566   2          {
1567   3            break;
1568   3          }     
1569   2        }
1570   1        Run_Count=Run_Count+j;      //×î¶à¿É¼ÇÊý44896Ìõ,256ÌõÎª»º³å
1571   1      
1572   1         //Run_Count = 2000;//²âÊÔÊ¹ÓÃ 2014-12-26
1573   1         //SPI_Read_nBytes(8000,1,&N);
1574   1         // DS1302_GetTime(NowTime);
1575   1         // if(NowTime[0]&0x80)         //·¢ÏÖµôµçÔòÖØÐÂ³õÊ¼»¯Ê±¼ä£¬ÊÇ·ñÒªÑ¯ÎÊ
1576   1         //    DS1302_SetTime(initTime);    //³õÊ¼»¯Ê±¼ä
1577   1      //    if(N==1)                    //Ê±¼ä±ØÐë×ÔÐÐÉè¶¨
1578   1      //   {
1579   1      //      DS1302_SetTime(NowTime);
1580   1      //      j=2;
1581   1      //      SPI_Write_nBytes(8000,1,&j);
1582   1      //      delay_ms(10);
1583   1      //   }else if(N==2)
1584   1      //   {
1585   1      
1586   1      //   }
1587   1      
1588   1         
1589   1         /* 
1590   1         DISP_TIME_10X16(POS_RT_RH_X-20,10,Run_Count/10000,BLACK18);
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 27  

1591   1         DISP_TIME_10X16(POS_RT_RH_X-20,18,Run_Count%10000/1000,BLACK18);
1592   1         DISP_TIME_10X16(POS_RT_RH_X-20,26,Run_Count%1000/100,BLACK18);
1593   1         DISP_TIME_10X16(POS_RT_RH_X-20,34,Run_Count%100/10,BLACK18);
1594   1         DISP_TIME_10X16(POS_RT_RH_X-20,42,Run_Count%10,BLACK18);
1595   1         */
1596   1         //DISP_TIME_10X16(POS_RT_RH_X-20,POS_RT_RH_Y+150-90,Enable_Save_Data,BLACK18);
1597   1      }
1598          
1599          static uint8_t  Wire_Mode_Sel_Rem = 0xff;//¼ÇÒä×´Ì¬
1600          static uint8_t  Disp_ERR_VHB80_Code = 0xff;
1601          
1602          void Err_Base_HeaterWire_DISP_Enable(void)//ÆÁ±£Ê±ÖÃÏà¹Ø±êÖ¾,ÒÔ±ãÁÁÆÁÊ±ÏÔÊ¾Ö÷»úºÍÏßµÄÍ¼ÐÎ
1603          {
1604   1        Disp_ERR_VHB80_Code = 0xff;
1605   1        Wire_Mode_Sel_Rem = 0xff;//¼ÇÒä×´Ì¬
1606   1      }
1607          
1608          
1609          void AlarmErrorFunc(void)    //´íÎóÊÂ¼þ
1610          {
1611   1        uint8_t color=0;
1612   1        static uint8_t     Err_Event_Cnt=0;  //¼õÐ¡¹¤×÷´ÎÊý
1613   1        uint8_t     Err_Event_1=0;
1614   1        uint8_t     Err_Event_2=0;
1615   1          
1616   1        static uint8_t AlarmInfoRem = 0;//±¨¾¯×´Ì¬¼ÇÒä
1617   1      
1618   1        Err_Event_Cnt++;//ÉÁË¸¼ÆÊý¼°¼õÉÙ³ÌÐòÔËÐÐÊ±¼ä
1619   1        if(Err_Event_Cnt > (u8)1)
1620   1        { 
1621   2          Err_Event_Cnt = 0;//ºì  
1622   2        }
1623   1        Err_Event_1 = 0;
1624   1        Err_Event_2 = 1;      
1625   1      
1626   1        //LCD_ShowxNum(POS_RT_RH_X-40,5,16,4,RT_Temp,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾
1627   1        //LCD_ShowxNum(POS_RT_RH_X-40,60,16,4,ERR_RT_Temp_Times,0x80,BLACK18); //
1628   1      
1629   1        if(((No_CQKSensor_Times>(u16)1000) || (CQK_Sensor_Temp_No_Change_Times > (u16)6000)) //³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷´í
             -Îó¼ì²â
1630   1          ||(CQKSensor_Hithen800_Times > (u16)250)//Á¬Ðø10S > 80¶È
1631   1          ||(No_ReadData_Temp_Times>(u8)20)//¼ÓËÙÏÔÊ¾
1632   1          )
1633   1        {
1634   2          CQK_Sensor_Err=(uint8_t)1;
1635   2          CQK_Temp = 0; 
1636   2          LoTemp_CQK_Count  = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1637   2          Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã 
1638   2          Set_bit(&ERR_Kind,Alarm_Const_CQK_Sensor);        
1639   2        }
1640   1        else
1641   1        {
1642   2          CQK_Sensor_Err=(uint8_t)0;
1643   2          Clear_bit(&ERR_Kind,Alarm_Const_CQK_Sensor);        
1644   2        }
1645   1          
1646   1        if((Nochange_Times>(u16)900) || (No_ReadData_SHIDU_Times>(u8)20) || (RT_Temp_Not_Updated_10mS > (u16)3000
             -))//ÈËÌå¶ËÊª¶È´«¸ÐÆ÷´íÎó¼ì²â
1647   1        {
1648   2          SHIDU_Sensor_Err=(uint8_t)1;
1649   2          RTD_Sensor_Err=(uint8_t)1;
1650   2          RT_SHIDU = 0; 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 28  

1651   2          HiTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²â¸ßÎÂ±¨¾¯
1652   2          LoTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1653   2          LoHumity_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÊª±¨¾¯
1654   2          Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1655   2          Set_bit(&ERR_Kind,Alarm_Const_RTD_Sensor); 
1656   2        }   
1657   1        else
1658   1        {
1659   2          SHIDU_Sensor_Err=(uint8_t)0;
1660   2          Clear_bit(&ERR_Kind,Alarm_Const_RTD_Sensor); 
1661   2        }
1662   1          
1663   1        if((Nochange_Times>(u16)900) ||  (No_ReadData_Temp_Times>(u8)20) 
1664   1        || (ERR_RT_Temp_Times>(u8)20) || (RT_Temp_Not_Updated_10mS > (u16)3000))//ÈËÌå¶ËÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â 2014-0
             -7-03
1665   1        {
1666   2          RTD_Sensor_Err=(uint8_t)1;
1667   2          if(ERR_RT_Temp_Times<(u8)10)//¸ßÎÂÒì³£±¨¾¯Ê±ÎÂ¶È²»ÇåÁã
1668   2          {
1669   3            RT_Temp = 0;    
1670   3            Diplay_RTtemp = 0;
1671   3          }
1672   2          HiTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²â¸ßÎÂ±¨¾¯
1673   2          LoTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1674   2          LoHumity_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÊª±¨¾¯
1675   2          Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1676   2        }
1677   1        else
1678   1        {
1679   2          RTD_Sensor_Err=(uint8_t)0;
1680   2        }
1681   1          
1682   1        
1683   1        if( (No_HeatSensor_Times>(u8)150) || (JRP_Sensor_Temp_No_Change_Times > (u16)600))//¼ÓÈÈÅÌ´«¸ÐÆ÷´íÎó¼ì²â  
             - 
1684   1        {     
1685   2          JRP_Sensor_Err=(uint8_t)1;
1686   2          Set_bit(&ERR_Kind,Alarm_Const_JRP_Sensor); 
1687   2        }
1688   1        else
1689   1        {
1690   2          JRP_Sensor_Err=(uint8_t)0;
1691   2          Clear_bit(&ERR_Kind,Alarm_Const_JRP_Sensor); 
1692   2        }
1693   1        if(HiTemp_Count>(u8)2)  //¸ßÎÂ´íÎó¼ì²â
1694   1        {
1695   2          Set_bit(&ERR_Kind,Alarm_Const_HiTemp);
1696   2        }
1697   1        else
1698   1        {
1699   2          Clear_bit(&ERR_Kind,Alarm_Const_HiTemp);
1700   2        }
1701   1          
1702   1        
1703   1        if(LoTemp_Count>(u8)120)  //µÍÎÂ´íÎó¼ì²â
1704   1        {
1705   2          Set_bit(&ERR_Kind,Alarm_Const_LoTemp);
1706   2        } 
1707   1        else
1708   1        {
1709   2          Clear_bit(&ERR_Kind,Alarm_Const_LoTemp);
1710   2        }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 29  

1711   1          
1712   1      
1713   1        if(LoHumity_Count>(u8)120) //µÍÊª¶È´íÎó¼ì²â
1714   1        {
1715   2          Set_bit(&ERR_Kind,Alarm_Const_LoHumity);//ÉèÖÃµÍÊª¶È±¨¾¯±êÖ¾
1716   2        }
1717   1        else
1718   1        {
1719   2          if (Bit_is_one(ERR_Kind,Alarm_Const_LoHumity)!=(uint8_t)0)
1720   2          {
1721   3            Clear_bit(&ERR_Kind,Alarm_Const_LoHumity);//Çå³ýµÍÊª¶È±¨¾¯±êÖ¾
1722   3          }
1723   2        }
1724   1      
1725   1      //É«¿é±¨¾¯  VHB15A_FUNCTION_ALARM_COLOR_DISPLAY
1726   1      /*ÈËÌåÌ½Í·³ö´í    ---ºì
1727   1       ³öÆø¿ÚÌ½Í·³ö´í   ---ÂÌ
1728   1       ¼ÓÈÈÅÌÌ½Í·³ö´í   ---À¶
1729   1       ¸ßÎÂ±¨¾¯       ---ºÚ
1730   1       µÍÎÂ±¨¾¯       ---»Ò
1731   1       µÍÊª¶È±¨¾¯     ---»Æ
1732   1       Ë®¹ÞÎ´°²×°ºÃ±¨¾¯   ---Çà
1733   1       ·¢ÈÈÏßÎ´°²×°»ò¿ªÂ· ---×Ï
1734   1       ÎÞË®/¸ÉÉÕ        ---ºÚ
1735   1      */
1736   1      
1737   1        if(Work_State != UI_STATE_SCREENSAVER_MODE)//ÆÁ±£Ê±²»ÏÔÊ¾
1738   1        {
1739   2          if((SHIDU_Sensor_Err==(uint8_t)1)||(RTD_Sensor_Err!=(uint8_t)0))  //ÈËÌå¶ËÌ½Í·
1740   2          {
1741   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+5,RED18);
1742   3          }
1743   2          if(CQK_Sensor_Err==(uint8_t)1)//³öÆø¿ÚÌ½Í·
1744   2          {
1745   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+5,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+10,GREEN18);
1746   3          }
1747   2          if(JRP_Sensor_Err==(uint8_t)1)//¼ÓÈÈÅÌÌ½Í·
1748   2          {
1749   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+10,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+15,BLUE18);
1750   3          }
1751   2          if(HiTemp_Count>(u8)2)//¸ßÎÂ
1752   2          {
1753   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+15,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+20,BLACK18);
1754   3          }
1755   2          if(LoTemp_Count>(u8)120)//µÍÎÂ
1756   2          {
1757   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+20,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+25,GRAY18);
1758   3          }
1759   2          if(LoHumity_Count>(u8)120)//µÍÊª¶È
1760   2          {
1761   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+25,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+30,YELLOW18);
1762   3          }
1763   2          if(HeaterPlate_State==(u8)0)//Ë®¹ÞÎ´×°ºÃ»ò·¢ÈÈÅÌ¿ªÂ·
1764   2          {
1765   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+30,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+35,BRIGHT_BLU
             -E18);
1766   3          }
1767   2          if(Wire_Mode_Mismatch == (uint8_t)1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä  
1768   2          {
1769   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+35,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+40,PURPLE18);
1770   3          }
1771   2          if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®(¸ÉÉÕ)±¨¾¯
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 30  

1772   2          {
1773   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+40,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+45,BLACK18);
1774   3          } 
1775   2        }
1776   1      
1777   1      
1778   1        if(HeaterPlate_State==(uint8_t)0)  //Ã»ÓÐ·ÅÈë¹Þ×Ó
1779   1        {
1780   2          AlarmInfoIndex = (uint8_t)1;
1781   2        }
1782   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®´íÎó
1783   1        {
1784   2          AlarmInfoIndex = (uint8_t)2;
1785   2        }
1786   1        else if((CQK_Sensor_Err!=(uint8_t)0) || (RTD_Sensor_Err!=(uint8_t)0) || (SHIDU_Sensor_Err!=(uint8_t)0))
1787   1        {
1788   2          AlarmInfoIndex = (uint8_t)3;
1789   2        } 
1790   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_HiTemp)!=(uint8_t)0) //¸ßÎÂ´íÎó
1791   1        {
1792   2          AlarmInfoIndex = (uint8_t)4;
1793   2        }
1794   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_LoTemp)!=(uint8_t)0) //»¼Õß¶Ë³ÖÐøµÍÎÂ
1795   1        {
1796   2          AlarmInfoIndex = (uint8_t)5;
1797   2        }
1798   1        else if(LoTemp_CQK_Count>(uint8_t)120)//³öÆø¿Ú³ÖÐøµÍÎÂ
1799   1        {
1800   2          AlarmInfoIndex = (uint8_t)6;
1801   2        } 
1802   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_LoHumity)!=(uint8_t)0)//³ÖÐøµÍÊª¶È´íÎó
1803   1        {
1804   2          AlarmInfoIndex = (uint8_t)7;
1805   2        }
1806   1        else if(Wire_Mode_Mismatch == (uint8_t)1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä 
1807   1        {
1808   2          AlarmInfoIndex = (uint8_t)8;
1809   2        } 
1810   1        else
1811   1        {
1812   2          AlarmInfoIndex = (uint8_t)0;
1813   2          AlarmSoundPauseStatus = (uint8_t)0;//ÎÞ±¨¾¯£¬²»¿ÉÉùÒôÔÝÍ£
1814   2        }
1815   1      
1816   1        if(AlarmInfoIndex !=  AlarmInfoRem)//±¨¾¯×´Ì¬¸Ä±ä
1817   1        {
1818   2          AlarmSoundPauseStatus = 0;//ÉùÒôÔÝÍ£È¡Ïû
1819   2          Sound_Alarm_Pause_Disable();  
1820   2        } 
1821   1              
1822   1        AlarmInfoRem = AlarmInfoIndex;
1823   1        
1824   1      
1825   1        //´«¸ÐÆ÷´íÎó==============================================================
1826   1        ERR_Kind&=(uint8_t)0xFE;  ////Çå³ýµÚÒ»Î»ÊÇ´«¸ÐÆ÷´íÎó
1827   1        if((CQK_Sensor_Err!=(uint8_t)0) || (RTD_Sensor_Err!=(uint8_t)0) || (JRP_Sensor_Err!=(uint8_t)0) || (SHIDU
             -_Sensor_Err!=(uint8_t)0))
1828   1        {
1829   2          ERR_Kind|=(uint8_t)0x01;//µÚÒ»Î»ÊÇ´«¸ÐÆ÷´íÎó
1830   2        } 
1831   1      
1832   1        if(Work_State != UI_STATE_SCREENSAVER_MODE)//·ÇÆÁ±£Ä£Ê½£¬·ñÔòÒªÏÈÍË³öÆÁ±£Ä£Ê½
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 31  

1833   1        { 
1834   2          if(HeaterPlate_State==(u8)0)    //ÎÞ¼ÓÈÈÅÌ£¬ÏÔÊ¾ËùÓÐµÄÍ¼Æ¬   Plate_State==0
1835   2          {
1836   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã
1837   3      
1838   3            if(Work_State != UI_STATE_SCREENSAVER_MODE)
1839   3            {
1840   4              if(Disp_ERR_VHB80_Code!=(u8)1)
1841   4              {
1842   5                Disp_ERR_VHB80_Code=1;
1843   5                DISP_VHB80_PIC(BLUE18); 
1844   5      
1845   5                if(Wire_Mode_Sel_Rem != (uint8_t)Wire_Mode_Sel)
1846   5                {
1847   6                  if(Wire_Mode_Sel == Wire_Sel_None)
1848   6                  { 
1849   7                    if(Err_Event_Cnt == Err_Event_1) //ÎÞ¼ÓÈÈ
1850   7                    { 
1851   8                      Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,GRAY18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1852   8                      Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,GRAY18); 
1853   8                    }
1854   7                  } 
1855   6      
1856   6                  if((Wire_Mode_Sel==Wire_Sel_In_Only) || (Wire_Mode_Sel== Wire_Sel_None))
1857   6                  {
1858   7                    if(Err_Event_Cnt == Err_Event_1)
1859   7                    {
1860   8                      Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1861   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²
             -¿
1862   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú          
             -    
1863   8                    }
1864   7                  }
1865   6                }
1866   5                Wire_Mode_Sel_Rem = (uint8_t)Wire_Mode_Sel;                
1867   5              }
1868   4              if(Err_Event_Cnt == Err_Event_1)     
1869   4              {
1870   5                color=RED18;//¸ÄÑÕÉ«
1871   5              }
1872   4              else if(Err_Event_Cnt == Err_Event_2)
1873   4              {
1874   5                color=GRAY18;
1875   5              }
1876   4              else 
1877   4              {
1878   5                //do nothing
1879   5              }
1880   4      
1881   4              //         if((Err_Event_Cnt == Err_Event_1)||(Err_Event_Cnt == Err_Event_2))
1882   4              DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color); 
1883   4            }
1884   3            else
1885   3            {
1886   4              Disp_ERR_VHB80_Code = 0;        
1887   4            }     
1888   3          }
1889   2          else  if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®(¸ÉÉÕ)±¨¾¯
1890   2          // if(0)
1891   2          {
1892   3            //ÏÔÊ¾ÎÞË®´íÎó================================
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 32  

1893   3            if(Disp_ERR_VHB80_Code!=(u8)2)
1894   3            {
1895   4              Disp_ERR_VHB80_Code=2; 
1896   4              DISP_VHB80_PIC(BLUE18);
1897   4            }
1898   3            if(Err_Event_Cnt == Err_Event_1)
1899   3            {
1900   4              color=RED18;          //ÎÞË®´íÎó¸ÄÎªºìÉ«
1901   4            }
1902   3            else if(Err_Event_Cnt == Err_Event_2)
1903   3            {
1904   4              color=WHITE18;
1905   4            }
1906   3            else 
1907   3            {
1908   4              //do nothing
1909   4            }
1910   3            Draw_Rectangle_Real(POS_HEAT_X,POS_HEAT_Y+2,POS_HEAT_X+8,POS_HEAT_Y+33,color);
1911   3                  
1912   3          }
1913   2          else if((CQK_Sensor_Err!=(uint8_t)0) || (RTD_Sensor_Err!=(uint8_t)0) || (SHIDU_Sensor_Err!=(uint8_t)0)  
1914   2            ||(HiTemp_Count>(u8)2) || (LoTemp_Count>(u8)120) ||(LoTemp_CQK_Count>(u8)120)) //Ì½Í·´íÎó»ò¸ßµÍÎÂ±¨¾¯
1915   2          //   || Heat_ERR
1916   2          //else if(0)
1917   2          {
1918   3            //ÏÔÊ¾Í¼ÐÎ£¬ÉÁË¸´íÎó²¿·Ö==========================================
1919   3            if(Disp_ERR_VHB80_Code!=(u8)3)
1920   3            {
1921   4              Disp_ERR_VHB80_Code=3; 
1922   4              DISP_VHB80_PIC(GRAY18);
1923   4            }     
1924   3      
1925   3            if(Err_Event_Cnt == Err_Event_1)
1926   3            {
1927   4              color=RED18;  //ºì
1928   4            }
1929   3            else if(Err_Event_Cnt == Err_Event_2)
1930   3            {
1931   4              color=GRAY18; //»Ò
1932   4            }
1933   3            else
1934   3            {
1935   4              //do nothing
1936   4            }
1937   3      
1938   3      
1939   3            {
1940   4      
1941   4              if((CQK_Sensor_Err!=(uint8_t)0)||(LoTemp_CQK_Count>(uint8_t)120))//ÏÔÊ¾³öÆø¿Ú´íÎó///
1942   4              {
1943   5                DISP_CQK25X24(POS_CQK_X,POS_CQK_Y,color);
1944   5              }else
1945   4              {
1946   5                DISP_CQK25X24(POS_CQK_X,POS_CQK_Y,GRAY18);
1947   5              } 
1948   4              if((RTD_Sensor_Err!=(uint8_t)0)||(HiTemp_Count>(uint8_t)2) || (LoTemp_Count>(uint8_t)120))  //ÈËÌå¶ËÌ½
             -Í·´íÎó
1949   4              { 
1950   5                DISP_RTD28X24(POS_RTD_X,POS_RTD_Y,color);
1951   5              }else
1952   4              {
1953   5                DISP_RTD28X24(POS_RTD_X,POS_RTD_Y,GRAY18);
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 33  

1954   5              } 
1955   4              if(JRP_Sensor_Err!=(uint8_t)0) //¼ÓÈÈÅÌÌ½Í·
1956   4              {
1957   5                //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color);  
1958   5                DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,GRAY18);
1959   5                //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,RED18); 
1960   5              }else
1961   4              {
1962   5                DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,GRAY18); 
1963   5                //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,RED18);          
1964   5              } 
1965   4            }
1966   3          }
1967   2          else if(Wire_Mode_Mismatch == (uint8_t)1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä 
1968   2            //else if(0)
1969   2          {
1970   3            Working_Normal = (uint16_t)0;//Õý³£¹¤×÷Ê±¼äÇåÁã 
1971   3      
1972   3            {
1973   4              if(Disp_ERR_VHB80_Code!=(u8)4)
1974   4              {
1975   5                Disp_ERR_VHB80_Code=4; 
1976   5                DISP_VHB80_PIC(BLUE18);
1977   5              }
1978   4      
1979   4              //»­In¼ÓÈÈÏß¶Î
1980   4              if(WireIn_State > (u8)0)//ÓÐIn»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾À¶É«
1981   4              {
1982   5                color=BLUE18;
1983   5              }
1984   4              else
1985   4              {
1986   5                color=GRAY18;//ÎÞIn»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾»ÒÉ«
1987   5              }
1988   4              if(Err_Event_Cnt <= Err_Event_1)//ÏÔÊ¾µ±Ç°×´Ì¬£¬ÓÐ»òÕßÎÞ£¬À¶É«»ò»ÒÉ«
1989   4              {//°´ÉÏÃæµÄÑÕÉ«ÏÔÊ¾
1990   5              }               
1991   4              else if(Err_Event_Cnt <= Err_Event_2)//¸ù¾ÝÄ£Ê½È·¶¨ÏÔÊ¾ºìÉ«±¨¾¯»¹ÊÇµ±Ç°×´Ì¬ÑÕÉ«
1992   4              {
1993   5                if(((WireIn_State ==(u8) 0)&&(Wire_Mode_Sel == Wire_Sel_None))//ÎÞIn»ØÂ··¢ÈÈË¿ÇÒÊÇNoneÄ£Ê½²»ÐèÒª±¨¾¯
1994   5                  ||((WireIn_State == (u8)1)&&(Wire_Mode_Sel == Wire_Sel_Double))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇË«Ö§Ä£Ê½²»ÐèÒª±¨¾
             -¯
1995   5                  ||((WireIn_State == (u8)1)&&(Wire_Mode_Sel == Wire_Sel_In_Only)))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇµ¥Ö§Ä£Ê½²»ÐèÒª±
             -¨¾¯
1996   5                
1997   5                {
1998   6                }
1999   5                else//³ýÒÔÉÏÇé¿ö¾ùÐèÒª±¨¾¯:ÈçÎÞInÊ±µ¥/Ë«Ö§/Un,ÓÐInÊ±None/Un
2000   5                {
2001   6                  color=RED18;
2002   6                }
2003   5              }
2004   4              else 
2005   4              {
2006   5                //do nothing
2007   5              }
2008   4              
2009   4              Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,color);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2010   4              Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,color);       
2011   4          
2012   4                
2013   4               //»­Exp¼ÓÈÈÏß¶Î
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 34  

2014   4              if(WireOut_State > (u8)0)//ÓÐOut»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾À¶É«
2015   4              {
2016   5                color=BLUE18;
2017   5              }
2018   4              else
2019   4              {
2020   5                color=GRAY18;//ÎÞOut»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾»ÒÉ«
2021   5              }
2022   4              if(Err_Event_Cnt <= Err_Event_1)//ÏÔÊ¾µ±Ç°×´Ì¬£¬ÓÐ»òÕßÎÞ£¬À¶É«»ò»ÒÉ«
2023   4              {//°´ÉÏÃæµÄÑÕÉ«ÏÔÊ¾
2024   5              }               
2025   4              else if(Err_Event_Cnt <= Err_Event_2)//¸ù¾ÝÄ£Ê½È·¶¨ÏÔÊ¾ºìÉ«±¨¾¯»¹ÊÇµ±Ç°×´Ì¬ÑÕÉ«
2026   4              {
2027   5                if(((WireOut_State == (u8)0)&&(Wire_Mode_Sel == Wire_Sel_None))//ÎÞOut»ØÂ··¢ÈÈË¿ÇÒÊÇNoneÄ£Ê½²»ÐèÒª±¨¾
             -¯
2028   5                  ||((WireOut_State == (u8)0)&&(Wire_Mode_Sel == Wire_Sel_In_Only))//ÎÞOut»ØÂ··¢ÈÈË¿ÇÒÊÇµ¥Ö§Ä£Ê½²»ÐèÒª
             -±¨¾¯
2029   5                  ||((WireOut_State == (u8)1)&&(Wire_Mode_Sel == Wire_Sel_Double)))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇË«Ö§Ä£Ê½²»ÐèÒª±
             -¨¾¯              
2030   5                
2031   5                {
2032   6                }
2033   5                else//³ýÒÔÉÏÇé¿ö¾ùÐèÒª±¨¾¯:ÈçÎÞOutÊ±Ë«Ö§/Un,ÓÐOutÊ±µ¥/None/Un
2034   5                {
2035   6                  color=RED18;
2036   6                }
2037   5              }
2038   4              else
2039   4              {
2040   5                //do nothing
2041   5              }
2042   4                
2043   4              Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,color);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2044   4              Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,color);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2045   4              Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,color);  //»­·â¿Ú 
2046   4            }        
2047   3          }
2048   2          else if(JRP_Sensor_Err!=(uint8_t)0)//¼ÓÈÈÅÌÌ½Í·´íÎó
2049   2          {
2050   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
2051   3            //ÏÔÊ¾Í¼ÐÎ£¬ÉÁË¸´íÎó²¿·Ö==========================================
2052   3            if(Disp_ERR_VHB80_Code!=(u8)5)
2053   3            {
2054   4              Disp_ERR_VHB80_Code=5; 
2055   4              DISP_VHB80_PIC(GRAY18);
2056   4            } 
2057   3            if(Err_Event_Cnt == Err_Event_1)
2058   3            {
2059   4                //color=RED18;  //ºì
2060   4              color=BLUE18; //»Ò
2061   4            }
2062   3            //else
2063   3            else if(Err_Event_Cnt == Err_Event_2)
2064   3            {
2065   4              color=GRAY18; //»Ò
2066   4            }
2067   3            else
2068   3            {
2069   4              //do nothing
2070   4            }
2071   3            DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color);   
2072   3         
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 35  

2073   3          }
2074   2          else if((Wire_Mode_Sel==Wire_Sel_In_Only) || (Wire_Mode_Sel== Wire_Sel_None))//¾­¹ýÈ·ÈÏºóµÄµ¥Ö§¼ÓÈÈ»òÎÞ¼
             -ÓÈÈ»ØÂ·  
2075   2          { 
2076   3      
2077   3            if(Work_State != UI_STATE_SCREENSAVER_MODE)  //Ã»ÓÐÆÁÄ»±£»¤Ê±²ÅÄÜÏÔÊ¾¼ÓÈÈÄ£Ê½
2078   3            {
2079   4              if(Disp_ERR_VHB80_Code!=(u8)6)
2080   4              {
2081   5                Disp_ERR_VHB80_Code=6; 
2082   5                DISP_VHB80_PIC(BLUE18);
2083   5              }
2084   4      
2085   4              //»­¼ÓÈÈÏß 
2086   4              if(Err_Event_Cnt == Err_Event_1) //   
2087   4              { 
2088   5                if(Wire_Mode_Sel_Rem != (uint8_t)Wire_Mode_Sel)
2089   5                {        
2090   6                  if(Wire_Mode_Sel == Wire_Sel_None)//ÎÞ¼ÓÈÈË¿
2091   6                  { 
2092   7                    Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,GRAY18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2093   7                    Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,GRAY18); 
2094   7                  
2095   7                    Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2096   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2097   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú        
2098   7                  } 
2099   6                  else if(Wire_Mode_Sel==Wire_Sel_In_Only)
2100   6                  {
2101   7                    Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,BLUE18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2102   7                    Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,BLUE18); 
2103   7                    
2104   7                    Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2105   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2106   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú 
2107   7                  }
2108   6                  else
2109   6                  {
2110   7                    //do nothing
2111   7                  }
2112   6                }
2113   5                Wire_Mode_Sel_Rem = (uint8_t)Wire_Mode_Sel;
2114   5              } 
2115   4            }     
2116   3          }
2117   2          else   //Ïû³ýËùÓÐ´íÎóÏÔÊ¾
2118   2          {
2119   3            if(Disp_ERR_VHB80_Code!=(u8)0)
2120   3            {
2121   4              Disp_ERR_VHB80_Code=0;
2122   4              DISP_VHB80_PIC(WHITE18);        
2123   4            }     
2124   3          }
2125   2        }
2126   1       //DISP_TIME_10X16(POS_RT_RH_X,POS_RT_RH_Y+145,Disp_ERR_VHB80_Code,BLACK18);
2127   1      
2128   1      }   
2129          
2130          //void Event_1s(void)       //1ÃëÖÓÊÂ¼þ ÄÚ²¿¶¨Ê±ÖÐ¶ÏÖÃ±êÖ¾
2131          void LowTempDet1SFunc(void)
2132          {
2133   1        uint16_t a=0,b=0,c=0;//³öÆø¿ÚÎÂ¶È´ïµ½Éè¶¨ÎÂ¶È-1
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 36  

2134   1        static uint8_t     No_Water_Times=0;  
2135   1        static uint8_t RT_SHIDU_More_then_90_Cnt = 0;//Á¬Ðø³¬¹ý90%´ïµ½10´Î(1Ãë1´Î)  
2136   1        static uint16_t     Last1s_RThumity=0;
2137   1        static uint16_t     Last1s_RTtemp=0;
2138   1      
2139   1        if(Working_Normal < (u16)65000)
2140   1        {
2141   2          Working_Normal++;
2142   2        }
2143   1      
2144   1      
2145   1        if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == (u8)1))
2146   1        {
2147   2          LCD_ShowxNum(105,180,16,3,RT_Temp_Reach_Set_Cnt,0x80,BLACK18); //
2148   2          LCD_ShowxNum(105,215,16,3,LoTemp_Count,0x80,BLACK18); //  
2149   2        }
2150   1      
2151   1      
2152   1        if(Wire_Warm_Up_Sec < (u16)900)
2153   1        {
2154   2          Wire_Warm_Up_Sec++;
2155   2        }
2156   1      
2157   1        if(Plate_Warm_Up_Sec < (u16)900)
2158   1        {
2159   2          Plate_Warm_Up_Sec++;
2160   2        }
2161   1        Humidity_No_Change_Sec++;//Êª¶È²»¸Ä±äµÄ¼ÆÊý£¬µ±´óÓÚ600Ê±¿ÉÄÜÌ½Í·Ê§Ð§£¬Êª¶È¿ØÖÆÊ§Ð§
2162   1        
2163   1        if(HeaterPlate_State!=(uint8_t)0)  //
2164   1        { 
2165   2          if((Last1s_RThumity==CONTROL_RT_SHIDU) && (Last1s_RTtemp==(uint16_t)RT_Temp)) //ÈËÌå¶ËÎÂ¶ÈºÍÊª¶ÈÍ¬Ê±²»¸Ä
             -±ä
2166   2          {
2167   3            if(Nochange_Times<(u16)1000)
2168   3            {
2169   4              Nochange_Times++;
2170   4            }       
2171   3          }
2172   2          else
2173   2          { 
2174   3            Nochange_Times=0;
2175   3          } 
2176   2          
2177   2      
2178   2          //Last1s_RThumity=RT_SHIDU;
2179   2          Last1s_RThumity=CONTROL_RT_SHIDU;
2180   2          Last1s_RTtemp=(uint16_t)RT_Temp;
2181   2        }
2182   1        else
2183   1        {
2184   2          Nochange_Times=0;
2185   2        }
2186   1       
2187   1        //ÎÞË®±¨¾¯,Ó¦Í¨¹ý¼ÓÈÈÅÌµÄ¼ÓÈÈÉÏÉýËÙ¶ÈÅÐ¶ÏË®Á¿======================================
2188   1        //´ÓÓÐË®µ½ÎÞË®£¬ÈËÌå¶ËÎÂ¶ÈÓ¦¸Ã»á½µµÍ,½µµÍµÄ·ù¶È¹À¼ÆÔÚ3¶ÈÒÔÉÏ
2189   1        //ÓÐ¼ÓÈÈË¿µÄÎÞË®ÅÐ¶Ï£¬³öÆø¿ÚÎÂ¶È¸ßÓÚÈËÌå¶ËÎÂ¶È£¬¼ÓÈÈÅÌÎÂ¶ÈÔÚ100¶ÈÒÔÉÏ£¬ÈËÌå¶ËÊª¶ÈµÍÓÚ80%£¬»òÕßÓÐ20%×óÓÒµÄ
             -ÏÂ½µ
2190   1        //ÎÞ¼ÓÈÈË¿µÄÅÐ¶Ï£¬Èç¹ûË®·Ö²»¹»£¬¹À¼ÆÊÇÈËÌå¶ËÎÂ¶È½ÏµÍ£¬¼ÓÈÈÅÌÎÂ¶ÈÔÚ100¶ÈÒÔÉÏ
2191   1        if(HeaterPlate_State!=(uint8_t)0)
2192   1        {
2193   2          //do nothing
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 37  

2194   2        }
2195   1        else
2196   1        {     
2197   2          Clear_bit(&ERR_Kind,Alarm_Const_NoWater);     
2198   2        } 
2199   1         
2200   1        if(RT_SHIDU >= (u16)900) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»ÒªÊª¶È´ïµ½90%³ÖÐø10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2201   1        {    
2202   2          RT_SHIDU_More_then_90_Cnt++;
2203   2          if(RT_SHIDU_More_then_90_Cnt >= (u8)10)//Á¬Ðø10Ãë³¬¹ý90%
2204   2          {
2205   3            RT_SHIDU_More_then_90_Cnt = 10;
2206   3          }
2207   2        }
2208   1        else
2209   1        {
2210   2          if(RT_SHIDU_More_then_90_Cnt < (u8)10)//Ð¡ÓÚ90%ÇÒÔÚ10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2211   2          {
2212   3            RT_SHIDU_More_then_90_Cnt = 0;
2213   3          }
2214   2        }    
2215   1      
2216   1        //¸ÉÉÕ±¨¾¯  <60% 
2217   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0) //|| RT_SHIDU_More_then_90_Cnt >= 10)
2218   1        if(Working_Normal >= (u16)1200)
2219   1        {
2220   2          if(RT_SHIDU<(u16)600) //Á¬Ðø2·ÖÖÓÉÙÓÚ60%±¨¾¯   ÈÏÎªÊÇ¸ÉÉÕ£¬±ØÐëÖØÆô»úÆ÷
2221   2          {           
2222   3            if(No_Water_Times<(u8)240) 
2223   3            {
2224   4              No_Water_Times++;
2225   4            }       
2226   3            if((RTD_Sensor_Err!=(uint8_t)0) || (SHIDU_Sensor_Err!=(uint8_t)0)) //´«¸ÐÆ÷´íÎó²»¿ÉÒÀÊª¶ÈÀ´¼ì²âÎÞË®±¨¾¯
2227   3            {
2228   4              No_Water_Times = 0;
2229   4            }
2230   3          }
2231   2          else
2232   2          {
2233   3            No_Water_Times=0;
2234   3          }
2235   2          if( No_Water_Times>=(u8)120)
2236   2          {
2237   3            Set_bit(&ERR_Kind,Alarm_Const_NoWater);
2238   3          } 
2239   2        }
2240   1         
2241   1        if(RT_SHIDU>(u16)650)//ÎÂ¶È´óÓÚ65%£¬È¡ÏûÎÞË®±¨¾¯
2242   1        {
2243   2         No_Water_Times=0;
2244   2         Clear_bit(&ERR_Kind,Alarm_Const_NoWater);
2245   2        }
2246   1      
2247   1        //============================================================
2248   1        //ÈËÌå¶ËÎÂ¶È´ïµ½Ê¶±ð180S 
2249   1        //if(Work_Mode==Invasive_Mode) //ÓÐ´´Ä£Ê½
2250   1        //if(1) //
2251   1        {
2252   2          if(RT_Temp >= (Set_RT_Temp - 15)) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È-1.5¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2253   2          {    
2254   3            RT_Temp_Reach_Set_Cnt++;
2255   3            if(RT_Temp_Reach_Set_Cnt >= (u8)180)//Á¬Ðø180Ãë³¬¹ýÉè¶¨-1
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 38  

2256   3            {
2257   4              RT_Temp_Reach_Set_Cnt = 180;
2258   4            }
2259   3          }
2260   2          else
2261   2          {
2262   3            if(RT_Temp_Reach_Set_Cnt < (u8)180)//Ð¡ÓÚÉè¶¨ÇÒÔÚ10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2263   3            {
2264   4              RT_Temp_Reach_Set_Cnt = 0;
2265   4            }
2266   3          }
2267   2        } 
2268   1          
2269   1        if(Work_Mode==(u8)Noninvasive_Mode)//ÎÞ´´Ä£Ê½
2270   1        {
2271   2          a = Const_NoninvasPatientTemp_Max+10;//¸ßÎÂ±¨¾¯ÏÞÖµ
2272   2          if(WireIn_State!=(u8)0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2273   2          {
2274   3            b = Const_NoninvasPatientTemp_Min-10;//ÎÞ´´µÍÎÂ±¨¾¯ÏÞÖµ 29¶È
2275   3          }
2276   2          else 
2277   2          {
2278   3            b = 260;//ÎÞ»ØÂ·¼ÓÈÈË¿Ê±ÎÞ´´µÍÎÂ±¨¾¯Îª26¶È
2279   3          }
2280   2          //c = 700;//µÍÊª±¨¾¯ÏÞÖµ V2.0
2281   2          c = 300;//µÍÊª±¨¾¯ÏÞÖµ V2.02 ÎÞ´´Ä£Ê½È¡ÏûµÍÊª¶È±¨¾¯
2282   2        }
2283   1        else if(Work_Mode==(u8)Invasive_Mode) //ÓÐ´´Ä£Ê½
2284   1        {
2285   2          a = Const_InvasPatientTemp_Max+10;
2286   2          if(WireIn_State!=(u8)0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2287   2          {
2288   3            b = Const_InvasPatientTemp_Min-10;//ÓÐ´´µÍÎÂ±¨¾¯ÏÞÖµ 34¶È
2289   3          }
2290   2          else
2291   2          {
2292   3            b = 290;//ÎÞ»ØÂ·¼ÓÈÈË¿Ê±ÓÐ´´±¨¾¯Îª29¶È
2293   3          }
2294   2      
2295   2          c = 800;//µÍÊª±¨¾¯ÏÞÖµ
2296   2        }
2297   1        else
2298   1        {
2299   2          //do nothing
2300   2        }
2301   1      
2302   1        if(Diplay_RTtemp>a)
2303   1        {
2304   2          if(HiTemp_Count<(u8)240)
2305   2          {
2306   3            HiTemp_Count++;
2307   3          }     
2308   2        }else
2309   1        {
2310   2          HiTemp_Count=0;
2311   2        } 
2312   1          
2313   1      /*    
2314   1          ÎªÓ¦¶ÔÈÈ±ÈìÊ£¬Ôö¼ÓÐÂµÄµÍÎÂ±¨¾¯Âß¼­£¬ÐèÒªÍ¬Ê±Âú×ãÒÔÏÂÌõ¼þ´¥·¢µÍÎÂ±¨¾¯
2315   1            1£¬ÓÐ´´Ä£Ê½
2316   1            2£¬µ¥Ö§»òË«Ö§¼ÓÈÈ»ØÂ·Ä£Ê½
2317   1            3£¬»¼Õß¶Ë´ïµ½Éè¶¨ÎÂ¶È-1¶È Á¬Ðø180S£¬·ÀÖ¹Îó¶¯×÷
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 39  

2318   1            4£¬»¼Õß¶ËµÍÓÚÉè¶¨ÎÂ¶È-2¶ÈÇÒ»ØÂ·¼ÓÈÈ¹¦ÂÊÎªÈ«¹¦ÂÊ(190)Á¬Ðø10S*/
2319   1      
2320   1      //ÈËÌå¶ËµÍÎÂ±¨¾¯    
2321   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)// || RT_Temp_Reach_Set_Cnt >= 180)  //ÈËÌåµÍÎÂ±¨¾¯
2322   1        if(Working_Normal >= (u16)1200)//20·ÖÖÓ
2323   1        {
2324   2          if((RT_Temp_Reach_Set_Cnt >= (u8)180)//´ïµ½ÎÂ¶ÈÁ¬Ðø180S
2325   2          //&&(WireIn_State!=0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2326   2          &&(Diplay_RTtemp <= ((uint16_t)Set_RT_Temp - (u16)30)))//ÎÂ¶ÈµÍÓÚÉè¶¨ÎÂ¶È3¶È  //ÆøÔ´ÖÐ¶Ï»òÌ½Í·ÍÑÂä      
2327   2          {
2328   3            if(((WireIn_State!=(u8)0) && (Micro_Temp_In >= (u16)190)))//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2329   3             //||(WireIn_State==0))//ÎÞ·¢ÈÈË¿²»Ò»¶¨ÊÇÈ«¹¦ÂÊ¼ÓÈÈ ÎÞ·¢ÈÈË¿²»Ê¹ÓÃ 
2330   3      
2331   3            {
2332   4              if(LoTemp_Count<(u8)240)
2333   4              {
2334   5                LoTemp_Count+= (u8)12;  //µ±ÎÂ¶È´ïµ½Éè¶¨ÎÂ¶Èºó£¬Á¬Ðø10SÏÂ½µµ½Éè¶¨ÎÂ¶È-2.5¶È£¬µÍÎÂ±¨¾¯ 
2335   5              }         
2336   4            }
2337   3            else 
2338   3            {
2339   4             //if(LoTemp_Count<240) LoTemp_Count++; //µ±ÎÂ¶È´ïµ½Éè¶¨ÎÂ¶Èºó£¬Á¬Ðø10SÏÂ½µµ½Éè¶¨ÎÂ¶È-2.5¶È£¬µÍÎÂ±¨¾¯ 
2340   4            }
2341   3          }
2342   2          else if(Diplay_RTtemp<b)//55·ÖÖÓ¿ªÊ¼¼ì²âÎÂ¶È¹ýµÍ±¨¾¯
2343   2          {
2344   3            if(Working_Normal >= (u16)3300)
2345   3            {
2346   4              if(LoTemp_Count<(u8)240) 
2347   4              {
2348   5                LoTemp_Count++;
2349   5              }
2350   4            }
2351   3          }
2352   2          else
2353   2          {
2354   3            LoTemp_Count=0;
2355   3          }
2356   2        }
2357   1        else
2358   1        {
2359   2          LoTemp_Count=0;
2360   2        }
2361   1      
2362   1      //ÈËÌå¶ËµÍÊª±¨¾¯      
2363   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)// || RT_SHIDU_More_then_90_Cnt >= 10)   //ÈËÌåµÍÊª±¨¾¯
2364   1        if(Working_Normal >= (u16)1200)
2365   1        {
2366   2          if(RT_SHIDU<(u16)c)   //2014-07-23    µÍÊª¶È±¨¾¯
2367   2          {
2368   3            if(LoHumity_Count<(u8)250) 
2369   3            {
2370   4              LoHumity_Count++;
2371   4            }       
2372   3          }
2373   2          else
2374   2          {
2375   3            LoHumity_Count=0;
2376   3          }
2377   2        }
2378   1        else
2379   1        {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 40  

2380   2           LoHumity_Count=0;
2381   2        }  
2382   1       
2383   1      //³öÆø¿ÚµÍÎÂ±¨¾¯
2384   1        //if(CQK_Temp >= Set_CQK_Temp - 10) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2385   1        if(CQK_Temp >= 300) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2386   1        {    
2387   2          CQK_Temp_Reach_Set_Cnt++;
2388   2          if(CQK_Temp_Reach_Set_Cnt >= (u8)10)//Á¬Ðø10Ãë´ïµ½
2389   2          {
2390   3            CQK_Temp_Reach_Set_Cnt = 10;
2391   3          }
2392   2        }
2393   1        else
2394   1        {
2395   2          if(CQK_Temp_Reach_Set_Cnt < (u8)10)//10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2396   2          {
2397   3            CQK_Temp_Reach_Set_Cnt = 0;
2398   3          }
2399   2        } 
2400   1      
2401   1        if(Working_Normal >= (u16)1200)
2402   1        {
2403   2          if((CQK_Temp < (Const_NoninvasChamberTemp_Min - 10))
2404   2           &&(Work_Mode==(u8)Invasive_Mode))//ÓÐ´´Ä£Ê½²ÅÓÐ³öÆø¿ÚµÍÎÂ±¨¾¯
2405   2          {
2406   3            if(LoTemp_CQK_Count<(u8)240)
2407   3            {
2408   4              if(CQK_Temp_Reach_Set_Cnt>= (u8)10)//Èô´ïµ½¹ýÎÂ¶ÈÔò¼Ó¿ìËÙ¶È
2409   4              {
2410   5                //LoTemp_CQK_Count += 12;
2411   5                LoTemp_CQK_Count++;
2412   5              }
2413   4              else
2414   4              {
2415   5                LoTemp_CQK_Count++;
2416   5              }
2417   4            }
2418   3          }
2419   2          else
2420   2          {
2421   3            LoTemp_CQK_Count=0;
2422   3          }     
2423   2        }
2424   1        else
2425   1        {
2426   2          LoTemp_CQK_Count=0;
2427   2        }
2428   1      }
2429          
2430          void SaveDateToFlashFunc(void)
2431          {
2432   1      
2433   1        uint16_t a,b,c;//
2434   1        UINT32 Adress;  
2435   1        INT tmp=0;
2436   1        if(Enable_Save_Data>=(uint8_t)1)
2437   1        {
2438   2          Enable_Save_Data++;
2439   2          if(Enable_Save_Data>=(uint8_t)10)
2440   2          {
2441   3            Enable_Save_Data=(uint8_t)0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 41  

2442   3          }     
2443   2        }
2444   1        if(Enable_Save_Data==(uint8_t)2)
2445   1        {
2446   2          if(((Run_Count-(u16)1)%(u16)256)==(u16)0)//Ò»¸öÉÈÇøÎª4K£¬Ã¿´Î´æ´¢µÄÊý¾ÝÎª16×Ö½Ú£¬¼´256×éÊý¾Ý¼´Îª4K 256*1
             -6=4096;
2447   2          {
2448   3            //Çå³ýÏÂÃæ256µÄÊý¾Ý
2449   3            Adress=Run_Count-(u16)1;   //¼ÙÉèÎª257-1=256
2450   3            Adress=(Adress<<4);  //  256*16= 4096
2451   3            Adress=Adress+(UINT32)0x2000;//ÆðÊ¼µØÖ·Îª0X2000£¬¼´8192Îª±£Áô×Ö½Ú
2452   3            SPI_Erase_Sector(Adress);
2453   3          }
2454   2        }
2455   1        else  if(Enable_Save_Data==(uint8_t)3)//´æ·ÅÊý¾Ý
2456   1        {
2457   2          Adress=Run_Count-(u16)1;
2458   2          Adress=(Adress<<4);
2459   2          Adress=Adress+(UINT32)0x2000; 
2460   2           
2461   2          {
2462   3            RX8010_GetTime(SaveData);
2463   3      
2464   3            //LCD_ShowxNum(POS_RT_RH_X-40,5,16,3,SaveData[2],0x80,BLACK18); //
2465   3      
2466   3            a = (((u16)SaveData[2]&(u16)0x0F)%(u16)10) + ((((u16)SaveData[2]>>(u16)4)& (u16)0x03)*(u16)10);
2467   3            SaveData[2] = (uint8_t)a;//×ª»»Îª24Ð¡Ê±ÖÆÐ¡Ê±
2468   3      
2469   3            //LCD_ShowxNum(POS_RT_RH_X-40,45,16,3,SaveData[2],0x80,BLACK18); //
2470   3            
2471   3            if(SaveData[2] >= (u8)12)
2472   3            {
2473   4              a = (uint16_t)((u8)0x80 | (u8)0x20);//PM
2474   4              SaveData[2] -= (u8)12;
2475   4            }
2476   3            else
2477   3            {
2478   4              a = 0x80;//AM
2479   4            }
2480   3            b = (u16)SaveData[2]/(u16)10;
2481   3            c = (u16)SaveData[2]%(u16)10;
2482   3            SaveData[2] = (uint8_t)(((b << 4) + c) | a);//Ê±¼ä×ª»»ÎªDS1302¸ñÊ½
2483   3             
2484   3             //LCD_ShowxNum(POS_RT_RH_X-40,95,16,3,SaveData[2],0x80,BLACK18); //
2485   3          }
2486   2              
2487   2          SaveData[7]=ERR_Kind;
2488   2          if(RTD_Sensor_Err!=(uint8_t)0) 
2489   2          {
2490   3            SaveData[7]|=(uint8_t)0x20;
2491   3          }
2492   2          if(CQK_Sensor_Err!=(uint8_t)0)
2493   2          {
2494   3            SaveData[7]|=(uint8_t)0x40;
2495   3          }     
2496   2          if(JRP_Sensor_Err!=(uint8_t)0)
2497   2          {
2498   3            SaveData[7]|=(uint8_t)0x80;
2499   3          }   
2500   2          
2501   2          
2502   2      //    SaveData[8]=(uint8_t)RT_Temp/256;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 42  

2503   2      //    SaveData[9]=(uint8_t)(RT_Temp%256);
2504   2          tmp=RT_Temp/256;
2505   2          SaveData[8]=(uint8_t)tmp;
2506   2          tmp=RT_Temp%256;
2507   2          SaveData[9]=(uint8_t)tmp;
2508   2          
2509   2          SaveData[10]=(uint8_t)(RT_SHIDU/(u16)256);
2510   2          SaveData[11]=(u8)(RT_SHIDU%(u16)256); 
2511   2          
2512   2          
2513   2          //SaveData[10]=CONTROL_RT_SHIDU/256;  //2015-06-04 ´æ´¢ÕæÊµµÄÊª¶È
2514   2          //SaveData[11]=CONTROL_RT_SHIDU%256; 
2515   2      
2516   2          tmp=(INT)CQK_Temp/256;
2517   2          SaveData[12]=(uint8_t)tmp;  
2518   2          tmp=(INT)CQK_Temp%256;
2519   2          SaveData[13]=(uint8_t)tmp;
2520   2          tmp=JEP_Temp/256;
2521   2          SaveData[14]=(uint8_t)tmp;
2522   2          tmp=JEP_Temp%256;
2523   2          SaveData[15]=(uint8_t)tmp;
2524   2          
2525   2      //    SaveData[12]=(uint8_t)(CQK_Temp/256);     
2526   2      //    SaveData[13]=(uint8_t)(CQK_Temp%256);
2527   2      //    SaveData[14]=(uint8_t)(JEP_Temp/256);
2528   2      //    SaveData[15]=(uint8_t)(JEP_Temp%256);
2529   2          SPI_Write_nBytes(Adress,16,&SaveData[0]);
2530   2      
2531   2        }
2532   1        else if(Enable_Save_Data==(uint8_t)4)  //´æ·ÅÊý¾ÝµØÖ·
2533   1        {
2534   2          Store_Data();      
2535   2        }
2536   1        else if(Enable_Save_Data==(uint8_t)5)  //²Áµ÷Êý¾Ý
2537   1        {
2538   2          //Çå³ýËùÓÐÊý¾Ý,ÖØÐÂ¼ÆÊý
2539   2          if(Run_Count>=(u16)44896) 
2540   2          {
2541   3            SPI_Erase_Sector(0x000);
2542   3          }
2543   2        }
2544   1        else if(Enable_Save_Data==(uint8_t)6)  //²Áµ÷Êý¾Ý
2545   1        {
2546   2          //Çå³ýËùÓÐÊý¾Ý,ÖØÐÂ¼ÆÊý
2547   2          if(Run_Count>=(u16)44896) 
2548   2          { 
2549   3            SPI_Erase_Sector(0x1000);        
2550   3            Run_Count=0;
2551   3          }  
2552   2        } 
2553   1        else if(Enable_Save_Data==(uint8_t)9)  //²ÁÊý¾Ý
2554   1        {
2555   2          //do nothing
2556   2        } 
2557   1        else
2558   1        {
2559   2          //do nothing
2560   2        }
2561   1      }
2562          
2563          
2564          void  Init_port(void) //³õÊ¼»¯¶Ë¿Ú×´Ì¬--------------------------------
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 43  

2565          {
2566   1        uint16_t j=0;
2567   1      
2568   1        P1M1=0x08;  //P13Îª¸ß×èÊäÈë Wire_out_FB
2569   1        P1M0=0x0;
2570   1        P2M1=0x70;//P24-P26È«Éè¶¨³É¿ªÂ©Êä³ö
2571   1        P2M0=0xF0;
2572   1        P3M1=0x18;  //P34,P33Îª¸ß×èÊäÈë Wire_In_FB  Plant_FB 
2573   1        P3M0=0x64;  //P35,P36,P32ÎªÇ¿Êä³ö  Heat_Plant_Out  Heat_Wire_In  Heat_JRP_EN_OUT  
2574   1        P4M1=0x00;  //IO Port initialization
2575   1        P4M0=0x09;  //P40,P43ÎªÇ¿Êä³ö
2576   1        P4SW=0x70;  
2577   1      
2578   1        WDT_CONTR = 0x3F; //WDT Enable(4.55S)   
2579   1        LCD_LIGHT_CLOSE;  
2580   1      //  Rec_Count=0;
2581   1        Buzzer_Port=(bit)0;
2582   1        Heat_JRP_Port=(bit)0;
2583   1        Heat_WireIn_Port=(bit)0;
2584   1        Heat_WireOut_Port=(bit)0;
2585   1        Heat_WIRE_EN_OUT = (bit)1;
2586   1        EX1=(bit)1;
2587   1        IT1=(bit)1;  
2588   1        LCD_1DIR_L;     
2589   1        JEP_Temp=0;
2590   1        EA=(bit)1;  //
2591   1         
2592   1        EUSART_Initialize();//Uart initialization
2593   1        SPI_init();//SPI Flash initialization
2594   1        LCD_Initial();//TFT LCD initialization  
2595   1         
2596   1        //Holding down these two keys for three seconds at boot time will enter service mode. 
2597   1        if((KEY_LEFT_UP_IN==0)&&(KEY_LEFT_DOWN_IN==0))
2598   1        {
2599   2          Work_State = UI_STATE_SERVICE_MODE;
2600   2        }
2601   1        else
2602   1        {
2603   2          Work_State = UI_STATE_POST_MODE;
2604   2        }
2605   1        
2606   1      //Holding down these two keys for three seconds at boot time will enter Data Reading Interface. 
2607   1        if((KEY_LEFT_DOWN_IN==0) &&(KEY_RIGHT_DOWN_IN==0))
2608   1        {
2609   2          Work_State = UI_STATE_DATAREADER_MODE;//Êý¾Ý´«Êä½çÃæ
2610   2      //    ET0=0;
2611   2      //    TR0=0;
2612   2          Back_Color=WHITE18; 
2613   2      
2614   2          Draw_Rectangle_Real(0,0,239,319,WHITE18);
2615   2      //Display Data Reading Interface=============== DATA OUTPUT...
2616   2          for(j=4;j<(u16)8;j++)
2617   2          {
2618   3              DISP_FNT10X24((u8)115,(u16)100+((j-(u16)4)*(u16)12),(uint8_t)j,BLUE18);
2619   3          }
2620   2          for(j=j;j<(u16)14;j++)
2621   2          {
2622   3              DISP_FNT10X24((u8)115,(u16)100+((j-(u16)3)*(u16)12),(uint8_t)j,BLUE18);
2623   3          }   
2624   2          DISP_FNT10X24((u8)115,(u16)100+((u16)11*(u16)12),(u8)14,BLUE18);
2625   2          DISP_FNT10X24((u8)115,(u16)100+((u16)12*(u16)12),(u8)14,BLUE18);
2626   2          DISP_FNT10X24((u8)115,(u16)100+((u16)13*(u16)12),(u8)14,BLUE18);  
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 44  

2627   2      
2628   2      //Display soft version
2629   2          LCD_Show_Verion();  
2630   2          LCD_LIGHT_OPEN;
2631   2        }
2632   1        
2633   1        Test_Mode_Dis_Jrp_Ctl = DISPLAY_TEST_DATA_EN_DIS_DEF; //LCD Displays Working Data at Runningtime
2634   1      }
2635          
2636          void  Main_Init(void) //Ö÷³ÌÐò³õÊ¼»¯
2637          {
2638   1        Get_RunCount();  //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý  
2639   1      
2640   1        Diplay_RTtemp = (uint16_t)RT_Temp;
2641   1        
2642   1        CQK_Sensor_Err=(uint8_t)0;
2643   1        RTD_Sensor_Err=(uint8_t)0;
2644   1        JRP_Sensor_Err=(uint8_t)0;
2645   1        SHIDU_Sensor_Err=(uint8_t)0;
2646   1      
2647   1        Back_Color=BRIGHT_BLUE18 ;
2648   1      
2649   1        WireOut_State=0;
2650   1        WireIn_State=0;   
2651   1      
2652   1        Wire_Mode_Sel = Wire_Sel_Double;//Ä¬ÈÏÎªË«Ö§¼ÓÈÈ»ØÂ·
2653   1        Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
2654   1      
2655   1        Wire_Warm_Up_Sec = 0; //µ±<=300Ê±ÏÞÖÆ×î´ó¼ÓÈÈ¹¦ÂÊ
2656   1        Plate_Warm_Up_Sec = 0;
2657   1      
2658   1        Set_CQK_Temp_Comp = 360;//³õÊ¼»¯
2659   1        Humidity_No_Change_Sec = 0;//Êª¶È²»¸Ä±äµÄ¼ÆÊý 
2660   1        
2661   1        JEP_Temp_Aim = (INT)((INT)Set_CQK_Temp + 100);     //¼ÓÈÈÅÌÄ¿±êÎÂ¶È 400 - 530
2662   1        Controler_temp3.Sum_error = 0;
2663   1        Controler_temp3.Ek = 0;
2664   1        Controler_temp3.Ek1 = 0;
2665   1        Controler_temp3.Ek2 = 0;
2666   1      }
2667          
2668          
2669          
2670          //²âÊÔÄ£Ê½Ê±ÏÔÊ¾ÎÂ¶È
2671          //ºÍÕý³£¹¤×÷Ê±µÄÇø±ðÔÚÓÚÊµÊ±ÐÔ
2672          void ServiceMode_TempHumidy_Disp(void)
2673          {
2674   1        uint16_t Disp,color;
2675   1      //  bit Disp_Err;
2676   1        Back_Color=WHITE18; 
2677   1      //  Disp_Err=0;   
2678   1      
2679   1        if((CQK_Temp>=0x0FFF) || (No_CQKSensor_Times>(u16)20) ) //³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â
2680   1        {
2681   2          CQK_Sensor_Err=(uint8_t)1;
2682   2          CQK_Temp = 0;
2683   2        }
2684   1        else
2685   1        {
2686   2          CQK_Sensor_Err=(uint8_t)0;
2687   2        }
2688   1          
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 45  

2689   1        if(No_ReadData_SHIDU_Times>(uint8_t)10)//ÈËÌå¶ËÊª¶È´«¸ÐÆ÷´íÎó¼ì²â
2690   1        {
2691   2          SHIDU_Sensor_Err=(uint8_t)1;
2692   2          RT_SHIDU = 0; 
2693   2        }   
2694   1        else
2695   1        {
2696   2          SHIDU_Sensor_Err=(uint8_t)0;
2697   2        }
2698   1      
2699   1        if((No_ReadData_Temp_Times>(u8)20) || (ERR_RT_Temp_Times>(u8)10))//ÈËÌå¶ËÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â 2014-07-03
2700   1        {    
2701   2          RTD_Sensor_Err=(uint8_t)1;
2702   2          RT_Temp = 0;    
2703   2          Diplay_RTtemp = 0;
2704   2        }
2705   1        else
2706   1        {
2707   2          RTD_Sensor_Err=(uint8_t)0;
2708   2        }
2709   1          
2710   1            
2711   1        if( No_HeatSensor_Times>(u8)20)//¼ÓÈÈÅÌ´«¸ÐÆ÷´íÎó¼ì²â
2712   1        {
2713   2          JRP_Sensor_Err=(uint8_t)1;
2714   2          JEP_Temp = 0;
2715   2        }
2716   1        else
2717   1        {
2718   2          JRP_Sensor_Err=(uint8_t)0;
2719   2        }
2720   1          
2721   1      
2722   1        //ÈËÌå¶ËÎÂ¶È
2723   1        {
2724   2          Disp=(uint16_t)RT_Temp;
2725   2      //    Disp_Err=RTD_Sensor_Err;      
2726   2        }
2727   1        color=BLACK18;   
2728   1      
2729   1        if(Disp>=(u16)1000)
2730   1        {
2731   2          DISP_TEMP_30X56((POS_RT_TEMP_X-8),POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
2732   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+34,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);  
             - 
2733   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+73,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
2734   2          Draw_Rectangle_Real(POS_RT_TEMP_X+1-8,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8-8,POS_RT_TEMP_Y+71,WHITE18); //È¥
             -µôÐ¡Êýµã
2735   2        }
2736   1        else
2737   1        {
2738   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
2739   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+34,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
2740   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+(34*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
2741   2          Draw_Rectangle_Real(POS_RT_TEMP_X+1-8,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8-8,POS_RT_TEMP_Y+71,(uint8_t)color
             -); //»­µã
2742   2        }     
2743   1      
2744   1        //³öÆø¿ÚÎÂ¶È
2745   1        Disp=(uint16_t)CQK_Temp; 
2746   1        if(Disp>=(u16)1000)
2747   1        {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 46  

2748   2          DISP_RH_17X40(55,POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
2749   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+20,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);   
2750   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+(20*2)+5,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
2751   2          Draw_Rectangle_Real(56,POS_RT_TEMP_Y+40,61,POS_RT_TEMP_Y+43,WHITE18); //È¥µôÐ¡Êýµã
2752   2        }
2753   1        else
2754   1        {
2755   2          DISP_RH_17X40(55,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
2756   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+20,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
2757   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+(20*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
2758   2          Draw_Rectangle_Real(56,POS_RT_TEMP_Y+40,61,POS_RT_TEMP_Y+43,(uint8_t)color); //»­µã
2759   2        }
2760   1         
2761   1        //¼ÓÈÈÅÌÎÂ¶È
2762   1        Disp=(uint16_t)JEP_Temp;
2763   1        if(Disp>=(u16)1000)
2764   1        {
2765   2          DISP_RH_17X40(5,POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
2766   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+20,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);   
2767   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+(20*2)+5,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
2768   2          Draw_Rectangle_Real(51,POS_RT_TEMP_Y+40,56,POS_RT_TEMP_Y+43,WHITE18); //È¥µôÐ¡Êýµã
2769   2        }
2770   1        else
2771   1        {
2772   2          DISP_RH_17X40(5,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
2773   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+20,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
2774   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+(20*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
2775   2          Draw_Rectangle_Real(6,POS_RT_TEMP_Y+40,11,POS_RT_TEMP_Y+43,(uint8_t)color); //»­µã
2776   2        } 
2777   1      
2778   1        //ÏÔÊ¾Êª¶È
2779   1        { 
2780   2          DISP_RH_17X40(POS_RT_RH_X+2,POS_RT_RH_Y,(uint8_t)(RT_SHIDU%(u16)1000/(u16)100),(uint8_t)color);
2781   2          DISP_RH_17X40(POS_RT_RH_X+2,POS_RT_RH_Y+19,(u8)(RT_SHIDU%(u16)100/(u16)10),(uint8_t)color);
2782   2        }   
2783   1      }
2784          
2785          //½«Éè¶¨µÄ²ÎÊýÐ´Èëµ½STC EEPROM
2786          //×¢Òâ£º¿ª»úÊ±±ØÐë°ÑFLASHµÄÊý¾Ý¶ÁÈëµ½RAMÄÚ
2787          void Setting_write_to_flash(void)
2788          { 
2789   1        STC_IAP_Sector_Erase(DATA_FLASH_ADDRESS_Set_RT_YCTemp);           //²Á³ýÕû¸öÉÈÇø
2790   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_First, data_flash.First);//½« DEBUG_DATA Ð´Èë EEPROM
2791   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Work_Mode, data_flash.Work_Mode);//
2792   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_RT_WCTemp, data_flash.Set_RT_WCTemp);//
2793   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_RT_YCTemp, data_flash.Set_RT_YCTemp);//
2794   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_In_Exp_Ratio, data_flash.In_Exp_Ratio);//
2795   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_CQK_WCTemp, data_flash.Set_CQK_WCTemp);//
2796   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_CQK_YCTemp, data_flash.Set_CQK_YCTemp);//
2797   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Language, data_flash.Language);//
2798   1      }
2799          
2800          //½«Ä¬ÈÏµÄ²ÎÊýÐ´Èëµ½STC EEPROM
2801          static void Write_Default_Setting_to_flash(void) //°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2802          {
2803   1        data_flash.First = (u8)'Z';
2804   1        data_flash.Work_Mode = Invasive_Mode;//ÓÐ´´
2805   1        data_flash.Set_RT_WCTemp = (340/5);//
2806   1        data_flash.Set_RT_YCTemp = (390/5);//
2807   1        data_flash.In_Exp_Ratio = 4;//1:1.3
2808   1        data_flash.Set_CQK_WCTemp = (310/5);//
2809   1        data_flash.Set_CQK_YCTemp = (360/5);//
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 47  

2810   1        //data_flash.Language = Lan_English;
2811   1      
2812   1        Setting_write_to_flash();//Ð´Èëµ½FLASH
2813   1      }
2814          
2815          
2816          void Mem_Flash_Recall(void) //¶ÁÈ¡ÉÏ´ÎµÄ¼ÇÒä²¢ÑéÖ¤Êý¾Ý
2817          {
2818   1        data_flash.First = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_First);    //¶ÁEEPROMµÄÖµ
2819   1        data_flash.Work_Mode = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Work_Mode);    
2820   1        data_flash.Set_RT_WCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_RT_WCTemp);    
2821   1        data_flash.Set_RT_YCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_RT_YCTemp);    
2822   1        data_flash.In_Exp_Ratio = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_In_Exp_Ratio);  
2823   1        data_flash.Set_CQK_WCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_CQK_WCTemp);    
2824   1        data_flash.Set_CQK_YCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_CQK_YCTemp); 
2825   1        data_flash.Language = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Language); 
2826   1        
2827   1        if( //Ð£ÑéÊý¾ÝÊÇ·ñÕýÈ·
2828   1            (data_flash.First != (u8)'Z')
2829   1            ||(data_flash.Work_Mode > (u8)1) 
2830   1            ||(data_flash.Set_RT_WCTemp > (u8)(Const_NoninvasPatientTemp_Max/5)) //370/5 = 74;  
2831   1            ||(data_flash.Set_RT_WCTemp < (u8)(Const_NoninvasPatientTemp_Min/5)) //300/5 = 60;  
2832   1            ||(data_flash.Set_RT_YCTemp > (u8)(Const_InvasPatientTemp_Max/5)) //400/5 = 80; 
2833   1            ||(data_flash.Set_RT_YCTemp < (u8)(Const_InvasPatientTemp_Min/5)) //350/5 = 70;
2834   1            ||(data_flash.In_Exp_Ratio > (u8)6)
2835   1            ||(data_flash.In_Exp_Ratio < (u8)1)
2836   1            ||(data_flash.Set_CQK_WCTemp > (u8)(Const_NoninvasChamberTemp_Max/5)) //360/5 = 74;  
2837   1            ||(data_flash.Set_CQK_WCTemp < (u8)(Const_NoninvasChamberTemp_Min/5)) //310/5 = 60;  
2838   1            ||(data_flash.Set_CQK_YCTemp > (u8)(Const_InvasChamberTemp_Max/5))  //400/5 = 80; 
2839   1            ||(data_flash.Set_CQK_YCTemp < (u8)(Const_InvasChamberTemp_Min/5))  //350/5 = 70;
2840   1            ||(data_flash.Language > (u8)Lan_French)//×î¶à4ÖÖÓïÑÔ
2841   1          )
2842   1        {
2843   2          data_flash.Language = Lan_English;
2844   2          Write_Default_Setting_to_flash();//°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2845   2        }
2846   1      }
2847          
2848          
2849          
2850          void Load_Settings_Before_Choice(void)//ÔÚÑ¡Ôñ·½¿ò³öÏÖÖ®Ç°£¬Òª´¦ÀíµÄÊý¾Ý£¬ÒÔÍ¬Ê±¼æÈÝÓÐÎÞÑ¡Ôñ¼ÇÒä½çÃæ³ÌÐò
2851          {
2852   1        if(defalut_mode == (u8)Load_Fac_MODE)  //ÈôÊÇ¹¤³§Ä¬ÈÏÉè¶¨  
2853   1        {
2854   2          Write_Default_Setting_to_flash();//°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2855   2        }
2856   1      
2857   1        Work_Mode = data_flash.Work_Mode;  //¹¤×÷Ä£Ê½
2858   1        Set_RT_WCTemp = data_flash.Set_RT_WCTemp * (u16)5;//
2859   1        Set_RT_YCTemp = data_flash.Set_RT_YCTemp * (u16)5;//
2860   1        Set_CQK_WCTemp = data_flash.Set_CQK_WCTemp * (u16)5;//
2861   1        Set_CQK_YCTemp = data_flash.Set_CQK_YCTemp * (u16)5;//
2862   1        In_Exp_Ratio = data_flash.In_Exp_Ratio;  //
2863   1      
2864   1        if(Work_Mode==(u8)0)  
2865   1        {     
2866   2          Set_RT_Temp=(INT)Set_RT_WCTemp;
2867   2          Set_CQK_Temp=Set_CQK_WCTemp;
2868   2        }
2869   1        else
2870   1        {
2871   2          Set_RT_Temp=(INT)Set_RT_YCTemp; 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 48  

2872   2          Set_CQK_Temp=Set_CQK_YCTemp; 
2873   2        }
2874   1      }
2875          
2876          /*µÍ¹¦ÂÊÄ£Ê½
2877          ¹¦ÄÜ---½øÈë´ý»úÄ£Ê½Ê±£¬a,¼ÓÈÈÅÌ¼ÓÈÈÊ±³¤±»ÏÞ¶¨ÔÚ50ÇÒÎÂ¶È²»³¬¹ý50¶È
2878                                 b,»ØÂ··¢ÈÈË¿¼ÓÈÈÊ±³¤±»ÏÞ¶¨ÔÚ40
2879          Ä¿µÄ---µ±³öÏÖÈËÌå¶Ë»ò³öÆø¿ÚµÍÎÂ±¨¾¯Ê±£¬³ýÁËÆøÔ´£¬»ØÂ·±»¶ÂµÈÔ­ÒòÍâ£¬»¹ÓÐ¿ÉÄÜÊÇÌ½Í·ÍÑÂä£¬
2880                  ÈôÍêÈ«²»¼ÓÈÈ£¬ÔòÔÚÓÃ»§Î´¸ÉÔ¤Ê±ÍêÈ«²»¼ÓÈÈÖÁÀäÈ´µ½ÊÒÎÂ£¬ÓÃ»§¿ÉÄÜ»áÈÏÎª»úÆ÷ÓÐÑÏÖØ¹ÊÕÏ
2881                  Èô°´Õý³£Ä£Ê½¼ÓÈÈ£¬Ôò¿ÉÄÜ»áÓÉÓÚÌ½Í·ÍÑÂäµ¼ÖÂ´ó¹¦ÂÊ¼ÓÈÈ£¬ÒýÆð³¬ÎÂ¶ø²úÉú·çÏÕ¡£
2882          ½øÈë´ý»úÄ£Ê½Ìõ¼þ---ÈËÌå¶Ë»ò³öÆø¿Ú³öÏÖµÍÎÂ±¨¾¯£¬ÇÒÓÐ±¨¾¯ÒôÊ±
2883          ÍË³ö´ý»úÄ£Ê½Ìõ¼þ---µÍÎÂ±¨¾¯½â³ý£¬»ò°´ÏûÒô¼ü¿ÉÔÝÊ±ÍË³ö90S
2884          */
2885          void LowPowerModeFunc(void)  
2886          { 
2887   1        if(((LoTemp_Count > (uint8_t)120) || (LoTemp_CQK_Count > (uint8_t)120))||(Bit_is_one(ERR_Kind,Alarm_Const
             -_NoWater)!=(uint8_t)0)) //ÎÞË®(¸ÉÉÕ)±¨¾¯
2888   1        {
2889   2          if(   
2890   2               ((ERR_Kind & (uint8_t)0x01)!=(u8)0)//´«¸ÐÆ÷´íÎó
2891   2            || ((ERR_Kind & (uint8_t)0x02)!=(u8)0)//¸ßÎÂ
2892   2            || (Wire_Mode_Mismatch == (uint8_t)1)  //·¢ÈÈË¿Î´Ñ¡
2893   2            || (HeaterPlate_State==(uint8_t)0))//Ë®¹ÞÎ´×°ºÃ
2894   2          { 
2895   3          }
2896   2          else  
2897   2          {     
2898   3            if(AlarmSoundPauseStatus == (uint8_t)0)//Î´°´ÏÂ¾²Òô¼ü
2899   3            {
2900   4              Low_Power_Mode_Flag = (u16)1;//µÍ¹¦ÂÊÄ£Ê½±êÖ¾
2901   4              if(JEP_Temp<=450)
2902   4              {       
2903   5                Micro_Temp_Val=50;  //Í£Ö¹¼ÓÈÈ
2904   5              }
2905   4              else
2906   4              {
2907   5                Micro_Temp_Val=0;  //Í£Ö¹¼ÓÈÈ
2908   5              }
2909   4              Micro_Temp_In=40;
2910   4              Micro_Temp_Out=Micro_Temp_In;     
2911   4              Micro_Adj_Mode_Test = 4;//¼ÓÈÈÄ£Ê½²âÊÔ
2912   4            }
2913   3            else
2914   3            {
2915   4              Low_Power_Mode_Flag = (u16)0;
2916   4            }
2917   3          }
2918   2        }
2919   1        else
2920   1        {
2921   2          Low_Power_Mode_Flag = (u16)0;
2922   2        }
2923   1          
2924   1      }
2925          
2926          
2927          //ÔöÁ¿ControlerËã·¨
2928          //¦¤U = U(k)-U(k-1) = Kp*[e(k)-e(k-1)]+Ki*e(k)+Kd*[e(k)-2*e(k-1)+e(k-2)]
2929          //* ÆäÖÐ£ºKp¡¢Ki¡¢Kd·Ö±ðÎª±ÈÀý¡¢»ý·ÖºÍÎ¢·Ö·Å´óÏµÊý£¬u(k)±íÊ¾µÚk¸ö²ÉÑùÊ±¿Ì
2930          //µÄ¿ØÖÆÁ¿,e(k)±íÊ¾µÚk¸ö²ÉÑùÊ±¿ÌµÄº½ÏòÊäÈëÆ«²î.
2931          //PIE_UK = Kp*(Ek-Ek1)+Ki*EK+Kd*(Ek+Ek2-EK1)
2932          
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 49  

2933          //struct Controler
2934          //    {
2935          //      int Uk; //×ÜµÄ¿ØÖÆÁ¿
2936          //      int Uk1;//ÉÏ´ÎµÄ×Ü¿ØÖÆÁ¿
2937          //      int Sum_error;//Îó²î×ÜÁ¿
2938          //      int Ek;//µ±Ç°µÄ×ÜÎó²îÁ¿
2939          //      int Ek1;//Ç°Ò»´ÎµÄÎó²îÁ¿
2940          //      int Ek2;//Ç°¶þ´ÎµÄÎó²îÁ¿       
2941          //       }Controler_temp;//
2942          
2943          //ÓÐ·¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶È¿ØÖÆControlerËã·¨---¸ù¾Ý»¼Õß¶ËÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈ»ØÂ·Çý¶¯Öµ  Ã¿1Ãë¹¤×÷Ò
             -»´Î
2944          static void Controler_Calc(void) //Éè¶¨ÎÂ¶È×î¸ß400,×îµÍ000,Êµ¼Ê0-800,  
2945          {
2946   1      
2947   1        INT Vlaue1,tmp;
2948   1        static const INT Controler_Kp = 40;//±ÈÀýÏµÊý 5¶ÈÎª1500;1¶ÈÎª300;0.1¶ÈÎª30
2949   1        static const INT Controler_Ki = 8;//»ý·ÖÏµÊý
2950   1        static const INT Controler_Kd = 20;//Î¢·ÖÏµÊý   
2951   1      
2952   1        if(Controler_temp.Ek > 100)//10¶ÈÎª¼«ÏÞ 
2953   1        {
2954   2          Controler_temp.Ek = 100;
2955   2        }
2956   1        if(Controler_temp.Ek < -100)
2957   1        {
2958   2          Controler_temp.Ek = -100;
2959   2        }
2960   1        
2961   1        Controler_temp.Sum_error += Controler_temp.Ek;//Îó²î×ÜÁ¿
2962   1        if(Controler_temp.Sum_error > 3500) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
2963   1        {
2964   2          Controler_temp.Sum_error = 3500;
2965   2        }
2966   1        if(Controler_temp.Sum_error < -3500)
2967   1        {
2968   2          
2969   2        }
2970   1        Vlaue1 = Controler_Kp * Controler_temp.Ek;//±ÈÀý ×î´ó100*30=3000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=1250)
2971   1        
2972   1        tmp = Controler_temp.Sum_error * Controler_Ki / 50; //»ý·Ö ×î´ó3000*2/100=60,Ò»¸ö¼ÓÈÈÖÜÆÚÊÇ250´Î  250*5/1
             -5*3=250;
2973   1        Vlaue1 += tmp;
2974   1        tmp = ((Controler_temp.Ek - (2 * Controler_temp.Ek1)) + Controler_temp.Ek2) * Controler_Kd;//Î¢·Ö 
2975   1        Controler_temp.Sum_error = Controler_temp.Sum_error + tmp;//2015-06-16 °ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
2976   1        Vlaue1 += tmp;
2977   1        Controler_temp.Uk = Vlaue1;// Controler_temp.Uk1 + Vlaue1;       // ½á¹û /100×î´óÎª250´Î
2978   1        if(Controler_temp.Uk > 780) 
2979   1        {
2980   2          Controler_temp.Uk = 780;
2981   2        }
2982   1        else if(Controler_temp.Uk < 0)
2983   1        {
2984   2          Controler_temp.Uk = 0;//²»ÄÜÎª¸ºÊý
2985   2        }
2986   1        else
2987   1        {
2988   2          //do nothing
2989   2        }
2990   1      
2991   1        Controler_temp.Uk /= 4;//×î¸ß190;   
2992   1          
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 50  

2993   1        Controler_temp.Ek2 = Controler_temp.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
2994   1        Controler_temp.Ek1 = Controler_temp.Ek;
2995   1      }
2996          
2997          
2998          //¼ÓÈÈÅÌÇý¶¯µÄControlerËã·¨--- ¸ù¾Ý¼ÓÈÈÅÌµÄÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈ»ØÂ·Çý¶¯Öµ  Ã¿1Ãë¹¤×÷Ò»´Î
2999          static void HeatPlate_Controler_Calc(void) //Éè¶¨ÎÂ¶È×î¸ß400,×îµÍ000,Êµ¼Ê0-800,  
3000          {
3001   1      
3002   1        INT Vlaue1,tmp;
3003   1      //  uint16_t  Val_Calc;
3004   1        static const INT Controler_Kp2 = 38;//±ÈÀýÏµÊý //±ÈÀýÏµÊý 10¶ÈÎª4000/20=200;1¶ÈÎª400/20=20;0.1¶ÈÎª2
3005   1        static const INT Controler_Ki2 = 8;//»ý·ÖÏµÊý
3006   1        static const INT Controler_Kd2 = 20;//Î¢·ÖÏµÊý  
3007   1      
3008   1        if(Controler_temp2.Ek > 100)//10¶ÈÎª¼«ÏÞ 
3009   1        {
3010   2          Controler_temp2.Ek = 100;
3011   2        }
3012   1        if(Controler_temp2.Ek < -100)
3013   1        {
3014   2          Controler_temp2.Ek = -100;
3015   2        }
3016   1        
3017   1        Controler_temp2.Sum_error += Controler_temp2.Ek;//Îó²î×ÜÁ¿
3018   1        if(Controler_temp2.Sum_error > 3500) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
3019   1        {
3020   2          Controler_temp2.Sum_error = 3500;
3021   2        }
3022   1        if(Controler_temp2.Sum_error < -3500)
3023   1        {
3024   2          Controler_temp2.Sum_error = -3500;
3025   2        }   
3026   1      
3027   1        Vlaue1 = Controler_Kp2 * Controler_temp2.Ek;//±ÈÀý ×î´ó100*30=3000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=125
             -0)
3028   1        
3029   1        tmp = Controler_temp2.Sum_error * Controler_Ki2/50; //»ý·Ö ×î´ó3000*2/100=60,Ò»¸ö¼ÓÈÈÖÜÆÚÊÇ250´Î  250*5/1
             -5*3=250;
3030   1        Vlaue1 += tmp;
3031   1        tmp = ((Controler_temp2.Ek - (2 * Controler_temp2.Ek1)) + Controler_temp2.Ek2) * Controler_Kd2;//Î¢·Ö 
3032   1        Controler_temp2.Sum_error = Controler_temp2.Sum_error + tmp;//2015-06-16 °ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
3033   1        Vlaue1 += tmp;
3034   1        Controler_temp2.Uk = Vlaue1;//;       // ½á¹û /100×î´óÎª250´Î
3035   1        if(Controler_temp2.Uk > 780) 
3036   1        {
3037   2          Controler_temp2.Uk = 780;
3038   2        }
3039   1        else if(Controler_temp2.Uk < 0)
3040   1        {
3041   2          Controler_temp2.Uk = 0;//²»ÄÜÎª¸ºÊý
3042   2        }
3043   1        else 
3044   1        {
3045   2          //do nothing
3046   2        }
3047   1      
3048   1        Controler_temp2.Uk /= 4;//×î¸ß195;    
3049   1      
3050   1        Controler_temp2.Ek2 = Controler_temp2.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
3051   1        Controler_temp2.Ek1 = Controler_temp2.Ek;
3052   1      }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 51  

3053          
3054          
3055          //¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈµÄControlerËã·¨--- ¸ù¾Ý³öÆø¿ÚµÄÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈµÄÆ«²î, Ã¿20Ãë¹¤×÷Ò
             -»´Î
3056          static void HeatPlateTemp_Aim_Controler_Calc(void) // 
3057          {
3058   1        INT Vlaue1,tmp;
3059   1      //  uint16_t  Val_Calc;
3060   1        static const INT Controler_Kp3 = 40;//±ÈÀýÏµÊý 10¶ÈÎª4000/100=40;1¶ÈÎª400/100=4;0.1¶ÈÎª0.4
3061   1        static const INT Controler_Ki3 = 1;//»ý·ÖÏµÊý
3062   1        static const INT Controler_Kd3 = 80;//Î¢·ÖÏµÊý  
3063   1      
3064   1        if(Controler_temp3.Ek > 100)//10¶ÈÎª¼«ÏÞ 
3065   1        {
3066   2          Controler_temp3.Ek = 100;
3067   2        }
3068   1        if(Controler_temp3.Ek < -100)
3069   1        {
3070   2          Controler_temp3.Ek = -100;
3071   2        }
3072   1        
3073   1        Controler_temp3.Sum_error += Controler_temp3.Ek;//Îó²î×ÜÁ¿
3074   1        if(Controler_temp3.Sum_error > 1000) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
3075   1        {
3076   2          Controler_temp3.Sum_error = 1000;
3077   2        }
3078   1        if(Controler_temp3.Sum_error < -1000)
3079   1        {
3080   2          Controler_temp3.Sum_error = -1000;
3081   2        }   
3082   1      
3083   1        Vlaue1 = Controler_Kp3 * Controler_temp3.Ek;//±ÈÀý ×î´ó100*40=4000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=125
             -0)
3084   1      
3085   1        
3086   1        tmp = Controler_temp3.Sum_error * Controler_Ki3; //»ý·Ö ×î´ó3500*8/100=280
3087   1        Vlaue1 += tmp;
3088   1        //tmp = (Controler_temp3.Ek - (2 * Controler_temp3.Ek1) + Controler_temp3.Ek2) * Controler_Kd3;//Î¢·Ö 
3089   1        tmp = (((2 * Controler_temp3.Ek) - Controler_temp3.Ek1) - Controler_temp3.Ek2) * Controler_Kd3;//Î¢·Ö 
3090   1        Controler_temp3.Sum_error = Controler_temp3.Sum_error + tmp;//°ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
3091   1        Vlaue1 += tmp;
3092   1        Controler_temp3.Uk = Vlaue1;// Controler_temp.Uk1 + Vlaue1;       // ½á¹û /100×î´óÎª250´Î
3093   1        if(Controler_temp3.Uk > 5000) 
3094   1        {
3095   2          Controler_temp3.Uk = 5000;
3096   2        }
3097   1        else if(Controler_temp3.Uk < -5000)
3098   1        {
3099   2          Controler_temp3.Uk = -5000;//¸ºÊý
3100   2        }
3101   1        else 
3102   1        {
3103   2          //do nothing
3104   2        }
3105   1      
3106   1        Controler_temp3.Uk /= 100;//×î¸ß50;     
3107   1      
3108   1        Controler_temp3.Ek2 = Controler_temp3.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
3109   1        Controler_temp3.Ek1 = Controler_temp3.Ek;
3110   1      }
3111          
3112          
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 52  

3113          //ÎÞ»ØÂ··¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶Èµ÷½Ú
3114          //static uint16_t NoneWire_Warm_Up_Sec=0;
3115          static void PatientTemp_NoneHeatWire_Adj(void)
3116          {
3117   1        static uint16_t NoneWire_Warm_Up_Sec=0;
3118   1        static INT err_sum=0;
3119   1        static INT RT_Temp_Mem = 0;
3120   1        //  static uint16_t WarmUpstate=0;
3121   1        INT Calc_int=0;
3122   1        uint16_t Val_Calc;      
3123   1      
3124   1        {
3125   2          if(CQK_Temp < 330)//Èô³öÆø¿ÚÎÂ¶ÈµÍÓÚ33¶ÈÔòÈ«¹¦ÂÊ¼ÓÈÈ
3126   2          {
3127   3            //Micro_Temp_Val = 190;
3128   3            //ÒÔÏÂÎª·¢ÈÈÅÌÎÂ¶ÈµÄControler¿ØÖÆ
3129   3            
3130   3            Controler_temp2.Ek = 980 - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
3131   3            HeatPlate_Controler_Calc(); 
3132   3            Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
3133   3            Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
3134   3            
3135   3            Temp2_Int = JEP_Temp;
3136   3            
3137   3          }
3138   2          else
3139   2          { 
3140   3            NoneWire_Warm_Up_Sec++;
3141   3            if(NoneWire_Warm_Up_Sec > (u16)2000)
3142   3            {
3143   4              NoneWire_Warm_Up_Sec = 2000;
3144   4            }
3145   3            if(NoneWire_Warm_Up_Sec < (u16)3)//00)//10·ÖÖÓÄÚÉè¶¨
3146   3            {
3147   4              //Temp2_Int = 500 + Set_RT_Temp - 300;//·¢ÈÈÅÌÎÂ¶ÈÉè¶¨ÔÚ50¶È-60¶È
3148   4              if(Temp2_Int < (550 + ((Set_RT_Temp - 300)*2)))//·¢ÈÈÅÌÎÂ¶ÈÉè¶¨ÔÚ50¶È-60¶È
3149   4              {
3150   5                Temp2_Int = 550 + ((Set_RT_Temp - 300)*2);
3151   5              } 
3152   4              RT_Temp_Mem = RT_Temp;
3153   4            }
3154   3            else
3155   3            { 
3156   4              err_sum = err_sum + Set_RT_Temp - RT_Temp;//»ý·Ö
3157   4              if(err_sum > 180)
3158   4              {
3159   5                err_sum=180;
3160   5              }
3161   4              else if(err_sum < -180)
3162   4              {
3163   5                err_sum=-180;//Ã¿Ãë10¶È(100)£¬30000/100=300,¼´Îª5·ÖÖÓÊý¾Ý
3164   5              }
3165   4              else 
3166   4              {
3167   5                //do nothing
3168   5              }
3169   4              //if((RT_Temp - Set_RT_Temp) >= 1){if(err_sum > 0)err_sum = 0;}//´ïµ½Éè¶¨ÎÂ¶È£¬Îó²î²»ÄÜÎªÕý
3170   4              //else if((Set_RT_Temp - RT_Temp) >= 1){if(err_sum < 0)err_sum = 0;}//Î´´ïµ½Éè¶¨ÎÂ¶È£¬Îó²î²»ÄÜÎª¸º
3171   4              
3172   4              if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == (u8)1))
3173   4              { //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ³öÆø¿Ú
3174   5                Back_Color=WHITE18;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 53  

3175   5                if(err_sum >=0)
3176   5                {
3177   6                  LCD_ShowxNum(220,10,16,1,1,0x80,BLACK18); //1-±íÊ¾ÎªÕýÊý
3178   6                }
3179   5                else
3180   5                {
3181   6                  LCD_ShowxNum(220,10,16,1,0,0x80,BLACK18); //0-±íÊ¾Îª¸ºÊý
3182   6                }           
3183   5                LCD_ShowxNum(220,20,16,5,(u32)(abs(err_sum)),0x80,BLACK18); //·¢ÈÈÅÌ¼ÓÈÈµÄÄ£Ê½ÏÔÊ¾
3184   5              }           
3185   4      
3186   4              NoneWire_Heat_Sec++;
3187   4              if(NoneWire_Heat_Sec >= (u16)180)//3·ÖÖÓµ÷ÕûÒ»´ÎÎÂ¶È
3188   4              {
3189   5                NoneWire_Heat_Sec = 0;//-Temp2_Int
3190   5                
3191   5                Calc_int = err_sum;
3192   5                //if(Calc_int > 6000)Calc_int=6000;
3193   5                //else if(Calc_int< -6000)Calc_int=-6000;//Ã¿Ãë5¶È(50)£¬2·ÖÖÓÊý¾ÝÎª6000
3194   5                
3195   5                Temp2_Int = Temp2_Int + ((Set_RT_Temp - RT_Temp)/6) + ((RT_Temp_Mem-RT_Temp)/2) + (Calc_int/40);//(40
             -0-300)/10
3196   5                //if(Temp2_Int > 1050)Temp2_Int = 1050;
3197   5                if(Temp2_Int > 980)
3198   5                {
3199   6                  Temp2_Int = 980;
3200   6                }
3201   5      
3202   5                RT_Temp_Mem = RT_Temp;
3203   5              }
3204   4            }           
3205   3      
3206   3            //ÒÔÏÂÎª·¢ÈÈÅÌÎÂ¶ÈµÄControler¿ØÖÆ
3207   3            Controler_temp2.Ek = Temp2_Int - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
3208   3            HeatPlate_Controler_Calc(); 
3209   3            Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
3210   3            if(RT_Temp > (Set_RT_Temp + 10))
3211   3            {
3212   4              Micro_Temp_Val = 0;//³¬¹ý1¶È 
3213   4              
3214   4            }
3215   3            else  
3216   3            {
3217   4              Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
3218   4            }
3219   3          }       
3220   2        }
3221   1      }
3222          
3223          //Õý³£ÔËÐÐ½çÃæ,°´ÏÂÈ·ÈÏ¼üÈ·¶¨»ØÂ·µÄÄ£Ê½
3224          void WireInOut_State_Confirm(void)
3225          {
3226   1        if((WireIn_State > (u8)0) && (WireOut_State > (u8)0)) //Ë«¹Ü¼ÓÈÈÄ£Ê½
3227   1        {
3228   2          Wire_Mode_Sel = Wire_Sel_Double;  
3229   2        } 
3230   1        else if((WireIn_State > (u8)0) && (WireOut_State == (u8)0)) //µ¥¹Ü¼ÓÈÈÄ£Ê½
3231   1        {
3232   2          Wire_Mode_Sel = Wire_Sel_In_Only; 
3233   2        }
3234   1        else if((WireIn_State == (u8)0) && (WireOut_State == (u8)0)) //ÎÞ¼ÓÈÈË¿Ä£Ê½
3235   1        {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 54  

3236   2          Wire_Mode_Sel = Wire_Sel_None;  
3237   2        } 
3238   1        else 
3239   1        {
3240   2          //do nothing
3241   2        }
3242   1      }
3243          
3244          void HeaterPlateWireDriveFbTask(void)//16
3245          {
3246   1        static uint8_t Micro_Temp_CLK = 0;
3247   1        static uint8_t    Check_WireInTimes = 0;
3248   1        static uint8_t    Check_WireOutTimes =0 ;
3249   1        static uint8_t WireIn_FB_Count = 0;     //¼ì²â¼ÓÈÈÏßIn·´À¡ÐÅºÅ
3250   1        static uint8_t WireOut_FB_Count = 0;     //¼ì²â¼ÓÈÈÏßOut·´À¡ÐÅºÅ
3251   1        static uint8_t NoHpCheck_Times = 0;//ÎÞ¼ÓÈÈÅÌµÄ´ÎÊý.
3252   1        
3253   1        Micro_Temp_CLK++;
3254   1        if(Micro_Temp_CLK > (u8)200)//Ê±»ù
3255   1        {   
3256   2          Micro_Temp_CLK = 0;
3257   2      
3258   2          //Ã¿¸öÖÜÆÚ¼ì²â¼ÓÈÈÅÌÊÇ·ñ´æÔÚ
3259   2           HP_CNT_Int_End_Rem = HP_CNT_Int;
3260   2          if(HP_CNT_Int < (u16)1)//Î´¼ì²âµ½
3261   2          {
3262   3            NoHpCheck_Times++;
3263   3            if(NoHpCheck_Times >=(u8)2)
3264   3            {
3265   4              NoHpCheck_Times = 2;
3266   4              HeaterPlate_State=0; //Î´¼ì²âµ½¼ÓÈÈÅÌ
3267   4            }
3268   3          }
3269   2          else
3270   2          {
3271   3            NoHpCheck_Times = 0;
3272   3            HeaterPlate_State=1; //¼ì²â¼ÓÈÈÅÌ´æÔÚ         
3273   3          }
3274   2          HP_CNT_Int = 0;//ÇåÁã
3275   2        }
3276   1         
3277   1      //¼ÓÈÈÅÌÇý¶¯  
3278   1        if (Micro_Temp_Val>Micro_Temp_CLK)
3279   1        {
3280   2          Heat_JRP_Port=(bit)1;
3281   2        }  
3282   1        else
3283   1        {
3284   2          Heat_JRP_Port=(bit)0;
3285   2        }
3286   1        
3287   1      //INSP½øÖ§Æø¼ÓÈÈÇý¶¯ºÍ¼ì²â
3288   1        if (Micro_Temp_In>(u16)Micro_Temp_CLK)
3289   1        {
3290   2          Heat_WireIn_Port=(bit)1;
3291   2          Heat_WIRE_EN_OUT=(bit)0;//·ÀÖ¹µ¥Ò»¹ÊÕÏ  
3292   2        }
3293   1        else  //²»¼ÓÈÈÊ±µÄ¼ì²â
3294   1        {     
3295   2          if(Heat_WireIn_Port!=0)
3296   2          {
3297   3            Heat_WireIn_Port=(bit)0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 55  

3298   3            Heat_WIRE_EN_OUT=(bit)1;//·ÀÖ¹µ¥Ò»¹ÊÕÏ      
3299   3            Check_WireInTimes=0;
3300   3            WireIn_FB_Count=0;
3301   3          }
3302   2          else
3303   2          {
3304   3            Check_WireInTimes++;
3305   3            if(WireIn_Exist_Port==0)
3306   3            {
3307   4              WireIn_FB_Count++;
3308   4            }       
3309   3            if(Check_WireInTimes>(u8)4)
3310   3            {
3311   4              if(WireIn_FB_Count<(u8)3)   //Á¬Ðø¼ì²âµ½Îå´Î²»¼ÓÈÈ±¨´í
3312   4              {
3313   5                WireIn_State=0; //Î´¼ì²âµ½·¢ÈÈË¿             
3314   5              }
3315   4              else
3316   4              {            
3317   5                WireIn_State=1; //Ã»¼ÓÈÈ£¬´ú±í¼ì²âµ½·¢ÈÈË¿
3318   5              }
3319   4              Check_WireInTimes=0;
3320   4              WireIn_FB_Count=0;
3321   4            }
3322   3          }
3323   2        }     
3324   1        
3325   1      //EXP³öÖ§Æø¼ÓÈÈÇý¶¯ºÍ¼ì²â
3326   1        if (Micro_Temp_Out>Micro_Temp_CLK)
3327   1        {
3328   2          Heat_WireOut_Port=(bit)1;
3329   2          Heat_WIRE_EN_OUT = (bit)0;//·ÀÖ¹µ¥Ò»¹ÊÕÏ    
3330   2        }
3331   1        else
3332   1        {
3333   2          if(Heat_WireOut_Port!=0)
3334   2          {
3335   3            Heat_WireOut_Port=(bit)0;
3336   3            Heat_WIRE_EN_OUT =(bit)1;//·ÀÖ¹µ¥Ò»¹ÊÕÏ   
3337   3            Check_WireOutTimes=0;
3338   3            WireOut_FB_Count=0;
3339   3          }
3340   2          else
3341   2          {
3342   3            Check_WireOutTimes++;
3343   3            if(WireOut_Exist_Port==0)
3344   3            {
3345   4              WireOut_FB_Count++;
3346   4            }       
3347   3            if(Check_WireOutTimes>(u8)4  )
3348   3            {
3349   4              if(WireOut_FB_Count<(u8)3)   //Á¬Ðø¼ì²âµ½Îå´Î²»¼ÓÈÈ±¨´í
3350   4              {
3351   5                WireOut_State=0; //Ã»¼ÓÈÈ£¬´ú±í¼ì²âµ½·¢ÈÈË¿
3352   5              }
3353   4              else
3354   4              {
3355   5                WireOut_State=1;
3356   5              }
3357   4              Check_WireOutTimes=0;
3358   4              WireOut_FB_Count=0;
3359   4            }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/11/2019 16:15:50 PAGE 56  

3360   3          }
3361   2        }  
3362   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  16747    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    271      80
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
