C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE ACTIVITYFUNCTIONS
OBJECT MODULE PLACED IN ..\OBJ\ActivityFunctions.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\CODE\ActivityFunctions.c LARGE OBJECTADVANCED OPTIMIZE(9,SIZE) BROWSE
                    - ORDER NOAREGS INCDIR(..\HARDWARE\ds1302;..\HARDWARE\ds18b20;..\HARDWARE\lcd;..\HARDWARE\RX8010;..\HARDWARE\sht21;..\HAR
                    -DWARE\sht31;..\HARDWARE\w25x;..\SYSTEM\delay;..\SYSTEM\stc_eeprom;..\SYSTEM;..\CODE) DEBUG PRINT(.\ActivityFunctions.lst
                    -) TABS(2) OBJECT(..\OBJ\ActivityFunctions.obj)

line level    source

   1          /* VHB15AÊª»¯Æ÷*/ 
   2          
   3          #include "all.h"
   4          
   5          ////2019.03.29
   6          //sfr P4M0 = 0xB4; 
   7          //sfr P4M1 = 0xB3;
   8          //sfr P4SW = 0xBB;
   9          //sfr WDT_CONTR = 0xC1;
  10          //sbit EA  = (uint8_t)0xA8^(uint8_t)7;
  11          //sbit EX1 = (uint8_t)0xA8^(uint8_t)2;
  12          //sbit ET0 = (uint8_t)0xA8^(uint8_t)1;
  13          //sfr P1M0 = 0x92; 
  14          //sfr P1M1 = 0x91;
  15          ////sbit P10 = (uint8_t)0x90^(uint8_t)0;
  16          //sbit P10 = (uint8_t)0x90;
  17          //sbit P12 = (uint8_t)0x90^(uint8_t)2;
  18          //sbit P13 = (uint8_t)0x90^(uint8_t)3;
  19          //sbit P17 = (uint8_t)0x90^(uint8_t)7;
  20          ////sbit P20 = (uint8_t)0xA0^(uint8_t)0;
  21          //sbit P20 = (uint8_t)0xA0;
  22          //sbit P21 = (uint8_t)0xA0^(uint8_t)1;
  23          //sbit P22 = (uint8_t)0xA0^(uint8_t)2;
  24          //sbit P27 = (uint8_t)0xA0^(uint8_t)7;
  25          //sfr P2M0 = 0x96;
  26          //sfr P2M1 = 0x95;
  27          //sbit P32 = (uint8_t)0xB0^(uint8_t)2;
  28          //sbit P34 = (uint8_t)0xB0^(uint8_t)4;
  29          //sbit P35 = (uint8_t)0xB0^(uint8_t)5;
  30          //sbit P36 = (uint8_t)0xB0^(uint8_t)6;
  31          //sbit P37 = (uint8_t)0xB0^(uint8_t)7;
  32          //sfr P3M0 = 0xB2;
  33          //sfr P3M1 = 0xB1; 
  34          ////sbit P40 = (uint8_t)0xC0^(uint8_t)0;
  35          //sbit P40 = (uint8_t)0xC0;
  36          //sbit P43 = (uint8_t)0xC0^(uint8_t)3;
  37          //sbit TI  = (uint8_t)0x98^(uint8_t)1;
  38          ////sbit RI  = (uint8_t)0x98^(uint8_t)0;
  39          //sbit RI  = (uint8_t)0x98;
  40          //sbit TR0 = (uint8_t)0x88^(uint8_t)4;
  41          //sbit IT1 = (uint8_t)0x88^(uint8_t)2;
  42          
  43          //static void  Interrupt_EXT1(void);
  44          //static void  Interrupt_Time0(void);
  45          //static void  Serial (void);   //´®¿ÚÖÐ¶Ï
  46          
  47          
  48          
  49          //static enum  //heating wire mode
  50          //{ 
  51          //  Wire_Sel_Double = 0,  //double heating wire
  52          //  Wire_Sel_In_Only,     //INSP Only heating wire
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 2   

  53          //  Wire_Sel_None       //Whithout heating wire
  54          //}Wire_Mode_Sel; 
  55          static WIRE_MODE_SEL Wire_Mode_Sel=Wire_Sel_Double;
  56              
  57          //´íÎó¼ì²âºÍ±¨¾¯Ïà¹Ø±äÁ¿  
  58          uint8_t  ERR_Kind=0;//´íÎóµÄÖÖÀà//0´«¸ÐÆ÷/1¸ßÎÂ/2µÍÎÂ/3µÍÊª/4ÎÞË®/5»¼Õß´«¸ÐÆ÷/6³öÆø¿Ú´«¸ÐÆ÷/7¼ÓÈÈÅÌ´«¸ÐÆ÷ 
             -  
  59          uint8_t Wire_Mode_Mismatch ; //»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä   
  60          static uint8_t JRP_Sensor_Err=0;
  61          static uint8_t CQK_Sensor_Err=0;
  62          static uint8_t RTD_Sensor_Err=0;
  63          static uint8_t SHIDU_Sensor_Err=0;    
  64              
  65          uint8_t AlarmSoundPauseStatus = 0;//±¨¾¯ÉùÒôÔÝÍ£ 0-Õý³£±¨¾¯ 1-±¨¾¯ÉùÒôÔÝÍ£(½ö±¨¾¯Ê±ÓÐÐ§)
  66          uint8_t AlarmInfoIndex = 0;//
  67                    
  68          static uint8_t    HiTemp_Count=0;   //¸ßÎÂ¶È´ÎÊý
  69          static uint8_t    LoTemp_Count=0;     //µÍÎÂ¶È´ÎÊý
  70          static uint8_t    LoTemp_CQK_Count=0;//³öÆø¿ÚµÍÎÂ¶È´ÎÊý
  71          static uint8_t    LoHumity_Count=0;  //µÍÊª¶È´ÎÊý
  72          
  73          uint8_t No_HeatSensor_Times=0;//¼ÓÈÈÅÌÎÂ¶È´«¸ÐÆ÷ÎÞÏìÓ¦´ÎÊý
  74          static uint16_t  No_CQKSensor_Times=0;//³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷ÎÞÏìÓ¦´ÎÊý
  75          static uint16_t  CQKSensor_Hithen800_Times=0;//³¬¹ý80¶È
  76          static uint16_t  JRP_Sensor_Temp_No_Change_Times=0;// ¼ÓÈÈÅÌÎÂ¶ÈÍêÈ«²»±äµÄ´ÎÊý2014-07-03
  77          static uint16_t  CQK_Sensor_Temp_No_Change_Times=0;// ³öÆø¿ÚÎÂ¶ÈÍêÈ«²»±äµÄ´ÎÊý    
  78          static uint8_t ERR_RT_Temp_Times=0;//»¼ÕßÎÂ¶È³¬¹ý80¶È
  79          static uint8_t No_ReadData_SHIDU_Times=0;//»¼Õß¶ËÎÂ¶ÈÎÞÏìÓ¦´ÎÊý
  80          static uint16_t  RT_Temp_Not_Updated_10mS = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼ä
  81          static uint8_t No_ReadData_Temp_Times=0;//³öÆø¿ÚÎÂ¶ÈÎÞÏìÓ¦´ÎÊý
  82          static uint16_t  Nochange_Times=0;//»¼Õß¶ËÎÂÊª¶ÈÍêÈ«²»±äµÄ´ÎÊý
  83          
  84          uint8_t RT_Temp_Reach_Set_Cnt = 0;//ÈËÌåÎÂ¶È´ïµ½Éè¶¨ÎÂ¶È-1.5
  85          uint8_t CQK_Temp_Reach_Set_Cnt = 0;//³öÆø¿ÚÎÂ¶È´ïµ½30
  86          
  87          uint8_t show_str[23]; 
  88          
  89          //static uint8_t   Work_Day=0;
  90          //static uint8_t   Work_Hour=0;
  91          //static uint8_t   Work_Min=0;
  92          //static uint8_t   Work_Sec=0;
  93          
  94          //´æ´¢Ïà¹Ø
  95          struct stc_data_flash data_flash;//
  96          static uint16_t  Run_Count;
  97          uint8_t    SaveData[16];
  98                                              
  99          //´®¿ÚÏà¹Ø±äÁ¿                                    
 100          //static bit Buff_Full_flag;    
 101          //static uint8_t   Rec_Count=0;
 102          //static BYTE    Rec_Buff[21];          //½ÓÊÕµ½µÄÖ¸ÁîREAD0001[CR]-READ0200[CR];
 103                                              //Ò»ÌõÖ¸Áî¿É½ÓÊÕ256ÌõÊý¾Ý                                   
 104          //static uint16_t   Tick_20ms=0;
 105          uint8_t defalut_mode = Load_User_Pre_MODE;  //Ô¤ÉèÄ£Ê½Ñ¡Ôñ
 106          
 107          //ÊµÊ±²ÎÊý
 108          INT             RT_Temp=0;            //ÈËÌå¶ËÎÂ¶È
 109          INT             JEP_Temp=280;           //¼ÓÈÈÅÌÎÂ¶È
 110          LONG              CQK_Temp=280;           //³öÆø¿ÚÎÂ¶È
 111          static uint16_t     RT_SHIDU=0;             //ÈËÌå¶ËÊª¶È
 112          static uint16_t     CONTROL_RT_SHIDU=550;     //¿ØÖÆ¼ÓÈÈµÄÊª¶È
 113          uint16_t     Diplay_RTtemp = 0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 3   

 114          
 115          //Éè¶¨²ÎÊý    
 116          uint8_t         Work_Mode = Invasive_Mode; //Ä¬ÈÏ1ÎªÓÐ´´Ä£Ê½ £¬0ÎªÎÞ´´Ä£Ê½£¬2£¬¼òÒ×Ä£Ê½(ÎÞ·¢ÈÈË¿)       
 117          INT                   Set_RT_Temp=390;         //ÈËÌå¶ËÎÂ¶ÈÉè¶¨Öµ       
 118          uint16_t          Set_RT_WCTemp=340;       //ÈËÌåÎÞ´´ÎÂ¶È
 119          uint16_t          Set_RT_YCTemp=390;       //ÈËÌåÓÐ´´ÎÂ¶È
 120          uint16_t          Set_CQK_Temp=370;        //³öÆø¿ÚÎÂ¶È
 121          uint16_t          Set_CQK_WCTemp=310;      //ÈËÌåÎÞ´´ÎÂ¶È
 122          uint16_t          Set_CQK_YCTemp=370;      //ÈËÌåÓÐ´´ÎÂ¶È
 123          uint8_t         In_Exp_Ratio=4;  //InºÍExp¼ÓÈÈ·½Ê½µÄ±ÈÀý  //1-1:1 2-1:1.1 3-1:1.2 4-1:1.3 5-1:1.4 6-1:1.5
 124          
 125          //¼ÓÈÈÅÌÇý¶¯ºÍ¼ì²â
 126          uint16_t          HP_CNT_Int = 0;//¼ÓÈÈÅÌÖÐ¶Ï¼ì²â¼ÆÊý
 127          uint16_t          HP_CNT_Int_End_Rem = 0;//8S½áÊøÊ±¼ÓÈÈÅÌÖÐ¶Ï¼ì²â¼ÆÊý
 128          uint8_t         WireIn_State=0;      //¼ÓÈÈÏßIn×´Ì¬ 1-ÓÐ 0-ÎÞ
 129          uint8_t         WireOut_State=0;     //¼ÓÈÈÏßOut×´Ì¬    1-ÓÐ 0-ÎÞ
 130          uint8_t         HeaterPlate_State = 0; //¼ÓÈÈÅÌ×´Ì¬ 1-ÓÐ 0-ÎÞ
 131          
 132          uint8_t         Micro_Temp_Val=0;   //¼ÓÈÈÅÌ×î´óÎª201;×îÐ¡Îª0,1±íÊ¾10ms¼ÓÈÈÊ±¼ä
 133          uint16_t          Micro_Temp_In=0;    //½øÆøÖ§
 134          uint16_t          Micro_Temp_Out=0;   //³öÆøÖ§
 135          
 136          //¿ØÖÆ²ÎÊý
 137          //static uint16_t   Aim_SHIDU=900;  //Ä¿±êÊª¶È 
 138          static INT    JEP_Temp_Aim=400;           //¼ÓÈÈÅÌÄ¿±êÎÂ¶È
 139          static uint16_t Wire_Warm_Up_Sec;    //µ±<=300Ê±ÏÞÖÆ·¢ÈÈË¿×î´ó¼ÓÈÈ¹¦ÂÊ
 140          static uint16_t Plate_Warm_Up_Sec;   //µ±<=600Ê±ÏÞÖÆ·¢ÈÈÅÌ×î´ó¼ÓÈÈ¹¦ÂÊ
 141          static uint16_t Humidity_No_Change_Sec;//Êª¶È²»¸Ä±äµÄ¼ÆÊý£¬µ±´óÓÚ600Ê±¿ÉÄÜÌ½Í·Ê§Ð§£¬Êª¶È¿ØÖÆÊ§Ð§
 142          static uint16_t Low_Power_Mode_Flag = 0;//µÍ¹¦ÂÊÄ£Ê½Ê¹ÄÜ±êÖ¾
 143          
 144          uint8_t     Test_Mode_Dis_Jrp_Ctl=0; //´Ó²âÊÔÄ£Ê½½øÈëÕý³£Ä£Ê½¼´ÏÔÊ¾ËùÓÐ¹¤×÷Êý¾Ý 
 145          static uint8_t     Micro_Adj_Mode_Test;  //¼ÓÈÈµÄÄ£Ê½²âÊÔ
 146          uint16_t      Working_Normal=0;//Õý³£¹¤×÷¶ÁÊý£¬Ã¿Ãë¼Ó1£¬¹ÊÕÏÖØÖÃ£¬¸Ä±äÉèÖÃÒ²ÖØÖÃ
 147          
 148          static uint8_t     Enable_Save_Data=0;  //±£´æÊý¾Ý¼ÆÊý
 149          
 150          static struct 
 151          {
 152            INT Uk; //×ÜµÄ¿ØÖÆÁ¿
 153          //  int Uk1;//ÉÏ´ÎµÄ×Ü¿ØÖÆÁ¿
 154            INT Sum_error;//Îó²î×ÜÁ¿
 155            INT Ek;//µ±Ç°µÄÎó²îÁ¿
 156            INT Ek1;//Ç°Ò»´ÎµÄÎó²îÁ¿
 157            INT Ek2;//Ç°¶þ´ÎµÄÎó²îÁ¿       
 158          }Controler_temp,Controler_temp2,Controler_temp3;//¶¨ÒåÒ»¸öÎÂ¶ÈControler½á¹¹
 159          
 160          //static CONTROLLER_TEMP Controler_temp;
 161          //static CONTROLLER_TEMP Controler_temp2;
 162          //static CONTROLLER_TEMP Controler_temp3;
 163          
 164          
 165           //Ãë    ·Ö    Ê±    ÈÕ    ÔÂ  ÐÇÆÚ    Äê
 166          static BYTE   NowTime[7]= {0x00, 0x00, 0xB2, 0x01, 0x01, 0x05, 0x12};
 167          
 168          //uint8_t Alarm_time_det_10mS_cnt = 0;
 169          
 170          //================================================== 
 171          
 172          static void Store_Data(void);           //´æ·ÅÊý¾Ý
 173          static void Get_RunCount(void);         //´æ·ÅÊý¾Ý
 174          //static void Init_Erase_Flash_Data(void);//³õÊ¼»¯Ê±²Á³ýÍâ²¿FLASHÊý¾Ý
 175          //static void Init_port(void); //³õÊ¼»¯¶Ë¿Ú×´Ì¬£¬ÏÔÊ¾°æ±¾ºÅ£¬¶ÁÈ¡Êý¾Ý£¬ÆÁÄ»²âÊÔ£¬W25XÇåÊý¾Ý
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 4   

 176          // void Main_Init(void);  //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý,»­¹¤×÷´°¿Ú,Ê¹ÄÜä¸Á÷³äµç,RTC¼ì²â,ÆäËü±äÁ¿³õÊ¼»¯
 177          static void Write_Default_Setting_to_flash(void); //°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
 178          //static void LCD_Show_Verion(void);//ÏÔÊ¾°æ±¾ºÅ
 179          static void PatientTemp_NoneHeatWire_Adj(void);//ÎÞ»ØÂ··¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶Èµ÷½Ú
 180          static void Controler_Calc(void); //ControlerËã·¨
 181          static void HeatPlateTemp_Aim_Controler_Calc(void); //¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈControlerËã·¨---
 182          static void HeatPlate_Controler_Calc(void);//¼ÓÈÈÅÌµÄControlerËã·¨---
 183          
 184          
 185          static void  Clear_bit(uint8_t* Value,INT bit_num) 
 186          {
 187   1        uint8_t* pV=Value;
 188   1        (*pV) =(*pV)& (u8)( ~ ( (uint16_t)1 << (uint16_t)(bit_num) ) );
 189   1      }
 190          static void  Set_bit(uint8_t* Value,INT bit_num)
 191          {
 192   1        uint8_t* pV=Value;
 193   1        (*pV) =(*pV)| (uint8_t)( (uint16_t)1 << (uint16_t)(bit_num) );
 194   1      }
 195          
 196          uint8_t  Bit_is_one(uint8_t Value,INT bit_num)
 197          {
 198   1        return (u8)( (Value) & ((uint16_t)1<< (uint16_t)(bit_num) ) );
 199   1      }
 200          
 201          
 202          
 203          static void  Interrupt_EXT1(void)  interrupt 2 //Íâ²¿ÖÐ¶ÏEXT1
 204          {
 205   1        HP_CNT_Int++; 
 206   1      }
 207          
 208          static void  Interrupt_Time0(void)  interrupt 1  using  2  //10msÖÐ¶ÏÒ»´Î //22.1184M
 209          {   
 210   1      //  static uint16_t   Tick_20ms;
 211   1        Timer_T0_INT_Main();
 212   1      //  ++Tick_20ms;
 213   1      }
 214          
 215          static void  Interrupt_Serial (void) interrupt 4 using 1    //´®¿ÚÖÐ¶Ï
 216          {
 217   1        if(RI)
 218   1        {
 219   2          EUSART_Receive_ISR();
 220   2      
 221   2          RI = (bit)0;
 222   2        }
 223   1      
 224   1        if(TI)
 225   1        {     
 226   2          EUSART_Transmit_ISR();
 227   2          TI = (bit)0;
 228   2        }
 229   1      }
 230          
 231          
 232          
 233          //static UART_RECSTATE UART_RecState=UART_REC_STATE_READY;
 234          
 235          //static enum
 236          //{
 237          //  UART_REC_STATE_READY = 0, //×¼±¸½ÓÊÕ,³õÊ¼»¯¼ÆÊý,  1
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 5   

 238          //  UART_REC_STATE_HEADER_DET,//¼ì²âÃüÁîÍ· "NEUNIT=1," ¹²9¸ö×Ö·û 
 239          //  UART_REC_STATE_DATA_TAIL_DET,//½ÓÊÕÃüÁî(×î¶à9¸ö×Ö·û)£¬¼ì²âÃüÁîÎ²"\CR"¹²3¸ö×Ö·û 
 240          //  UART_REC_STATE_DONE //½ÓÊÕÕýÈ·Íê³É
 241          //}UART_RecState = UART_REC_STATE_READY;
 242          
 243          
 244          static uint8_t   UART_Rec_Buf[20];//½ÓÊÕ»º³åÇø 
 245           
 246          static void UART_RecBuf_Clear_Fun(void)  //Çå¿Õ»º³åÇø
 247          {
 248   1        INT i;
 249   1      
 250   1        for(i=0;i<=19;i++)
 251   1        {
 252   2          UART_Rec_Buf[i] = 0;        
 253   2        } 
 254   1      }
 255          
 256          //½ÓÊÕÊý¾Ý
 257          //static uint8_t   DataToPc[8];
 258          void UART_RecData_Func(void)
 259          {
 260   1        typedef enum
 261   1        {
 262   1          UART_REC_STATE_READY = 0, //×¼±¸½ÓÊÕ,³õÊ¼»¯¼ÆÊý,  1
 263   1          UART_REC_STATE_HEADER_DET,//¼ì²âÃüÁîÍ· "NEUNIT=1," ¹²9¸ö×Ö·û 
 264   1          UART_REC_STATE_DATA_TAIL_DET,//½ÓÊÕÃüÁî(×î¶à9¸ö×Ö·û)£¬¼ì²âÃüÁîÎ²"\CR"¹²3¸ö×Ö·û 
 265   1          UART_REC_STATE_DONE //½ÓÊÕÕýÈ·Íê³É
 266   1        }UART_RECSTATE;
 267   1        UART_RECSTATE UART_RecState=UART_REC_STATE_READY;
 268   1        
 269   1        static uint8_t   UART_Rec_Cnt = 0;//½ÓÊÕÊý¾ÝÊýÁ¿ 
 270   1        //    static uint8_t UART_Len = 0;//½ÓÊÕµÄÊý¾Ý³¤¶È
 271   1        uint8_t   i;
 272   1        uint8_t   uart_data;    
 273   1        UINT32   Adress;
 274   1        //    uint16_t    sum;
 275   1        
 276   1        while(EUSART_DataReady!=(uint8_t)0)//»º³åÇøÓÐÊý¾Ý
 277   1        {
 278   2          uart_data = EUSART_Read(); //´Ó»º³åÇø¶ÁÒ»¸öÊý¾Ý
 279   2          
 280   2          if(Work_State == UI_STATE_DATAREADER_MODE)
 281   2          {
 282   3            UART_Rec_Cnt++;//ÊýÁ¿Ôö¼Ó
 283   3            if(UART_RecState == UART_REC_STATE_READY)//¿ªÊ¼
 284   3            {
 285   4              UART_RecState = UART_REC_STATE_HEADER_DET;           
 286   4              UART_RecBuf_Clear_Fun();//Çå¿Õ»º³åÇø
 287   4              UART_Rec_Buf[0] = uart_data;//³õÊ¼½ÓÊÕ
 288   4              UART_Rec_Cnt = (uint8_t)1; //ÊýÁ¿
 289   4              //EUSART_Write('A');
 290   4            }
 291   3            else if(UART_RecState == UART_REC_STATE_HEADER_DET)//¼ì²â½ÓÊÕÍ·
 292   3            {//×¢Òâ:×îÖÕ8¸ö×Ö½Ú´æ·ÅµÄË³ÐòÊÇÏÈÊÕµ½µÄÔÚ×îµÍÎ»£¬Àý:ÊÕµ½µÄÊÇAXXLOGET£¬´æ·ÅµÄÊÇTEGOLXXA
 293   4              UART_Rec_Buf[UART_Rec_Cnt-(u8)1] = uart_data;//´ÓµÍ×Ö½ÚÍù¸ß×Ö½Ú´æ·Å
 294   4              if(UART_Rec_Cnt>=(uint8_t)2)//½ÓÊÕµ½3¸öÊý¾Ý RD 13
 295   4              {
 296   5                if((UART_Rec_Buf[0] == (uint8_t)'R')//Í·±êÖ¾ÅÐ¶Ï
 297   5                  &&(UART_Rec_Buf[1] == (uint8_t)'D'))
 298   5                {
 299   6              //              EUSART_Write_Str("HEAR_OK",7);
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 6   

 300   6                  UART_RecState = UART_REC_STATE_DATA_TAIL_DET;//±êÖ¾OK£¬½ÓÊÕÊý¾Ý
 301   6                  UART_RecBuf_Clear_Fun();//Çå¿Õ»º³åÇø  
 302   6                  UART_Rec_Cnt = (uint8_t)0; //ÊýÁ¿
 303   6                }
 304   5                else
 305   5                {
 306   6                  UART_Rec_Cnt--;//ÍùµÍÎ»ÒÆ
 307   6                  for(i=0;i<=(uint8_t)18;i++) //Êý¾ÝÍùµÍÎ»ÒÆÒ»Î»
 308   6                  {
 309   7                     UART_Rec_Buf[i] = UART_Rec_Buf[i+(u8)1];        
 310   7                  }//×¢Òâ:×îÖÕ8¸ö×Ö½Ú´æ·ÅµÄË³ÐòÊÇÏÈÊÕµ½µÄÔÚ×îµÍÎ»£¬Àý:ÊÕµ½µÄÊÇAXXLOGET£¬´æ·ÅµÄÊÇTEGOLXXA              
             - 
 311   6                }
 312   5              } 
 313   4            }
 314   3            else if(UART_RecState == UART_REC_STATE_DATA_TAIL_DET)//¼ì²âÊý¾ÝºÍ½áÎ²
 315   3            {
 316   4              UART_Rec_Buf[UART_Rec_Cnt-(u8)1] = uart_data;//´ÓµÍ×Ö½ÚÍù¸ß×Ö½Ú´æ·Å
 317   4      
 318   4              if(UART_Rec_Cnt>=(uint8_t)3)//×î¶à´æ·Å15¸öÊý¾Ý
 319   4              { 
 320   5                UART_RecState = UART_REC_STATE_DONE;//½ÓÊÕÍê³É        
 321   5              }
 322   4            }
 323   3            else
 324   3            {
 325   4              //do nothing
 326   4            }
 327   3              
 328   3            if(UART_RecState == UART_REC_STATE_DONE)//¼ì²âµ½Î²±êÖ¾
 329   3            {
 330   4              UART_RecState = UART_REC_STATE_READY; //×¼±¸ÏÂÒ»´Î¼ì²â
 331   4              
 332   4              Adress=UART_Rec_Buf[0];
 333   4              Adress=(Adress<<8)+UART_Rec_Buf[1]-(u8)1;
 334   4              Adress=(Adress<<4)+(UINT32)0x2000;
 335   4              SPI_Read_nBytes(Adress,16,&SaveData[0]);
 336   4              EUSART_Write_Str(&SaveData[0],16);//·¢ËÍ16¸ö×Ö½Ú¸øPC
 337   4            }           
 338   3          }
 339   2        }
 340   1      }
 341          
 342          void HeaterWireModeDetFunc(void)
 343          {
 344   1        if(Wire_Mode_Sel == Wire_Sel_Double)//Ë«Ö§¼ÓÈÈ»ØÂ·µ«Êµ¼ÊÎ´¼ì²âµ½IN»òOUT          
 345   1        {
 346   2          if((WireIn_State == (uint8_t)0)||(WireOut_State == (uint8_t)0)) 
 347   2          {
 348   3            Wire_Mode_Mismatch = (uint8_t)1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 349   3          }
 350   2          else
 351   2          {
 352   3            Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 353   3          }
 354   2        } 
 355   1        else if(Wire_Mode_Sel == Wire_Sel_In_Only)  //µ¥Ö§¼ÓÈÈ»ØÂ·µ«Êµ¼ÊÎ´¼ì²âµ½IN»ò¼ì²âµ½ÓÐOUT    
 356   1        {
 357   2          if((WireIn_State == (uint8_t)0)||(WireOut_State > (uint8_t)0))  
 358   2          {
 359   3            Wire_Mode_Mismatch = (uint8_t)1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 360   3          }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 7   

 361   2          else
 362   2          {
 363   3            Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 364   3          }
 365   2        }
 366   1        else if(Wire_Mode_Sel == Wire_Sel_None) //ÎÞ¼ÓÈÈ»ØÂ·µ«Êµ¼Ê¼ì²âµ½ÓÐIN»òOUT
 367   1        {
 368   2          if((WireIn_State > (uint8_t)0)||(WireOut_State > (uint8_t)0)) 
 369   2          {
 370   3            Wire_Mode_Mismatch = (uint8_t)1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 371   3          }
 372   2          else
 373   2          {
 374   3            Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 375   3          }
 376   2        }
 377   1        else
 378   1        {
 379   2          //do nothing
 380   2        }
 381   1      }
 382          
 383          void RefreshTempHumidyFunc(uint8_t Refresh_En)//Ë¢ÐÂÏÔÊ¾ÎÂ¶ÈºÍÊª¶È
 384          {
 385   1        static uint8_t     Refresh_WenDu_Cnt = 0; 
 386   1        static uint8_t     Alarm_WenDu_Cnt = 0; 
 387   1      
 388   1        uint16_t Disp=0,color;
 389   1      
 390   1        uint16_t Temp_Dis_En = 0;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 391   1        uint8_t Disp_Err;
 392   1      
 393   1        Refresh_WenDu_Cnt++;
 394   1        if(Refresh_WenDu_Cnt > (uint8_t)5)//1.2S
 395   1        {
 396   2          Refresh_WenDu_Cnt = (uint8_t)0; 
 397   2        }
 398   1        
 399   1        Alarm_WenDu_Cnt++;
 400   1        if(Alarm_WenDu_Cnt > (uint8_t)1)
 401   1        {
 402   2          Alarm_WenDu_Cnt = (uint8_t)0;
 403   2        }
 404   1          
 405   1        
 406   1        Back_Color=WHITE18; 
 407   1        Disp_Err=(uint8_t)0;
 408   1      
 409   1      //  Temp_Dis_En = 0;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 410   1        if(Refresh_En!=(uint8_t)0)
 411   1        {
 412   2          Temp_Dis_En = (uint16_t)1;//Ç¿ÖÆË¢ÐÂÒ»´Î  
 413   2        }
 414   1      
 415   1        color=(u16)BLACK18;
 416   1        if((Bit_is_one(ERR_Kind,Alarm_Const_HiTemp)!=(uint8_t)0)   //»¼Õß¶Ë¸ßÎÂºìÉ«
 417   1          &&(Display_Temp_Kind==DISPLAY_Temperature_Patient))
 418   1        {
 419   2           Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 420   2           color=RED18; 
 421   2            if(Alarm_WenDu_Cnt == (uint8_t)1)
 422   2            {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 8   

 423   3              color=WHITE18;
 424   3            }
 425   2        }
 426   1        else if(((Bit_is_one(ERR_Kind,Alarm_Const_LoTemp)!=(uint8_t)0)&&((u8)Display_Temp_Kind==(u8)0))  //»¼Õß¶Ë
             -µÍÎÂºìÉ«
 427   1               ||((LoTemp_CQK_Count>(u8)120)&&((uint8_t)Display_Temp_Kind==(uint8_t)1)))  //³öÆø¿ÚµÍÎÂºìÉ«
 428   1        {
 429   2          Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 430   2          color=RED18;
 431   2          if(Alarm_WenDu_Cnt == (uint8_t)1)
 432   2          {
 433   3            color=WHITE18;
 434   3          }
 435   2        }
 436   1        else
 437   1        {
 438   2          if(Refresh_WenDu_Cnt == (uint8_t)0)
 439   2          {
 440   3            Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 441   3          }
 442   2        }
 443   1          
 444   1        if(Temp_Dis_En == (uint16_t)1)
 445   1        {     
 446   2          if(Display_Temp_Kind==DISPLAY_Temperature_Chamber)//³öÆø¿ÚÎÂ¶È
 447   2          {
 448   3            Disp=(uint16_t)CQK_Temp;
 449   3            Disp_Err=CQK_Sensor_Err; 
 450   3          }
 451   2          else if(Display_Temp_Kind==DISPLAY_Temperature_Patient) //ÈËÌå¶ËÎÂ¶È
 452   2          {
 453   3            Disp=Diplay_RTtemp;
 454   3            Disp_Err=RTD_Sensor_Err;
 455   3          }
 456   2          else
 457   2          {
 458   3            //do nothing
 459   3          }
 460   2          
 461   2          if(Disp_Err!=(uint8_t)0)
 462   2          {
 463   3             Draw_Rectangle_Real((POS_RT_TEMP_X+4),(POS_RT_TEMP_Y),(POS_RT_TEMP_X+56),(POS_RT_TEMP_Y+103),(WHITE18)
             -);     
 464   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+29,RED18);
 465   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+63,RED18);
 466   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y+73,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+102,RED18);
 467   3             //Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,RED18); //»­µã
             -  
 468   3          }
 469   2          else  if(Disp>=(uint16_t)1000)//ÏÔÊ¾ÎÂ¶È
 470   2          {
 471   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
 472   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);   
 473   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+73,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
 474   3            Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,(uint8_t)WHITE18)
             -; //È¥µôÐ¡Êýµã
 475   3          }
 476   2          else
 477   2          {
 478   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
 479   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
 480   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+(34*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 9   

 481   3            Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,(uint8_t)color); 
             -//»­µã
 482   3          }
 483   2         }     
 484   1           
 485   1        //ÏÔÊ¾Êª¶È
 486   1        color=BLACK18;
 487   1        if((Bit_is_one(ERR_Kind,Alarm_Const_LoHumity))!=(uint8_t)0)   //µÍÊª¶È±¨¾¯
 488   1        {
 489   2          Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 490   2          color=RED18;
 491   2          if(Alarm_WenDu_Cnt == (uint8_t)1)
 492   2          {
 493   3            color=WHITE18;
 494   3          }
 495   2        }
 496   1        else
 497   1        {
 498   2          if(Refresh_WenDu_Cnt == (uint8_t)0)
 499   2          {
 500   3            Temp_Dis_En = (uint16_t)1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾  
 501   3          }     
 502   2        }
 503   1            
 504   1        if(Temp_Dis_En == (uint16_t)1)
 505   1        {
 506   2          if(RTD_Sensor_Err!=(uint8_t)0)
 507   2          {     
 508   3            Draw_Rectangle_Real(POS_RT_RH_X+4 , POS_RT_RH_Y,POS_RT_RH_X+39,POS_RT_RH_Y+35,(uint8_t)WHITE18);   
 509   3            Draw_Rectangle_Real(POS_RT_RH_X , POS_RT_RH_Y,POS_RT_RH_X+3,POS_RT_RH_Y+16,(uint8_t)RED18);     
 510   3            Draw_Rectangle_Real(POS_RT_RH_X , POS_RT_RH_Y+19,POS_RT_RH_X+3,POS_RT_RH_Y+35,(uint8_t)RED18);       
 511   3          }
 512   2          else
 513   2          { 
 514   3            DISP_RH_17X40(POS_RT_RH_X,POS_RT_RH_Y,(uint8_t)(RT_SHIDU%(u16)1000/(u16)100),(uint8_t)color);
 515   3            DISP_RH_17X40(POS_RT_RH_X,POS_RT_RH_Y+19,(u8)(RT_SHIDU%(u16)100/(u16)10),(uint8_t)color);
 516   3          }
 517   2        } 
 518   1      }
 519          
 520          //---------Ë¢ÐÂÔËÐÐÊ±¼ä
 521          void RefreshRunTimeFunc(uint8_t Refresh_En)
 522          //Refresh_En 1-Ç¿ÖÆË¢ÐÂÒ»´Î£¬·ñÔòÃ¿·ÖÖÓË¢ÐÂÒ»´Î
 523          { 
 524   1        uint8_t t;
 525   1      //  uint8_t refreshEn=Refresh_En;
 526   1        static uint8_t Last_Sec = 60;   
 527   1        static uint8_t   Work_Min=0;
 528   1        static uint8_t   Work_Sec=0;
 529   1        static uint8_t   Work_Day=0;
 530   1        static uint8_t   Work_Hour=0;
 531   1        
 532   1        RX8010_GetTime(NowTime);  
 533   1        t = ((uint8_t)NowTime[0]&(uint8_t)0xF)%(u8)10;
 534   1        
 535   1        if(t != Last_Sec)//Ê±¼äÃëÓÐ±ä»¯
 536   1        {
 537   2          Last_Sec = t;
 538   2          if(Work_Sec<(uint8_t)59)
 539   2          {
 540   3            Work_Sec++;
 541   3          }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 10  

 542   2          else
 543   2          {
 544   3            Work_Sec = 0;
 545   3            t = 0xff;//Ë¢ÐÂ±êÖ¾ 
 546   3            
 547   3            Enable_Save_Data=1;//±£´æ±êÖ¾Î»
 548   3            Run_Count++;//±£´æÊý¾ÝÌõÊý
 549   3      
 550   3            if(Work_Min<(uint8_t)59)
 551   3            {
 552   4              Work_Min++;
 553   4            }
 554   3            else
 555   3            {
 556   4              Work_Min=0;
 557   4              if(Work_Hour<(uint8_t)23)
 558   4              {
 559   5                Work_Hour++;
 560   5              }else
 561   4              {
 562   5                Work_Hour=0;
 563   5                if(Work_Day<(uint8_t)99)
 564   5                {
 565   6                  Work_Day++;
 566   6                }           
 567   5              }
 568   4            }
 569   3          }
 570   2        }
 571   1        
 572   1        if((Refresh_En!=(uint8_t)0)||(t == (uint8_t)0xff))
 573   1        {
 574   2      //    Refresh_En = 0;   
 575   2          if(Work_State != UI_STATE_SCREENSAVER_MODE)
 576   2          {
 577   3            Back_Color=WHITE18;
 578   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y-5,Work_Day/(u8)10,(uint8_t)BLACK18);
 579   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+6,Work_Day%(u8)10,(uint8_t)BLACK18);
 580   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+22,Work_Hour/(u8)10,(uint8_t)BLACK18);
 581   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+33,Work_Hour%(u8)10,(uint8_t)BLACK18);
 582   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+47,Work_Min/(u8)10,(uint8_t)BLACK18);
 583   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+58,Work_Min%(u8)10,(uint8_t)BLACK18);  
 584   3          }
 585   2        }
 586   1      }
 587          
 588          //---------Ë¢ÐÂRTCÊ±ÖÓ
 589          void RefreshRTCTimeFunc(void)
 590          {
 591   1        static uint8_t Last_Min=0;
 592   1      //  uint8_t color;
 593   1        uint8_t t;
 594   1        static uint8_t Last_Sec = 60;
 595   1      
 596   1        
 597   1      //Ê±¼ä×ª»»=================================================
 598   1        RX8010_GetTime(NowTime);  
 599   1        t = (NowTime[0]&(BYTE)0xF)%(u8)10;
 600   1        if(t != Last_Sec)//Ê±¼äÃëÓÐ±ä»¯
 601   1        {
 602   2          Last_Sec = t;
 603   2               
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 11  

 604   2          if(Last_Min!=NowTime[1])
 605   2          {
 606   3            Last_Min=NowTime[1];
 607   3          }
 608   2      //    color=BLACK18;    
 609   2          DisPlayTime(NowTime,2); //ÏÔÊ¾Ê±¼ä
 610   2          DisPlayTime(NowTime,3); //ÏÔÊ¾Ê±¼ä
 611   2          DisPlayTime(NowTime,4); //ÏÔÊ¾Ê±¼ä
 612   2          DisPlayTime(NowTime,5); //ÏÔÊ¾Ê±¼ä
 613   2          DisPlayTime(NowTime,6); //ÏÔÊ¾Ê±¼ä
 614   2          DisPlayTime(NowTime,7); //ÏÔÊ¾Ê±¼ä
 615   2        }
 616   1      }
 617          
 618          void GetTempHumidity_PatientFunc(void)
 619          {
 620   1        static uint8_t Get_time_out = 0;//³¬Ê±£¬Êµ²â64mS£¬×î³¤¸øµ½100mS
 621   1        static BYTE       Read_Order=0; 
 622   1        uint8_t Read_SHT21_Err=0;
 623   1      
 624   1        uint8_t Read_SCL_CONF;
 625   1        UINT32 TempLong;
 626   1        uint16_t  Temp2;
 627   1      
 628   1        static uint16_t RT_Temp_Mem_L1 = 0;
 629   1        static uint16_t RT_Temp_Mem_L2 = 0;
 630   1        static uint16_t RT_Temp_Mem_L3 = 0;
 631   1        static uint8_t ReCnt=0;
 632   1        
 633   1        ReCnt++;
 634   1        if(ReCnt > (u8)50)//1S
 635   1        {
 636   2          ReCnt = 0;  
 637   2          RT_Temp_Mem_L3 = RT_Temp_Mem_L2;
 638   2          RT_Temp_Mem_L2 = RT_Temp_Mem_L1;
 639   2          RT_Temp_Mem_L1 = (uint16_t)RT_Temp; 
 640   2          Diplay_RTtemp = (RT_Temp_Mem_L3+RT_Temp_Mem_L2+RT_Temp_Mem_L1) / (u16)3;  
 641   2        }
 642   1        
 643   1        //static int Ix=0;
 644   1      
 645   1        //Ix++;
 646   1        //LCD_ShowxNum(223,30,16,5,Ix,0x80,BLUE18);//   
 647   1      
 648   1      //  LCD_ShowxNum(223,10,16,3,RT_Temp_Not_Updated_10mS ,0x80,BLUE18);//  
 649   1      //  LCD_ShowxNum(223,70,16,3,No_ReadData_Temp_Times,0x80,BLUE18);//   
 650   1      //  LCD_ShowxNum(223,100,16,3,No_ReadData_SHIDU_Times,0x80,BLUE18);// 
 651   1      //  LCD_ShowxNum(223,130,16,3,ERR_RT_Temp_Times,0x80,BLUE18);// 
 652   1        
 653   1      //  EA = 0;
 654   1        if(RT_Temp_Not_Updated_10mS < (uint16_t)4000)
 655   1        {
 656   2          RT_Temp_Not_Updated_10mS++;
 657   2        }
 658   1        
 659   1        {
 660   2          if(Read_Order==(BYTE)0)   //·¢ÎÂ¶ÈÖ¸Áî      
 661   2          {
 662   3            Read_SHT21_Err = SHT21_WriteTemp(); 
 663   3            if(Read_SHT21_Err!=(uint8_t)0)
 664   3            {
 665   4              Read_Order = 0;//½ÓÊÕ´íÎó
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 12  

 666   4            }
 667   3            else
 668   3            {       
 669   4              Read_Order = 1;
 670   4              Get_time_out = 0;
 671   4            }
 672   3          }
 673   2          else if(Read_Order == (BYTE)1)  //ÎÂ¶ÈÊý¾Ý½ÓÊÕ
 674   2          {
 675   3            //SCL_INPUT_HIGH(); // set SCL I/O port as input
 676   3      //      Read_SCL_CONF=SCL_CONF;
 677   3            if(SCL_CONF)
 678   3            {
 679   4              Read_SCL_CONF=(u8)1;
 680   4            }
 681   3            else
 682   3            {
 683   4              Read_SCL_CONF=(u8)0;
 684   4            }
 685   3            if(Read_SCL_CONF==(uint8_t)1)
 686   3            {
 687   4              Get_time_out = 0;
 688   4              TempLong =  SHT21_ReadData();
 689   4              //RT_Temp_Test = TempLong;
 690   4                //LCD_ShowxNum(223,160,16,5,TempLong,0x80,BLUE18);//  
 691   4                
 692   4              if((TempLong == (UINT32)SHT21_ERROR) || ((TempLong & (UINT32)0x8000)!=(UINT32)0)) //¶ÁÈ¡³ö´í£¬ºóÃæÎªÊ
             -ª¶È±êÖ¾Î»
 693   4              {
 694   5                //if(No_ReadData_Temp_Times<250) No_ReadData_Temp_Times++;  
 695   5                Read_Order = 0;   
 696   5              }
 697   4              else
 698   4              {         
 699   5                No_ReadData_Temp_Times = 0;
 700   5                Read_Order = 2; 
 701   5                          
 702   5                if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÎÂ¶È
 703   5                {
 704   6                  if(WireIn_State!=(uint8_t)0)    //ÓÐ¼ÓÈÈË¿Ïß½øÐÐÎÂ¶ÈÐÞÕý
 705   6                  {
 706   7                    TempLong=(TempLong*(UINT32)101/(UINT32)100)-((UINT32)4*TempLong/(UINT32)388);
 707   7                  }
 708   6                  else
 709   6                  {
 710   7                    TempLong=TempLong-((UINT32)4*TempLong/(UINT32)400); 
 711   7                  }
 712   6                     
 713   6      
 714   6                  if(TempLong>=(UINT32)350)   //ÎÂ¶ÈÐÞÕý
 715   6                  {
 716   7                    TempLong=TempLong+((UINT32)6*(TempLong-(UINT32)350)/(UINT32)45);
 717   7                  }
 718   6                    
 719   6                    
 720   6                  if(TempLong>(UINT32)800) //Èç¹ûÈËÌå¶Ë´ïµ½80ËµÃ÷ÓÐÒì³££¬³ö´í±¨¾¯ //2014-07-07 
 721   6                  {
 722   7                    if(ERR_RT_Temp_Times<(UINT32)100)
 723   7                    {
 724   8                      ERR_RT_Temp_Times++;
 725   8                    }
 726   7                  }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 13  

 727   6                  else 
 728   6                  {
 729   7                    ERR_RT_Temp_Times=0;
 730   7                    RT_Temp=(INT)TempLong;
 731   7                    RT_Temp_Not_Updated_10mS = 0;
 732   7                  }            
 733   6                }
 734   5                else
 735   5                {
 736   6                  RT_Temp=(INT)TempLong;
 737   6                  RT_Temp_Not_Updated_10mS = 0;
 738   6                }
 739   5              } 
 740   4            }
 741   3            else
 742   3            {
 743   4              //CONTROL_RT_SHIDU = 0;       
 744   4            }     
 745   3            //LCD_ShowxNum(223,150,16,3,RT_Temp,0x80,BLUE18);// 
 746   3      
 747   3          }
 748   2          else if(Read_Order==(BYTE)2)  //·¢Êª¶ÈÖ¸Áî
 749   2          {                    
 750   3            Read_SHT21_Err = SHT21_WriteRH();
 751   3            if(Read_SHT21_Err!=(uint8_t)0)
 752   3            {
 753   4              Read_Order = 2;//½ÓÊÕ´íÎó
 754   4            }
 755   3            else
 756   3            {       
 757   4              Read_Order = 3;
 758   4              Get_time_out = 0;
 759   4            }
 760   3          }     
 761   2          else  if(Read_Order == (BYTE)3)//Êª¶ÈÊý¾Ý½ÓÊÕ
 762   2          {
 763   3            //SCL_INPUT_HIGH(); // set SCL I/O port as input
 764   3      //      Read_SCL_CONF=SCL_CONF;
 765   3            if(SCL_CONF)
 766   3            {
 767   4              Read_SCL_CONF=(u8)1;
 768   4            }
 769   3            else
 770   3            {
 771   4              Read_SCL_CONF=(u8)0;
 772   4            }
 773   3            if(Read_SCL_CONF==(uint8_t)1)
 774   3            { 
 775   4              //Read_Order = 0;
 776   4              Get_time_out = 0;
 777   4              TempLong =  SHT21_ReadData();
 778   4              //LCD_ShowxNum(223,210,16,5,TempLong,0x80,BLUE18);//  
 779   4              if((TempLong == (UINT32)SHT21_ERROR)||((TempLong & (UINT32)0x8000) ==(UINT32)0)) //¶ÁÈ¡³ö´í
 780   4              {
 781   5                if(No_ReadData_SHIDU_Times<(uint8_t)250)
 782   5                {
 783   6                  No_ReadData_SHIDU_Times++;
 784   6                }           
 785   5                CONTROL_RT_SHIDU = 0;
 786   5                Read_Order = 2; 
 787   5      
 788   5              }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 14  

 789   4              else
 790   4              {
 791   5                Read_Order = 0; 
 792   5                TempLong &= (UINT32)0x7fff;//×î¸ßÎ»ÊÇ1²ÅÊÇÊª¶È
 793   5                No_ReadData_SHIDU_Times = (uint8_t)0;
 794   5                if(TempLong > (UINT32)999)
 795   5                {
 796   6                  TempLong = 999;
 797   6                }  
 798   5                RT_SHIDU=TempLong;
 799   5                CONTROL_RT_SHIDU=TempLong;  //¿ØÖÆÊª¶È
 800   5                //75%ÒÔÉÏ½øÐÐÐ£×¼
 801   5                if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÊª¶È
 802   5                {
 803   6                  if(RT_Temp>300)
 804   6                  {                  
 805   7                    if(TempLong>(UINT32)550)
 806   7                    {            
 807   8                      Temp2=(TempLong-(UINT32)550)*(UINT32)80/(UINT32)100; //16-05-06
 808   8                      if(Temp2>(u16)249)
 809   8                      {
 810   9                        Temp2=249;
 811   9                      }                     
 812   8                    }
 813   7                    else
 814   7                    {
 815   8                      Temp2 = 0;
 816   8                    }               
 817   7                    RT_SHIDU=TempLong + Temp2;  //2014-07-25
 818   7                  }
 819   6                  else
 820   6                  {                 
 821   7                    RT_SHIDU=TempLong;   //2014-07-18
 822   7                    //RT_SHIDU=TempLong+120;      
 823   7                  } 
 824   6                  
 825   6                  if(RT_Temp>350)
 826   6                  { 
 827   7                     RT_SHIDU=RT_SHIDU+((u16)180*((uint16_t)RT_Temp-(u16)350)/(u16)100);  //ÏÔÊ¾Êª¶È 16-05-06
 828   7                  }
 829   6                }
 830   5                else
 831   5                {
 832   6                  //do nothing
 833   6                } 
 834   5                RT_SHIDU += (u16)5; //ËÄÉáÎåÈë          
 835   5                if(RT_SHIDU>(uint16_t)999)
 836   5                {
 837   6                  RT_SHIDU=(uint16_t)999;//;  
 838   6                }            
 839   5              }
 840   4            }
 841   3            else
 842   3            {
 843   4                //do nothing
 844   4            }
 845   3          //LCD_ShowxNum(223,130,16,3,RT_SHIDU,0x80,BLUE18);//
 846   3            
 847   3          }
 848   2          else
 849   2          {
 850   3            //do nothing
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 15  

 851   3          }
 852   2        
 853   2          if((Read_SHT21_Err!=(uint8_t)0)||(RT_SHIDU == (uint16_t)0))
 854   2          { 
 855   3            if(No_ReadData_SHIDU_Times<(uint8_t)100)
 856   3            {
 857   4              No_ReadData_SHIDU_Times++;
 858   4            }       
 859   3            if(No_ReadData_Temp_Times<(u8)100)
 860   3            {
 861   4              No_ReadData_Temp_Times++;
 862   4            }       
 863   3           
 864   3          }
 865   2          else  
 866   2          {
 867   3            No_ReadData_SHIDU_Times=(uint8_t)0;
 868   3            No_ReadData_Temp_Times=0;
 869   3          } 
 870   2      
 871   2          Get_time_out++;
 872   2          if(Get_time_out >(u8)100)//³¬¹ý100mS
 873   2          {
 874   3            Get_time_out = 0;
 875   3            if(Read_Order == (BYTE)1)
 876   3            {
 877   4              Read_Order = 0;
 878   4            }
 879   3            else if(Read_Order == (BYTE)3)
 880   3            {
 881   4              Read_Order = 2;
 882   4            }
 883   3            else
 884   3            {
 885   4              Read_Order = 0;
 886   4            }       
 887   3          }        
 888   2        }
 889   1      }
 890          
 891          
 892          void GetTemp_HpChamberFunc(void)
 893          {
 894   1      //  bit HeaterSensorExist;
 895   1        uint8_t CQKSensorExist=0;
 896   1      
 897   1        //  static uint16_t CQK_Temp_Not_Updated_40mS = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼äS
 898   1        //  static uint16_t JRP_Temp_Not_Updated_S = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼äS
 899   1      
 900   1        uint8_t T18B20_L;
 901   1        uint8_t T18B20_H;
 902   1        uint8_t CQK_T18B20_L;
 903   1        uint8_t CQK_T18B20_H; 
 904   1      
 905   1        uint8_t T18B20_H_GET;
 906   1        uint8_t T18B20_L_GET;
 907   1        uint8_t CQK_T18B20_H_GET;
 908   1        uint8_t CQK_T18B20_L_GET;
 909   1      
 910   1      
 911   1        static uint16_t CQK_Temp_Last=0;
 912   1        uint8_t CRC8_error=0;   //checksum
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 16  

 913   1        uint8_t checksum=0;   //checksum
 914   1        uint8_t DS18B20_Cdata[8];    //data array for checksum verification 
 915   1      
 916   1        uint16_t temp=0;
 917   1        static uint16_t JRP_Temp_Last=0;
 918   1      
 919   1        static uint8_t Get_Temp_Cnt=0;
 920   1      
 921   1        Get_Temp_Cnt++;
 922   1        if(Get_Temp_Cnt > (u8)3)
 923   1        {
 924   2          Get_Temp_Cnt = 0;
 925   2        }
 926   1        
 927   1        if(No_CQKSensor_Times<(u16)2000)
 928   1        {
 929   2          No_CQKSensor_Times++;
 930   2        }
 931   1        if(No_HeatSensor_Times<(u8)200)
 932   1        {
 933   2          No_HeatSensor_Times++;
 934   2        }
 935   1        
 936   1        if(Get_Temp_Cnt == (u8)0)  //
 937   1        {
 938   2          HeatingPlateSensor_Port=(bit)0;                                //Ö÷»úÀ­ÖÁµÍµçÆ½
 939   2          ChamberOutletSensor_Port=(bit)0;
 940   2          delay_us(609);                                //609
 941   2          HeatingPlateSensor_Port=(bit)1;                                //ÊÍ·Å×ÜÏßµÈµç×èÀ­¸ß×ÜÏß,²¢±£³Ö15~60us
 942   2          ChamberOutletSensor_Port=(bit)1;
 943   2          delay_us(86);                           //ÑÓÊ±70us                     //ÑÓÊ±70us
 944   2      //    HeaterSensorExist=HeatingPlateSensor_Port;                //½ÓÊÕÓ¦´ðÐÅºÅ
 945   2      //    CQKSensorExist=ChamberOutletSensor_Port;
 946   2          delay_us(488);                                //403
 947   2          DS18B20_WriteByte(0xCC);                      //Ìø¹ýROMÃüÁî
 948   2          DS18B20_WriteByte(0x44);                      //¿ªÊ¼×ª»»ÃüÁî
 949   2        }
 950   1        else if(Get_Temp_Cnt == (u8)2) //
 951   1         //½øÐÐÎÂ¶È×ª»»
 952   1        {
 953   2          HeatingPlateSensor_Port=(bit)0;                                //Ö÷»úÀ­ÖÁµÍµçÆ½
 954   2          ChamberOutletSensor_Port=(bit)0;
 955   2          delay_us(609);                                //503us
 956   2          HeatingPlateSensor_Port=(bit)1;                                //ÊÍ·Å×ÜÏßµÈµç×èÀ­¸ß×ÜÏß,²¢±£³Ö15~60us
 957   2          ChamberOutletSensor_Port=(bit)1;
 958   2          delay_us(86);                           //ÑÓÊ±70us
 959   2      ////    HeaterSensorExist=HeatingPlateSensor_Port;                //½ÓÊÕÓ¦´ðÐÅºÅ
 960   2      //    CQKSensorExist=ChamberOutletSensor_Port;
 961   2          if(ChamberOutletSensor_Port)
 962   2          {
 963   3            CQKSensorExist=(u8)1;
 964   3          }
 965   2          else
 966   2          {
 967   3            CQKSensorExist=(u8)0;
 968   3          }
 969   2          delay_us(488);
 970   2          DS18B20_WriteByte(0xCC);                      //Ìø¹ýROMÃüÁî
 971   2          DS18B20_WriteByte(0xBE);                      //¶ÁÔÝ´æ´æ´¢Æ÷ÃüÁî
 972   2          delay_us(10);
 973   2          DS18B20_ReadByte();                           //¶ÁÎÂ¶ÈµÍ×Ö½Ú
 974   2          T18B20_L=Read_18B20_Value;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 17  

 975   2          CQK_T18B20_L=Read_18B20_Value2;
 976   2          DS18B20_ReadByte();                           //¶ÁÎÂ¶È¸ß×Ö½Ú
 977   2          T18B20_H=Read_18B20_Value;
 978   2          CQK_T18B20_H=Read_18B20_Value2;
 979   2        
 980   2          if((CQKSensorExist==(uint8_t)0))//´íÎóÔò²»½øÐÐÐ£Ñé
 981   2          {
 982   3            DS18B20_Cdata[0] = CQK_T18B20_L;
 983   3            DS18B20_Cdata[1] = CQK_T18B20_H;
 984   3            DS18B20_ReadByte();  
 985   3            DS18B20_Cdata[2] = Read_18B20_Value2;
 986   3            DS18B20_ReadByte();  
 987   3            DS18B20_Cdata[3] = Read_18B20_Value2;
 988   3            DS18B20_ReadByte();  
 989   3            DS18B20_Cdata[4] = Read_18B20_Value2;
 990   3            DS18B20_ReadByte();  
 991   3            DS18B20_Cdata[5] = Read_18B20_Value2;
 992   3            DS18B20_ReadByte();  
 993   3            DS18B20_Cdata[6] = Read_18B20_Value2;
 994   3            DS18B20_ReadByte();  
 995   3            DS18B20_Cdata[7] = Read_18B20_Value2;
 996   3            DS18B20_ReadByte();  
 997   3            checksum = Read_18B20_Value2;     
 998   3            //Cdata[7] = 0x11; //test CRC
 999   3      
1000   3            CRC8_error = DS18B20_CheckCrc(DS18B20_Cdata,8,checksum); 
1001   3              
1002   3            if(CRC8_error == (u8)CHECKSUM_ERROR)
1003   3            {
1004   4              CQKSensorExist = (uint8_t)1;
1005   4            }          
1006   3             
1007   3            if((CQKSensorExist==(uint8_t)0))//
1008   3            {
1009   4              CQK_T18B20_H_GET = CQK_T18B20_H;
1010   4              CQK_T18B20_L_GET = CQK_T18B20_L;
1011   4      
1012   4              CQK_T18B20_H_GET = (uint8_t)((CQK_T18B20_H_GET << 4) | (CQK_T18B20_L_GET >> 4));      //¼ÓÈÈÅÌÎÂ¶ÈÖµºÏ²¢¸
             -ßµÍÎ»´æÈëÕûÊýÎ»
1013   4              if((CQK_T18B20_H_GET&(uint8_t)0x80)!=(uint8_t)0)//ÊÇ¸ºÊý
1014   4              {
1015   5                CQK_T18B20_L_GET =(((~CQK_T18B20_L_GET)&(uint8_t)0x0F)*(u8)10)/(u8)16;
1016   5                temp=((~CQK_T18B20_H_GET)*(u16)10)+(u16)CQK_T18B20_L_GET;
1017   5              } 
1018   4              else
1019   4              {
1020   5                CQK_T18B20_L_GET = ((CQK_T18B20_L_GET&(uint8_t)0x0F)*(u8)10)/(u8)16;
1021   5                temp=(CQK_T18B20_H_GET*(u16)10)+(u16)CQK_T18B20_L_GET;
1022   5              }
1023   4          
1024   4              if((CQK_Temp_Last ==  temp) && (temp == (u16)850))  //´íÎóÊ±Ò»Ö±ÏÔÊ¾85¶È 2014-07-18
1025   4              {
1026   5                CQK_Sensor_Temp_No_Change_Times++;//2014-07-03 ³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷ÎÂ¶ÈÏàÍ¬µÄ´ÎÊý
1027   5                if(CQK_Sensor_Temp_No_Change_Times > (u16)10000)
1028   5                {
1029   6                  CQK_Sensor_Temp_No_Change_Times =10000;
1030   6                }
1031   5              }
1032   4              else
1033   4              {
1034   5                CQK_Sensor_Temp_No_Change_Times = 0;    
1035   5              }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 18  

1036   4               
1037   4              if(temp > (u16)800)
1038   4              {
1039   5              //           if(CQKSensor_Hithen800_Times < 2000) CQKSensor_Hithen800_Times++;            
1040   5              }
1041   4              else
1042   4              {
1043   5                CQKSensor_Hithen800_Times = 0;
1044   5              }         
1045   4      
1046   4              if(((CQK_Temp_Last >=  temp) && ((CQK_Temp_Last - temp) < (u16)200))
1047   4              ||((CQK_Temp_Last <=  temp) && ((temp - CQK_Temp_Last)  < (u16)200)))//EFT¶Ô²ß£ºÎÂ¶È²»ÄÜË²±ä,1S±ä»¯²»Ä
             -Ü³¬¹ý20¶È
1048   4              { 
1049   5                if((temp > (u16)0)&&(temp < (u16)850))//²»¶ÁÁã
1050   5                {
1051   6                  CQK_Temp = (LONG)temp;//ÊµÊ±ÏÔÊ¾ÎÂ¶È
1052   6                  if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÎÂ¶È
1053   6                  {
1054   7                    CQK_Temp=CQK_Temp*51/50;  
1055   7                  }
1056   6                }
1057   5              }
1058   4              else
1059   4              {
1060   5                //do nothing
1061   5              } 
1062   4              CQK_Temp_Last =  temp;  
1063   4            }
1064   3          }
1065   2           
1066   2      //    if(CQKSensorExist==1)// || CQK_Temp > 800)
1067   2      //    {
1068   2      //    //        if(No_CQKSensor_Times<2000)No_CQKSensor_Times++;          
1069   2      //    }
1070   2      //    else
1071   2          {
1072   3            No_CQKSensor_Times=0; 
1073   3          }
1074   2      
1075   2          T18B20_H_GET = T18B20_H;
1076   2          T18B20_L_GET = T18B20_L;
1077   2      
1078   2          if(Work_State == UI_STATE_SERVICE_MODE)//ÔÚ²âÊÔÄ£Ê½Ê±ÏÔÊ¾¶ÁÈ¡µÄÊý¾Ý
1079   2          {
1080   3      //      LCD_ShowxNum(10,220,24,3,T18B20_H_GET,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ¼ÓÈÈÅÌ
1081   3      //      LCD_ShowxNum(10,268,24,3,T18B20_L_GET,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾
1082   3          }    
1083   2      
1084   2      
1085   2          T18B20_H_GET = (uint8_t)((T18B20_H_GET << 4) | (T18B20_L_GET >> 4));      //¼ÓÈÈÅÌÎÂ¶ÈÖµºÏ²¢¸ßµÍÎ»´æÈëÕûÊýÎ
             -»
1086   2          if((T18B20_H_GET&(uint8_t)0x80)!=(uint8_t)0)//ÊÇ¸ºÊý
1087   2          {
1088   3            T18B20_L_GET =(((~T18B20_L_GET)&(uint8_t)0x0F)*(u8)10)/(u8)16;
1089   3            temp=((~T18B20_H_GET)*(u16)10)+(u16)T18B20_L_GET;
1090   3          } 
1091   2          else
1092   2          {
1093   3            T18B20_L_GET = ((T18B20_L_GET&(uint8_t)0x0F)*(u8)10)/(u8)16;
1094   3            temp=(T18B20_H_GET*(u16)10)+(u16)T18B20_L_GET;
1095   3          }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 19  

1096   2            
1097   2             
1098   2          if((JRP_Temp_Last ==  temp))// && (temp == 850))  //´íÎóÊ±Ò»Ö±ÏÔÊ¾85¶È 2014-07-18
1099   2          {
1100   3            JRP_Sensor_Temp_No_Change_Times++;//2014-07-03 ¼ÓÈÈÅÌÎÂ¶È´«¸ÐÆ÷ÎÂ¶ÈÏàÍ¬µÄ´ÎÊý
1101   3            if(JRP_Sensor_Temp_No_Change_Times > (u16)6000)
1102   3            {
1103   4              JRP_Sensor_Temp_No_Change_Times = 6000;
1104   4            }
1105   3          }
1106   2          else
1107   2          {
1108   3            JRP_Sensor_Temp_No_Change_Times = 0;
1109   3          }
1110   2          JRP_Temp_Last =  temp;    
1111   2      
1112   2          JEP_Temp =  (INT)temp;    //ÊµÊ±ÏÔÊ¾ÎÂ¶È
1113   2      
1114   2      //    if(HeaterSensorExist==1 || JEP_Temp>=0x0FFF || JEP_Temp > 1250)
1115   2      //    {
1116   2      ////       if(No_HeatSensor_Times<2000)No_HeatSensor_Times++; 
1117   2      //    }
1118   2      //    else
1119   2          {
1120   3            No_HeatSensor_Times=0;
1121   3          }
1122   2        }
1123   1        else
1124   1        {
1125   2          //do nothing
1126   2        }
1127   1      } 
1128          
1129          
1130          static INT  Temp2_Int = 400;
1131          static uint16_t NoneWire_Heat_Sec=0;
1132          static INT  Set_CQK_Temp_Comp;//³öÆø¿ÚÐ£Õý¹ýºóµÄÄ¿±êÎÂ¶È
1133          void  HeaterPlateWireControlFunc(void)//ÎÂ¶È¿ØÖÆ
1134          {
1135   1        //    uint8_t  Temp3;
1136   1        uint16_t  Val_Calc=0;
1137   1      
1138   1        INT  Humidity_Err=0; //Î´´ïµ½Ä¿±êÊª¶ÈµÄ²îÖµ
1139   1        INT  Humidity_Comp=0;//³¬¹ýÄ¿±êÎÂ¶ÈµÄ²îÖµ 
1140   1        static uint16_t Last_Rem_Humidity=0;  
1141   1        static uint16_t   Aim_SHIDU=900;  //Ä¿±êÊª¶È 
1142   1        static INT  Temp1_Int = 260;
1143   1        
1144   1        static uint16_t WarmUp_S_Cnt=0; 
1145   1        //uint16_t  CQK_Vaul_Err;//²îÖµ
1146   1      
1147   1        if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == (u8)1))
1148   1        { //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ³öÆø¿Ú
1149   2          Back_Color=WHITE18;
1150   2          LCD_ShowxNum(POS_RT_RH_X-50,5,16,2,Micro_Adj_Mode_Test,0x80,BLACK18); //·¢ÈÈÅÌ¼ÓÈÈµÄÄ£Ê½ÏÔÊ¾
1151   2          LCD_ShowxNum(POS_RT_RH_X-50,34,16,4,(u32)JEP_Temp,0x80,BLACK18); //·¢ÈÈÅÌµÄÎÂ¶È
1152   2          LCD_ShowxNum(POS_RT_RH_X-50,73,16,3,(u32)CQK_Temp,0x80,BLACK18); //³öÆø¿ÚµÄÎÂ¶È
1153   2          LCD_ShowxNum(POS_RT_RH_X-50,107,16,3,Set_CQK_Temp,0x80,BLACK18); //³öÆø¿ÚÉè¶¨ÎÂ¶È
1154   2          LCD_ShowxNum(POS_RT_RH_X-50,141,16,3,Micro_Temp_Val,0x80,BLACK18); //·¢ÈÈÅÌµÄ¼ÓÈÈÊ±³¤
1155   2          
1156   2          LCD_ShowxNum(POS_RT_RH_X-50,185,16,3,CONTROL_RT_SHIDU,0x80,BLACK18); //ÕæÊµÏà¶ÔÊª¶È
1157   2          LCD_ShowxNum(POS_RT_RH_X-50,219,16,3,Aim_SHIDU,0x80,BLACK18); //Ä¿±êÊª¶È
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 20  

1158   2          LCD_ShowxNum(POS_RT_RH_X-50,253,16,3,Micro_Temp_In,0x80,BLACK18); //In¼ÓÈÈÊ±³¤
1159   2          LCD_ShowxNum(POS_RT_RH_X-50,287,16,3,Micro_Temp_Out,0x80,BLACK18); //Exp¼ÓÈÈÊ±³¤
1160   2          
1161   2          LCD_ShowxNum(POS_RT_RH_X-33,2,16,1,(u32)Wire_Mode_Sel,0x80,BLACK18); //¼ÓÈÈË¿Ä£Ê½     
1162   2          LCD_ShowxNum(POS_RT_RH_X-33,10,16,1,WireIn_State,0x80,BLACK18); //IN¼ÓÈÈË¿×´Ì¬
1163   2          LCD_ShowxNum(POS_RT_RH_X-33,18,16,1,WireOut_State,0x80,BLACK18); //EXP¼ÓÈÈË¿×´Ì¬  
1164   2            
1165   2          //LCD_ShowxNum(POS_RT_RH_X-20,185,16,1,SHT21_Heater_State,0x80,BLACK18); //SHT¼ÓÈÈ×´Ì¬
1166   2          LCD_ShowxNum(POS_RT_RH_X-33,253,16,3,Wire_Warm_Up_Sec,0x80,BLACK18); //600S¼ÆÊ± 
1167   2          LCD_ShowxNum(POS_RT_RH_X-33,107,16,3,(u32)Set_CQK_Temp_Comp,0x80,BLACK18); //Ð£Õý¹ýºóµÄ³öÆø¿ÚÄ¿±êÊª¶È
1168   2          //LCD_ShowxNum(POS_RT_RH_X-33,141,16,3,Plate_Warm_Up_Sec,0x80,BLACK18); //600S¼ÆÊ±  
1169   2          LCD_ShowxNum(POS_RT_RH_X-33,185,16,3,Humidity_No_Change_Sec,0x80,BLACK18); //600S¼ÆÊ±     
1170   2          
1171   2          if(WireIn_State!=(u8)0) //ÓÐ·¢ÈÈË¿
1172   2          {
1173   3            LCD_ShowxNum(POS_RT_RH_X-33,34,16,4,(u32)JEP_Temp_Aim,0x80,BLACK18); //·¢ÈÈÅÌµÄÄ¿±êÎÂ¶È
1174   3            LCD_ShowxNum(POS_RT_RH_X-16,34,16,3,WarmUp_S_Cnt,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±¸Ä±äÊ±¼ä  
1175   3      
1176   3            if(Controler_temp3.Sum_error >0)
1177   3            {
1178   4              LCD_ShowxNum(POS_RT_RH_X+41,20,16,1,1,0x80,BLACK18); //
1179   4            }
1180   3            else
1181   3            {
1182   4              LCD_ShowxNum(POS_RT_RH_X+41,20,16,1,0,0x80,BLACK18); //
1183   4            }
1184   3              
1185   3      
1186   3            LCD_ShowxNum(POS_RT_RH_X+41,34,16,4,(u32)(abs(Controler_temp3.Sum_error)),0x80,BLACK18); //
1187   3      
1188   3      
1189   3            if(Controler_temp2.Sum_error >0)
1190   3            {
1191   4              LCD_ShowxNum(POS_RT_RH_X+41,80,16,1,1,0x80,BLACK18); //
1192   4            }
1193   3            else
1194   3            {
1195   4              LCD_ShowxNum(POS_RT_RH_X+41,80,16,1,0,0x80,BLACK18); //
1196   4            }
1197   3              
1198   3      
1199   3            LCD_ShowxNum(POS_RT_RH_X+41,94,16,4,(u32)(abs(Controler_temp2.Sum_error)),0x80,BLACK18); //
1200   3          }
1201   2          else
1202   2          {
1203   3            LCD_ShowxNum(POS_RT_RH_X-33,34,16,4,(u32)Temp2_Int,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±·¢ÈÈÅÌµÄÄ¿±êÎÂ¶È
1204   3            LCD_ShowxNum(POS_RT_RH_X-16,34,16,3,NoneWire_Heat_Sec,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±¸Ä±äÊ±¼ä 
1205   3          }
1206   2            
1207   2          LCD_ShowxNum(POS_RT_RH_X+40,170,16,3,(u32)Temp1_Int,0x80,BLACK18); //¿ª»ú½¥½øÊ½ÎÂ¶ÈÄ¿±ê
1208   2          LCD_ShowxNum(POS_RT_RH_X+20,170,16,3,(u32)RT_Temp,0x80,BLACK18); //»¼Õß¶ËÎÂ¶È
1209   2          LCD_ShowxNum(POS_RT_RH_X+20,210,16,4,Nochange_Times,0x80,BLACK18); //ÎÂÊª¶ÈÁ¬Ðø²»±ä¼ÆÊý   
1210   2      
1211   2          LCD_ShowxNum(2,2,16,5,Working_Normal,0x80,BLACK18); //Õý³£¹¤×÷Ê±¼ä¼ÆÊ±  
1212   2          LCD_ShowxNum(2,60,16,5,HP_CNT_Int_End_Rem,0x80,BLACK18); //ÏÔÊ¾Ã¿4Ãë¼ÓÈÈÅÌ·½²¨µÄ´ÎÊý      
1213   2        }
1214   1      
1215   1        if(        
1216   1          ((ERR_Kind & (uint8_t)0x01)!=(uint8_t)0)//´«¸ÐÆ÷´íÎó        
1217   1          ||((ERR_Kind & (uint8_t)0x02)!=(uint8_t)0) //¸ßÎÂ
1218   1          ||((ERR_Kind & (uint8_t)0x10)!=(uint8_t)0) //ÎÞË®   
1219   1          || (Wire_Mode_Mismatch == (uint8_t)1)  //·¢ÈÈË¿Î´Ñ¡
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 21  

1220   1          || (HeaterPlate_State==(uint8_t)0))//Ë®¹ÞÎ´×°ºÃ
1221   1        {
1222   2          Micro_Temp_In=0;
1223   2          Micro_Temp_Out=0;
1224   2          Micro_Temp_Val=0;  //Í£Ö¹¼ÓÈÈ
1225   2          Micro_Adj_Mode_Test = 1;//¼ÓÈÈÄ£Ê½²âÊÔ
1226   2          Wire_Warm_Up_Sec = 0; //µ±<=300Ê±ÏÞÖÆ×î´ó¼ÓÈÈ¹¦ÂÊ  
1227   2          //Plate_Warm_Up_Sec = 0;
1228   2          Humidity_No_Change_Sec = 0;     
1229   2        }
1230   1        else
1231   1        {       
1232   2          //¹ÜÄÚ·¢ÈÈË¿¹¤×÷,¿ØÖÆÎÂ¶Èµ÷½Ú==========================       
1233   2      
1234   2          if(Work_Mode==(u8)Noninvasive_Mode) //ÎÞ´´Ä£Ê½Ê±,ÈËÌå¶ËÎÂ¶È¶ÔÄ¿±êÊª¶ÈµÄ¿ØÖÆÂß¼­
1235   2          {       
1236   3            Aim_SHIDU=790;  
1237   3          }else   //ÓÐ´´Ä£Ê½Ê±,ÈËÌå¶ËÎÂ¶È¶ÔÄ¿±êÊª¶ÈµÄÓ°Ïì
1238   2          {
1239   3            Aim_SHIDU=890; //2014-11-21 
1240   3          }
1241   2      
1242   2          Val_Calc = 0;       
1243   2          //if(Boot_Start_RT_Temp_Heating_Timer_Sec > 300) //»¼Õß¶Ë¿ª»ú½¥½øÊ½¼ÓÈÈ½áÊø
1244   2          if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1245   2          {//»ØÂ··¢ÈÈË¿µÄ¿ØÖÆ
1246   3            if(WireIn_State!=(u8)0)   //µ±ÓÐ¹ÜÄÚIN·¢ÈÈË¿Ê±£¬¹ÜÄÚ·¢ÈÈË¿µÄ¼ÓÈÈÂß¼­
1247   3            {
1248   4              if(Working_Normal >= (u16)1200)
1249   4              {
1250   5                Temp1_Int = Set_RT_Temp;//20·ÖÖÓÒÔºóÎªÉè¶¨ÎÂ¶È
1251   5              }
1252   4              else
1253   4              {           
1254   5                Temp1_Int = CQK_Temp + 30;//20·ÖÖÓÒÔÇ°¸úËæ³öÆø¿ÚÎÂ¶È
1255   5              }
1256   4              if(Temp1_Int > Set_RT_Temp)
1257   4              {
1258   5                Temp1_Int = Set_RT_Temp;
1259   5              }
1260   4                
1261   4                
1262   4              //Controler_temp.Ek = Set_RT_Temp - RT_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1263   4              Controler_temp.Ek = Temp1_Int - RT_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1264   4              Controler_Calc(); 
1265   4              Val_Calc = (uint8_t)Controler_temp.Uk;  //¼ÆËã³ö¼ÓÈÈÊ±¼ä          
1266   4                
1267   4              if(WireIn_State!=(u8)0)
1268   4              {
1269   5                if (RT_Temp<(Set_RT_Temp-20))
1270   5                {
1271   6                  //do nothing
1272   6                }
1273   5                else if (RT_Temp<(Set_RT_Temp-10))
1274   5                {
1275   6                  //do nothing
1276   6                }
1277   5                else if (RT_Temp<=Set_RT_Temp)
1278   5                {
1279   6                  //do nothing
1280   6                }
1281   5                else if (RT_Temp<=(Set_RT_Temp+10))
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 22  

1282   5                {
1283   6                  //do nothing
1284   6                }
1285   5                else
1286   5                {
1287   6                  Val_Calc=0; 
1288   6                }
1289   5              }
1290   4              else
1291   4              {
1292   5                     Val_Calc=0;
1293   5              }
1294   4            } 
1295   3            else    //µ±ÎÞ¹ÜÄÚ·¢ÈÈË¿Ê±
1296   3            {
1297   4              Val_Calc=0;
1298   4            }
1299   3              
1300   3            if(Working_Normal >= (u16)1200)//Õý³£¹¤×÷20·ÖÖÓÖ®ºó
1301   3            {
1302   4      
1303   4            }
1304   3            else
1305   3            {
1306   4              if(Val_Calc > (u16)160)
1307   4              {
1308   5                Val_Calc = 160;//20·ÖÖÓÄÚÏÞÖÆ¼ÓÈÈ¹¦ÂÊ
1309   5              }
1310   4            }
1311   3              
1312   3              
1313   3            Micro_Temp_In = Val_Calc;
1314   3      
1315   3            Val_Calc=0;
1316   3            if(WireOut_State!=(u8)0)    //µ±ÓÐ¹ÜÄÚOUT·¢ÈÈË¿Ê±£¬¹ÜÄÚ·¢ÈÈË¿µÄ¼ÓÈÈÂß¼­
1317   3            {
1318   4              {
1319   5                Val_Calc = Micro_Temp_In *((u16)10+In_Exp_Ratio-(u16)1)/(u16)10;
1320   5                if(Val_Calc > (u16)195)
1321   5                {
1322   6                  Val_Calc = 195;
1323   6                }
1324   5                if(In_Exp_Ratio > (u8)1)
1325   5                { 
1326   6                  if(Val_Calc==(u16)0)
1327   6                  {
1328   7                    Val_Calc=(u16)40*((u16)10+In_Exp_Ratio-(u16)1)/(u16)10;
1329   7                  }
1330   6                }
1331   5                if (RT_Temp >= (Set_RT_Temp+10))//´óÓÚ1¶È,Í£Ö¹¼ÓÈÈ,±£»¤´ëÊ©
1332   5                {
1333   6                  Val_Calc=0; 
1334   6                }
1335   5              }          
1336   4            }
1337   3            else
1338   3            { 
1339   4              Val_Calc=0; 
1340   4            }
1341   3            Micro_Temp_Out = Val_Calc;
1342   3          }
1343   2      
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 23  

1344   2          //ÓÐÎÞ´´Ä£Ê½Ê±·¢ÈÈÅÌµÄ¼ÓÈÈÂß¼­
1345   2      
1346   2          //²»Çø·Ö¼ÓÈÈÏß/////////////////////////////   
1347   2          if(CONTROL_RT_SHIDU<=Aim_SHIDU)//Ö÷ÒªÊÇÕë¶Ô´óÁ÷Á¿Ê±µÄ²¹³¥
1348   2          {
1349   3            Humidity_Err = (INT)((INT)Aim_SHIDU - (INT)CONTROL_RT_SHIDU);///2;//Êª¶ÈÎó²î¼ÆËã
1350   3            if(Humidity_Err > 100)
1351   3            {
1352   4              Humidity_Err = 100;//×î´óÏÞ¶¨Îª100
1353   4            }
1354   3          }   
1355   2          else
1356   2          {
1357   3            Humidity_Err = 0; 
1358   3          }     
1359   2                
1360   2          Humidity_Comp = (INT) ((INT)CONTROL_RT_SHIDU - (INT)Aim_SHIDU); //¿ØÖÆÊª¶ÈÒÔ¼õÉÙÀäÄýË®    
1361   2          if(Humidity_Comp > 100)
1362   2          {
1363   3            Humidity_Comp  = 100;
1364   3          }
1365   2      
1366   2          if(Last_Rem_Humidity != CONTROL_RT_SHIDU)//ÕæÊµÊª¶È¸Ä±äÔòÇåÁã
1367   2          {
1368   3            Humidity_No_Change_Sec = 0;
1369   3          }
1370   2          Last_Rem_Humidity = CONTROL_RT_SHIDU;
1371   2      
1372   2          if(Humidity_No_Change_Sec >= (uint16_t)900)//¿ÉÄÜ½øÈëÀäÄý×´Ì¬
1373   2          {
1374   3            Humidity_No_Change_Sec = 901;
1375   3            Humidity_Err = 0;  //½øÈëÀäÄý×´Ì¬ÔòÊª¶È¿ØÖÆÎÞÐ§
1376   3            Humidity_Comp = 0;
1377   3          }       
1378   2                      
1379   2          if((CQK_Temp>=660) ||(JEP_Temp>=HeatingTemperature_MAX))     //³öÆø¿ÚÎÂ¶È×î¸ß66¶È
1380   2          {
1381   3             Micro_Temp_Val=0;//´óÓÚ65¶È±ØÐëÍ£Ö¹¼ÓÈÈ
1382   3             Micro_Adj_Mode_Test = 2;//¼ÓÈÈÄ£Ê½²âÊÔ          
1383   3          }       
1384   2          //´ø¼ÓÈÈÏßµÄÎÂ¶Èµ÷½Ú===========================
1385   2          else if(WireIn_State!=(uint8_t)0)
1386   2          {
1387   3            if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1388   3            {
1389   4              if(JEP_Temp>=HeatingTemperature_MAX)   //105¶È
1390   4              {
1391   5                Val_Calc = 0;
1392   5                Micro_Adj_Mode_Test = 7;//¼ÓÈÈÄ£Ê½²âÊÔ              
1393   5              }
1394   4              else
1395   4              { 
1396   5                Set_CQK_Temp_Comp = (INT)Set_CQK_Temp; //³öÆø¿ÚÉè¶¨ÎÂ¶È
1397   5                
1398   5                if(Work_Mode==(u8)Invasive_Mode)//
1399   5                { 
1400   6                  if(Humidity_Err >= (INT)50)  //µ±Ä¿±êÊª¶ÈÏà²î5%ÒÔÉÏÇÒÎªÎÞ´´Ê±£¬ÔÊÐí×î¸ß³¬¹ý¶È
1401   6                  {
1402   7                    //Set_CQK_Temp_Comp += Humidity_Err/6;//×î¸ßÔÊÐí³¬¹ý1.6¶È
1403   7                    Set_CQK_Temp_Comp += Humidity_Err/10;//×î¸ßÔÊÐí³¬¹ý1¶È
1404   7                  } 
1405   6                } 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 24  

1406   5                else
1407   5                {
1408   6                  if(Humidity_Err >= 50)  //µ±Ä¿±êÊª¶ÈÏà²î5%ÒÔÉÏÇÒÎªÎÞ´´Ê±£¬ÔÊÐí×î¸ß³¬¹ý¶È
1409   6                  {
1410   7                    Set_CQK_Temp_Comp += Humidity_Err/2;//×î¸ßÔÊÐí³¬¹ý5¶È 120L 28»·¾³ÎÂ¶È
1411   7                  }
1412   6                } 
1413   5      
1414   5                if(Humidity_Comp >= 10)
1415   5                {
1416   6                  //Set_CQK_Temp_Comp = Set_CQK_Temp_Comp - Humidity_Comp/5;//Êª¶ÈÃ¿ÉÏ1%Ôò³öÆø¿ÚÎÂ¶ÈÏÂ½µ0.2¶È£¬×î¶à2¶È
1417   6                  Set_CQK_Temp_Comp = Set_CQK_Temp_Comp - (Humidity_Comp/10);//Êª¶ÈÃ¿ÉÏ1%Ôò³öÆø¿ÚÎÂ¶ÈÏÂ½µ0.1¶È£¬×î¶à1¶
             -È
1418   6                }   
1419   5      
1420   5                if(Work_Mode==(uint8_t)Invasive_Mode)//
1421   5                { 
1422   6                  //Set_CQK_Temp_Comp -= 5;//ÓÐ´´Ê±½µµÍ0.5¶È  
1423   6                  if(Set_CQK_Temp_Comp < 320)
1424   6                  {
1425   7                    Set_CQK_Temp_Comp = 320;//×î¼«ÏÞµÄÎÂ¶È
1426   7                  }
1427   6                }
1428   5                else
1429   5                { 
1430   6                  if(Set_CQK_Temp_Comp < 300)
1431   6                  {
1432   7                    Set_CQK_Temp_Comp = 300;//×î¼«ÏÞµÄÎÂ¶È
1433   7                  }
1434   6                } 
1435   5      
1436   5                ////if(CQK_Temp < Set_CQK_Temp_Comp - 30) //  
1437   5      
1438   5                //Ëã·¨¿ªÊ¼
1439   5                if(JEP_Temp < (JEP_Temp_Aim - 20))//¼ÓÈÈÅÌÎÂ¶ÈÐ¡ÓÚ¼ÓÈÈÅÌÄ¿±êÎÂ¶È-2    
1440   5                {
1441   6                  WarmUp_S_Cnt = 0;//ÇåÁã£¬µÈ´ý´ïµ½¼ÓÈÈÄ¿±ê
1442   6                } 
1443   5                else
1444   5                {
1445   6                  WarmUp_S_Cnt++;
1446   6                  if(WarmUp_S_Cnt >= (u16)20)//Ã¿Á½·ÖÖÓµ÷ÕûÒ»´Î¼ÓÈÈÅÌÄ¿±êÎÂ¶È
1447   6                  {
1448   7                    WarmUp_S_Cnt = 0;
1449   7                    Controler_temp3.Ek = Set_CQK_Temp_Comp - CQK_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1450   7                    HeatPlateTemp_Aim_Controler_Calc();                       
1451   7      
1452   7                    JEP_Temp_Aim = JEP_Temp_Aim + Controler_temp3.Uk;//                       
1453   7                    
1454   7                    if(Work_Mode==(u8)Invasive_Mode)//
1455   7                    {
1456   8                      if(JEP_Temp_Aim < 500)
1457   8                      {
1458   9                        JEP_Temp_Aim = 500;//×îÐ¡50¶È
1459   9                      }
1460   8                    }
1461   7                    else
1462   7                    {
1463   8                      if(JEP_Temp_Aim < 400)
1464   8                      {
1465   9                        JEP_Temp_Aim = 400;//×îÐ¡50¶È
1466   9                      }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 25  

1467   8                    } 
1468   7                    
1469   7                    if(Working_Normal >= (u16)1200)
1470   7        //                    if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)//¿ª»ú20·ÖÖÓÖ®ºó
1471   7                    {
1472   8                      if(JEP_Temp_Aim > 1045)
1473   8                      {
1474   9                        JEP_Temp_Aim = 1045;//×î´ó102¶È
1475   9                      }
1476   8                    }
1477   7                    else
1478   7                    {
1479   8                      if(JEP_Temp_Aim > 980)
1480   8                      {
1481   9                        JEP_Temp_Aim = 980;//¿ª»ú20·ÖÖÓÒÔÄÚ×î´ó98¶È
1482   9                      }
1483   8                    }
1484   7                  }
1485   6                }
1486   5                      
1487   5                      
1488   5                Controler_temp2.Ek = JEP_Temp_Aim - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1489   5                HeatPlate_Controler_Calc(); 
1490   5                Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
1491   5      
1492   5                if((CQK_Temp - Set_CQK_Temp_Comp) > 20)//³öÆø¿ÚÎÂ¶È±ÈÄ¿±êÎÂ¶È¸ß
1493   5                {
1494   6                  if(Val_Calc > (u16)20)
1495   6                  {
1496   7                    Val_Calc = 20;  
1497   7                  }
1498   6                  JEP_Temp_Aim = JEP_Temp;//¸ü¸Ä¼ÓÈÈÅÌÄ¿±êÎÂ¶È
1499   6                } 
1500   5                else if((CQK_Temp - Set_CQK_Temp_Comp) > 10)//³öÆø¿ÚÎÂ¶È±ÈÄ¿±êÎÂ¶È¸ß
1501   5                {
1502   6                  //do nothing
1503   6                }
1504   5                else
1505   5                {
1506   6                  //do nothing
1507   6                }
1508   5              }
1509   4            }          
1510   3                
1511   3                
1512   3            if(Val_Calc > (u16)195)
1513   3            {
1514   4              Val_Calc = 195; 
1515   4            }       
1516   3            if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1517   3            {
1518   4              Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
1519   4            }
1520   3                
1521   3            }
1522   2          else if(Low_Power_Mode_Flag == (u16)0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1523   2          { 
1524   3            PatientTemp_NoneHeatWire_Adj();
1525   3            //²»´ø¼ÓÈÈÏßµÄÎÂ¶Èµ÷½Ú==============================================================
1526   3          }
1527   2          else
1528   2          {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 26  

1529   3            //do nothing
1530   3          }
1531   2      
1532   2        }
1533   1      } 
1534          
1535          
1536          static void   Store_Data(void)   //´æ·ÅÊý¾ÝµØÖ·´Ó1¿ªÊ¼
1537          {
1538   1        uint16_t i;
1539   1        uint8_t N,j;
1540   1        if (Run_Count<(u16)1)
1541   1        {
1542   2      //    return;
1543   2        }
1544   1        else
1545   1        {
1546   2          i=((Run_Count-(u16)1)/(u16)8)+(u16)1;     //¼ÆËãµØÖ·
1547   2          N=(u8)(Run_Count%(u16)8);       //¼ÆËãÎ»
1548   2          if ((Run_Count!=(u16)0) && (N==(u16)0)) 
1549   2          {
1550   3            N=8;
1551   3          }
1552   2          j=(uint8_t)((uint16_t)0xFF<<N);
1553   2          SPI_Write_nBytes(i,1,&j);
1554   2      
1555   2              //delay_us(100);
1556   2        }
1557   1      }
1558          
1559          static void  Get_RunCount(void)   //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý
1560          {
1561   1        uint16_t Start1,Start2,StartAdr;
1562   1        uint8_t N,K,j;
1563   1        Start1=0x1;
1564   1        Start2=0x2000;
1565   1        for(j=0;j<(u8)14;j++) //²éÕÒ¼ÆÊýÎ»
1566   1        {
1567   2          StartAdr=(Start1+Start2)/(u16)2;
1568   2          SPI_Read_nBytes(StartAdr,1,&N);
1569   2          delay_us(100);
1570   2          if(N==(u8)0xFF)
1571   2          {
1572   3            Start2=StartAdr;
1573   3          }else
1574   2          {
1575   3            Start1=StartAdr;
1576   3            Start2=Start1+((uint16_t)2<<((u16)12-(uint16_t)j));
1577   3            SPI_Read_nBytes(StartAdr+(u16)1,1,&K);
1578   3            if(K==(u8)0xFF)
1579   3            {  break;  }
1580   3            else
1581   3            {
1582   4              StartAdr=StartAdr+(u16)1;
1583   4              N=K;
1584   4            }
1585   3          }
1586   2        }
1587   1        Run_Count=(StartAdr-(u16)1)*(u16)8;//¼ÆËãÊ±1¸ö×Ö½Ú±í8
1588   1        for(j=0;j<(u8)8;j++)
1589   1        {
1590   2          if((((u16)0x01<<j) & (u8)N)!=(u8)0)
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 27  

1591   2          {
1592   3            break;
1593   3          }     
1594   2        }
1595   1        Run_Count=Run_Count+j;      //×î¶à¿É¼ÇÊý44896Ìõ,256ÌõÎª»º³å
1596   1      
1597   1         //Run_Count = 2000;//²âÊÔÊ¹ÓÃ 2014-12-26
1598   1         //SPI_Read_nBytes(8000,1,&N);
1599   1         // DS1302_GetTime(NowTime);
1600   1         // if(NowTime[0]&0x80)         //·¢ÏÖµôµçÔòÖØÐÂ³õÊ¼»¯Ê±¼ä£¬ÊÇ·ñÒªÑ¯ÎÊ
1601   1         //    DS1302_SetTime(initTime);    //³õÊ¼»¯Ê±¼ä
1602   1      //    if(N==1)                    //Ê±¼ä±ØÐë×ÔÐÐÉè¶¨
1603   1      //   {
1604   1      //      DS1302_SetTime(NowTime);
1605   1      //      j=2;
1606   1      //      SPI_Write_nBytes(8000,1,&j);
1607   1      //      delay_ms(10);
1608   1      //   }else if(N==2)
1609   1      //   {
1610   1      
1611   1      //   }
1612   1      
1613   1         
1614   1         /* 
1615   1         DISP_TIME_10X16(POS_RT_RH_X-20,10,Run_Count/10000,BLACK18);
1616   1         DISP_TIME_10X16(POS_RT_RH_X-20,18,Run_Count%10000/1000,BLACK18);
1617   1         DISP_TIME_10X16(POS_RT_RH_X-20,26,Run_Count%1000/100,BLACK18);
1618   1         DISP_TIME_10X16(POS_RT_RH_X-20,34,Run_Count%100/10,BLACK18);
1619   1         DISP_TIME_10X16(POS_RT_RH_X-20,42,Run_Count%10,BLACK18);
1620   1         */
1621   1         //DISP_TIME_10X16(POS_RT_RH_X-20,POS_RT_RH_Y+150-90,Enable_Save_Data,BLACK18);
1622   1      }
1623          
1624          static uint8_t  Wire_Mode_Sel_Rem = 0xff;//¼ÇÒä×´Ì¬
1625          static uint8_t  Disp_ERR_VHB80_Code = 0xff;
1626          
1627          void Err_Base_HeaterWire_DISP_Enable(void)//ÆÁ±£Ê±ÖÃÏà¹Ø±êÖ¾,ÒÔ±ãÁÁÆÁÊ±ÏÔÊ¾Ö÷»úºÍÏßµÄÍ¼ÐÎ
1628          {
1629   1        Disp_ERR_VHB80_Code = 0xff;
1630   1        Wire_Mode_Sel_Rem = 0xff;//¼ÇÒä×´Ì¬
1631   1      }
1632          
1633          
1634          void AlarmErrorFunc(void)    //´íÎóÊÂ¼þ
1635          {
1636   1        uint8_t color=0;
1637   1        static uint8_t     Err_Event_Cnt=0;  //¼õÐ¡¹¤×÷´ÎÊý
1638   1        uint8_t     Err_Event_1;
1639   1        uint8_t     Err_Event_2;
1640   1          
1641   1        static uint8_t AlarmInfoRem = 0;//±¨¾¯×´Ì¬¼ÇÒä
1642   1      
1643   1        Err_Event_Cnt++;//ÉÁË¸¼ÆÊý¼°¼õÉÙ³ÌÐòÔËÐÐÊ±¼ä
1644   1        if(Err_Event_Cnt > (u8)1)
1645   1        { 
1646   2          Err_Event_Cnt = 0;//ºì  
1647   2        }
1648   1        Err_Event_1 = 0;
1649   1        Err_Event_2 = 1;      
1650   1      
1651   1        //LCD_ShowxNum(POS_RT_RH_X-40,5,16,4,RT_Temp,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾
1652   1        //LCD_ShowxNum(POS_RT_RH_X-40,60,16,4,ERR_RT_Temp_Times,0x80,BLACK18); //
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 28  

1653   1      
1654   1        if(((No_CQKSensor_Times>(u16)1000) || (CQK_Sensor_Temp_No_Change_Times > (u16)6000)) //³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷´í
             -Îó¼ì²â
1655   1          ||(CQKSensor_Hithen800_Times > (u16)250)//Á¬Ðø10S > 80¶È
1656   1          ||(No_ReadData_Temp_Times>(u8)20)//¼ÓËÙÏÔÊ¾
1657   1          )
1658   1        {
1659   2          CQK_Sensor_Err=(uint8_t)1;
1660   2          CQK_Temp = 0; 
1661   2          LoTemp_CQK_Count  = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1662   2          Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã 
1663   2          Set_bit(&ERR_Kind,Alarm_Const_CQK_Sensor);        
1664   2        }
1665   1        else
1666   1        {
1667   2          CQK_Sensor_Err=(uint8_t)0;
1668   2          Clear_bit(&ERR_Kind,Alarm_Const_CQK_Sensor);        
1669   2        }
1670   1          
1671   1        if((Nochange_Times>(u16)900) || (No_ReadData_SHIDU_Times>(u8)20) || (RT_Temp_Not_Updated_10mS > (u16)3000
             -))//ÈËÌå¶ËÊª¶È´«¸ÐÆ÷´íÎó¼ì²â
1672   1        {
1673   2          SHIDU_Sensor_Err=(uint8_t)1;
1674   2          RTD_Sensor_Err=(uint8_t)1;
1675   2          RT_SHIDU = 0; 
1676   2          HiTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²â¸ßÎÂ±¨¾¯
1677   2          LoTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1678   2          LoHumity_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÊª±¨¾¯
1679   2          Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1680   2          Set_bit(&ERR_Kind,Alarm_Const_RTD_Sensor); 
1681   2        }   
1682   1        else
1683   1        {
1684   2          SHIDU_Sensor_Err=(uint8_t)0;
1685   2          Clear_bit(&ERR_Kind,Alarm_Const_RTD_Sensor); 
1686   2        }
1687   1          
1688   1        if((Nochange_Times>(u16)900) ||  (No_ReadData_Temp_Times>(u8)20) 
1689   1        || (ERR_RT_Temp_Times>(u8)20) || (RT_Temp_Not_Updated_10mS > (u16)3000))//ÈËÌå¶ËÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â 2014-0
             -7-03
1690   1        {
1691   2          RTD_Sensor_Err=(uint8_t)1;
1692   2          if(ERR_RT_Temp_Times<(u8)10)//¸ßÎÂÒì³£±¨¾¯Ê±ÎÂ¶È²»ÇåÁã
1693   2          {
1694   3            RT_Temp = 0;    
1695   3            Diplay_RTtemp = 0;
1696   3          }
1697   2          HiTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²â¸ßÎÂ±¨¾¯
1698   2          LoTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1699   2          LoHumity_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÊª±¨¾¯
1700   2          Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1701   2        }
1702   1        else
1703   1        {
1704   2          RTD_Sensor_Err=(uint8_t)0;
1705   2        }
1706   1          
1707   1        
1708   1        if( (No_HeatSensor_Times>(u8)150) || (JRP_Sensor_Temp_No_Change_Times > (u16)600))//¼ÓÈÈÅÌ´«¸ÐÆ÷´íÎó¼ì²â  
             - 
1709   1        {     
1710   2          JRP_Sensor_Err=(uint8_t)1;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 29  

1711   2          Set_bit(&ERR_Kind,Alarm_Const_JRP_Sensor); 
1712   2        }
1713   1        else
1714   1        {
1715   2          JRP_Sensor_Err=(uint8_t)0;
1716   2          Clear_bit(&ERR_Kind,Alarm_Const_JRP_Sensor); 
1717   2        }
1718   1        if(HiTemp_Count>(u8)2)  //¸ßÎÂ´íÎó¼ì²â
1719   1        {
1720   2          Set_bit(&ERR_Kind,Alarm_Const_HiTemp);
1721   2        }
1722   1        else
1723   1        {
1724   2          Clear_bit(&ERR_Kind,Alarm_Const_HiTemp);
1725   2        }
1726   1          
1727   1        
1728   1        if(LoTemp_Count>(u8)120)  //µÍÎÂ´íÎó¼ì²â
1729   1        {
1730   2          Set_bit(&ERR_Kind,Alarm_Const_LoTemp);
1731   2        } 
1732   1        else
1733   1        {
1734   2          Clear_bit(&ERR_Kind,Alarm_Const_LoTemp);
1735   2        }
1736   1          
1737   1      
1738   1        if(LoHumity_Count>(u8)120) //µÍÊª¶È´íÎó¼ì²â
1739   1        {
1740   2          Set_bit(&ERR_Kind,Alarm_Const_LoHumity);//ÉèÖÃµÍÊª¶È±¨¾¯±êÖ¾
1741   2        }
1742   1        else
1743   1        {
1744   2          if (Bit_is_one(ERR_Kind,Alarm_Const_LoHumity)!=(uint8_t)0)
1745   2          {
1746   3            Clear_bit(&ERR_Kind,Alarm_Const_LoHumity);//Çå³ýµÍÊª¶È±¨¾¯±êÖ¾
1747   3          }
1748   2        }
1749   1      
1750   1      //É«¿é±¨¾¯  VHB15A_FUNCTION_ALARM_COLOR_DISPLAY
1751   1      /*ÈËÌåÌ½Í·³ö´í    ---ºì
1752   1       ³öÆø¿ÚÌ½Í·³ö´í   ---ÂÌ
1753   1       ¼ÓÈÈÅÌÌ½Í·³ö´í   ---À¶
1754   1       ¸ßÎÂ±¨¾¯       ---ºÚ
1755   1       µÍÎÂ±¨¾¯       ---»Ò
1756   1       µÍÊª¶È±¨¾¯     ---»Æ
1757   1       Ë®¹ÞÎ´°²×°ºÃ±¨¾¯   ---Çà
1758   1       ·¢ÈÈÏßÎ´°²×°»ò¿ªÂ· ---×Ï
1759   1       ÎÞË®/¸ÉÉÕ        ---ºÚ
1760   1      */
1761   1      
1762   1        if(Work_State != UI_STATE_SCREENSAVER_MODE)//ÆÁ±£Ê±²»ÏÔÊ¾
1763   1        {
1764   2          if((SHIDU_Sensor_Err==(uint8_t)1)||(RTD_Sensor_Err!=(uint8_t)0))  //ÈËÌå¶ËÌ½Í·
1765   2          {
1766   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+5,RED18);
1767   3          }
1768   2          if(CQK_Sensor_Err==(uint8_t)1)//³öÆø¿ÚÌ½Í·
1769   2          {
1770   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+5,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+10,GREEN18);
1771   3          }
1772   2          if(JRP_Sensor_Err==(uint8_t)1)//¼ÓÈÈÅÌÌ½Í·
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 30  

1773   2          {
1774   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+10,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+15,BLUE18);
1775   3          }
1776   2          if(HiTemp_Count>(u8)2)//¸ßÎÂ
1777   2          {
1778   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+15,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+20,BLACK18);
1779   3          }
1780   2          if(LoTemp_Count>(u8)120)//µÍÎÂ
1781   2          {
1782   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+20,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+25,GRAY18);
1783   3          }
1784   2          if(LoHumity_Count>(u8)120)//µÍÊª¶È
1785   2          {
1786   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+25,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+30,YELLOW18);
1787   3          }
1788   2          if(HeaterPlate_State==(u8)0)//Ë®¹ÞÎ´×°ºÃ»ò·¢ÈÈÅÌ¿ªÂ·
1789   2          {
1790   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+30,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+35,BRIGHT_BLU
             -E18);
1791   3          }
1792   2          if(Wire_Mode_Mismatch == (uint8_t)1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä  
1793   2          {
1794   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+35,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+40,PURPLE18);
1795   3          }
1796   2          if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®(¸ÉÉÕ)±¨¾¯
1797   2          {
1798   3            Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+40,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+45,BLACK18);
1799   3          } 
1800   2        }
1801   1      
1802   1      
1803   1        if(HeaterPlate_State==(uint8_t)0)  //Ã»ÓÐ·ÅÈë¹Þ×Ó
1804   1        {
1805   2          AlarmInfoIndex = (uint8_t)1;
1806   2        }
1807   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®´íÎó
1808   1        {
1809   2          AlarmInfoIndex = (uint8_t)2;
1810   2        }
1811   1        else if((CQK_Sensor_Err!=(uint8_t)0) || (RTD_Sensor_Err!=(uint8_t)0) || (SHIDU_Sensor_Err!=(uint8_t)0))
1812   1        {
1813   2          AlarmInfoIndex = (uint8_t)3;
1814   2        } 
1815   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_HiTemp)!=(uint8_t)0) //¸ßÎÂ´íÎó
1816   1        {
1817   2          AlarmInfoIndex = (uint8_t)4;
1818   2        }
1819   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_LoTemp)!=(uint8_t)0) //»¼Õß¶Ë³ÖÐøµÍÎÂ
1820   1        {
1821   2          AlarmInfoIndex = (uint8_t)5;
1822   2        }
1823   1        else if(LoTemp_CQK_Count>(uint8_t)120)//³öÆø¿Ú³ÖÐøµÍÎÂ
1824   1        {
1825   2          AlarmInfoIndex = (uint8_t)6;
1826   2        } 
1827   1        else if(Bit_is_one(ERR_Kind,Alarm_Const_LoHumity)!=(uint8_t)0)//³ÖÐøµÍÊª¶È´íÎó
1828   1        {
1829   2          AlarmInfoIndex = (uint8_t)7;
1830   2        }
1831   1        else if(Wire_Mode_Mismatch == (uint8_t)1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä 
1832   1        {
1833   2          AlarmInfoIndex = (uint8_t)8;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 31  

1834   2        } 
1835   1        else
1836   1        {
1837   2          AlarmInfoIndex = (uint8_t)0;
1838   2          AlarmSoundPauseStatus = (uint8_t)0;//ÎÞ±¨¾¯£¬²»¿ÉÉùÒôÔÝÍ£
1839   2        }
1840   1      
1841   1        if(AlarmInfoIndex !=  AlarmInfoRem)//±¨¾¯×´Ì¬¸Ä±ä
1842   1        {
1843   2          AlarmSoundPauseStatus = 0;//ÉùÒôÔÝÍ£È¡Ïû
1844   2          Sound_Alarm_Pause_Disable();  
1845   2        } 
1846   1              
1847   1        AlarmInfoRem = AlarmInfoIndex;
1848   1        
1849   1      
1850   1        //´«¸ÐÆ÷´íÎó==============================================================
1851   1        ERR_Kind&=(uint8_t)0xFE;  ////Çå³ýµÚÒ»Î»ÊÇ´«¸ÐÆ÷´íÎó
1852   1        if((CQK_Sensor_Err!=(uint8_t)0) || (RTD_Sensor_Err!=(uint8_t)0) || (JRP_Sensor_Err!=(uint8_t)0) || (SHIDU
             -_Sensor_Err!=(uint8_t)0))
1853   1        {
1854   2          ERR_Kind|=(uint8_t)0x01;//µÚÒ»Î»ÊÇ´«¸ÐÆ÷´íÎó
1855   2        } 
1856   1      
1857   1        if(Work_State != UI_STATE_SCREENSAVER_MODE)//·ÇÆÁ±£Ä£Ê½£¬·ñÔòÒªÏÈÍË³öÆÁ±£Ä£Ê½
1858   1        { 
1859   2          if(HeaterPlate_State==(u8)0)    //ÎÞ¼ÓÈÈÅÌ£¬ÏÔÊ¾ËùÓÐµÄÍ¼Æ¬   Plate_State==0
1860   2          {
1861   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã
1862   3      
1863   3            if(Work_State != UI_STATE_SCREENSAVER_MODE)
1864   3            {
1865   4              if(Disp_ERR_VHB80_Code!=(u8)1)
1866   4              {
1867   5                Disp_ERR_VHB80_Code=1;
1868   5                DISP_VHB80_PIC(BLUE18); 
1869   5      
1870   5                if(Wire_Mode_Sel_Rem != (uint8_t)Wire_Mode_Sel)
1871   5                {
1872   6                  if(Wire_Mode_Sel == Wire_Sel_None)
1873   6                  { 
1874   7                    if(Err_Event_Cnt == Err_Event_1) //ÎÞ¼ÓÈÈ
1875   7                    { 
1876   8                      Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,GRAY18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1877   8                      Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,GRAY18); 
1878   8                    }
1879   7                  } 
1880   6      
1881   6                  if((Wire_Mode_Sel==Wire_Sel_In_Only) || (Wire_Mode_Sel== Wire_Sel_None))
1882   6                  {
1883   7                    if(Err_Event_Cnt == Err_Event_1)
1884   7                    {
1885   8                      Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1886   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²
             -¿
1887   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú          
             -    
1888   8                    }
1889   7                  }
1890   6                }
1891   5                Wire_Mode_Sel_Rem = (uint8_t)Wire_Mode_Sel;                
1892   5              }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 32  

1893   4              if(Err_Event_Cnt == Err_Event_1)     
1894   4              {
1895   5                color=RED18;//¸ÄÑÕÉ«
1896   5              }
1897   4              else if(Err_Event_Cnt == Err_Event_2)
1898   4              {
1899   5                color=GRAY18;
1900   5              }
1901   4              else 
1902   4              {
1903   5                //do nothing
1904   5              }
1905   4      
1906   4              //         if((Err_Event_Cnt == Err_Event_1)||(Err_Event_Cnt == Err_Event_2))
1907   4              DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color); 
1908   4            }
1909   3            else
1910   3            {
1911   4              Disp_ERR_VHB80_Code = 0;        
1912   4            }     
1913   3          }
1914   2          else  if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®(¸ÉÉÕ)±¨¾¯
1915   2          // if(0)
1916   2          {
1917   3            //ÏÔÊ¾ÎÞË®´íÎó================================
1918   3            if(Disp_ERR_VHB80_Code!=(u8)2)
1919   3            {
1920   4              Disp_ERR_VHB80_Code=2; 
1921   4              DISP_VHB80_PIC(BLUE18);
1922   4            }
1923   3            if(Err_Event_Cnt == Err_Event_1)
1924   3            {
1925   4              color=RED18;          //ÎÞË®´íÎó¸ÄÎªºìÉ«
1926   4            }
1927   3            else if(Err_Event_Cnt == Err_Event_2)
1928   3            {
1929   4              color=WHITE18;
1930   4            }
1931   3            else 
1932   3            {
1933   4              //do nothing
1934   4            }
1935   3            Draw_Rectangle_Real(POS_HEAT_X,POS_HEAT_Y+2,POS_HEAT_X+8,POS_HEAT_Y+33,color);
1936   3                  
1937   3          }
1938   2          else if((CQK_Sensor_Err!=(uint8_t)0) || (RTD_Sensor_Err!=(uint8_t)0) || (SHIDU_Sensor_Err!=(uint8_t)0)  
1939   2            ||(HiTemp_Count>(u8)2) || (LoTemp_Count>(u8)120) ||(LoTemp_CQK_Count>(u8)120)) //Ì½Í·´íÎó»ò¸ßµÍÎÂ±¨¾¯
1940   2          //   || Heat_ERR
1941   2          //else if(0)
1942   2          {
1943   3            //ÏÔÊ¾Í¼ÐÎ£¬ÉÁË¸´íÎó²¿·Ö==========================================
1944   3            if(Disp_ERR_VHB80_Code!=(u8)3)
1945   3            {
1946   4              Disp_ERR_VHB80_Code=3; 
1947   4              DISP_VHB80_PIC(GRAY18);
1948   4            }     
1949   3      
1950   3            if(Err_Event_Cnt == Err_Event_1)
1951   3            {
1952   4              color=RED18;  //ºì
1953   4            }
1954   3            else if(Err_Event_Cnt == Err_Event_2)
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 33  

1955   3            {
1956   4              color=GRAY18; //»Ò
1957   4            }
1958   3            else
1959   3            {
1960   4              //do nothing
1961   4            }
1962   3      
1963   3      
1964   3            {
1965   4      
1966   4              if((CQK_Sensor_Err!=(uint8_t)0)||(LoTemp_CQK_Count>(uint8_t)120))//ÏÔÊ¾³öÆø¿Ú´íÎó///
1967   4              {
1968   5                DISP_CQK25X24(POS_CQK_X,POS_CQK_Y,color);
1969   5              }else
1970   4              {
1971   5                DISP_CQK25X24(POS_CQK_X,POS_CQK_Y,GRAY18);
1972   5              } 
1973   4              if((RTD_Sensor_Err!=(uint8_t)0)||(HiTemp_Count>(uint8_t)2) || (LoTemp_Count>(uint8_t)120))  //ÈËÌå¶ËÌ½
             -Í·´íÎó
1974   4              { 
1975   5                DISP_RTD28X24(POS_RTD_X,POS_RTD_Y,color);
1976   5              }else
1977   4              {
1978   5                DISP_RTD28X24(POS_RTD_X,POS_RTD_Y,GRAY18);
1979   5              } 
1980   4              if(JRP_Sensor_Err!=(uint8_t)0) //¼ÓÈÈÅÌÌ½Í·
1981   4              {
1982   5                //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color);  
1983   5                DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,GRAY18);
1984   5                //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,RED18); 
1985   5              }else
1986   4              {
1987   5                DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,GRAY18); 
1988   5                //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,RED18);          
1989   5              } 
1990   4            }
1991   3          }
1992   2          else if(Wire_Mode_Mismatch == (uint8_t)1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä 
1993   2            //else if(0)
1994   2          {
1995   3            Working_Normal = (uint16_t)0;//Õý³£¹¤×÷Ê±¼äÇåÁã 
1996   3      
1997   3            {
1998   4              if(Disp_ERR_VHB80_Code!=(u8)4)
1999   4              {
2000   5                Disp_ERR_VHB80_Code=4; 
2001   5                DISP_VHB80_PIC(BLUE18);
2002   5              }
2003   4      
2004   4              //»­In¼ÓÈÈÏß¶Î
2005   4              if(WireIn_State > (u8)0)//ÓÐIn»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾À¶É«
2006   4              {
2007   5                color=BLUE18;
2008   5              }
2009   4              else
2010   4              {
2011   5                color=GRAY18;//ÎÞIn»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾»ÒÉ«
2012   5              }
2013   4              if(Err_Event_Cnt <= Err_Event_1)//ÏÔÊ¾µ±Ç°×´Ì¬£¬ÓÐ»òÕßÎÞ£¬À¶É«»ò»ÒÉ«
2014   4              {//°´ÉÏÃæµÄÑÕÉ«ÏÔÊ¾
2015   5              }               
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 34  

2016   4              else if(Err_Event_Cnt <= Err_Event_2)//¸ù¾ÝÄ£Ê½È·¶¨ÏÔÊ¾ºìÉ«±¨¾¯»¹ÊÇµ±Ç°×´Ì¬ÑÕÉ«
2017   4              {
2018   5                if(((WireIn_State ==(u8) 0)&&(Wire_Mode_Sel == Wire_Sel_None))//ÎÞIn»ØÂ··¢ÈÈË¿ÇÒÊÇNoneÄ£Ê½²»ÐèÒª±¨¾¯
2019   5                  ||((WireIn_State == (u8)1)&&(Wire_Mode_Sel == Wire_Sel_Double))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇË«Ö§Ä£Ê½²»ÐèÒª±¨¾
             -¯
2020   5                  ||((WireIn_State == (u8)1)&&(Wire_Mode_Sel == Wire_Sel_In_Only)))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇµ¥Ö§Ä£Ê½²»ÐèÒª±
             -¨¾¯
2021   5                
2022   5                {
2023   6                }
2024   5                else//³ýÒÔÉÏÇé¿ö¾ùÐèÒª±¨¾¯:ÈçÎÞInÊ±µ¥/Ë«Ö§/Un,ÓÐInÊ±None/Un
2025   5                {
2026   6                  color=RED18;
2027   6                }
2028   5              }
2029   4              else 
2030   4              {
2031   5                //do nothing
2032   5              }
2033   4              
2034   4              Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,color);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2035   4              Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,color);       
2036   4          
2037   4                
2038   4               //»­Exp¼ÓÈÈÏß¶Î
2039   4              if(WireOut_State > (u8)0)//ÓÐOut»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾À¶É«
2040   4              {
2041   5                color=BLUE18;
2042   5              }
2043   4              else
2044   4              {
2045   5                color=GRAY18;//ÎÞOut»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾»ÒÉ«
2046   5              }
2047   4              if(Err_Event_Cnt <= Err_Event_1)//ÏÔÊ¾µ±Ç°×´Ì¬£¬ÓÐ»òÕßÎÞ£¬À¶É«»ò»ÒÉ«
2048   4              {//°´ÉÏÃæµÄÑÕÉ«ÏÔÊ¾
2049   5              }               
2050   4              else if(Err_Event_Cnt <= Err_Event_2)//¸ù¾ÝÄ£Ê½È·¶¨ÏÔÊ¾ºìÉ«±¨¾¯»¹ÊÇµ±Ç°×´Ì¬ÑÕÉ«
2051   4              {
2052   5                if(((WireOut_State == (u8)0)&&(Wire_Mode_Sel == Wire_Sel_None))//ÎÞOut»ØÂ··¢ÈÈË¿ÇÒÊÇNoneÄ£Ê½²»ÐèÒª±¨¾
             -¯
2053   5                  ||((WireOut_State == (u8)0)&&(Wire_Mode_Sel == Wire_Sel_In_Only))//ÎÞOut»ØÂ··¢ÈÈË¿ÇÒÊÇµ¥Ö§Ä£Ê½²»ÐèÒª
             -±¨¾¯
2054   5                  ||((WireOut_State == (u8)1)&&(Wire_Mode_Sel == Wire_Sel_Double)))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇË«Ö§Ä£Ê½²»ÐèÒª±
             -¨¾¯              
2055   5                
2056   5                {
2057   6                }
2058   5                else//³ýÒÔÉÏÇé¿ö¾ùÐèÒª±¨¾¯:ÈçÎÞOutÊ±Ë«Ö§/Un,ÓÐOutÊ±µ¥/None/Un
2059   5                {
2060   6                  color=RED18;
2061   6                }
2062   5              }
2063   4              else
2064   4              {
2065   5                //do nothing
2066   5              }
2067   4                
2068   4              Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,color);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2069   4              Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,color);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2070   4              Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,color);  //»­·â¿Ú 
2071   4            }        
2072   3          }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 35  

2073   2          else if(JRP_Sensor_Err!=(uint8_t)0)//¼ÓÈÈÅÌÌ½Í·´íÎó
2074   2          {
2075   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
2076   3            //ÏÔÊ¾Í¼ÐÎ£¬ÉÁË¸´íÎó²¿·Ö==========================================
2077   3            if(Disp_ERR_VHB80_Code!=(u8)5)
2078   3            {
2079   4              Disp_ERR_VHB80_Code=5; 
2080   4              DISP_VHB80_PIC(GRAY18);
2081   4            } 
2082   3            if(Err_Event_Cnt == Err_Event_1)
2083   3            {
2084   4                //color=RED18;  //ºì
2085   4              color=BLUE18; //»Ò
2086   4            }
2087   3            //else
2088   3            else if(Err_Event_Cnt == Err_Event_2)
2089   3            {
2090   4              color=GRAY18; //»Ò
2091   4            }
2092   3            else
2093   3            {
2094   4              //do nothing
2095   4            }
2096   3            DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color);   
2097   3         
2098   3          }
2099   2          else if((Wire_Mode_Sel==Wire_Sel_In_Only) || (Wire_Mode_Sel== Wire_Sel_None))//¾­¹ýÈ·ÈÏºóµÄµ¥Ö§¼ÓÈÈ»òÎÞ¼
             -ÓÈÈ»ØÂ·  
2100   2          { 
2101   3      
2102   3            if(Work_State != UI_STATE_SCREENSAVER_MODE)  //Ã»ÓÐÆÁÄ»±£»¤Ê±²ÅÄÜÏÔÊ¾¼ÓÈÈÄ£Ê½
2103   3            {
2104   4              if(Disp_ERR_VHB80_Code!=(u8)6)
2105   4              {
2106   5                Disp_ERR_VHB80_Code=6; 
2107   5                DISP_VHB80_PIC(BLUE18);
2108   5              }
2109   4      
2110   4              //»­¼ÓÈÈÏß 
2111   4              if(Err_Event_Cnt == Err_Event_1) //   
2112   4              { 
2113   5                if(Wire_Mode_Sel_Rem != (uint8_t)Wire_Mode_Sel)
2114   5                {        
2115   6                  if(Wire_Mode_Sel == Wire_Sel_None)//ÎÞ¼ÓÈÈË¿
2116   6                  { 
2117   7                    Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,GRAY18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2118   7                    Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,GRAY18); 
2119   7                  
2120   7                    Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2121   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2122   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú        
2123   7                  } 
2124   6                  else if(Wire_Mode_Sel==Wire_Sel_In_Only)
2125   6                  {
2126   7                    Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,BLUE18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2127   7                    Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,BLUE18); 
2128   7                    
2129   7                    Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2130   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2131   7                    Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú 
2132   7                  }
2133   6                  else
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 36  

2134   6                  {
2135   7                    //do nothing
2136   7                  }
2137   6                }
2138   5                Wire_Mode_Sel_Rem = (uint8_t)Wire_Mode_Sel;
2139   5              } 
2140   4            }     
2141   3          }
2142   2          else   //Ïû³ýËùÓÐ´íÎóÏÔÊ¾
2143   2          {
2144   3            if(Disp_ERR_VHB80_Code!=(u8)0)
2145   3            {
2146   4              Disp_ERR_VHB80_Code=0;
2147   4              DISP_VHB80_PIC(WHITE18);        
2148   4            }     
2149   3          }
2150   2        }
2151   1       //DISP_TIME_10X16(POS_RT_RH_X,POS_RT_RH_Y+145,Disp_ERR_VHB80_Code,BLACK18);
2152   1      
2153   1      }   
2154          
2155          //void Event_1s(void)       //1ÃëÖÓÊÂ¼þ ÄÚ²¿¶¨Ê±ÖÐ¶ÏÖÃ±êÖ¾
2156          void LowTempDet1SFunc(void)
2157          {
2158   1        uint16_t a=0,b=0,c=0;//³öÆø¿ÚÎÂ¶È´ïµ½Éè¶¨ÎÂ¶È-1
2159   1        static uint8_t     No_Water_Times=0;  
2160   1        static uint8_t RT_SHIDU_More_then_90_Cnt = 0;//Á¬Ðø³¬¹ý90%´ïµ½10´Î(1Ãë1´Î)  
2161   1        static uint16_t     Last1s_RThumity=0;
2162   1        static uint16_t     Last1s_RTtemp=0;
2163   1      
2164   1        if(Working_Normal < (u16)65000)
2165   1        {
2166   2          Working_Normal++;
2167   2        }
2168   1      
2169   1      
2170   1        if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == (u8)1))
2171   1        {
2172   2          LCD_ShowxNum(105,180,16,3,RT_Temp_Reach_Set_Cnt,0x80,BLACK18); //
2173   2          LCD_ShowxNum(105,215,16,3,LoTemp_Count,0x80,BLACK18); //  
2174   2        }
2175   1      
2176   1      
2177   1        if(Wire_Warm_Up_Sec < (u16)900)
2178   1        {
2179   2          Wire_Warm_Up_Sec++;
2180   2        }
2181   1      
2182   1        if(Plate_Warm_Up_Sec < (u16)900)
2183   1        {
2184   2          Plate_Warm_Up_Sec++;
2185   2        }
2186   1        Humidity_No_Change_Sec++;//Êª¶È²»¸Ä±äµÄ¼ÆÊý£¬µ±´óÓÚ600Ê±¿ÉÄÜÌ½Í·Ê§Ð§£¬Êª¶È¿ØÖÆÊ§Ð§
2187   1        
2188   1        if(HeaterPlate_State!=(uint8_t)0)  //
2189   1        { 
2190   2          if((Last1s_RThumity==CONTROL_RT_SHIDU) && (Last1s_RTtemp==(uint16_t)RT_Temp)) //ÈËÌå¶ËÎÂ¶ÈºÍÊª¶ÈÍ¬Ê±²»¸Ä
             -±ä
2191   2          {
2192   3            if(Nochange_Times<(u16)1000)
2193   3            {
2194   4              Nochange_Times++;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 37  

2195   4            }       
2196   3          }
2197   2          else
2198   2          { 
2199   3            Nochange_Times=0;
2200   3          } 
2201   2          
2202   2      
2203   2          //Last1s_RThumity=RT_SHIDU;
2204   2          Last1s_RThumity=CONTROL_RT_SHIDU;
2205   2          Last1s_RTtemp=(uint16_t)RT_Temp;
2206   2        }
2207   1        else
2208   1        {
2209   2          Nochange_Times=0;
2210   2        }
2211   1       
2212   1        //ÎÞË®±¨¾¯,Ó¦Í¨¹ý¼ÓÈÈÅÌµÄ¼ÓÈÈÉÏÉýËÙ¶ÈÅÐ¶ÏË®Á¿======================================
2213   1        //´ÓÓÐË®µ½ÎÞË®£¬ÈËÌå¶ËÎÂ¶ÈÓ¦¸Ã»á½µµÍ,½µµÍµÄ·ù¶È¹À¼ÆÔÚ3¶ÈÒÔÉÏ
2214   1        //ÓÐ¼ÓÈÈË¿µÄÎÞË®ÅÐ¶Ï£¬³öÆø¿ÚÎÂ¶È¸ßÓÚÈËÌå¶ËÎÂ¶È£¬¼ÓÈÈÅÌÎÂ¶ÈÔÚ100¶ÈÒÔÉÏ£¬ÈËÌå¶ËÊª¶ÈµÍÓÚ80%£¬»òÕßÓÐ20%×óÓÒµÄ
             -ÏÂ½µ
2215   1        //ÎÞ¼ÓÈÈË¿µÄÅÐ¶Ï£¬Èç¹ûË®·Ö²»¹»£¬¹À¼ÆÊÇÈËÌå¶ËÎÂ¶È½ÏµÍ£¬¼ÓÈÈÅÌÎÂ¶ÈÔÚ100¶ÈÒÔÉÏ
2216   1        if(HeaterPlate_State!=(uint8_t)0)
2217   1        {
2218   2          //do nothing
2219   2        }
2220   1        else
2221   1        {     
2222   2          Clear_bit(&ERR_Kind,Alarm_Const_NoWater);     
2223   2        } 
2224   1         
2225   1        if(RT_SHIDU >= (u16)900) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»ÒªÊª¶È´ïµ½90%³ÖÐø10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2226   1        {    
2227   2          RT_SHIDU_More_then_90_Cnt++;
2228   2          if(RT_SHIDU_More_then_90_Cnt >= (u8)10)//Á¬Ðø10Ãë³¬¹ý90%
2229   2          {
2230   3            RT_SHIDU_More_then_90_Cnt = 10;
2231   3          }
2232   2        }
2233   1        else
2234   1        {
2235   2          if(RT_SHIDU_More_then_90_Cnt < (u8)10)//Ð¡ÓÚ90%ÇÒÔÚ10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2236   2          {
2237   3            RT_SHIDU_More_then_90_Cnt = 0;
2238   3          }
2239   2        }    
2240   1      
2241   1        //¸ÉÉÕ±¨¾¯  <60% 
2242   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0) //|| RT_SHIDU_More_then_90_Cnt >= 10)
2243   1        if(Working_Normal >= (u16)1200)
2244   1        {
2245   2          if(RT_SHIDU<(u16)600) //Á¬Ðø2·ÖÖÓÉÙÓÚ60%±¨¾¯   ÈÏÎªÊÇ¸ÉÉÕ£¬±ØÐëÖØÆô»úÆ÷
2246   2          {           
2247   3            if(No_Water_Times<(u8)240) 
2248   3            {
2249   4              No_Water_Times++;
2250   4            }       
2251   3            if((RTD_Sensor_Err!=(uint8_t)0) || (SHIDU_Sensor_Err!=(uint8_t)0)) //´«¸ÐÆ÷´íÎó²»¿ÉÒÀÊª¶ÈÀ´¼ì²âÎÞË®±¨¾¯
2252   3            {
2253   4              No_Water_Times = 0;
2254   4            }
2255   3          }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 38  

2256   2          else
2257   2          {
2258   3            No_Water_Times=0;
2259   3          }
2260   2          if( No_Water_Times>=(u8)120)
2261   2          {
2262   3            Set_bit(&ERR_Kind,Alarm_Const_NoWater);
2263   3          } 
2264   2        }
2265   1         
2266   1        if(RT_SHIDU>(u16)650)//ÎÂ¶È´óÓÚ65%£¬È¡ÏûÎÞË®±¨¾¯
2267   1        {
2268   2         No_Water_Times=0;
2269   2         Clear_bit(&ERR_Kind,Alarm_Const_NoWater);
2270   2        }
2271   1      
2272   1        //============================================================
2273   1        //ÈËÌå¶ËÎÂ¶È´ïµ½Ê¶±ð180S 
2274   1        //if(Work_Mode==Invasive_Mode) //ÓÐ´´Ä£Ê½
2275   1        //if(1) //
2276   1        {
2277   2          if(RT_Temp >= (Set_RT_Temp - 15)) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È-1.5¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2278   2          {    
2279   3            RT_Temp_Reach_Set_Cnt++;
2280   3            if(RT_Temp_Reach_Set_Cnt >= (u8)180)//Á¬Ðø180Ãë³¬¹ýÉè¶¨-1
2281   3            {
2282   4              RT_Temp_Reach_Set_Cnt = 180;
2283   4            }
2284   3          }
2285   2          else
2286   2          {
2287   3            if(RT_Temp_Reach_Set_Cnt < (u8)180)//Ð¡ÓÚÉè¶¨ÇÒÔÚ10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2288   3            {
2289   4              RT_Temp_Reach_Set_Cnt = 0;
2290   4            }
2291   3          }
2292   2        } 
2293   1          
2294   1        if(Work_Mode==(u8)Noninvasive_Mode)//ÎÞ´´Ä£Ê½
2295   1        {
2296   2          a = Const_NoninvasPatientTemp_Max+10;//¸ßÎÂ±¨¾¯ÏÞÖµ
2297   2          if(WireIn_State!=(u8)0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2298   2          {
2299   3            b = Const_NoninvasPatientTemp_Min-10;//ÎÞ´´µÍÎÂ±¨¾¯ÏÞÖµ 29¶È
2300   3          }
2301   2          else 
2302   2          {
2303   3            b = 260;//ÎÞ»ØÂ·¼ÓÈÈË¿Ê±ÎÞ´´µÍÎÂ±¨¾¯Îª26¶È
2304   3          }
2305   2          //c = 700;//µÍÊª±¨¾¯ÏÞÖµ V2.0
2306   2          c = 300;//µÍÊª±¨¾¯ÏÞÖµ V2.02 ÎÞ´´Ä£Ê½È¡ÏûµÍÊª¶È±¨¾¯
2307   2        }
2308   1        else if(Work_Mode==(u8)Invasive_Mode) //ÓÐ´´Ä£Ê½
2309   1        {
2310   2          a = Const_InvasPatientTemp_Max+10;
2311   2          if(WireIn_State!=(u8)0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2312   2          {
2313   3            b = Const_InvasPatientTemp_Min-10;//ÓÐ´´µÍÎÂ±¨¾¯ÏÞÖµ 34¶È
2314   3          }
2315   2          else
2316   2          {
2317   3            b = 290;//ÎÞ»ØÂ·¼ÓÈÈË¿Ê±ÓÐ´´±¨¾¯Îª29¶È
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 39  

2318   3          }
2319   2      
2320   2          c = 800;//µÍÊª±¨¾¯ÏÞÖµ
2321   2        }
2322   1        else
2323   1        {
2324   2          //do nothing
2325   2        }
2326   1      
2327   1        if(Diplay_RTtemp>a)
2328   1        {
2329   2          if(HiTemp_Count<(u8)240)
2330   2          {
2331   3            HiTemp_Count++;
2332   3          }     
2333   2        }else
2334   1        {
2335   2          HiTemp_Count=0;
2336   2        } 
2337   1          
2338   1      /*    
2339   1          ÎªÓ¦¶ÔÈÈ±ÈìÊ£¬Ôö¼ÓÐÂµÄµÍÎÂ±¨¾¯Âß¼­£¬ÐèÒªÍ¬Ê±Âú×ãÒÔÏÂÌõ¼þ´¥·¢µÍÎÂ±¨¾¯
2340   1            1£¬ÓÐ´´Ä£Ê½
2341   1            2£¬µ¥Ö§»òË«Ö§¼ÓÈÈ»ØÂ·Ä£Ê½
2342   1            3£¬»¼Õß¶Ë´ïµ½Éè¶¨ÎÂ¶È-1¶È Á¬Ðø180S£¬·ÀÖ¹Îó¶¯×÷
2343   1            4£¬»¼Õß¶ËµÍÓÚÉè¶¨ÎÂ¶È-2¶ÈÇÒ»ØÂ·¼ÓÈÈ¹¦ÂÊÎªÈ«¹¦ÂÊ(190)Á¬Ðø10S*/
2344   1      
2345   1      //ÈËÌå¶ËµÍÎÂ±¨¾¯    
2346   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)// || RT_Temp_Reach_Set_Cnt >= 180)  //ÈËÌåµÍÎÂ±¨¾¯
2347   1        if(Working_Normal >= (u16)1200)//20·ÖÖÓ
2348   1        {
2349   2          if((RT_Temp_Reach_Set_Cnt >= (u8)180)//´ïµ½ÎÂ¶ÈÁ¬Ðø180S
2350   2          //&&(WireIn_State!=0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2351   2          &&(Diplay_RTtemp <= ((uint16_t)Set_RT_Temp - (u16)30)))//ÎÂ¶ÈµÍÓÚÉè¶¨ÎÂ¶È3¶È  //ÆøÔ´ÖÐ¶Ï»òÌ½Í·ÍÑÂä      
2352   2          {
2353   3            if(((WireIn_State!=(u8)0) && (Micro_Temp_In >= (u16)190)))//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2354   3             //||(WireIn_State==0))//ÎÞ·¢ÈÈË¿²»Ò»¶¨ÊÇÈ«¹¦ÂÊ¼ÓÈÈ ÎÞ·¢ÈÈË¿²»Ê¹ÓÃ 
2355   3      
2356   3            {
2357   4              if(LoTemp_Count<(u8)240)
2358   4              {
2359   5                LoTemp_Count+= (u8)12;  //µ±ÎÂ¶È´ïµ½Éè¶¨ÎÂ¶Èºó£¬Á¬Ðø10SÏÂ½µµ½Éè¶¨ÎÂ¶È-2.5¶È£¬µÍÎÂ±¨¾¯ 
2360   5              }         
2361   4            }
2362   3            else 
2363   3            {
2364   4             //if(LoTemp_Count<240) LoTemp_Count++; //µ±ÎÂ¶È´ïµ½Éè¶¨ÎÂ¶Èºó£¬Á¬Ðø10SÏÂ½µµ½Éè¶¨ÎÂ¶È-2.5¶È£¬µÍÎÂ±¨¾¯ 
2365   4            }
2366   3          }
2367   2          else if(Diplay_RTtemp<b)//55·ÖÖÓ¿ªÊ¼¼ì²âÎÂ¶È¹ýµÍ±¨¾¯
2368   2          {
2369   3            if(Working_Normal >= (u16)3300)
2370   3            {
2371   4              if(LoTemp_Count<(u8)240) 
2372   4              {
2373   5                LoTemp_Count++;
2374   5              }
2375   4            }
2376   3          }
2377   2          else
2378   2          {
2379   3            LoTemp_Count=0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 40  

2380   3          }
2381   2        }
2382   1        else
2383   1        {
2384   2          LoTemp_Count=0;
2385   2        }
2386   1      
2387   1      //ÈËÌå¶ËµÍÊª±¨¾¯      
2388   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)// || RT_SHIDU_More_then_90_Cnt >= 10)   //ÈËÌåµÍÊª±¨¾¯
2389   1        if(Working_Normal >= (u16)1200)
2390   1        {
2391   2          if(RT_SHIDU<(u16)c)   //2014-07-23    µÍÊª¶È±¨¾¯
2392   2          {
2393   3            if(LoHumity_Count<(u8)250) 
2394   3            {
2395   4              LoHumity_Count++;
2396   4            }       
2397   3          }
2398   2          else
2399   2          {
2400   3            LoHumity_Count=0;
2401   3          }
2402   2        }
2403   1        else
2404   1        {
2405   2           LoHumity_Count=0;
2406   2        }  
2407   1       
2408   1      //³öÆø¿ÚµÍÎÂ±¨¾¯
2409   1        //if(CQK_Temp >= Set_CQK_Temp - 10) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2410   1        if(CQK_Temp >= 300) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2411   1        {    
2412   2          CQK_Temp_Reach_Set_Cnt++;
2413   2          if(CQK_Temp_Reach_Set_Cnt >= (u8)10)//Á¬Ðø10Ãë´ïµ½
2414   2          {
2415   3            CQK_Temp_Reach_Set_Cnt = 10;
2416   3          }
2417   2        }
2418   1        else
2419   1        {
2420   2          if(CQK_Temp_Reach_Set_Cnt < (u8)10)//10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2421   2          {
2422   3            CQK_Temp_Reach_Set_Cnt = 0;
2423   3          }
2424   2        } 
2425   1      
2426   1        if(Working_Normal >= (u16)1200)
2427   1        {
2428   2          if((CQK_Temp < (Const_NoninvasChamberTemp_Min - 10))
2429   2           &&(Work_Mode==(u8)Invasive_Mode))//ÓÐ´´Ä£Ê½²ÅÓÐ³öÆø¿ÚµÍÎÂ±¨¾¯
2430   2          {
2431   3            if(LoTemp_CQK_Count<(u8)240)
2432   3            {
2433   4              if(CQK_Temp_Reach_Set_Cnt>= (u8)10)//Èô´ïµ½¹ýÎÂ¶ÈÔò¼Ó¿ìËÙ¶È
2434   4              {
2435   5                //LoTemp_CQK_Count += 12;
2436   5                LoTemp_CQK_Count++;
2437   5              }
2438   4              else
2439   4              {
2440   5                LoTemp_CQK_Count++;
2441   5              }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 41  

2442   4            }
2443   3          }
2444   2          else
2445   2          {
2446   3            LoTemp_CQK_Count=0;
2447   3          }     
2448   2        }
2449   1        else
2450   1        {
2451   2          LoTemp_CQK_Count=0;
2452   2        }
2453   1      }
2454          
2455          void SaveDateToFlashFunc(void)
2456          {
2457   1      
2458   1        uint16_t a,b,c;//
2459   1        UINT32 Adress;  
2460   1        INT tmp=0;
2461   1        if(Enable_Save_Data>=(uint8_t)1)
2462   1        {
2463   2          Enable_Save_Data++;
2464   2          if(Enable_Save_Data>=(uint8_t)10)
2465   2          {
2466   3            Enable_Save_Data=(uint8_t)0;
2467   3          }     
2468   2        }
2469   1        if(Enable_Save_Data==(uint8_t)2)
2470   1        {
2471   2          if(((Run_Count-(u16)1)%(u16)256)==(u16)0)//Ò»¸öÉÈÇøÎª4K£¬Ã¿´Î´æ´¢µÄÊý¾ÝÎª16×Ö½Ú£¬¼´256×éÊý¾Ý¼´Îª4K 256*1
             -6=4096;
2472   2          {
2473   3            //Çå³ýÏÂÃæ256µÄÊý¾Ý
2474   3            Adress=Run_Count-(u16)1;   //¼ÙÉèÎª257-1=256
2475   3            Adress=(Adress<<4);  //  256*16= 4096
2476   3            Adress=Adress+(UINT32)0x2000;//ÆðÊ¼µØÖ·Îª0X2000£¬¼´8192Îª±£Áô×Ö½Ú
2477   3            SPI_Erase_Sector(Adress);
2478   3          }
2479   2        }
2480   1        else  if(Enable_Save_Data==(uint8_t)3)//´æ·ÅÊý¾Ý
2481   1        {
2482   2          Adress=Run_Count-(u16)1;
2483   2          Adress=(Adress<<4);
2484   2          Adress=Adress+(UINT32)0x2000; 
2485   2           
2486   2          {
2487   3            RX8010_GetTime(SaveData);
2488   3      
2489   3            //LCD_ShowxNum(POS_RT_RH_X-40,5,16,3,SaveData[2],0x80,BLACK18); //
2490   3      
2491   3            a = (((u16)SaveData[2]&(u16)0x0F)%(u16)10) + ((((u16)SaveData[2]>>(u16)4)& (u16)0x03)*(u16)10);
2492   3            SaveData[2] = (uint8_t)a;//×ª»»Îª24Ð¡Ê±ÖÆÐ¡Ê±
2493   3      
2494   3            //LCD_ShowxNum(POS_RT_RH_X-40,45,16,3,SaveData[2],0x80,BLACK18); //
2495   3            
2496   3            if(SaveData[2] >= (u8)12)
2497   3            {
2498   4              a = (uint16_t)((u8)0x80 | (u8)0x20);//PM
2499   4              SaveData[2] -= (u8)12;
2500   4            }
2501   3            else
2502   3            {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 42  

2503   4              a = 0x80;//AM
2504   4            }
2505   3            b = (u16)SaveData[2]/(u16)10;
2506   3            c = (u16)SaveData[2]%(u16)10;
2507   3            SaveData[2] = (uint8_t)(((b << 4) + c) | a);//Ê±¼ä×ª»»ÎªDS1302¸ñÊ½
2508   3             
2509   3             //LCD_ShowxNum(POS_RT_RH_X-40,95,16,3,SaveData[2],0x80,BLACK18); //
2510   3          }
2511   2              
2512   2          SaveData[7]=ERR_Kind;
2513   2          if(RTD_Sensor_Err!=(uint8_t)0) 
2514   2          {
2515   3            SaveData[7]|=(uint8_t)0x20;
2516   3          }
2517   2          if(CQK_Sensor_Err!=(uint8_t)0)
2518   2          {
2519   3            SaveData[7]|=(uint8_t)0x40;
2520   3          }     
2521   2          if(JRP_Sensor_Err!=(uint8_t)0)
2522   2          {
2523   3            SaveData[7]|=(uint8_t)0x80;
2524   3          }   
2525   2          
2526   2          
2527   2      //    SaveData[8]=(uint8_t)RT_Temp/256;
2528   2      //    SaveData[9]=(uint8_t)(RT_Temp%256);
2529   2          tmp=RT_Temp/256;
2530   2          SaveData[8]=(uint8_t)tmp;
2531   2          tmp=RT_Temp%256;
2532   2          SaveData[9]=(uint8_t)tmp;
2533   2          
2534   2          SaveData[10]=(uint8_t)(RT_SHIDU/(u16)256);
2535   2          SaveData[11]=(u8)(RT_SHIDU%(u16)256); 
2536   2          
2537   2          
2538   2          //SaveData[10]=CONTROL_RT_SHIDU/256;  //2015-06-04 ´æ´¢ÕæÊµµÄÊª¶È
2539   2          //SaveData[11]=CONTROL_RT_SHIDU%256; 
2540   2      
2541   2          tmp=(INT)CQK_Temp/256;
2542   2          SaveData[12]=(uint8_t)tmp;  
2543   2          tmp=(INT)CQK_Temp%256;
2544   2          SaveData[13]=(uint8_t)tmp;
2545   2          tmp=JEP_Temp/256;
2546   2          SaveData[14]=(uint8_t)tmp;
2547   2          tmp=JEP_Temp%256;
2548   2          SaveData[15]=(uint8_t)tmp;
2549   2          
2550   2      //    SaveData[12]=(uint8_t)(CQK_Temp/256);     
2551   2      //    SaveData[13]=(uint8_t)(CQK_Temp%256);
2552   2      //    SaveData[14]=(uint8_t)(JEP_Temp/256);
2553   2      //    SaveData[15]=(uint8_t)(JEP_Temp%256);
2554   2          SPI_Write_nBytes(Adress,16,&SaveData[0]);
2555   2      
2556   2        }
2557   1        else if(Enable_Save_Data==(uint8_t)4)  //´æ·ÅÊý¾ÝµØÖ·
2558   1        {
2559   2          Store_Data();      
2560   2        }
2561   1        else if(Enable_Save_Data==(uint8_t)5)  //²Áµ÷Êý¾Ý
2562   1        {
2563   2          //Çå³ýËùÓÐÊý¾Ý,ÖØÐÂ¼ÆÊý
2564   2          if(Run_Count>=(u16)44896) 
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 43  

2565   2          {
2566   3            SPI_Erase_Sector(0x000);
2567   3          }
2568   2        }
2569   1        else if(Enable_Save_Data==(uint8_t)6)  //²Áµ÷Êý¾Ý
2570   1        {
2571   2          //Çå³ýËùÓÐÊý¾Ý,ÖØÐÂ¼ÆÊý
2572   2          if(Run_Count>=(u16)44896) 
2573   2          { 
2574   3            SPI_Erase_Sector(0x1000);        
2575   3            Run_Count=0;
2576   3          }  
2577   2        } 
2578   1        else if(Enable_Save_Data==(uint8_t)9)  //²ÁÊý¾Ý
2579   1        {
2580   2          //do nothing
2581   2        } 
2582   1        else
2583   1        {
2584   2          //do nothing
2585   2        }
2586   1      }
2587          
2588          
2589          void  Init_port(void) //³õÊ¼»¯¶Ë¿Ú×´Ì¬--------------------------------
2590          {
2591   1        uint16_t j=0;
2592   1      
2593   1        P1M1=0x08;  //P13Îª¸ß×èÊäÈë Wire_out_FB
2594   1        P1M0=0x0;
2595   1        P2M1=0x70;//P24-P26È«Éè¶¨³É¿ªÂ©Êä³ö
2596   1        P2M0=0xF0;
2597   1        P3M1=0x18;  //P34,P33Îª¸ß×èÊäÈë Wire_In_FB  Plant_FB 
2598   1        P3M0=0x64;  //P35,P36,P32ÎªÇ¿Êä³ö  Heat_Plant_Out  Heat_Wire_In  Heat_JRP_EN_OUT  
2599   1        P4M1=0x00;  //IO Port initialization
2600   1        P4M0=0x09;  //P40,P43ÎªÇ¿Êä³ö
2601   1        P4SW=0x70;  
2602   1      
2603   1        WDT_CONTR = 0x3F; //WDT Enable(4.55S)   
2604   1        LCD_LIGHT_CLOSE;  
2605   1      //  Rec_Count=0;
2606   1        Buzzer_Port=(bit)0;
2607   1        Heat_JRP_Port=(bit)0;
2608   1        Heat_WireIn_Port=(bit)0;
2609   1        Heat_WireOut_Port=(bit)0;
2610   1        Heat_WIRE_EN_OUT = (bit)1;
2611   1        EX1=(bit)1;
2612   1        IT1=(bit)1;  
2613   1        LCD_1DIR_L;     
2614   1        JEP_Temp=0;
2615   1        EA=(bit)1;  //
2616   1         
2617   1        EUSART_Initialize();//Uart initialization
2618   1        SPI_init();//SPI Flash initialization
2619   1        LCD_Initial();//TFT LCD initialization  
2620   1         
2621   1        //Holding down these two keys for three seconds at boot time will enter service mode. 
2622   1      //  if((KEY_LEFT_UP_IN==0)&&(KEY_LEFT_DOWN_IN==0))
2623   1        if((!KEY_LEFT_UP_IN)&&(!KEY_LEFT_DOWN_IN))
2624   1        {
2625   2          Work_State = UI_STATE_SERVICE_MODE;
2626   2        }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 44  

2627   1        else
2628   1        {
2629   2          Work_State = UI_STATE_POST_MODE;
2630   2        }
2631   1        
2632   1      //Holding down these two keys for three seconds at boot time will enter Data Reading Interface. 
2633   1        if((!KEY_LEFT_DOWN_IN) &&(!KEY_RIGHT_DOWN_IN))
2634   1        {
2635   2          Work_State = UI_STATE_DATAREADER_MODE;//Êý¾Ý´«Êä½çÃæ
2636   2      //    ET0=0;
2637   2      //    TR0=0;
2638   2          Back_Color=WHITE18; 
2639   2      
2640   2          Draw_Rectangle_Real(0,0,239,319,WHITE18);
2641   2      //Display Data Reading Interface=============== DATA OUTPUT...
2642   2          for(j=4;j<(u16)8;j++)
2643   2          {
2644   3              DISP_FNT10X24((u8)115,(u16)100+((j-(u16)4)*(u16)12),(uint8_t)j,BLUE18);
2645   3          }
2646   2          for(j=j;j<(u16)14;j++)
2647   2          {
2648   3              DISP_FNT10X24((u8)115,(u16)100+((j-(u16)3)*(u16)12),(uint8_t)j,BLUE18);
2649   3          }   
2650   2          DISP_FNT10X24((u8)115,(u16)100+((u16)11*(u16)12),(u8)14,BLUE18);
2651   2          DISP_FNT10X24((u8)115,(u16)100+((u16)12*(u16)12),(u8)14,BLUE18);
2652   2          DISP_FNT10X24((u8)115,(u16)100+((u16)13*(u16)12),(u8)14,BLUE18);  
2653   2      
2654   2      //Display soft version
2655   2          LCD_Show_Verion();  
2656   2          LCD_LIGHT_OPEN;
2657   2        }
2658   1        
2659   1        Test_Mode_Dis_Jrp_Ctl = DISPLAY_TEST_DATA_EN_DIS_DEF; //LCD Displays Working Data at Runningtime
2660   1      }
2661          
2662          void  Main_Init(void) //Ö÷³ÌÐò³õÊ¼»¯
2663          {
2664   1        Get_RunCount();  //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý  
2665   1      
2666   1        Diplay_RTtemp = (uint16_t)RT_Temp;
2667   1        
2668   1        CQK_Sensor_Err=(uint8_t)0;
2669   1        RTD_Sensor_Err=(uint8_t)0;
2670   1        JRP_Sensor_Err=(uint8_t)0;
2671   1        SHIDU_Sensor_Err=(uint8_t)0;
2672   1      
2673   1        Back_Color=BRIGHT_BLUE18 ;
2674   1      
2675   1        WireOut_State=0;
2676   1        WireIn_State=0;   
2677   1      
2678   1        Wire_Mode_Sel = Wire_Sel_Double;//Ä¬ÈÏÎªË«Ö§¼ÓÈÈ»ØÂ·
2679   1        Wire_Mode_Mismatch = (uint8_t)0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
2680   1      
2681   1        Wire_Warm_Up_Sec = 0; //µ±<=300Ê±ÏÞÖÆ×î´ó¼ÓÈÈ¹¦ÂÊ
2682   1        Plate_Warm_Up_Sec = 0;
2683   1      
2684   1        Set_CQK_Temp_Comp = 360;//³õÊ¼»¯
2685   1        Humidity_No_Change_Sec = 0;//Êª¶È²»¸Ä±äµÄ¼ÆÊý 
2686   1        
2687   1        JEP_Temp_Aim = (INT)((INT)Set_CQK_Temp + 100);     //¼ÓÈÈÅÌÄ¿±êÎÂ¶È 400 - 530
2688   1        Controler_temp3.Sum_error = 0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 45  

2689   1        Controler_temp3.Ek = 0;
2690   1        Controler_temp3.Ek1 = 0;
2691   1        Controler_temp3.Ek2 = 0;
2692   1      }
2693          
2694          
2695          
2696          //²âÊÔÄ£Ê½Ê±ÏÔÊ¾ÎÂ¶È
2697          //ºÍÕý³£¹¤×÷Ê±µÄÇø±ðÔÚÓÚÊµÊ±ÐÔ
2698          void ServiceMode_TempHumidy_Disp(void)
2699          {
2700   1        uint16_t Disp,color;
2701   1      //  bit Disp_Err;
2702   1        Back_Color=WHITE18; 
2703   1      //  Disp_Err=0;   
2704   1      
2705   1        if((CQK_Temp>=0x0FFF) || (No_CQKSensor_Times>(u16)20) ) //³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â
2706   1        {
2707   2          CQK_Sensor_Err=(uint8_t)1;
2708   2          CQK_Temp = 0;
2709   2        }
2710   1        else
2711   1        {
2712   2          CQK_Sensor_Err=(uint8_t)0;
2713   2        }
2714   1          
2715   1        if(No_ReadData_SHIDU_Times>(uint8_t)10)//ÈËÌå¶ËÊª¶È´«¸ÐÆ÷´íÎó¼ì²â
2716   1        {
2717   2          SHIDU_Sensor_Err=(uint8_t)1;
2718   2          RT_SHIDU = 0; 
2719   2        }   
2720   1        else
2721   1        {
2722   2          SHIDU_Sensor_Err=(uint8_t)0;
2723   2        }
2724   1      
2725   1        if((No_ReadData_Temp_Times>(u8)20) || (ERR_RT_Temp_Times>(u8)10))//ÈËÌå¶ËÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â 2014-07-03
2726   1        {    
2727   2          RTD_Sensor_Err=(uint8_t)1;
2728   2          RT_Temp = 0;    
2729   2          Diplay_RTtemp = 0;
2730   2        }
2731   1        else
2732   1        {
2733   2          RTD_Sensor_Err=(uint8_t)0;
2734   2        }
2735   1          
2736   1            
2737   1        if( No_HeatSensor_Times>(u8)20)//¼ÓÈÈÅÌ´«¸ÐÆ÷´íÎó¼ì²â
2738   1        {
2739   2          JRP_Sensor_Err=(uint8_t)1;
2740   2          JEP_Temp = 0;
2741   2        }
2742   1        else
2743   1        {
2744   2          JRP_Sensor_Err=(uint8_t)0;
2745   2        }
2746   1          
2747   1      
2748   1        //ÈËÌå¶ËÎÂ¶È
2749   1        {
2750   2          Disp=(uint16_t)RT_Temp;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 46  

2751   2      //    Disp_Err=RTD_Sensor_Err;      
2752   2        }
2753   1        color=BLACK18;   
2754   1      
2755   1        if(Disp>=(u16)1000)
2756   1        {
2757   2          DISP_TEMP_30X56((POS_RT_TEMP_X-8),POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
2758   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+34,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);  
             - 
2759   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+73,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
2760   2          Draw_Rectangle_Real(POS_RT_TEMP_X+1-8,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8-8,POS_RT_TEMP_Y+71,WHITE18); //È¥
             -µôÐ¡Êýµã
2761   2        }
2762   1        else
2763   1        {
2764   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
2765   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+34,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
2766   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+(34*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
2767   2          Draw_Rectangle_Real(POS_RT_TEMP_X+1-8,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8-8,POS_RT_TEMP_Y+71,(uint8_t)color
             -); //»­µã
2768   2        }     
2769   1      
2770   1        //³öÆø¿ÚÎÂ¶È
2771   1        Disp=(uint16_t)CQK_Temp; 
2772   1        if(Disp>=(u16)1000)
2773   1        {
2774   2          DISP_RH_17X40(55,POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
2775   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+20,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);   
2776   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+(20*2)+5,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
2777   2          Draw_Rectangle_Real(56,POS_RT_TEMP_Y+40,61,POS_RT_TEMP_Y+43,WHITE18); //È¥µôÐ¡Êýµã
2778   2        }
2779   1        else
2780   1        {
2781   2          DISP_RH_17X40(55,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
2782   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+20,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
2783   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+(20*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
2784   2          Draw_Rectangle_Real(56,POS_RT_TEMP_Y+40,61,POS_RT_TEMP_Y+43,(uint8_t)color); //»­µã
2785   2        }
2786   1         
2787   1        //¼ÓÈÈÅÌÎÂ¶È
2788   1        Disp=(uint16_t)JEP_Temp;
2789   1        if(Disp>=(u16)1000)
2790   1        {
2791   2          DISP_RH_17X40(5,POS_RT_TEMP_Y,(u8)((Disp/(u16)1000)%(u16)10),(uint8_t)color);  
2792   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+20,(uint8_t)((Disp%(u16)1000)/(u16)100),(uint8_t)color);   
2793   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+(20*2)+5,(u8)((Disp%(u16)100)/(u16)10),(uint8_t)color);    
2794   2          Draw_Rectangle_Real(51,POS_RT_TEMP_Y+40,56,POS_RT_TEMP_Y+43,WHITE18); //È¥µôÐ¡Êýµã
2795   2        }
2796   1        else
2797   1        {
2798   2          DISP_RH_17X40(5,POS_RT_TEMP_Y,(u8)((Disp/(u16)100)%(u16)10),(uint8_t)color);  
2799   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+20,(u8)(Disp%(u16)100/(u16)10),(uint8_t)color);   
2800   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+(20*2)+5,(u8)(Disp%(u16)10),(uint8_t)color);    
2801   2          Draw_Rectangle_Real(6,POS_RT_TEMP_Y+40,11,POS_RT_TEMP_Y+43,(uint8_t)color); //»­µã
2802   2        } 
2803   1      
2804   1        //ÏÔÊ¾Êª¶È
2805   1        { 
2806   2          DISP_RH_17X40(POS_RT_RH_X+2,POS_RT_RH_Y,(uint8_t)(RT_SHIDU%(u16)1000/(u16)100),(uint8_t)color);
2807   2          DISP_RH_17X40(POS_RT_RH_X+2,POS_RT_RH_Y+19,(u8)(RT_SHIDU%(u16)100/(u16)10),(uint8_t)color);
2808   2        }   
2809   1      }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 47  

2810          
2811          //½«Éè¶¨µÄ²ÎÊýÐ´Èëµ½STC EEPROM
2812          //×¢Òâ£º¿ª»úÊ±±ØÐë°ÑFLASHµÄÊý¾Ý¶ÁÈëµ½RAMÄÚ
2813          void Setting_write_to_flash(void)
2814          { 
2815   1        STC_IAP_Sector_Erase(DATA_FLASH_ADDRESS_Set_RT_YCTemp);           //²Á³ýÕû¸öÉÈÇø
2816   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_First, data_flash.First);//½« DEBUG_DATA Ð´Èë EEPROM
2817   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Work_Mode, data_flash.Work_Mode);//
2818   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_RT_WCTemp, data_flash.Set_RT_WCTemp);//
2819   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_RT_YCTemp, data_flash.Set_RT_YCTemp);//
2820   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_In_Exp_Ratio, data_flash.In_Exp_Ratio);//
2821   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_CQK_WCTemp, data_flash.Set_CQK_WCTemp);//
2822   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_CQK_YCTemp, data_flash.Set_CQK_YCTemp);//
2823   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Language, data_flash.Language);//
2824   1      }
2825          
2826          //½«Ä¬ÈÏµÄ²ÎÊýÐ´Èëµ½STC EEPROM
2827          static void Write_Default_Setting_to_flash(void) //°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2828          {
2829   1        data_flash.First = (u8)'Z';
2830   1        data_flash.Work_Mode = Invasive_Mode;//ÓÐ´´
2831   1        data_flash.Set_RT_WCTemp = (340/5);//
2832   1        data_flash.Set_RT_YCTemp = (390/5);//
2833   1        data_flash.In_Exp_Ratio = 4;//1:1.3
2834   1        data_flash.Set_CQK_WCTemp = (310/5);//
2835   1        data_flash.Set_CQK_YCTemp = (360/5);//
2836   1        //data_flash.Language = Lan_English;
2837   1      
2838   1        Setting_write_to_flash();//Ð´Èëµ½FLASH
2839   1      }
2840          
2841          
2842          void Mem_Flash_Recall(void) //¶ÁÈ¡ÉÏ´ÎµÄ¼ÇÒä²¢ÑéÖ¤Êý¾Ý
2843          {
2844   1        data_flash.First = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_First);    //¶ÁEEPROMµÄÖµ
2845   1        data_flash.Work_Mode = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Work_Mode);    
2846   1        data_flash.Set_RT_WCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_RT_WCTemp);    
2847   1        data_flash.Set_RT_YCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_RT_YCTemp);    
2848   1        data_flash.In_Exp_Ratio = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_In_Exp_Ratio);  
2849   1        data_flash.Set_CQK_WCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_CQK_WCTemp);    
2850   1        data_flash.Set_CQK_YCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_CQK_YCTemp); 
2851   1        data_flash.Language = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Language); 
2852   1        
2853   1        if( //Ð£ÑéÊý¾ÝÊÇ·ñÕýÈ·
2854   1            (data_flash.First != (u8)'Z')
2855   1            ||(data_flash.Work_Mode > (u8)1) 
2856   1            ||(data_flash.Set_RT_WCTemp > (u8)(Const_NoninvasPatientTemp_Max/5)) //370/5 = 74;  
2857   1            ||(data_flash.Set_RT_WCTemp < (u8)(Const_NoninvasPatientTemp_Min/5)) //300/5 = 60;  
2858   1            ||(data_flash.Set_RT_YCTemp > (u8)(Const_InvasPatientTemp_Max/5)) //400/5 = 80; 
2859   1            ||(data_flash.Set_RT_YCTemp < (u8)(Const_InvasPatientTemp_Min/5)) //350/5 = 70;
2860   1            ||(data_flash.In_Exp_Ratio > (u8)6)
2861   1            ||(data_flash.In_Exp_Ratio < (u8)1)
2862   1            ||(data_flash.Set_CQK_WCTemp > (u8)(Const_NoninvasChamberTemp_Max/5)) //360/5 = 74;  
2863   1            ||(data_flash.Set_CQK_WCTemp < (u8)(Const_NoninvasChamberTemp_Min/5)) //310/5 = 60;  
2864   1            ||(data_flash.Set_CQK_YCTemp > (u8)(Const_InvasChamberTemp_Max/5))  //400/5 = 80; 
2865   1            ||(data_flash.Set_CQK_YCTemp < (u8)(Const_InvasChamberTemp_Min/5))  //350/5 = 70;
2866   1            ||(data_flash.Language > (u8)Lan_French)//×î¶à4ÖÖÓïÑÔ
2867   1          )
2868   1        {
2869   2          data_flash.Language = Lan_English;
2870   2          Write_Default_Setting_to_flash();//°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2871   2        }
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 48  

2872   1      }
2873          
2874          
2875          
2876          void Load_Settings_Before_Choice(void)//ÔÚÑ¡Ôñ·½¿ò³öÏÖÖ®Ç°£¬Òª´¦ÀíµÄÊý¾Ý£¬ÒÔÍ¬Ê±¼æÈÝÓÐÎÞÑ¡Ôñ¼ÇÒä½çÃæ³ÌÐò
2877          {
2878   1        if(defalut_mode == (u8)Load_Fac_MODE)  //ÈôÊÇ¹¤³§Ä¬ÈÏÉè¶¨  
2879   1        {
2880   2          Write_Default_Setting_to_flash();//°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2881   2        }
2882   1      
2883   1        Work_Mode = data_flash.Work_Mode;  //¹¤×÷Ä£Ê½
2884   1        Set_RT_WCTemp = data_flash.Set_RT_WCTemp * (u16)5;//
2885   1        Set_RT_YCTemp = data_flash.Set_RT_YCTemp * (u16)5;//
2886   1        Set_CQK_WCTemp = data_flash.Set_CQK_WCTemp * (u16)5;//
2887   1        Set_CQK_YCTemp = data_flash.Set_CQK_YCTemp * (u16)5;//
2888   1        In_Exp_Ratio = data_flash.In_Exp_Ratio;  //
2889   1      
2890   1        if(Work_Mode==(u8)0)  
2891   1        {     
2892   2          Set_RT_Temp=(INT)Set_RT_WCTemp;
2893   2          Set_CQK_Temp=Set_CQK_WCTemp;
2894   2        }
2895   1        else
2896   1        {
2897   2          Set_RT_Temp=(INT)Set_RT_YCTemp; 
2898   2          Set_CQK_Temp=Set_CQK_YCTemp; 
2899   2        }
2900   1      }
2901          
2902          /*µÍ¹¦ÂÊÄ£Ê½
2903          ¹¦ÄÜ---½øÈë´ý»úÄ£Ê½Ê±£¬a,¼ÓÈÈÅÌ¼ÓÈÈÊ±³¤±»ÏÞ¶¨ÔÚ50ÇÒÎÂ¶È²»³¬¹ý50¶È
2904                                 b,»ØÂ··¢ÈÈË¿¼ÓÈÈÊ±³¤±»ÏÞ¶¨ÔÚ40
2905          Ä¿µÄ---µ±³öÏÖÈËÌå¶Ë»ò³öÆø¿ÚµÍÎÂ±¨¾¯Ê±£¬³ýÁËÆøÔ´£¬»ØÂ·±»¶ÂµÈÔ­ÒòÍâ£¬»¹ÓÐ¿ÉÄÜÊÇÌ½Í·ÍÑÂä£¬
2906                  ÈôÍêÈ«²»¼ÓÈÈ£¬ÔòÔÚÓÃ»§Î´¸ÉÔ¤Ê±ÍêÈ«²»¼ÓÈÈÖÁÀäÈ´µ½ÊÒÎÂ£¬ÓÃ»§¿ÉÄÜ»áÈÏÎª»úÆ÷ÓÐÑÏÖØ¹ÊÕÏ
2907                  Èô°´Õý³£Ä£Ê½¼ÓÈÈ£¬Ôò¿ÉÄÜ»áÓÉÓÚÌ½Í·ÍÑÂäµ¼ÖÂ´ó¹¦ÂÊ¼ÓÈÈ£¬ÒýÆð³¬ÎÂ¶ø²úÉú·çÏÕ¡£
2908          ½øÈë´ý»úÄ£Ê½Ìõ¼þ---ÈËÌå¶Ë»ò³öÆø¿Ú³öÏÖµÍÎÂ±¨¾¯£¬ÇÒÓÐ±¨¾¯ÒôÊ±
2909          ÍË³ö´ý»úÄ£Ê½Ìõ¼þ---µÍÎÂ±¨¾¯½â³ý£¬»ò°´ÏûÒô¼ü¿ÉÔÝÊ±ÍË³ö90S
2910          */
2911          void LowPowerModeFunc(void)  
2912          { 
2913   1        if(((LoTemp_Count > (uint8_t)120) || (LoTemp_CQK_Count > (uint8_t)120))||(Bit_is_one(ERR_Kind,Alarm_Const
             -_NoWater)!=(uint8_t)0)) //ÎÞË®(¸ÉÉÕ)±¨¾¯
2914   1        {
2915   2          if(   
2916   2               ((ERR_Kind & (uint8_t)0x01)!=(u8)0)//´«¸ÐÆ÷´íÎó
2917   2            || ((ERR_Kind & (uint8_t)0x02)!=(u8)0)//¸ßÎÂ
2918   2            || (Wire_Mode_Mismatch == (uint8_t)1)  //·¢ÈÈË¿Î´Ñ¡
2919   2            || (HeaterPlate_State==(uint8_t)0))//Ë®¹ÞÎ´×°ºÃ
2920   2          { 
2921   3          }
2922   2          else  
2923   2          {     
2924   3            if(AlarmSoundPauseStatus == (uint8_t)0)//Î´°´ÏÂ¾²Òô¼ü
2925   3            {
2926   4              Low_Power_Mode_Flag = (u16)1;//µÍ¹¦ÂÊÄ£Ê½±êÖ¾
2927   4              if(JEP_Temp<=450)
2928   4              {       
2929   5                Micro_Temp_Val=50;  //Í£Ö¹¼ÓÈÈ
2930   5              }
2931   4              else
2932   4              {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 49  

2933   5                Micro_Temp_Val=0;  //Í£Ö¹¼ÓÈÈ
2934   5              }
2935   4              Micro_Temp_In=40;
2936   4              Micro_Temp_Out=Micro_Temp_In;     
2937   4              Micro_Adj_Mode_Test = 4;//¼ÓÈÈÄ£Ê½²âÊÔ
2938   4            }
2939   3            else
2940   3            {
2941   4              Low_Power_Mode_Flag = (u16)0;
2942   4            }
2943   3          }
2944   2        }
2945   1        else
2946   1        {
2947   2          Low_Power_Mode_Flag = (u16)0;
2948   2        }
2949   1          
2950   1      }
2951          
2952          
2953          //ÔöÁ¿ControlerËã·¨
2954          //¦¤U = U(k)-U(k-1) = Kp*[e(k)-e(k-1)]+Ki*e(k)+Kd*[e(k)-2*e(k-1)+e(k-2)]
2955          //* ÆäÖÐ£ºKp¡¢Ki¡¢Kd·Ö±ðÎª±ÈÀý¡¢»ý·ÖºÍÎ¢·Ö·Å´óÏµÊý£¬u(k)±íÊ¾µÚk¸ö²ÉÑùÊ±¿Ì
2956          //µÄ¿ØÖÆÁ¿,e(k)±íÊ¾µÚk¸ö²ÉÑùÊ±¿ÌµÄº½ÏòÊäÈëÆ«²î.
2957          //PIE_UK = Kp*(Ek-Ek1)+Ki*EK+Kd*(Ek+Ek2-EK1)
2958          
2959          //struct Controler
2960          //    {
2961          //      int Uk; //×ÜµÄ¿ØÖÆÁ¿
2962          //      int Uk1;//ÉÏ´ÎµÄ×Ü¿ØÖÆÁ¿
2963          //      int Sum_error;//Îó²î×ÜÁ¿
2964          //      int Ek;//µ±Ç°µÄ×ÜÎó²îÁ¿
2965          //      int Ek1;//Ç°Ò»´ÎµÄÎó²îÁ¿
2966          //      int Ek2;//Ç°¶þ´ÎµÄÎó²îÁ¿       
2967          //       }Controler_temp;//
2968          
2969          //ÓÐ·¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶È¿ØÖÆControlerËã·¨---¸ù¾Ý»¼Õß¶ËÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈ»ØÂ·Çý¶¯Öµ  Ã¿1Ãë¹¤×÷Ò
             -»´Î
2970          static void Controler_Calc(void) //Éè¶¨ÎÂ¶È×î¸ß400,×îµÍ000,Êµ¼Ê0-800,  
2971          {
2972   1      
2973   1        INT Vlaue1,tmp;
2974   1        static const INT Controler_Kp = 40;//±ÈÀýÏµÊý 5¶ÈÎª1500;1¶ÈÎª300;0.1¶ÈÎª30
2975   1        static const INT Controler_Ki = 8;//»ý·ÖÏµÊý
2976   1        static const INT Controler_Kd = 20;//Î¢·ÖÏµÊý   
2977   1      
2978   1        if(Controler_temp.Ek > 100)//10¶ÈÎª¼«ÏÞ 
2979   1        {
2980   2          Controler_temp.Ek = 100;
2981   2        }
2982   1        if(Controler_temp.Ek < -100)
2983   1        {
2984   2          Controler_temp.Ek = -100;
2985   2        }
2986   1        
2987   1        Controler_temp.Sum_error += Controler_temp.Ek;//Îó²î×ÜÁ¿
2988   1        if(Controler_temp.Sum_error > 3500) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
2989   1        {
2990   2          Controler_temp.Sum_error = 3500;
2991   2        }
2992   1        if(Controler_temp.Sum_error < -3500)
2993   1        {
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 50  

2994   2          
2995   2        }
2996   1        Vlaue1 = Controler_Kp * Controler_temp.Ek;//±ÈÀý ×î´ó100*30=3000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=1250)
2997   1        
2998   1        tmp = Controler_temp.Sum_error * Controler_Ki / 50; //»ý·Ö ×î´ó3000*2/100=60,Ò»¸ö¼ÓÈÈÖÜÆÚÊÇ250´Î  250*5/1
             -5*3=250;
2999   1        Vlaue1 += tmp;
3000   1        tmp = ((Controler_temp.Ek - (2 * Controler_temp.Ek1)) + Controler_temp.Ek2) * Controler_Kd;//Î¢·Ö 
3001   1        Controler_temp.Sum_error = Controler_temp.Sum_error + tmp;//2015-06-16 °ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
3002   1        Vlaue1 += tmp;
3003   1        Controler_temp.Uk = Vlaue1;// Controler_temp.Uk1 + Vlaue1;       // ½á¹û /100×î´óÎª250´Î
3004   1        if(Controler_temp.Uk > 780) 
3005   1        {
3006   2          Controler_temp.Uk = 780;
3007   2        }
3008   1        else if(Controler_temp.Uk < 0)
3009   1        {
3010   2          Controler_temp.Uk = 0;//²»ÄÜÎª¸ºÊý
3011   2        }
3012   1        else
3013   1        {
3014   2          //do nothing
3015   2        }
3016   1      
3017   1        Controler_temp.Uk /= 4;//×î¸ß190;   
3018   1          
3019   1        Controler_temp.Ek2 = Controler_temp.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
3020   1        Controler_temp.Ek1 = Controler_temp.Ek;
3021   1      }
3022          
3023          
3024          //¼ÓÈÈÅÌÇý¶¯µÄControlerËã·¨--- ¸ù¾Ý¼ÓÈÈÅÌµÄÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈ»ØÂ·Çý¶¯Öµ  Ã¿1Ãë¹¤×÷Ò»´Î
3025          static void HeatPlate_Controler_Calc(void) //Éè¶¨ÎÂ¶È×î¸ß400,×îµÍ000,Êµ¼Ê0-800,  
3026          {
3027   1      
3028   1        INT Vlaue1,tmp;
3029   1      //  uint16_t  Val_Calc;
3030   1        static const INT Controler_Kp2 = 38;//±ÈÀýÏµÊý //±ÈÀýÏµÊý 10¶ÈÎª4000/20=200;1¶ÈÎª400/20=20;0.1¶ÈÎª2
3031   1        static const INT Controler_Ki2 = 8;//»ý·ÖÏµÊý
3032   1        static const INT Controler_Kd2 = 20;//Î¢·ÖÏµÊý  
3033   1      
3034   1        if(Controler_temp2.Ek > 100)//10¶ÈÎª¼«ÏÞ 
3035   1        {
3036   2          Controler_temp2.Ek = 100;
3037   2        }
3038   1        if(Controler_temp2.Ek < -100)
3039   1        {
3040   2          Controler_temp2.Ek = -100;
3041   2        }
3042   1        
3043   1        Controler_temp2.Sum_error += Controler_temp2.Ek;//Îó²î×ÜÁ¿
3044   1        if(Controler_temp2.Sum_error > 3500) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
3045   1        {
3046   2          Controler_temp2.Sum_error = 3500;
3047   2        }
3048   1        if(Controler_temp2.Sum_error < -3500)
3049   1        {
3050   2          Controler_temp2.Sum_error = -3500;
3051   2        }   
3052   1      
3053   1        Vlaue1 = Controler_Kp2 * Controler_temp2.Ek;//±ÈÀý ×î´ó100*30=3000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=125
             -0)
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 51  

3054   1        
3055   1        tmp = Controler_temp2.Sum_error * Controler_Ki2/50; //»ý·Ö ×î´ó3000*2/100=60,Ò»¸ö¼ÓÈÈÖÜÆÚÊÇ250´Î  250*5/1
             -5*3=250;
3056   1        Vlaue1 += tmp;
3057   1        tmp = ((Controler_temp2.Ek - (2 * Controler_temp2.Ek1)) + Controler_temp2.Ek2) * Controler_Kd2;//Î¢·Ö 
3058   1        Controler_temp2.Sum_error = Controler_temp2.Sum_error + tmp;//2015-06-16 °ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
3059   1        Vlaue1 += tmp;
3060   1        Controler_temp2.Uk = Vlaue1;//;       // ½á¹û /100×î´óÎª250´Î
3061   1        if(Controler_temp2.Uk > 780) 
3062   1        {
3063   2          Controler_temp2.Uk = 780;
3064   2        }
3065   1        else if(Controler_temp2.Uk < 0)
3066   1        {
3067   2          Controler_temp2.Uk = 0;//²»ÄÜÎª¸ºÊý
3068   2        }
3069   1        else 
3070   1        {
3071   2          //do nothing
3072   2        }
3073   1      
3074   1        Controler_temp2.Uk /= 4;//×î¸ß195;    
3075   1      
3076   1        Controler_temp2.Ek2 = Controler_temp2.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
3077   1        Controler_temp2.Ek1 = Controler_temp2.Ek;
3078   1      }
3079          
3080          
3081          //¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈµÄControlerËã·¨--- ¸ù¾Ý³öÆø¿ÚµÄÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈµÄÆ«²î, Ã¿20Ãë¹¤×÷Ò
             -»´Î
3082          static void HeatPlateTemp_Aim_Controler_Calc(void) // 
3083          {
3084   1        INT Vlaue1,tmp;
3085   1      //  uint16_t  Val_Calc;
3086   1        static const INT Controler_Kp3 = 40;//±ÈÀýÏµÊý 10¶ÈÎª4000/100=40;1¶ÈÎª400/100=4;0.1¶ÈÎª0.4
3087   1        static const INT Controler_Ki3 = 1;//»ý·ÖÏµÊý
3088   1        static const INT Controler_Kd3 = 80;//Î¢·ÖÏµÊý  
3089   1      
3090   1        if(Controler_temp3.Ek > 100)//10¶ÈÎª¼«ÏÞ 
3091   1        {
3092   2          Controler_temp3.Ek = 100;
3093   2        }
3094   1        if(Controler_temp3.Ek < -100)
3095   1        {
3096   2          Controler_temp3.Ek = -100;
3097   2        }
3098   1        
3099   1        Controler_temp3.Sum_error += Controler_temp3.Ek;//Îó²î×ÜÁ¿
3100   1        if(Controler_temp3.Sum_error > 1000) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
3101   1        {
3102   2          Controler_temp3.Sum_error = 1000;
3103   2        }
3104   1        if(Controler_temp3.Sum_error < -1000)
3105   1        {
3106   2          Controler_temp3.Sum_error = -1000;
3107   2        }   
3108   1      
3109   1        Vlaue1 = Controler_Kp3 * Controler_temp3.Ek;//±ÈÀý ×î´ó100*40=4000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=125
             -0)
3110   1      
3111   1        
3112   1        tmp = Controler_temp3.Sum_error * Controler_Ki3; //»ý·Ö ×î´ó3500*8/100=280
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 52  

3113   1        Vlaue1 += tmp;
3114   1        //tmp = (Controler_temp3.Ek - (2 * Controler_temp3.Ek1) + Controler_temp3.Ek2) * Controler_Kd3;//Î¢·Ö 
3115   1        tmp = (((2 * Controler_temp3.Ek) - Controler_temp3.Ek1) - Controler_temp3.Ek2) * Controler_Kd3;//Î¢·Ö 
3116   1        Controler_temp3.Sum_error = Controler_temp3.Sum_error + tmp;//°ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
3117   1        Vlaue1 += tmp;
3118   1        Controler_temp3.Uk = Vlaue1;// Controler_temp.Uk1 + Vlaue1;       // ½á¹û /100×î´óÎª250´Î
3119   1        if(Controler_temp3.Uk > 5000) 
3120   1        {
3121   2          Controler_temp3.Uk = 5000;
3122   2        }
3123   1        else if(Controler_temp3.Uk < -5000)
3124   1        {
3125   2          Controler_temp3.Uk = -5000;//¸ºÊý
3126   2        }
3127   1        else 
3128   1        {
3129   2          //do nothing
3130   2        }
3131   1      
3132   1        Controler_temp3.Uk /= 100;//×î¸ß50;     
3133   1      
3134   1        Controler_temp3.Ek2 = Controler_temp3.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
3135   1        Controler_temp3.Ek1 = Controler_temp3.Ek;
3136   1      }
3137          
3138          
3139          //ÎÞ»ØÂ··¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶Èµ÷½Ú
3140          //static uint16_t NoneWire_Warm_Up_Sec=0;
3141          static void PatientTemp_NoneHeatWire_Adj(void)
3142          {
3143   1        static uint16_t NoneWire_Warm_Up_Sec=0;
3144   1        static INT err_sum=0;
3145   1        static INT RT_Temp_Mem = 0;
3146   1        //  static uint16_t WarmUpstate=0;
3147   1        INT Calc_int=0;
3148   1        uint16_t Val_Calc;      
3149   1      
3150   1        {
3151   2          if(CQK_Temp < 330)//Èô³öÆø¿ÚÎÂ¶ÈµÍÓÚ33¶ÈÔòÈ«¹¦ÂÊ¼ÓÈÈ
3152   2          {
3153   3            //Micro_Temp_Val = 190;
3154   3            //ÒÔÏÂÎª·¢ÈÈÅÌÎÂ¶ÈµÄControler¿ØÖÆ
3155   3            
3156   3            Controler_temp2.Ek = 980 - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
3157   3            HeatPlate_Controler_Calc(); 
3158   3            Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
3159   3            Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
3160   3            
3161   3            Temp2_Int = JEP_Temp;
3162   3            
3163   3          }
3164   2          else
3165   2          { 
3166   3            NoneWire_Warm_Up_Sec++;
3167   3            if(NoneWire_Warm_Up_Sec > (u16)2000)
3168   3            {
3169   4              NoneWire_Warm_Up_Sec = 2000;
3170   4            }
3171   3            if(NoneWire_Warm_Up_Sec < (u16)3)//00)//10·ÖÖÓÄÚÉè¶¨
3172   3            {
3173   4              //Temp2_Int = 500 + Set_RT_Temp - 300;//·¢ÈÈÅÌÎÂ¶ÈÉè¶¨ÔÚ50¶È-60¶È
3174   4              if(Temp2_Int < (550 + ((Set_RT_Temp - 300)*2)))//·¢ÈÈÅÌÎÂ¶ÈÉè¶¨ÔÚ50¶È-60¶È
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 53  

3175   4              {
3176   5                Temp2_Int = 550 + ((Set_RT_Temp - 300)*2);
3177   5              } 
3178   4              RT_Temp_Mem = RT_Temp;
3179   4            }
3180   3            else
3181   3            { 
3182   4              err_sum = err_sum + Set_RT_Temp - RT_Temp;//»ý·Ö
3183   4              if(err_sum > 180)
3184   4              {
3185   5                err_sum=180;
3186   5              }
3187   4              else if(err_sum < -180)
3188   4              {
3189   5                err_sum=-180;//Ã¿Ãë10¶È(100)£¬30000/100=300,¼´Îª5·ÖÖÓÊý¾Ý
3190   5              }
3191   4              else 
3192   4              {
3193   5                //do nothing
3194   5              }
3195   4              //if((RT_Temp - Set_RT_Temp) >= 1){if(err_sum > 0)err_sum = 0;}//´ïµ½Éè¶¨ÎÂ¶È£¬Îó²î²»ÄÜÎªÕý
3196   4              //else if((Set_RT_Temp - RT_Temp) >= 1){if(err_sum < 0)err_sum = 0;}//Î´´ïµ½Éè¶¨ÎÂ¶È£¬Îó²î²»ÄÜÎª¸º
3197   4              
3198   4              if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == (u8)1))
3199   4              { //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ³öÆø¿Ú
3200   5                Back_Color=WHITE18;
3201   5                if(err_sum >=0)
3202   5                {
3203   6                  LCD_ShowxNum(220,10,16,1,1,0x80,BLACK18); //1-±íÊ¾ÎªÕýÊý
3204   6                }
3205   5                else
3206   5                {
3207   6                  LCD_ShowxNum(220,10,16,1,0,0x80,BLACK18); //0-±íÊ¾Îª¸ºÊý
3208   6                }           
3209   5                LCD_ShowxNum(220,20,16,5,(u32)(abs(err_sum)),0x80,BLACK18); //·¢ÈÈÅÌ¼ÓÈÈµÄÄ£Ê½ÏÔÊ¾
3210   5              }           
3211   4      
3212   4              NoneWire_Heat_Sec++;
3213   4              if(NoneWire_Heat_Sec >= (u16)180)//3·ÖÖÓµ÷ÕûÒ»´ÎÎÂ¶È
3214   4              {
3215   5                NoneWire_Heat_Sec = 0;//-Temp2_Int
3216   5                
3217   5                Calc_int = err_sum;
3218   5                //if(Calc_int > 6000)Calc_int=6000;
3219   5                //else if(Calc_int< -6000)Calc_int=-6000;//Ã¿Ãë5¶È(50)£¬2·ÖÖÓÊý¾ÝÎª6000
3220   5                
3221   5                Temp2_Int = Temp2_Int + ((Set_RT_Temp - RT_Temp)/6) + ((RT_Temp_Mem-RT_Temp)/2) + (Calc_int/40);//(40
             -0-300)/10
3222   5                //if(Temp2_Int > 1050)Temp2_Int = 1050;
3223   5                if(Temp2_Int > 980)
3224   5                {
3225   6                  Temp2_Int = 980;
3226   6                }
3227   5      
3228   5                RT_Temp_Mem = RT_Temp;
3229   5              }
3230   4            }           
3231   3      
3232   3            //ÒÔÏÂÎª·¢ÈÈÅÌÎÂ¶ÈµÄControler¿ØÖÆ
3233   3            Controler_temp2.Ek = Temp2_Int - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
3234   3            HeatPlate_Controler_Calc(); 
3235   3            Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 54  

3236   3            if(RT_Temp > (Set_RT_Temp + 10))
3237   3            {
3238   4              Micro_Temp_Val = 0;//³¬¹ý1¶È 
3239   4              
3240   4            }
3241   3            else  
3242   3            {
3243   4              Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
3244   4            }
3245   3          }       
3246   2        }
3247   1      }
3248          
3249          //Õý³£ÔËÐÐ½çÃæ,°´ÏÂÈ·ÈÏ¼üÈ·¶¨»ØÂ·µÄÄ£Ê½
3250          void WireInOut_State_Confirm(void)
3251          {
3252   1        if((WireIn_State > (u8)0) && (WireOut_State > (u8)0)) //Ë«¹Ü¼ÓÈÈÄ£Ê½
3253   1        {
3254   2          Wire_Mode_Sel = Wire_Sel_Double;  
3255   2        } 
3256   1        else if((WireIn_State > (u8)0) && (WireOut_State == (u8)0)) //µ¥¹Ü¼ÓÈÈÄ£Ê½
3257   1        {
3258   2          Wire_Mode_Sel = Wire_Sel_In_Only; 
3259   2        }
3260   1        else if((WireIn_State == (u8)0) && (WireOut_State == (u8)0)) //ÎÞ¼ÓÈÈË¿Ä£Ê½
3261   1        {
3262   2          Wire_Mode_Sel = Wire_Sel_None;  
3263   2        } 
3264   1        else 
3265   1        {
3266   2          //do nothing
3267   2        }
3268   1      }
3269          
3270          void HeaterPlateWireDriveFbTask(void)//16
3271          {
3272   1        static uint8_t Micro_Temp_CLK = 0;
3273   1        static uint8_t    Check_WireInTimes = 0;
3274   1        static uint8_t    Check_WireOutTimes =0 ;
3275   1        static uint8_t WireIn_FB_Count = 0;     //¼ì²â¼ÓÈÈÏßIn·´À¡ÐÅºÅ
3276   1        static uint8_t WireOut_FB_Count = 0;     //¼ì²â¼ÓÈÈÏßOut·´À¡ÐÅºÅ
3277   1        static uint8_t NoHpCheck_Times = 0;//ÎÞ¼ÓÈÈÅÌµÄ´ÎÊý.
3278   1        
3279   1        Micro_Temp_CLK++;
3280   1        if(Micro_Temp_CLK > (u8)200)//Ê±»ù
3281   1        {   
3282   2          Micro_Temp_CLK = 0;
3283   2      
3284   2          //Ã¿¸öÖÜÆÚ¼ì²â¼ÓÈÈÅÌÊÇ·ñ´æÔÚ
3285   2           HP_CNT_Int_End_Rem = HP_CNT_Int;
3286   2          if(HP_CNT_Int < (u16)1)//Î´¼ì²âµ½
3287   2          {
3288   3            NoHpCheck_Times++;
3289   3            if(NoHpCheck_Times >=(u8)2)
3290   3            {
3291   4              NoHpCheck_Times = 2;
3292   4              HeaterPlate_State=0; //Î´¼ì²âµ½¼ÓÈÈÅÌ
3293   4            }
3294   3          }
3295   2          else
3296   2          {
3297   3            NoHpCheck_Times = 0;
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 55  

3298   3            HeaterPlate_State=1; //¼ì²â¼ÓÈÈÅÌ´æÔÚ         
3299   3          }
3300   2          HP_CNT_Int = 0;//ÇåÁã
3301   2        }
3302   1         
3303   1      //¼ÓÈÈÅÌÇý¶¯  
3304   1        if (Micro_Temp_Val>Micro_Temp_CLK)
3305   1        {
3306   2          Heat_JRP_Port=(bit)1;
3307   2        }  
3308   1        else
3309   1        {
3310   2          Heat_JRP_Port=(bit)0;
3311   2        }
3312   1        
3313   1      //INSP½øÖ§Æø¼ÓÈÈÇý¶¯ºÍ¼ì²â
3314   1        if (Micro_Temp_In>(u16)Micro_Temp_CLK)
3315   1        {
3316   2          Heat_WireIn_Port=(bit)1;
3317   2          Heat_WIRE_EN_OUT=(bit)0;//·ÀÖ¹µ¥Ò»¹ÊÕÏ  
3318   2        }
3319   1        else  //²»¼ÓÈÈÊ±µÄ¼ì²â
3320   1        {     
3321   2          if(Heat_WireIn_Port)
3322   2          {
3323   3            Heat_WireIn_Port=(bit)0;
3324   3            Heat_WIRE_EN_OUT=(bit)1;//·ÀÖ¹µ¥Ò»¹ÊÕÏ      
3325   3            Check_WireInTimes=0;
3326   3            WireIn_FB_Count=0;
3327   3          }
3328   2          else
3329   2          {
3330   3            Check_WireInTimes++;
3331   3            if(!WireIn_Exist_Port)
3332   3            {
3333   4              WireIn_FB_Count++;
3334   4            }       
3335   3            if(Check_WireInTimes>(u8)4)
3336   3            {
3337   4              if(WireIn_FB_Count<(u8)3)   //Á¬Ðø¼ì²âµ½Îå´Î²»¼ÓÈÈ±¨´í
3338   4              {
3339   5                WireIn_State=0; //Î´¼ì²âµ½·¢ÈÈË¿             
3340   5              }
3341   4              else
3342   4              {            
3343   5                WireIn_State=1; //Ã»¼ÓÈÈ£¬´ú±í¼ì²âµ½·¢ÈÈË¿
3344   5              }
3345   4              Check_WireInTimes=0;
3346   4              WireIn_FB_Count=0;
3347   4            }
3348   3          }
3349   2        }     
3350   1        
3351   1      //EXP³öÖ§Æø¼ÓÈÈÇý¶¯ºÍ¼ì²â
3352   1        if (Micro_Temp_Out>Micro_Temp_CLK)
3353   1        {
3354   2          Heat_WireOut_Port=(bit)1;
3355   2          Heat_WIRE_EN_OUT = (bit)0;//·ÀÖ¹µ¥Ò»¹ÊÕÏ    
3356   2        }
3357   1        else
3358   1        {
3359   2          if(Heat_WireOut_Port)
C51 COMPILER V9.59.0.0   ACTIVITYFUNCTIONS                                                 04/19/2019 09:13:59 PAGE 56  

3360   2          {
3361   3            Heat_WireOut_Port=(bit)0;
3362   3            Heat_WIRE_EN_OUT =(bit)1;//·ÀÖ¹µ¥Ò»¹ÊÕÏ   
3363   3            Check_WireOutTimes=0;
3364   3            WireOut_FB_Count=0;
3365   3          }
3366   2          else
3367   2          {
3368   3            Check_WireOutTimes++;
3369   3            if(!WireOut_Exist_Port)
3370   3            {
3371   4              WireOut_FB_Count++;
3372   4            }       
3373   3            if(Check_WireOutTimes>(u8)4  )
3374   3            {
3375   4              if(WireOut_FB_Count<(u8)3)   //Á¬Ðø¼ì²âµ½Îå´Î²»¼ÓÈÈ±¨´í
3376   4              {
3377   5                WireOut_State=0; //Ã»¼ÓÈÈ£¬´ú±í¼ì²âµ½·¢ÈÈË¿
3378   5              }
3379   4              else
3380   4              {
3381   5                WireOut_State=1;
3382   5              }
3383   4              Check_WireOutTimes=0;
3384   4              WireOut_FB_Count=0;
3385   4            }
3386   3          }
3387   2        }  
3388   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  16779    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    271      80
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
