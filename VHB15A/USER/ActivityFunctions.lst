C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE ACTIVITYFUNCTIONS
OBJECT MODULE PLACED IN ..\OBJ\ActivityFunctions.obj
COMPILER INVOKED BY: D:\Keil4\C51\BIN\C51.EXE ..\CODE\ActivityFunctions.c LARGE OBJECTADVANCED OPTIMIZE(9,SIZE) BROWSE O
                    -RDER NOAREGS INCDIR(..\HARDWARE\ds1302;..\HARDWARE\ds18b20;..\HARDWARE\lcd;..\HARDWARE\RX8010;..\HARDWARE\sht21;..\HARDW
                    -ARE\sht31;..\HARDWARE\w25x;..\SYSTEM\delay;..\SYSTEM\stc_eeprom;..\SYSTEM;..\CODE) DEBUG PRINT(.\ActivityFunctions.lst) 
                    -TABS(2) OBJECT(..\OBJ\ActivityFunctions.obj)

line level    source

   1          /* VHB15AÊª»¯Æ÷*/ 
   2          
   3          #include "all.h"
   4          
   5          //2019.03.29
   6          sfr P4M0 = 0xB4; 
   7          sfr P4M1 = 0xB3;
   8          sfr P4SW = 0xBB;
   9          sfr WDT_CONTR = 0xC1;
  10          sbit EA  = (uint8_t)0xA8^(uint8_t)7;
  11          sbit EX1 = (uint8_t)0xA8^(uint8_t)2;
  12          sbit ET0 = (uint8_t)0xA8^(uint8_t)1;
  13          sfr P1M0 = 0x92; 
  14          sfr P1M1 = 0x91;
  15          sbit P10 = (uint8_t)0x90^(uint8_t)0;
  16          sbit P12 = (uint8_t)0x90^(uint8_t)2;
  17          sbit P13 = (uint8_t)0x90^(uint8_t)3;
  18          sbit P17 = (uint8_t)0x90^(uint8_t)7;
  19          sbit P20 = (uint8_t)0xA0^(uint8_t)0;
  20          sbit P21 = (uint8_t)0xA0^(uint8_t)1;
  21          sbit P22 = (uint8_t)0xA0^(uint8_t)2;
  22          sbit P27 = (uint8_t)0xA0^(uint8_t)7;
  23          sfr P2M0 = 0x96;
  24          sfr P2M1 = 0x95;
  25          sbit P32 = (uint8_t)0xB0^(uint8_t)2;
  26          sbit P34 = (uint8_t)0xB0^(uint8_t)4;
  27          sbit P35 = (uint8_t)0xB0^(uint8_t)5;
  28          sbit P36 = (uint8_t)0xB0^(uint8_t)6;
  29          sbit P37 = (uint8_t)0xB0^(uint8_t)7;
  30          sfr P3M0 = 0xB2;
  31          sfr P3M1 = 0xB1; 
  32          sbit P40 = (uint8_t)0xC0^(uint8_t)0;
  33          sbit P43 = (uint8_t)0xC0^(uint8_t)3;
  34          sbit TI  = (uint8_t)0x98^(uint8_t)1;
  35          sbit RI  = (uint8_t)0x98^(uint8_t)0;
  36          sbit TR0 = (uint8_t)0x88^(uint8_t)4;
  37          sbit IT1 = (uint8_t)0x88^(uint8_t)2;
  38          
  39          static void  Interrupt_EXT1(void);
  40          static void  Interrupt_Time0(void);
  41          static void  Serial (void);   //´®¿ÚÖÐ¶Ï
  42          
  43          
  44          static enum  //heating wire mode
  45          { 
  46            Wire_Sel_Double = 0,  //double heating wire
  47            Wire_Sel_In_Only,     //INSP Only heating wire
  48            Wire_Sel_None       //Whithout heating wire
  49          }Wire_Mode_Sel; 
  50              
  51          //´íÎó¼ì²âºÍ±¨¾¯Ïà¹Ø±äÁ¿  
  52          uint8_t  ERR_Kind=0;//´íÎóµÄÖÖÀà//0´«¸ÐÆ÷/1¸ßÎÂ/2µÍÎÂ/3µÍÊª/4ÎÞË®/5»¼Õß´«¸ÐÆ÷/6³öÆø¿Ú´«¸ÐÆ÷/7¼ÓÈÈÅÌ´«¸ÐÆ÷ 
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 2   

             -  
  53          bit Wire_Mode_Mismatch ; //»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä   
  54          static bit JRP_Sensor_Err;
  55          static bit CQK_Sensor_Err;
  56          static bit RTD_Sensor_Err;
  57          static bit SHIDU_Sensor_Err;    
  58              
  59          uint8_t AlarmSoundPauseStatus = 0;//±¨¾¯ÉùÒôÔÝÍ£ 0-Õý³£±¨¾¯ 1-±¨¾¯ÉùÒôÔÝÍ£(½ö±¨¾¯Ê±ÓÐÐ§)
  60          uint8_t AlarmInfoIndex = 0;//
  61                    
  62          static uint8_t    HiTemp_Count=0;   //¸ßÎÂ¶È´ÎÊý
  63          static uint8_t    LoTemp_Count=0;     //µÍÎÂ¶È´ÎÊý
  64          static uint8_t    LoTemp_CQK_Count=0;//³öÆø¿ÚµÍÎÂ¶È´ÎÊý
  65          static uint8_t    LoHumity_Count=0;  //µÍÊª¶È´ÎÊý
  66          
  67          uint8_t No_HeatSensor_Times=0;//¼ÓÈÈÅÌÎÂ¶È´«¸ÐÆ÷ÎÞÏìÓ¦´ÎÊý
  68          static uint16_t  No_CQKSensor_Times=0;//³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷ÎÞÏìÓ¦´ÎÊý
  69          static uint16_t  CQKSensor_Hithen800_Times=0;//³¬¹ý80¶È
  70          static uint16_t  JRP_Sensor_Temp_No_Change_Times=0;// ¼ÓÈÈÅÌÎÂ¶ÈÍêÈ«²»±äµÄ´ÎÊý2014-07-03
  71          static uint16_t  CQK_Sensor_Temp_No_Change_Times=0;// ³öÆø¿ÚÎÂ¶ÈÍêÈ«²»±äµÄ´ÎÊý    
  72          static uint8_t ERR_RT_Temp_Times=0;//»¼ÕßÎÂ¶È³¬¹ý80¶È
  73          static uint8_t No_ReadData_SHIDU_Times=0;//»¼Õß¶ËÎÂ¶ÈÎÞÏìÓ¦´ÎÊý
  74          static uint16_t  RT_Temp_Not_Updated_10mS = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼ä
  75          static uint8_t No_ReadData_Temp_Times=0;//³öÆø¿ÚÎÂ¶ÈÎÞÏìÓ¦´ÎÊý
  76          static uint16_t  Nochange_Times=0;//»¼Õß¶ËÎÂÊª¶ÈÍêÈ«²»±äµÄ´ÎÊý
  77          
  78          uint8_t RT_Temp_Reach_Set_Cnt = 0;//ÈËÌåÎÂ¶È´ïµ½Éè¶¨ÎÂ¶È-1.5
  79          uint8_t CQK_Temp_Reach_Set_Cnt = 0;//³öÆø¿ÚÎÂ¶È´ïµ½30
  80          
  81          uint8_t show_str[23]; 
  82          
  83          static uint8_t   Work_Day=0;
  84          static uint8_t   Work_Hour=0;
  85          static uint8_t   Work_Min=0;
  86          static uint8_t   Work_Sec=0;
  87          
  88          //´æ´¢Ïà¹Ø
  89          struct stc_data_flash data_flash;//
  90          static uint16_t  Run_Count;
  91          uint8_t    SaveData[16];
  92                                              
  93          //´®¿ÚÏà¹Ø±äÁ¿                                    
  94          //static bit Buff_Full_flag;    
  95          static uint8_t   Rec_Count=0;
  96          //static BYTE    Rec_Buff[21];          //½ÓÊÕµ½µÄÖ¸ÁîREAD0001[CR]-READ0200[CR];
  97                                              //Ò»ÌõÖ¸Áî¿É½ÓÊÕ256ÌõÊý¾Ý                                   
  98          static uint16_t   Tick_20ms=0;
  99          uint8_t defalut_mode = Load_User_Pre_MODE;  //Ô¤ÉèÄ£Ê½Ñ¡Ôñ
 100          
 101          //ÊµÊ±²ÎÊý
 102          INT             RT_Temp=0;            //ÈËÌå¶ËÎÂ¶È
 103          INT             JEP_Temp=280;           //¼ÓÈÈÅÌÎÂ¶È
 104          LONG              CQK_Temp=280;           //³öÆø¿ÚÎÂ¶È
 105          static uint16_t     RT_SHIDU=0;             //ÈËÌå¶ËÊª¶È
 106          static uint16_t     CONTROL_RT_SHIDU=550;     //¿ØÖÆ¼ÓÈÈµÄÊª¶È
 107          uint16_t     Diplay_RTtemp = 0;
 108          
 109          //Éè¶¨²ÎÊý    
 110          uint8_t         Work_Mode = Invasive_Mode; //Ä¬ÈÏ1ÎªÓÐ´´Ä£Ê½ £¬0ÎªÎÞ´´Ä£Ê½£¬2£¬¼òÒ×Ä£Ê½(ÎÞ·¢ÈÈË¿)       
 111          INT                   Set_RT_Temp=390;         //ÈËÌå¶ËÎÂ¶ÈÉè¶¨Öµ       
 112          uint16_t          Set_RT_WCTemp=340;       //ÈËÌåÎÞ´´ÎÂ¶È
 113          uint16_t          Set_RT_YCTemp=390;       //ÈËÌåÓÐ´´ÎÂ¶È
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 3   

 114          uint16_t          Set_CQK_Temp=370;        //³öÆø¿ÚÎÂ¶È
 115          uint16_t          Set_CQK_WCTemp=310;      //ÈËÌåÎÞ´´ÎÂ¶È
 116          uint16_t          Set_CQK_YCTemp=370;      //ÈËÌåÓÐ´´ÎÂ¶È
 117          uint8_t         In_Exp_Ratio=4;  //InºÍExp¼ÓÈÈ·½Ê½µÄ±ÈÀý  //1-1:1 2-1:1.1 3-1:1.2 4-1:1.3 5-1:1.4 6-1:1.5
 118          
 119          //¼ÓÈÈÅÌÇý¶¯ºÍ¼ì²â
 120          uint16_t          HP_CNT_Int = 0;//¼ÓÈÈÅÌÖÐ¶Ï¼ì²â¼ÆÊý
 121          uint16_t          HP_CNT_Int_End_Rem = 0;//8S½áÊøÊ±¼ÓÈÈÅÌÖÐ¶Ï¼ì²â¼ÆÊý
 122          uint8_t         WireIn_State=0;      //¼ÓÈÈÏßIn×´Ì¬ 1-ÓÐ 0-ÎÞ
 123          uint8_t         WireOut_State=0;     //¼ÓÈÈÏßOut×´Ì¬    1-ÓÐ 0-ÎÞ
 124          uint8_t         HeaterPlate_State = 0; //¼ÓÈÈÅÌ×´Ì¬ 1-ÓÐ 0-ÎÞ
 125          
 126          uint8_t         Micro_Temp_Val=0;   //¼ÓÈÈÅÌ×î´óÎª201;×îÐ¡Îª0,1±íÊ¾10ms¼ÓÈÈÊ±¼ä
 127          uint16_t          Micro_Temp_In=0;    //½øÆøÖ§
 128          uint16_t          Micro_Temp_Out=0;   //³öÆøÖ§
 129          
 130          //¿ØÖÆ²ÎÊý
 131          static uint16_t   Aim_SHIDU=900;  //Ä¿±êÊª¶È 
 132          static INT    JEP_Temp_Aim=400;           //¼ÓÈÈÅÌÄ¿±êÎÂ¶È
 133          static uint16_t Wire_Warm_Up_Sec;    //µ±<=300Ê±ÏÞÖÆ·¢ÈÈË¿×î´ó¼ÓÈÈ¹¦ÂÊ
 134          static uint16_t Plate_Warm_Up_Sec;   //µ±<=600Ê±ÏÞÖÆ·¢ÈÈÅÌ×î´ó¼ÓÈÈ¹¦ÂÊ
 135          static uint16_t Humidity_No_Change_Sec;//Êª¶È²»¸Ä±äµÄ¼ÆÊý£¬µ±´óÓÚ600Ê±¿ÉÄÜÌ½Í·Ê§Ð§£¬Êª¶È¿ØÖÆÊ§Ð§
 136          static uint16_t Low_Power_Mode_Flag = 0;//µÍ¹¦ÂÊÄ£Ê½Ê¹ÄÜ±êÖ¾
 137          
 138          uint8_t     Test_Mode_Dis_Jrp_Ctl=0; //´Ó²âÊÔÄ£Ê½½øÈëÕý³£Ä£Ê½¼´ÏÔÊ¾ËùÓÐ¹¤×÷Êý¾Ý 
 139          static uint8_t     Micro_Adj_Mode_Test;  //¼ÓÈÈµÄÄ£Ê½²âÊÔ
 140          uint16_t      Working_Normal=0;//Õý³£¹¤×÷¶ÁÊý£¬Ã¿Ãë¼Ó1£¬¹ÊÕÏÖØÖÃ£¬¸Ä±äÉèÖÃÒ²ÖØÖÃ
 141          
 142          static struct 
 143          {
 144            INT Uk; //×ÜµÄ¿ØÖÆÁ¿
 145          //  int Uk1;//ÉÏ´ÎµÄ×Ü¿ØÖÆÁ¿
 146            INT Sum_error;//Îó²î×ÜÁ¿
 147            INT Ek;//µ±Ç°µÄÎó²îÁ¿
 148            INT Ek1;//Ç°Ò»´ÎµÄÎó²îÁ¿
 149            INT Ek2;//Ç°¶þ´ÎµÄÎó²îÁ¿       
 150          }Controler_temp,Controler_temp2,Controler_temp3;//¶¨ÒåÒ»¸öÎÂ¶ÈControler½á¹¹
 151          
 152          
 153           //Ãë    ·Ö    Ê±    ÈÕ    ÔÂ  ÐÇÆÚ    Äê
 154          static BYTE   NowTime[7]= {0x00, 0x00, 0xB2, 0x01, 0x01, 0x05, 0x12};
 155          
 156          //uint8_t Alarm_time_det_10mS_cnt = 0;
 157          
 158          //================================================== 
 159          
 160          static void Store_Data(void);           //´æ·ÅÊý¾Ý
 161          static void Get_RunCount(void);         //´æ·ÅÊý¾Ý
 162          //static void Init_Erase_Flash_Data(void);//³õÊ¼»¯Ê±²Á³ýÍâ²¿FLASHÊý¾Ý
 163          //static void Init_port(void); //³õÊ¼»¯¶Ë¿Ú×´Ì¬£¬ÏÔÊ¾°æ±¾ºÅ£¬¶ÁÈ¡Êý¾Ý£¬ÆÁÄ»²âÊÔ£¬W25XÇåÊý¾Ý
 164          // void Main_Init(void);  //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý,»­¹¤×÷´°¿Ú,Ê¹ÄÜä¸Á÷³äµç,RTC¼ì²â,ÆäËü±äÁ¿³õÊ¼»¯
 165          static void Write_Default_Setting_to_flash(void); //°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
 166          //static void LCD_Show_Verion(void);//ÏÔÊ¾°æ±¾ºÅ
 167          static void PatientTemp_NoneHeatWire_Adj(void);//ÎÞ»ØÂ··¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶Èµ÷½Ú
 168          static void Controler_Calc(void); //ControlerËã·¨
 169          static void HeatPlateTemp_Aim_Controler_Calc(void); //¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈControlerËã·¨---
 170          static void HeatPlate_Controler_Calc(void);//¼ÓÈÈÅÌµÄControlerËã·¨---
 171          
 172          
 173          
 174          static void  Interrupt_EXT1(void)  interrupt 2  //Íâ²¿ÖÐ¶ÏEXT1
 175          {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 4   

 176   1        HP_CNT_Int++; 
 177   1      }
 178          
 179          static void  Interrupt_Time0(void)  interrupt 1  using  2  //10msÖÐ¶ÏÒ»´Î //22.1184M
 180          {   
 181   1        Timer_T0_INT_Main();
 182   1        Tick_20ms++;
 183   1      }
 184          
 185          static void  Serial (void) interrupt 4 using 1    //´®¿ÚÖÐ¶Ï
 186          {
 187   1        if(RI)
 188   1        {
 189   2          EUSART_Receive_ISR();
 190   2      
 191   2          RI = 0;
 192   2        }
 193   1      
 194   1        if(TI)
 195   1        {     
 196   2          EUSART_Transmit_ISR();
 197   2          TI = 0;
 198   2        }
 199   1      }
 200          
 201          
 202          
 203          static enum
 204          {
 205            UART_REC_STATE_READY = 0, //×¼±¸½ÓÊÕ,³õÊ¼»¯¼ÆÊý,  1
 206            UART_REC_STATE_HEADER_DET,//¼ì²âÃüÁîÍ· "NEUNIT=1," ¹²9¸ö×Ö·û 
 207            UART_REC_STATE_DATA_TAIL_DET,//½ÓÊÕÃüÁî(×î¶à9¸ö×Ö·û)£¬¼ì²âÃüÁîÎ²"\CR"¹²3¸ö×Ö·û 
 208            UART_REC_STATE_DONE //½ÓÊÕÕýÈ·Íê³É
 209          }UART_RecState = UART_REC_STATE_READY;
 210          
 211          
 212          static uint8_t   UART_Rec_Buf[20];//½ÓÊÕ»º³åÇø 
 213           
 214          static void UART_RecBuf_Clear_Fun(void)  //Çå¿Õ»º³åÇø
 215          {
 216   1        INT i;
 217   1      
 218   1        for(i=0;i<=19;i++)
 219   1        {
 220   2          UART_Rec_Buf[i] = 0;        
 221   2        } 
 222   1      }
 223          
 224          //½ÓÊÕÊý¾Ý
 225          //static uint8_t   DataToPc[8];
 226          void UART_RecData_Func(void)
 227          {
 228   1        static uint8_t   UART_Rec_Cnt = 0;//½ÓÊÕÊý¾ÝÊýÁ¿ 
 229   1        //    static uint8_t UART_Len = 0;//½ÓÊÕµÄÊý¾Ý³¤¶È
 230   1        uint8_t   i;
 231   1        uint8_t   uart_data;    
 232   1        UINT32   Adress;
 233   1        //    uint16_t    sum;
 234   1        
 235   1        while(EUSART_DataReady!=(uint8_t)0)//»º³åÇøÓÐÊý¾Ý
 236   1        {
 237   2          uart_data = EUSART_Read(); //´Ó»º³åÇø¶ÁÒ»¸öÊý¾Ý
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 5   

 238   2          
 239   2          if(Work_State == UI_STATE_DATAREADER_MODE)
 240   2          {
 241   3            UART_Rec_Cnt++;//ÊýÁ¿Ôö¼Ó
 242   3            if(UART_RecState == UART_REC_STATE_READY)//¿ªÊ¼
 243   3            {
 244   4              UART_RecState = UART_REC_STATE_HEADER_DET;           
 245   4              UART_RecBuf_Clear_Fun();//Çå¿Õ»º³åÇø
 246   4              UART_Rec_Buf[0] = uart_data;//³õÊ¼½ÓÊÕ
 247   4              UART_Rec_Cnt = 1; //ÊýÁ¿
 248   4              //EUSART_Write('A');
 249   4            }
 250   3            else if(UART_RecState == UART_REC_STATE_HEADER_DET)//¼ì²â½ÓÊÕÍ·
 251   3            {//×¢Òâ:×îÖÕ8¸ö×Ö½Ú´æ·ÅµÄË³ÐòÊÇÏÈÊÕµ½µÄÔÚ×îµÍÎ»£¬Àý:ÊÕµ½µÄÊÇAXXLOGET£¬´æ·ÅµÄÊÇTEGOLXXA
 252   4              UART_Rec_Buf[UART_Rec_Cnt-1] = uart_data;//´ÓµÍ×Ö½ÚÍù¸ß×Ö½Ú´æ·Å
 253   4              if(UART_Rec_Cnt>=3)//½ÓÊÕµ½3¸öÊý¾Ý RD 13
 254   4              {
 255   5                if((UART_Rec_Buf[0] == 'R')//Í·±êÖ¾ÅÐ¶Ï
 256   5                  &&(UART_Rec_Buf[1] == 'D'))
 257   5                {
 258   6              //              EUSART_Write_Str("HEAR_OK",7);
 259   6                  UART_RecState = UART_REC_STATE_DATA_TAIL_DET;//±êÖ¾OK£¬½ÓÊÕÊý¾Ý
 260   6                  UART_RecBuf_Clear_Fun();//Çå¿Õ»º³åÇø  
 261   6                  UART_Rec_Cnt = 0; //ÊýÁ¿
 262   6                }
 263   5                else
 264   5                {
 265   6                  UART_Rec_Cnt--;//ÍùµÍÎ»ÒÆ
 266   6                  for(i=0;i<=18;i++) //Êý¾ÝÍùµÍÎ»ÒÆÒ»Î»
 267   6                  {
 268   7                     UART_Rec_Buf[i] = UART_Rec_Buf[i+1];        
 269   7                  }//×¢Òâ:×îÖÕ8¸ö×Ö½Ú´æ·ÅµÄË³ÐòÊÇÏÈÊÕµ½µÄÔÚ×îµÍÎ»£¬Àý:ÊÕµ½µÄÊÇAXXLOGET£¬´æ·ÅµÄÊÇTEGOLXXA              
             - 
 270   6                }
 271   5              } 
 272   4            }
 273   3            else if(UART_RecState == UART_REC_STATE_DATA_TAIL_DET)//¼ì²âÊý¾ÝºÍ½áÎ²
 274   3            {
 275   4              UART_Rec_Buf[UART_Rec_Cnt-1] = uart_data;//´ÓµÍ×Ö½ÚÍù¸ß×Ö½Ú´æ·Å
 276   4      
 277   4              if(UART_Rec_Cnt>=2)//×î¶à´æ·Å15¸öÊý¾Ý
 278   4              { 
 279   5                UART_RecState = UART_REC_STATE_DONE;//½ÓÊÕÍê³É        
 280   5              }
 281   4            }
 282   3            else
 283   3            {
 284   4              //do nothing
 285   4            }
 286   3              
 287   3            if(UART_RecState == UART_REC_STATE_DONE)//¼ì²âµ½Î²±êÖ¾
 288   3            {
 289   4              UART_RecState = UART_REC_STATE_READY; //×¼±¸ÏÂÒ»´Î¼ì²â
 290   4              
 291   4              Adress=UART_Rec_Buf[0];
 292   4              Adress=(Adress<<8)+UART_Rec_Buf[1]-1;
 293   4              Adress=(Adress<<4)+0x2000;
 294   4              SPI_Read_nBytes(Adress,16,&SaveData[0]);
 295   4              EUSART_Write_Str(&SaveData[0],16);//·¢ËÍ16¸ö×Ö½Ú¸øPC
 296   4            }           
 297   3          }
 298   2        }
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 6   

 299   1      }
 300          
 301          void HeaterWireModeDetFunc(void)
 302          {
 303   1        if(Wire_Mode_Sel == Wire_Sel_Double)//Ë«Ö§¼ÓÈÈ»ØÂ·µ«Êµ¼ÊÎ´¼ì²âµ½IN»òOUT          
 304   1        {
 305   2          if((WireIn_State == 0)||(WireOut_State == 0)) 
 306   2          {
 307   3            Wire_Mode_Mismatch = 1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 308   3          }
 309   2          else
 310   2          {
 311   3            Wire_Mode_Mismatch = 0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 312   3          }
 313   2        } 
 314   1        else if(Wire_Mode_Sel == Wire_Sel_In_Only)  //µ¥Ö§¼ÓÈÈ»ØÂ·µ«Êµ¼ÊÎ´¼ì²âµ½IN»ò¼ì²âµ½ÓÐOUT    
 315   1        {
 316   2          if((WireIn_State == 0)||(WireOut_State > 0))  
 317   2          {
 318   3            Wire_Mode_Mismatch = 1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 319   3          }
 320   2          else
 321   2          {
 322   3            Wire_Mode_Mismatch = 0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 323   3          }
 324   2        }
 325   1        else if(Wire_Mode_Sel == Wire_Sel_None) //ÎÞ¼ÓÈÈ»ØÂ·µ«Êµ¼Ê¼ì²âµ½ÓÐIN»òOUT
 326   1        {
 327   2          if((WireIn_State > 0)||(WireOut_State > 0)) 
 328   2          {
 329   3            Wire_Mode_Mismatch = 1;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 330   3          }
 331   2          else
 332   2          {
 333   3            Wire_Mode_Mismatch = 0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
 334   3          }
 335   2        }
 336   1        else
 337   1        {
 338   2          //do nothing
 339   2        }
 340   1      }
 341          
 342          void RefreshTempHumidyFunc(uint8_t Refresh_En)//Ë¢ÐÂÏÔÊ¾ÎÂ¶ÈºÍÊª¶È
 343          {
 344   1        static uint8_t     Refresh_WenDu_Cnt = 0; 
 345   1        static uint8_t     Alarm_WenDu_Cnt = 0; 
 346   1      
 347   1        uint16_t Disp=0,color=0;
 348   1        uint16_t Temp_Dis_En = 0;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 349   1        bit Disp_Err;
 350   1      
 351   1        Refresh_WenDu_Cnt++;
 352   1        if(Refresh_WenDu_Cnt > 5)//1.2S
 353   1        {
 354   2          Refresh_WenDu_Cnt = 0;  
 355   2        }
 356   1        
 357   1        Alarm_WenDu_Cnt++;
 358   1        if(Alarm_WenDu_Cnt > 1)
 359   1        {
 360   2          Alarm_WenDu_Cnt = 0;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 7   

 361   2        }
 362   1          
 363   1        
 364   1        Back_Color=WHITE18; 
 365   1        Disp_Err=0;
 366   1      
 367   1      //  Temp_Dis_En = 0;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 368   1        if(Refresh_En!=(uint8_t)0)
 369   1        {
 370   2          Temp_Dis_En = 1;//Ç¿ÖÆË¢ÐÂÒ»´Î  
 371   2        }
 372   1      
 373   1        color=BLACK18;
 374   1        if((Bit_is_one(ERR_Kind,Alarm_Const_HiTemp))   //»¼Õß¶Ë¸ßÎÂºìÉ«
 375   1          &&(Display_Temp_Kind==DISPLAY_Temperature_Patient))
 376   1        {
 377   2           Temp_Dis_En = 1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 378   2           color=RED18; 
 379   2            if(Alarm_WenDu_Cnt == 1)
 380   2            {
 381   3              color=WHITE18;
 382   3            }
 383   2        }
 384   1        else if(((Bit_is_one(ERR_Kind,Alarm_Const_LoTemp))&&((INT)Display_Temp_Kind==0))  //»¼Õß¶ËµÍÎÂºìÉ«
 385   1               ||((LoTemp_CQK_Count>120)&&((INT)Display_Temp_Kind==1)))  //³öÆø¿ÚµÍÎÂºìÉ«
 386   1        {
 387   2          Temp_Dis_En = 1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 388   2          color=RED18;
 389   2          if(Alarm_WenDu_Cnt == 1)
 390   2          {
 391   3            color=WHITE18;
 392   3          }
 393   2        }
 394   1        else
 395   1        {
 396   2          if(Refresh_WenDu_Cnt == 0)
 397   2          {
 398   3            Temp_Dis_En = 1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 399   3          }
 400   2        }
 401   1          
 402   1        if(Temp_Dis_En == 1)
 403   1        {     
 404   2          if(Display_Temp_Kind==DISPLAY_Temperature_Chamber)//³öÆø¿ÚÎÂ¶È
 405   2          {
 406   3            Disp=(uint16_t)CQK_Temp;
 407   3            Disp_Err=CQK_Sensor_Err; 
 408   3          }
 409   2          else if(Display_Temp_Kind==DISPLAY_Temperature_Patient) //ÈËÌå¶ËÎÂ¶È
 410   2          {
 411   3            Disp=Diplay_RTtemp;
 412   3            Disp_Err=RTD_Sensor_Err;
 413   3          }
 414   2          else
 415   2          {
 416   3            //do nothing
 417   3          }
 418   2          
 419   2          if(Disp_Err)
 420   2          {
 421   3             Draw_Rectangle_Real(POS_RT_TEMP_X+4,POS_RT_TEMP_Y,POS_RT_TEMP_X+56,POS_RT_TEMP_Y+103,WHITE18);     
 422   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+29,RED18);
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 8   

 423   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+63,RED18);
 424   3             Draw_Rectangle_Real(POS_RT_TEMP_X,POS_RT_TEMP_Y+73,POS_RT_TEMP_X+3,POS_RT_TEMP_Y+102,RED18);
 425   3             //Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,RED18); //»­µã
             -  
 426   3          }
 427   2          else  if(Disp>=1000)//ÏÔÊ¾ÎÂ¶È
 428   2          {
 429   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y,(Disp/1000)%10,(uint8_t)color);  
 430   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,(uint8_t)((Disp%1000)/100),(uint8_t)color);   
 431   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+73,(Disp%100)/10,(uint8_t)color);    
 432   3            Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,(uint8_t)WHITE18)
             -; //È¥µôÐ¡Êýµã
 433   3          }
 434   2          else
 435   2          {
 436   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y,(Disp/100)%10,(uint8_t)color);  
 437   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+34,Disp%100/10,(uint8_t)color);   
 438   3            DISP_TEMP_30X56(POS_RT_TEMP_X,POS_RT_TEMP_Y+(34*2)+5,Disp%10,(uint8_t)color);    
 439   3            Draw_Rectangle_Real(POS_RT_TEMP_X+1,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8,POS_RT_TEMP_Y+71,(uint8_t)color); 
             -//»­µã
 440   3          }
 441   2         }     
 442   1           
 443   1        //ÏÔÊ¾Êª¶È
 444   1        color=BLACK18;
 445   1        if((Bit_is_one(ERR_Kind,Alarm_Const_LoHumity))!=(uint8_t)0)   //µÍÊª¶È±¨¾¯
 446   1        {
 447   2          Temp_Dis_En = 1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾
 448   2          color=RED18;
 449   2          if(Alarm_WenDu_Cnt == 1)
 450   2          {
 451   3            color=WHITE18;
 452   3          }
 453   2        }
 454   1        else
 455   1        {
 456   2          if(Refresh_WenDu_Cnt == 0)
 457   2          {
 458   3            Temp_Dis_En = 1;//ÎÂ¶ÈÏÔÊ¾±êÖ¾  
 459   3          }     
 460   2        }
 461   1            
 462   1        if(Temp_Dis_En == 1)
 463   1        {
 464   2          if(RTD_Sensor_Err)
 465   2          {     
 466   3            Draw_Rectangle_Real(POS_RT_RH_X+4 , POS_RT_RH_Y,POS_RT_RH_X+39,POS_RT_RH_Y+35,(uint8_t)WHITE18);   
 467   3            Draw_Rectangle_Real(POS_RT_RH_X , POS_RT_RH_Y,POS_RT_RH_X+3,POS_RT_RH_Y+16,(uint8_t)RED18);     
 468   3            Draw_Rectangle_Real(POS_RT_RH_X , POS_RT_RH_Y+19,POS_RT_RH_X+3,POS_RT_RH_Y+35,(uint8_t)RED18);       
 469   3          }
 470   2          else
 471   2          { 
 472   3            DISP_RH_17X40(POS_RT_RH_X,POS_RT_RH_Y,(uint8_t)(RT_SHIDU%1000/100),(uint8_t)color);
 473   3            DISP_RH_17X40(POS_RT_RH_X,POS_RT_RH_Y+19,RT_SHIDU%100/10,(uint8_t)color);
 474   3          }
 475   2        } 
 476   1      }
 477          
 478          //---------Ë¢ÐÂÔËÐÐÊ±¼ä
 479          void RefreshRunTimeFunc(uint8_t Refresh_En)
 480          //Refresh_En 1-Ç¿ÖÆË¢ÐÂÒ»´Î£¬·ñÔòÃ¿·ÖÖÓË¢ÐÂÒ»´Î
 481          { 
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 9   

 482   1        uint8_t t=0;
 483   1      //  uint8_t refreshEn=Refresh_En;
 484   1        static uint8_t Last_Sec = 60;   
 485   1        
 486   1        RX8010_GetTime(NowTime);  
 487   1        t = ((uint8_t)NowTime[0]&(uint8_t)0xF)%10;
 488   1        
 489   1        if(t != Last_Sec)//Ê±¼äÃëÓÐ±ä»¯
 490   1        {
 491   2          Last_Sec = t;
 492   2          if(Work_Sec<59)
 493   2          {
 494   3            Work_Sec++;
 495   3          }
 496   2          else
 497   2          {
 498   3            Work_Sec = 0;
 499   3            t = 0xff;//Ë¢ÐÂ±êÖ¾   
 500   3            if(Work_Min<59)
 501   3            {
 502   4              Work_Min++;
 503   4            }
 504   3            else
 505   3            {
 506   4              Work_Min=0;
 507   4              if(Work_Hour<23)
 508   4              {
 509   5                Work_Hour++;
 510   5              }else
 511   4              {
 512   5                Work_Hour=0;
 513   5                if(Work_Day<99)
 514   5                {
 515   6                  Work_Day++;
 516   6                }           
 517   5              }
 518   4            }
 519   3          }
 520   2        }
 521   1        
 522   1        if((Refresh_En)||(t == 0xff))
 523   1        {
 524   2      //    Refresh_En = 0;   
 525   2          if(Work_State != UI_STATE_SCREENSAVER_MODE)
 526   2          {
 527   3            Back_Color=WHITE18;
 528   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y-5,Work_Day/10,BLACK18);
 529   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+6,Work_Day%10,BLACK18);
 530   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+22,Work_Hour/10,BLACK18);
 531   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+33,Work_Hour%10,BLACK18);
 532   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+47,Work_Min/10,BLACK18);
 533   3            DISP_TIME_10X16(POS_ICO_TIME_X-2,POS_DMH_Y+58,Work_Min%10,BLACK18);  
 534   3          }
 535   2        }
 536   1      }
 537          
 538          //---------Ë¢ÐÂRTCÊ±ÖÓ
 539          void RefreshRTCTimeFunc(void)
 540          {
 541   1        static uint8_t Last_Min=0;
 542   1      //  uint8_t color;
 543   1        uint8_t t=0;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 10  

 544   1        static uint8_t Last_Sec = 60;
 545   1      
 546   1        
 547   1      //Ê±¼ä×ª»»=================================================
 548   1        RX8010_GetTime(NowTime);  
 549   1        t = (NowTime[0]&0xF)%10;
 550   1        if(t != Last_Sec)//Ê±¼äÃëÓÐ±ä»¯
 551   1        {
 552   2          Last_Sec = t;
 553   2               
 554   2          if(Last_Min!=NowTime[1])
 555   2          {
 556   3            Last_Min=NowTime[1];
 557   3          }
 558   2      //    color=BLACK18;    
 559   2          DisPlayTime(NowTime,2); //ÏÔÊ¾Ê±¼ä
 560   2          DisPlayTime(NowTime,3); //ÏÔÊ¾Ê±¼ä
 561   2          DisPlayTime(NowTime,4); //ÏÔÊ¾Ê±¼ä
 562   2          DisPlayTime(NowTime,5); //ÏÔÊ¾Ê±¼ä
 563   2          DisPlayTime(NowTime,6); //ÏÔÊ¾Ê±¼ä
 564   2          DisPlayTime(NowTime,7); //ÏÔÊ¾Ê±¼ä
 565   2        }
 566   1      }
 567          
 568          void GetTempHumidity_PatientFunc(void)
 569          {
 570   1        static uint8_t Get_time_out = 0;//³¬Ê±£¬Êµ²â64mS£¬×î³¤¸øµ½100mS
 571   1        static BYTE       Read_Order=0; 
 572   1        uint8_t Read_SHT21_Err=0;
 573   1      
 574   1        bit Read_SCL_CONF;
 575   1        UINT32 TempLong;
 576   1        uint16_t  Temp2;
 577   1      
 578   1        static uint16_t RT_Temp_Mem_L1 = 0;
 579   1        static uint16_t RT_Temp_Mem_L2 = 0;
 580   1        static uint16_t RT_Temp_Mem_L3 = 0;
 581   1        static uint8_t ReCnt=0;
 582   1        
 583   1        ReCnt++;
 584   1        if(ReCnt > 50)//1S
 585   1        {
 586   2          ReCnt = 0;  
 587   2          RT_Temp_Mem_L3 = RT_Temp_Mem_L2;
 588   2          RT_Temp_Mem_L2 = RT_Temp_Mem_L1;
 589   2          RT_Temp_Mem_L1 = (uint16_t)RT_Temp; 
 590   2          Diplay_RTtemp = (RT_Temp_Mem_L3+RT_Temp_Mem_L2+RT_Temp_Mem_L1) / 3; 
 591   2        }
 592   1        
 593   1        //static int Ix=0;
 594   1      
 595   1        //Ix++;
 596   1        //LCD_ShowxNum(223,30,16,5,Ix,0x80,BLUE18);//   
 597   1      
 598   1      //  LCD_ShowxNum(223,10,16,3,RT_Temp_Not_Updated_10mS ,0x80,BLUE18);//  
 599   1      //  LCD_ShowxNum(223,70,16,3,No_ReadData_Temp_Times,0x80,BLUE18);//   
 600   1      //  LCD_ShowxNum(223,100,16,3,No_ReadData_SHIDU_Times,0x80,BLUE18);// 
 601   1      //  LCD_ShowxNum(223,130,16,3,ERR_RT_Temp_Times,0x80,BLUE18);// 
 602   1        
 603   1      //  EA = 0;
 604   1        if(RT_Temp_Not_Updated_10mS < 4000)
 605   1        {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 11  

 606   2          RT_Temp_Not_Updated_10mS++;
 607   2        }
 608   1        
 609   1        {
 610   2          if(Read_Order==0)   //·¢ÎÂ¶ÈÖ¸Áî      
 611   2          {
 612   3            Read_SHT21_Err = SHT21_WriteTemp(); 
 613   3            if(Read_SHT21_Err!=(uint8_t)0)
 614   3            {
 615   4              Read_Order = 0;//½ÓÊÕ´íÎó
 616   4            }
 617   3            else
 618   3            {       
 619   4              Read_Order = 1;
 620   4              Get_time_out = 0;
 621   4            }
 622   3          }
 623   2          else if(Read_Order == 1)  //ÎÂ¶ÈÊý¾Ý½ÓÊÕ
 624   2          {
 625   3            //SCL_INPUT_HIGH(); // set SCL I/O port as input
 626   3            Read_SCL_CONF=SCL_CONF;
 627   3            if(Read_SCL_CONF==1)
 628   3            {
 629   4              Get_time_out = 0;
 630   4              TempLong =  SHT21_ReadData();
 631   4              //RT_Temp_Test = TempLong;
 632   4                //LCD_ShowxNum(223,160,16,5,TempLong,0x80,BLUE18);//  
 633   4                
 634   4              if((TempLong == SHT21_ERROR) || (TempLong & 0x8000)) //¶ÁÈ¡³ö´í£¬ºóÃæÎªÊª¶È±êÖ¾Î»
 635   4              {
 636   5                //if(No_ReadData_Temp_Times<250) No_ReadData_Temp_Times++;  
 637   5                Read_Order = 0;   
 638   5              }
 639   4              else
 640   4              {         
 641   5                No_ReadData_Temp_Times = 0;
 642   5                Read_Order = 2; 
 643   5                          
 644   5                if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÎÂ¶È
 645   5                {
 646   6                  if(WireIn_State!=0)    //ÓÐ¼ÓÈÈË¿Ïß½øÐÐÎÂ¶ÈÐÞÕý
 647   6                  {
 648   7                    TempLong=(TempLong*101/100)-(4*TempLong/388);
 649   7                  }
 650   6                  else
 651   6                  {
 652   7                    TempLong=TempLong-(4*TempLong/400); 
 653   7                  }
 654   6                     
 655   6      
 656   6                  if(TempLong>=350)   //ÎÂ¶ÈÐÞÕý
 657   6                  {
 658   7                    TempLong=TempLong+(6*(TempLong-350)/45);
 659   7                  }
 660   6                    
 661   6                    
 662   6                  if(TempLong>800) //Èç¹ûÈËÌå¶Ë´ïµ½80ËµÃ÷ÓÐÒì³££¬³ö´í±¨¾¯ //2014-07-07 
 663   6                  {
 664   7                    if(ERR_RT_Temp_Times<100)
 665   7                    {
 666   8                      ERR_RT_Temp_Times++;
 667   8                    }
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 12  

 668   7                  }
 669   6                  else 
 670   6                  {
 671   7                    ERR_RT_Temp_Times=0;
 672   7                    RT_Temp=(INT)TempLong;
 673   7                    RT_Temp_Not_Updated_10mS = 0;
 674   7                  }            
 675   6                }
 676   5                else
 677   5                {
 678   6                  RT_Temp=(INT)TempLong;
 679   6                  RT_Temp_Not_Updated_10mS = 0;
 680   6                }
 681   5              } 
 682   4            }
 683   3            else
 684   3            {
 685   4              //CONTROL_RT_SHIDU = 0;       
 686   4            }     
 687   3            //LCD_ShowxNum(223,150,16,3,RT_Temp,0x80,BLUE18);// 
 688   3      
 689   3          }
 690   2          else if(Read_Order==2)  //·¢Êª¶ÈÖ¸Áî
 691   2          {                    
 692   3            Read_SHT21_Err = SHT21_WriteRH();
 693   3            if(Read_SHT21_Err!=(uint8_t)0)
 694   3            {
 695   4              Read_Order = 2;//½ÓÊÕ´íÎó
 696   4            }
 697   3            else
 698   3            {       
 699   4              Read_Order = 3;
 700   4              Get_time_out = 0;
 701   4            }
 702   3          }     
 703   2          else  if(Read_Order == 3)//Êª¶ÈÊý¾Ý½ÓÊÕ
 704   2          {
 705   3            //SCL_INPUT_HIGH(); // set SCL I/O port as input
 706   3            Read_SCL_CONF=SCL_CONF;
 707   3            if(Read_SCL_CONF==1)
 708   3            { 
 709   4              //Read_Order = 0;
 710   4              Get_time_out = 0;
 711   4              TempLong =  SHT21_ReadData();
 712   4              //LCD_ShowxNum(223,210,16,5,TempLong,0x80,BLUE18);//  
 713   4              if((TempLong == SHT21_ERROR)||((TempLong & 0x8000) ==0)) //¶ÁÈ¡³ö´í
 714   4              {
 715   5                if(No_ReadData_SHIDU_Times<250)
 716   5                {
 717   6                  No_ReadData_SHIDU_Times++;
 718   6                }           
 719   5                CONTROL_RT_SHIDU = 0;
 720   5                Read_Order = 2; 
 721   5      
 722   5              }
 723   4              else
 724   4              {
 725   5                Read_Order = 0; 
 726   5                TempLong &= 0x7fff;//×î¸ßÎ»ÊÇ1²ÅÊÇÊª¶È
 727   5                No_ReadData_SHIDU_Times = 0;
 728   5                if(TempLong > 999)
 729   5                {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 13  

 730   6                  TempLong = 999;
 731   6                }  
 732   5                RT_SHIDU=TempLong;
 733   5                CONTROL_RT_SHIDU=TempLong;  //¿ØÖÆÊª¶È
 734   5                //75%ÒÔÉÏ½øÐÐÐ£×¼
 735   5                if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÊª¶È
 736   5                {
 737   6                  if(RT_Temp>300)
 738   6                  {                  
 739   7                    if(TempLong>550)
 740   7                    {            
 741   8                      Temp2=(TempLong-550)*80/100; //16-05-06
 742   8                      if(Temp2>249)
 743   8                      {
 744   9                        Temp2=249;
 745   9                      }                     
 746   8                    }
 747   7                    else
 748   7                    {
 749   8                      Temp2 = 0;
 750   8                    }               
 751   7                    RT_SHIDU=TempLong + Temp2;  //2014-07-25
 752   7                  }
 753   6                  else
 754   6                  {                 
 755   7                    RT_SHIDU=TempLong;   //2014-07-18
 756   7                    //RT_SHIDU=TempLong+120;      
 757   7                  } 
 758   6                  
 759   6                  if(RT_Temp>350)
 760   6                  { 
 761   7                     RT_SHIDU=RT_SHIDU+(180*((uint16_t)RT_Temp-350)/100);  //ÏÔÊ¾Êª¶È 16-05-06
 762   7                  }
 763   6                }
 764   5                else
 765   5                {
 766   6                  //do nothing
 767   6                } 
 768   5                RT_SHIDU += 5;  //ËÄÉáÎåÈë          
 769   5                if(RT_SHIDU>999)
 770   5                {
 771   6                  RT_SHIDU=999;//;  
 772   6                }            
 773   5              }
 774   4            }
 775   3            else
 776   3            {
 777   4                //do nothing
 778   4            }
 779   3          //LCD_ShowxNum(223,130,16,3,RT_SHIDU,0x80,BLUE18);//
 780   3            
 781   3          }
 782   2          else
 783   2          {
 784   3            //do nothing
 785   3          }
 786   2        
 787   2          if((Read_SHT21_Err)||(RT_SHIDU == 0))
 788   2          { 
 789   3            if(No_ReadData_SHIDU_Times<100)
 790   3            {
 791   4              No_ReadData_SHIDU_Times++;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 14  

 792   4            }       
 793   3            if(No_ReadData_Temp_Times<100)
 794   3            {
 795   4              No_ReadData_Temp_Times++;
 796   4            }       
 797   3           
 798   3          }
 799   2          else  
 800   2          {
 801   3            No_ReadData_SHIDU_Times=0;
 802   3            No_ReadData_Temp_Times=0;
 803   3          } 
 804   2      
 805   2          Get_time_out++;
 806   2          if(Get_time_out > 100)//³¬¹ý100mS
 807   2          {
 808   3            Get_time_out = 0;
 809   3            if(Read_Order == 1)
 810   3            {
 811   4              Read_Order = 0;
 812   4            }
 813   3            else if(Read_Order == 3)
 814   3            {
 815   4              Read_Order = 2;
 816   4            }
 817   3            else
 818   3            {
 819   4              Read_Order = 0;
 820   4            }       
 821   3          }        
 822   2        }
 823   1      }
 824          
 825          
 826          void GetTemp_HpChamberFunc(void)
 827          {
 828   1      //  bit HeaterSensorExist;
 829   1        bit CQKSensorExist;
 830   1      
 831   1        //  static uint16_t CQK_Temp_Not_Updated_40mS = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼äS
 832   1        //  static uint16_t JRP_Temp_Not_Updated_S = 0;//Á¬ÐøÎ´²ÉÑùµ½Êý¾ÝµÄÊ±¼äS
 833   1      
 834   1        uint8_t T18B20_L;
 835   1        uint8_t T18B20_H;
 836   1        uint8_t CQK_T18B20_L;
 837   1        uint8_t CQK_T18B20_H; 
 838   1      
 839   1        uint8_t T18B20_H_GET;
 840   1        uint8_t T18B20_L_GET;
 841   1        uint8_t CQK_T18B20_H_GET;
 842   1        uint8_t CQK_T18B20_L_GET;
 843   1      
 844   1      
 845   1        static uint16_t CQK_Temp_Last=0;
 846   1        uint8_t CRC8_error=0;   //checksum
 847   1        uint8_t checksum=0;   //checksum
 848   1        uint8_t DS18B20_Cdata[8];    //data array for checksum verification 
 849   1      
 850   1        uint16_t temp=0;
 851   1        static uint16_t JRP_Temp_Last=0;
 852   1      
 853   1        static uint8_t Get_Temp_Cnt=0;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 15  

 854   1      
 855   1        Get_Temp_Cnt++;
 856   1        if(Get_Temp_Cnt > 3)
 857   1        {
 858   2          Get_Temp_Cnt = 0;
 859   2        }
 860   1        
 861   1        if(No_CQKSensor_Times<2000)
 862   1        {
 863   2          No_CQKSensor_Times++;
 864   2        }
 865   1        if(No_HeatSensor_Times<200)
 866   1        {
 867   2          No_HeatSensor_Times++;
 868   2        }
 869   1        
 870   1        if(Get_Temp_Cnt == 0)  //
 871   1        {
 872   2          HeatingPlateSensor_Port=0;                                //Ö÷»úÀ­ÖÁµÍµçÆ½
 873   2          ChamberOutletSensor_Port=0;
 874   2          delay_us(609);                                //609
 875   2          HeatingPlateSensor_Port=1;                                //ÊÍ·Å×ÜÏßµÈµç×èÀ­¸ß×ÜÏß,²¢±£³Ö15~60us
 876   2          ChamberOutletSensor_Port=1;
 877   2          delay_us(86);                           //ÑÓÊ±70us                     //ÑÓÊ±70us
 878   2      //    HeaterSensorExist=HeatingPlateSensor_Port;                //½ÓÊÕÓ¦´ðÐÅºÅ
 879   2          CQKSensorExist=ChamberOutletSensor_Port;
 880   2          delay_us(488);                                //403
 881   2          DS18B20_WriteByte(0xCC);                      //Ìø¹ýROMÃüÁî
 882   2          DS18B20_WriteByte(0x44);                      //¿ªÊ¼×ª»»ÃüÁî
 883   2        }
 884   1        else if(Get_Temp_Cnt == 2) //
 885   1         //½øÐÐÎÂ¶È×ª»»
 886   1        {
 887   2          HeatingPlateSensor_Port=0;                                //Ö÷»úÀ­ÖÁµÍµçÆ½
 888   2          ChamberOutletSensor_Port=0;
 889   2          delay_us(609);                                //503us
 890   2          HeatingPlateSensor_Port=1;                                //ÊÍ·Å×ÜÏßµÈµç×èÀ­¸ß×ÜÏß,²¢±£³Ö15~60us
 891   2          ChamberOutletSensor_Port=1;
 892   2          delay_us(86);                           //ÑÓÊ±70us
 893   2      //    HeaterSensorExist=HeatingPlateSensor_Port;                //½ÓÊÕÓ¦´ðÐÅºÅ
 894   2          CQKSensorExist=ChamberOutletSensor_Port;
 895   2          delay_us(488);
 896   2          DS18B20_WriteByte(0xCC);                      //Ìø¹ýROMÃüÁî
 897   2          DS18B20_WriteByte(0xBE);                      //¶ÁÔÝ´æ´æ´¢Æ÷ÃüÁî
 898   2          delay_us(10);
 899   2          DS18B20_ReadByte();                           //¶ÁÎÂ¶ÈµÍ×Ö½Ú
 900   2          T18B20_L=Read_18B20_Value;
 901   2          CQK_T18B20_L=Read_18B20_Value2;
 902   2          DS18B20_ReadByte();                           //¶ÁÎÂ¶È¸ß×Ö½Ú
 903   2          T18B20_H=Read_18B20_Value;
 904   2          CQK_T18B20_H=Read_18B20_Value2;
 905   2        
 906   2          if((CQKSensorExist==0))//´íÎóÔò²»½øÐÐÐ£Ñé
 907   2          {
 908   3            DS18B20_Cdata[0] = CQK_T18B20_L;
 909   3            DS18B20_Cdata[1] = CQK_T18B20_H;
 910   3            DS18B20_ReadByte();  
 911   3            DS18B20_Cdata[2] = Read_18B20_Value2;
 912   3            DS18B20_ReadByte();  
 913   3            DS18B20_Cdata[3] = Read_18B20_Value2;
 914   3            DS18B20_ReadByte();  
 915   3            DS18B20_Cdata[4] = Read_18B20_Value2;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 16  

 916   3            DS18B20_ReadByte();  
 917   3            DS18B20_Cdata[5] = Read_18B20_Value2;
 918   3            DS18B20_ReadByte();  
 919   3            DS18B20_Cdata[6] = Read_18B20_Value2;
 920   3            DS18B20_ReadByte();  
 921   3            DS18B20_Cdata[7] = Read_18B20_Value2;
 922   3            DS18B20_ReadByte();  
 923   3            checksum = Read_18B20_Value2;     
 924   3            //Cdata[7] = 0x11; //test CRC
 925   3      
 926   3            CRC8_error = DS18B20_CheckCrc(DS18B20_Cdata,8,checksum); 
 927   3              
 928   3            if(CRC8_error == CHECKSUM_ERROR)
 929   3            {
 930   4              CQKSensorExist = 1;
 931   4            }          
 932   3             
 933   3            if((CQKSensorExist==0))//
 934   3            {
 935   4              CQK_T18B20_H_GET = CQK_T18B20_H;
 936   4              CQK_T18B20_L_GET = CQK_T18B20_L;
 937   4      
 938   4              CQK_T18B20_H_GET = (uint8_t)((CQK_T18B20_H_GET << 4) | (CQK_T18B20_L_GET >> 4));      //¼ÓÈÈÅÌÎÂ¶ÈÖµºÏ²¢¸
             -ßµÍÎ»´æÈëÕûÊýÎ»
 939   4              if((CQK_T18B20_H_GET&(uint8_t)0x80)!=(uint8_t)0)//ÊÇ¸ºÊý
 940   4              {
 941   5                CQK_T18B20_L_GET =(((~CQK_T18B20_L_GET)&0x0F)*10)/16;
 942   5                temp=((~CQK_T18B20_H_GET)*10)+CQK_T18B20_L_GET;
 943   5              } 
 944   4              else
 945   4              {
 946   5                CQK_T18B20_L_GET = ((CQK_T18B20_L_GET&0x0F)*10)/16;
 947   5                temp=(CQK_T18B20_H_GET*10)+CQK_T18B20_L_GET;
 948   5              }
 949   4          
 950   4              if((CQK_Temp_Last ==  temp) && (temp == 850))  //´íÎóÊ±Ò»Ö±ÏÔÊ¾85¶È 2014-07-18
 951   4              {
 952   5                CQK_Sensor_Temp_No_Change_Times++;//2014-07-03 ³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷ÎÂ¶ÈÏàÍ¬µÄ´ÎÊý
 953   5                if(CQK_Sensor_Temp_No_Change_Times > 10000)
 954   5                {
 955   6                  CQK_Sensor_Temp_No_Change_Times =10000;
 956   6                }
 957   5              }
 958   4              else
 959   4              {
 960   5                CQK_Sensor_Temp_No_Change_Times = 0;    
 961   5              }
 962   4               
 963   4              if(temp > 800)
 964   4              {
 965   5              //           if(CQKSensor_Hithen800_Times < 2000) CQKSensor_Hithen800_Times++;            
 966   5              }
 967   4              else
 968   4              {
 969   5                CQKSensor_Hithen800_Times = 0;
 970   5              }         
 971   4      
 972   4              if(((CQK_Temp_Last >=  temp) && ((CQK_Temp_Last - temp) < 200))
 973   4              ||((CQK_Temp_Last <=  temp) && ((temp - CQK_Temp_Last)  < 200)))//EFT¶Ô²ß£ºÎÂ¶È²»ÄÜË²±ä,1S±ä»¯²»ÄÜ³¬¹ý
             -20¶È
 974   4              { 
 975   5                if((temp > 0)&&(temp < 850))//²»¶ÁÁã
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 17  

 976   5                {
 977   6                  CQK_Temp = (LONG)temp;//ÊµÊ±ÏÔÊ¾ÎÂ¶È
 978   6                  if(Work_State != UI_STATE_SERVICE_MODE) //×¢Òâ,²âÊÔÄ£Ê½ÏÂÏÔÊ¾ÕæÊµÎÂ¶È
 979   6                  {
 980   7                    CQK_Temp=CQK_Temp*51/50;  
 981   7                  }
 982   6                }
 983   5              }
 984   4              else
 985   4              {
 986   5                //do nothing
 987   5              } 
 988   4              CQK_Temp_Last =  temp;  
 989   4            }
 990   3          }
 991   2           
 992   2      //    if(CQKSensorExist==1)// || CQK_Temp > 800)
 993   2      //    {
 994   2      //    //        if(No_CQKSensor_Times<2000)No_CQKSensor_Times++;          
 995   2      //    }
 996   2      //    else
 997   2          {
 998   3            No_CQKSensor_Times=0; 
 999   3          }
1000   2      
1001   2          T18B20_H_GET = T18B20_H;
1002   2          T18B20_L_GET = T18B20_L;
1003   2      
1004   2          if(Work_State == UI_STATE_SERVICE_MODE)//ÔÚ²âÊÔÄ£Ê½Ê±ÏÔÊ¾¶ÁÈ¡µÄÊý¾Ý
1005   2          {
1006   3      //      LCD_ShowxNum(10,220,24,3,T18B20_H_GET,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ¼ÓÈÈÅÌ
1007   3      //      LCD_ShowxNum(10,268,24,3,T18B20_L_GET,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾
1008   3          }    
1009   2      
1010   2      
1011   2          T18B20_H_GET = (uint8_t)((T18B20_H_GET << 4) | (T18B20_L_GET >> 4));      //¼ÓÈÈÅÌÎÂ¶ÈÖµºÏ²¢¸ßµÍÎ»´æÈëÕûÊýÎ
             -»
1012   2          if((T18B20_H_GET&(uint8_t)0x80)!=(uint8_t)0)//ÊÇ¸ºÊý
1013   2          {
1014   3            T18B20_L_GET =(((~T18B20_L_GET)&0x0F)*10)/16;
1015   3            temp=((~T18B20_H_GET)*10)+T18B20_L_GET;
1016   3          } 
1017   2          else
1018   2          {
1019   3            T18B20_L_GET = ((T18B20_L_GET&0x0F)*10)/16;
1020   3            temp=(T18B20_H_GET*10)+T18B20_L_GET;
1021   3          }
1022   2            
1023   2             
1024   2          if((JRP_Temp_Last ==  temp))// && (temp == 850))  //´íÎóÊ±Ò»Ö±ÏÔÊ¾85¶È 2014-07-18
1025   2          {
1026   3            JRP_Sensor_Temp_No_Change_Times++;//2014-07-03 ¼ÓÈÈÅÌÎÂ¶È´«¸ÐÆ÷ÎÂ¶ÈÏàÍ¬µÄ´ÎÊý
1027   3            if(JRP_Sensor_Temp_No_Change_Times > 6000)
1028   3            {
1029   4              JRP_Sensor_Temp_No_Change_Times = 6000;
1030   4            }
1031   3          }
1032   2          else
1033   2          {
1034   3            JRP_Sensor_Temp_No_Change_Times = 0;
1035   3          }
1036   2          JRP_Temp_Last =  temp;    
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 18  

1037   2      
1038   2          JEP_Temp =  (INT)temp;    //ÊµÊ±ÏÔÊ¾ÎÂ¶È
1039   2      
1040   2      //    if(HeaterSensorExist==1 || JEP_Temp>=0x0FFF || JEP_Temp > 1250)
1041   2      //    {
1042   2      ////       if(No_HeatSensor_Times<2000)No_HeatSensor_Times++; 
1043   2      //    }
1044   2      //    else
1045   2          {
1046   3            No_HeatSensor_Times=0;
1047   3          }
1048   2        }
1049   1        else
1050   1        {
1051   2          //do nothing
1052   2        }
1053   1      } 
1054          
1055          static INT  Temp1_Int = 260;
1056          static INT  Temp2_Int = 400;
1057          static uint16_t NoneWire_Heat_Sec=0;
1058          static INT  Set_CQK_Temp_Comp;//³öÆø¿ÚÐ£Õý¹ýºóµÄÄ¿±êÎÂ¶È
1059          void  HeaterPlateWireControlFunc(void)//ÎÂ¶È¿ØÖÆ
1060          {
1061   1        //    uint8_t  Temp3;
1062   1        uint16_t  Val_Calc=0;
1063   1      
1064   1        INT  Humidity_Err=0; //Î´´ïµ½Ä¿±êÊª¶ÈµÄ²îÖµ
1065   1        INT  Humidity_Comp=0;//³¬¹ýÄ¿±êÎÂ¶ÈµÄ²îÖµ 
1066   1        static uint16_t Last_Rem_Humidity=0;  
1067   1        
1068   1        static uint16_t WarmUp_S_Cnt=0; 
1069   1        //uint16_t  CQK_Vaul_Err;//²îÖµ
1070   1      
1071   1        if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == 1))
1072   1        { //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ³öÆø¿Ú
1073   2          Back_Color=WHITE18;
1074   2          LCD_ShowxNum(POS_RT_RH_X-50,5,16,2,Micro_Adj_Mode_Test,0x80,BLACK18); //·¢ÈÈÅÌ¼ÓÈÈµÄÄ£Ê½ÏÔÊ¾
1075   2          LCD_ShowxNum(POS_RT_RH_X-50,34,16,4,(u32)JEP_Temp,0x80,BLACK18); //·¢ÈÈÅÌµÄÎÂ¶È
1076   2          LCD_ShowxNum(POS_RT_RH_X-50,73,16,3,(u32)CQK_Temp,0x80,BLACK18); //³öÆø¿ÚµÄÎÂ¶È
1077   2          LCD_ShowxNum(POS_RT_RH_X-50,107,16,3,Set_CQK_Temp,0x80,BLACK18); //³öÆø¿ÚÉè¶¨ÎÂ¶È
1078   2          LCD_ShowxNum(POS_RT_RH_X-50,141,16,3,Micro_Temp_Val,0x80,BLACK18); //·¢ÈÈÅÌµÄ¼ÓÈÈÊ±³¤
1079   2          
1080   2          LCD_ShowxNum(POS_RT_RH_X-50,185,16,3,CONTROL_RT_SHIDU,0x80,BLACK18); //ÕæÊµÏà¶ÔÊª¶È
1081   2          LCD_ShowxNum(POS_RT_RH_X-50,219,16,3,Aim_SHIDU,0x80,BLACK18); //Ä¿±êÊª¶È
1082   2          LCD_ShowxNum(POS_RT_RH_X-50,253,16,3,Micro_Temp_In,0x80,BLACK18); //In¼ÓÈÈÊ±³¤
1083   2          LCD_ShowxNum(POS_RT_RH_X-50,287,16,3,Micro_Temp_Out,0x80,BLACK18); //Exp¼ÓÈÈÊ±³¤
1084   2          
1085   2          LCD_ShowxNum(POS_RT_RH_X-33,2,16,1,(u32)Wire_Mode_Sel,0x80,BLACK18); //¼ÓÈÈË¿Ä£Ê½     
1086   2          LCD_ShowxNum(POS_RT_RH_X-33,10,16,1,WireIn_State,0x80,BLACK18); //IN¼ÓÈÈË¿×´Ì¬
1087   2          LCD_ShowxNum(POS_RT_RH_X-33,18,16,1,WireOut_State,0x80,BLACK18); //EXP¼ÓÈÈË¿×´Ì¬  
1088   2            
1089   2          //LCD_ShowxNum(POS_RT_RH_X-20,185,16,1,SHT21_Heater_State,0x80,BLACK18); //SHT¼ÓÈÈ×´Ì¬
1090   2          LCD_ShowxNum(POS_RT_RH_X-33,253,16,3,Wire_Warm_Up_Sec,0x80,BLACK18); //600S¼ÆÊ± 
1091   2          LCD_ShowxNum(POS_RT_RH_X-33,107,16,3,(u32)Set_CQK_Temp_Comp,0x80,BLACK18); //Ð£Õý¹ýºóµÄ³öÆø¿ÚÄ¿±êÊª¶È
1092   2          //LCD_ShowxNum(POS_RT_RH_X-33,141,16,3,Plate_Warm_Up_Sec,0x80,BLACK18); //600S¼ÆÊ±  
1093   2          LCD_ShowxNum(POS_RT_RH_X-33,185,16,3,Humidity_No_Change_Sec,0x80,BLACK18); //600S¼ÆÊ±     
1094   2          
1095   2          if(WireIn_State!=0) //ÓÐ·¢ÈÈË¿
1096   2          {
1097   3            LCD_ShowxNum(POS_RT_RH_X-33,34,16,4,(u32)JEP_Temp_Aim,0x80,BLACK18); //·¢ÈÈÅÌµÄÄ¿±êÎÂ¶È
1098   3            LCD_ShowxNum(POS_RT_RH_X-16,34,16,3,WarmUp_S_Cnt,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±¸Ä±äÊ±¼ä  
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 19  

1099   3      
1100   3            if(Controler_temp3.Sum_error >0)
1101   3            {
1102   4              LCD_ShowxNum(POS_RT_RH_X+41,20,16,1,1,0x80,BLACK18); //
1103   4            }
1104   3            else
1105   3            {
1106   4              LCD_ShowxNum(POS_RT_RH_X+41,20,16,1,0,0x80,BLACK18); //
1107   4            }
1108   3              
1109   3      
1110   3            LCD_ShowxNum(POS_RT_RH_X+41,34,16,4,(u32)(abs(Controler_temp3.Sum_error)),0x80,BLACK18); //
1111   3      
1112   3      
1113   3            if(Controler_temp2.Sum_error >0)
1114   3            {
1115   4              LCD_ShowxNum(POS_RT_RH_X+41,80,16,1,1,0x80,BLACK18); //
1116   4            }
1117   3            else
1118   3            {
1119   4              LCD_ShowxNum(POS_RT_RH_X+41,80,16,1,0,0x80,BLACK18); //
1120   4            }
1121   3              
1122   3      
1123   3            LCD_ShowxNum(POS_RT_RH_X+41,94,16,4,(u32)(abs(Controler_temp2.Sum_error)),0x80,BLACK18); //
1124   3          }
1125   2          else
1126   2          {
1127   3            LCD_ShowxNum(POS_RT_RH_X-33,34,16,4,(u32)Temp2_Int,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±·¢ÈÈÅÌµÄÄ¿±êÎÂ¶È
1128   3            LCD_ShowxNum(POS_RT_RH_X-16,34,16,3,NoneWire_Heat_Sec,0x80,BLACK18); //ÎÞ·¢ÈÈË¿»ØÂ·Ê±¸Ä±äÊ±¼ä 
1129   3          }
1130   2            
1131   2          LCD_ShowxNum(POS_RT_RH_X+40,170,16,3,(u32)Temp1_Int,0x80,BLACK18); //¿ª»ú½¥½øÊ½ÎÂ¶ÈÄ¿±ê
1132   2          LCD_ShowxNum(POS_RT_RH_X+20,170,16,3,(u32)RT_Temp,0x80,BLACK18); //»¼Õß¶ËÎÂ¶È
1133   2          LCD_ShowxNum(POS_RT_RH_X+20,210,16,4,Nochange_Times,0x80,BLACK18); //ÎÂÊª¶ÈÁ¬Ðø²»±ä¼ÆÊý   
1134   2      
1135   2          LCD_ShowxNum(2,2,16,5,Working_Normal,0x80,BLACK18); //Õý³£¹¤×÷Ê±¼ä¼ÆÊ±  
1136   2          LCD_ShowxNum(2,60,16,5,HP_CNT_Int_End_Rem,0x80,BLACK18); //ÏÔÊ¾Ã¿4Ãë¼ÓÈÈÅÌ·½²¨µÄ´ÎÊý      
1137   2        }
1138   1      
1139   1        if(        
1140   1          ((ERR_Kind & 0x01)!=0)//´«¸ÐÆ÷´íÎó        
1141   1          ||((ERR_Kind & 0x02)!=0) //¸ßÎÂ
1142   1          ||((ERR_Kind & 0x10)!=0) //ÎÞË®   
1143   1          || (Wire_Mode_Mismatch == 1)  //·¢ÈÈË¿Î´Ñ¡
1144   1          || (HeaterPlate_State==0))//Ë®¹ÞÎ´×°ºÃ
1145   1        {
1146   2          Micro_Temp_In=0;
1147   2          Micro_Temp_Out=0;
1148   2          Micro_Temp_Val=0;  //Í£Ö¹¼ÓÈÈ
1149   2          Micro_Adj_Mode_Test = 1;//¼ÓÈÈÄ£Ê½²âÊÔ
1150   2          Wire_Warm_Up_Sec = 0; //µ±<=300Ê±ÏÞÖÆ×î´ó¼ÓÈÈ¹¦ÂÊ  
1151   2          //Plate_Warm_Up_Sec = 0;
1152   2          Humidity_No_Change_Sec = 0;     
1153   2        }
1154   1        else
1155   1        {       
1156   2          //¹ÜÄÚ·¢ÈÈË¿¹¤×÷,¿ØÖÆÎÂ¶Èµ÷½Ú==========================       
1157   2      
1158   2          if(Work_Mode==Noninvasive_Mode) //ÎÞ´´Ä£Ê½Ê±,ÈËÌå¶ËÎÂ¶È¶ÔÄ¿±êÊª¶ÈµÄ¿ØÖÆÂß¼­
1159   2          {       
1160   3            Aim_SHIDU=790;  
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 20  

1161   3          }else   //ÓÐ´´Ä£Ê½Ê±,ÈËÌå¶ËÎÂ¶È¶ÔÄ¿±êÊª¶ÈµÄÓ°Ïì
1162   2          {
1163   3            Aim_SHIDU=890; //2014-11-21 
1164   3          }
1165   2      
1166   2          Val_Calc = 0;       
1167   2          //if(Boot_Start_RT_Temp_Heating_Timer_Sec > 300) //»¼Õß¶Ë¿ª»ú½¥½øÊ½¼ÓÈÈ½áÊø
1168   2          if(Low_Power_Mode_Flag == 0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1169   2          {//»ØÂ··¢ÈÈË¿µÄ¿ØÖÆ
1170   3            if(WireIn_State!=0)   //µ±ÓÐ¹ÜÄÚIN·¢ÈÈË¿Ê±£¬¹ÜÄÚ·¢ÈÈË¿µÄ¼ÓÈÈÂß¼­
1171   3            {
1172   4              if(Working_Normal >= 1200)
1173   4              {
1174   5                Temp1_Int = Set_RT_Temp;//20·ÖÖÓÒÔºóÎªÉè¶¨ÎÂ¶È
1175   5              }
1176   4              else
1177   4              {           
1178   5                Temp1_Int = CQK_Temp + 30;//20·ÖÖÓÒÔÇ°¸úËæ³öÆø¿ÚÎÂ¶È
1179   5              }
1180   4              if(Temp1_Int > Set_RT_Temp)
1181   4              {
1182   5                Temp1_Int = Set_RT_Temp;
1183   5              }
1184   4                
1185   4                
1186   4              //Controler_temp.Ek = Set_RT_Temp - RT_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1187   4              Controler_temp.Ek = Temp1_Int - RT_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1188   4              Controler_Calc(); 
1189   4              Val_Calc = (uint8_t)Controler_temp.Uk;  //¼ÆËã³ö¼ÓÈÈÊ±¼ä          
1190   4                
1191   4              if(WireIn_State!=0)
1192   4              {
1193   5                if (RT_Temp<(Set_RT_Temp-20))
1194   5                {
1195   6                  //do nothing
1196   6                }
1197   5                else if (RT_Temp<(Set_RT_Temp-10))
1198   5                {
1199   6                  //do nothing
1200   6                }
1201   5                else if (RT_Temp<=Set_RT_Temp)
1202   5                {
1203   6                  //do nothing
1204   6                }
1205   5                else if (RT_Temp<=(Set_RT_Temp+10))
1206   5                {
1207   6                  //do nothing
1208   6                }
1209   5                else
1210   5                {
1211   6                  Val_Calc=0; 
1212   6                }
1213   5              }
1214   4              else
1215   4              {
1216   5                     Val_Calc=0;
1217   5              }
1218   4            } 
1219   3            else    //µ±ÎÞ¹ÜÄÚ·¢ÈÈË¿Ê±
1220   3            {
1221   4              Val_Calc=0;
1222   4            }
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 21  

1223   3              
1224   3            if(Working_Normal >= 1200)//Õý³£¹¤×÷20·ÖÖÓÖ®ºó
1225   3            {
1226   4      
1227   4            }
1228   3            else
1229   3            {
1230   4              if(Val_Calc > 160)
1231   4              {
1232   5                Val_Calc = 160;//20·ÖÖÓÄÚÏÞÖÆ¼ÓÈÈ¹¦ÂÊ
1233   5              }
1234   4            }
1235   3              
1236   3              
1237   3            Micro_Temp_In = Val_Calc;
1238   3      
1239   3            Val_Calc=0;
1240   3            if(WireOut_State!=0)    //µ±ÓÐ¹ÜÄÚOUT·¢ÈÈË¿Ê±£¬¹ÜÄÚ·¢ÈÈË¿µÄ¼ÓÈÈÂß¼­
1241   3            {
1242   4              {
1243   5                Val_Calc = Micro_Temp_In *(10+In_Exp_Ratio-1)/10;
1244   5                if(Val_Calc > 195)
1245   5                {
1246   6                  Val_Calc = 195;
1247   6                }
1248   5                if(In_Exp_Ratio > 1)
1249   5                { 
1250   6                  if(Val_Calc==0)
1251   6                  {
1252   7                    Val_Calc=40*(10+In_Exp_Ratio-1)/10;
1253   7                  }
1254   6                }
1255   5                if (RT_Temp >= (Set_RT_Temp+10))//´óÓÚ1¶È,Í£Ö¹¼ÓÈÈ,±£»¤´ëÊ©
1256   5                {
1257   6                  Val_Calc=0; 
1258   6                }
1259   5              }          
1260   4            }
1261   3            else
1262   3            { 
1263   4              Val_Calc=0; 
1264   4            }
1265   3            Micro_Temp_Out = Val_Calc;
1266   3          }
1267   2      
1268   2          //ÓÐÎÞ´´Ä£Ê½Ê±·¢ÈÈÅÌµÄ¼ÓÈÈÂß¼­
1269   2      
1270   2          //²»Çø·Ö¼ÓÈÈÏß/////////////////////////////   
1271   2          if(CONTROL_RT_SHIDU<=Aim_SHIDU)//Ö÷ÒªÊÇÕë¶Ô´óÁ÷Á¿Ê±µÄ²¹³¥
1272   2          {
1273   3            Humidity_Err = (INT)(Aim_SHIDU - CONTROL_RT_SHIDU);///2;//Êª¶ÈÎó²î¼ÆËã
1274   3            if(Humidity_Err > 100)
1275   3            {
1276   4              Humidity_Err = 100;//×î´óÏÞ¶¨Îª100
1277   4            }
1278   3          }   
1279   2          else
1280   2          {
1281   3            Humidity_Err = 0; 
1282   3          }     
1283   2                
1284   2          Humidity_Comp = (INT) (CONTROL_RT_SHIDU - Aim_SHIDU); //¿ØÖÆÊª¶ÈÒÔ¼õÉÙÀäÄýË®    
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 22  

1285   2          if(Humidity_Comp > 100)
1286   2          {
1287   3            Humidity_Comp  = 100;
1288   3          }
1289   2      
1290   2          if(Last_Rem_Humidity != CONTROL_RT_SHIDU)//ÕæÊµÊª¶È¸Ä±äÔòÇåÁã
1291   2          {
1292   3            Humidity_No_Change_Sec = 0;
1293   3          }
1294   2          Last_Rem_Humidity = CONTROL_RT_SHIDU;
1295   2      
1296   2          if(Humidity_No_Change_Sec >= 900)//¿ÉÄÜ½øÈëÀäÄý×´Ì¬
1297   2          {
1298   3            Humidity_No_Change_Sec = 901;
1299   3            Humidity_Err = 0;  //½øÈëÀäÄý×´Ì¬ÔòÊª¶È¿ØÖÆÎÞÐ§
1300   3            Humidity_Comp = 0;
1301   3          }       
1302   2                      
1303   2          if((CQK_Temp>=660) ||(JEP_Temp>=HeatingTemperature_MAX))     //³öÆø¿ÚÎÂ¶È×î¸ß66¶È
1304   2          {
1305   3             Micro_Temp_Val=0;//´óÓÚ65¶È±ØÐëÍ£Ö¹¼ÓÈÈ
1306   3             Micro_Adj_Mode_Test = 2;//¼ÓÈÈÄ£Ê½²âÊÔ          
1307   3          }       
1308   2          //´ø¼ÓÈÈÏßµÄÎÂ¶Èµ÷½Ú===========================
1309   2          else if(WireIn_State!=0)
1310   2          {
1311   3            if(Low_Power_Mode_Flag == 0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1312   3            {
1313   4              if(JEP_Temp>=HeatingTemperature_MAX)   //105¶È
1314   4              {
1315   5                Val_Calc = 0;
1316   5                Micro_Adj_Mode_Test = 7;//¼ÓÈÈÄ£Ê½²âÊÔ              
1317   5              }
1318   4              else
1319   4              { 
1320   5                Set_CQK_Temp_Comp = (INT)Set_CQK_Temp; //³öÆø¿ÚÉè¶¨ÎÂ¶È
1321   5                
1322   5                if(Work_Mode==Invasive_Mode)//
1323   5                { 
1324   6                  if(Humidity_Err >= 50)  //µ±Ä¿±êÊª¶ÈÏà²î5%ÒÔÉÏÇÒÎªÎÞ´´Ê±£¬ÔÊÐí×î¸ß³¬¹ý¶È
1325   6                  {
1326   7                    //Set_CQK_Temp_Comp += Humidity_Err/6;//×î¸ßÔÊÐí³¬¹ý1.6¶È
1327   7                    Set_CQK_Temp_Comp += Humidity_Err/10;//×î¸ßÔÊÐí³¬¹ý1¶È
1328   7                  } 
1329   6                } 
1330   5                else
1331   5                {
1332   6                  if(Humidity_Err >= 50)  //µ±Ä¿±êÊª¶ÈÏà²î5%ÒÔÉÏÇÒÎªÎÞ´´Ê±£¬ÔÊÐí×î¸ß³¬¹ý¶È
1333   6                  {
1334   7                    Set_CQK_Temp_Comp += Humidity_Err/2;//×î¸ßÔÊÐí³¬¹ý5¶È 120L 28»·¾³ÎÂ¶È
1335   7                  }
1336   6                } 
1337   5      
1338   5                if(Humidity_Comp >= 10)
1339   5                {
1340   6                  //Set_CQK_Temp_Comp = Set_CQK_Temp_Comp - Humidity_Comp/5;//Êª¶ÈÃ¿ÉÏ1%Ôò³öÆø¿ÚÎÂ¶ÈÏÂ½µ0.2¶È£¬×î¶à2¶È
1341   6                  Set_CQK_Temp_Comp = Set_CQK_Temp_Comp - (Humidity_Comp/10);//Êª¶ÈÃ¿ÉÏ1%Ôò³öÆø¿ÚÎÂ¶ÈÏÂ½µ0.1¶È£¬×î¶à1¶
             -È
1342   6                }   
1343   5      
1344   5                if(Work_Mode==Invasive_Mode)//
1345   5                { 
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 23  

1346   6                  //Set_CQK_Temp_Comp -= 5;//ÓÐ´´Ê±½µµÍ0.5¶È  
1347   6                  if(Set_CQK_Temp_Comp < 320)
1348   6                  {
1349   7                    Set_CQK_Temp_Comp = 320;//×î¼«ÏÞµÄÎÂ¶È
1350   7                  }
1351   6                }
1352   5                else
1353   5                { 
1354   6                  if(Set_CQK_Temp_Comp < 300)
1355   6                  {
1356   7                    Set_CQK_Temp_Comp = 300;//×î¼«ÏÞµÄÎÂ¶È
1357   7                  }
1358   6                } 
1359   5      
1360   5                ////if(CQK_Temp < Set_CQK_Temp_Comp - 30) //  
1361   5      
1362   5                //Ëã·¨¿ªÊ¼
1363   5                if(JEP_Temp < (JEP_Temp_Aim - 20))//¼ÓÈÈÅÌÎÂ¶ÈÐ¡ÓÚ¼ÓÈÈÅÌÄ¿±êÎÂ¶È-2    
1364   5                {
1365   6                  WarmUp_S_Cnt = 0;//ÇåÁã£¬µÈ´ý´ïµ½¼ÓÈÈÄ¿±ê
1366   6                } 
1367   5                else
1368   5                {
1369   6                  WarmUp_S_Cnt++;
1370   6                  if(WarmUp_S_Cnt >= 20)//Ã¿Á½·ÖÖÓµ÷ÕûÒ»´Î¼ÓÈÈÅÌÄ¿±êÎÂ¶È
1371   6                  {
1372   7                    WarmUp_S_Cnt = 0;
1373   7                    Controler_temp3.Ek = Set_CQK_Temp_Comp - CQK_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1374   7                    HeatPlateTemp_Aim_Controler_Calc();                       
1375   7      
1376   7                    JEP_Temp_Aim = JEP_Temp_Aim + Controler_temp3.Uk;//                       
1377   7                    
1378   7                    if(Work_Mode==Invasive_Mode)//
1379   7                    {
1380   8                      if(JEP_Temp_Aim < 500)
1381   8                      {
1382   9                        JEP_Temp_Aim = 500;//×îÐ¡50¶È
1383   9                      }
1384   8                    }
1385   7                    else
1386   7                    {
1387   8                      if(JEP_Temp_Aim < 400)
1388   8                      {
1389   9                        JEP_Temp_Aim = 400;//×îÐ¡50¶È
1390   9                      }
1391   8                    } 
1392   7                    
1393   7                    if(Working_Normal >= 1200)
1394   7        //                    if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)//¿ª»ú20·ÖÖÓÖ®ºó
1395   7                    {
1396   8                      if(JEP_Temp_Aim > 1045)
1397   8                      {
1398   9                        JEP_Temp_Aim = 1045;//×î´ó102¶È
1399   9                      }
1400   8                    }
1401   7                    else
1402   7                    {
1403   8                      if(JEP_Temp_Aim > 980)
1404   8                      {
1405   9                        JEP_Temp_Aim = 980;//¿ª»ú20·ÖÖÓÒÔÄÚ×î´ó98¶È
1406   9                      }
1407   8                    }
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 24  

1408   7                  }
1409   6                }
1410   5                      
1411   5                      
1412   5                Controler_temp2.Ek = JEP_Temp_Aim - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
1413   5                HeatPlate_Controler_Calc(); 
1414   5                Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
1415   5      
1416   5                if((CQK_Temp - Set_CQK_Temp_Comp) > 20)//³öÆø¿ÚÎÂ¶È±ÈÄ¿±êÎÂ¶È¸ß
1417   5                {
1418   6                  if(Val_Calc > 20)
1419   6                  {
1420   7                    Val_Calc = 20;  
1421   7                  }
1422   6                  JEP_Temp_Aim = JEP_Temp;//¸ü¸Ä¼ÓÈÈÅÌÄ¿±êÎÂ¶È
1423   6                } 
1424   5                else if((CQK_Temp - Set_CQK_Temp_Comp) > 10)//³öÆø¿ÚÎÂ¶È±ÈÄ¿±êÎÂ¶È¸ß
1425   5                {
1426   6                  //do nothing
1427   6                }
1428   5                else
1429   5                {
1430   6                  //do nothing
1431   6                }
1432   5              }
1433   4            }          
1434   3                
1435   3                
1436   3            if(Val_Calc > 195)
1437   3            {
1438   4              Val_Calc = 195; 
1439   4            }       
1440   3            if(Low_Power_Mode_Flag == 0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1441   3            {
1442   4              Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
1443   4            }
1444   3                
1445   3            }
1446   2          else if(Low_Power_Mode_Flag == 0)//·ÇµÍ¹¦ÂÊÄ£Ê½²Å¿ÉÒÔ¿ØÖÆ
1447   2          { 
1448   3            PatientTemp_NoneHeatWire_Adj();
1449   3            //²»´ø¼ÓÈÈÏßµÄÎÂ¶Èµ÷½Ú==============================================================
1450   3          }
1451   2          else
1452   2          {
1453   3            //do nothing
1454   3          }
1455   2      
1456   2        }
1457   1      } 
1458          
1459          
1460          static void   Store_Data(void)   //´æ·ÅÊý¾ÝµØÖ·´Ó1¿ªÊ¼
1461          {
1462   1        uint16_t i;
1463   1        uint8_t N,j;
1464   1        if (Run_Count<1)
1465   1        {
1466   2          return;
1467   2        }   
1468   1        i=((Run_Count-1)/8)+1;     //¼ÆËãµØÖ·
1469   1        N=Run_Count%8;       //¼ÆËãÎ»
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 25  

1470   1        if ((Run_Count!=0) && (N==0)) 
1471   1        {
1472   2          N=8;
1473   2        }
1474   1        j=(uint8_t)(0xFF<<N);
1475   1        SPI_Write_nBytes(i,1,&j);
1476   1      
1477   1            //delay_us(100);
1478   1      }
1479          
1480          static void  Get_RunCount(void)   //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý
1481          {
1482   1        uint16_t Start1,Start2,StartAdr;
1483   1        uint8_t N,K,j;
1484   1        Start1=0x1;
1485   1        Start2=0x2000;
1486   1        for(j=0;j<14;j++) //²éÕÒ¼ÆÊýÎ»
1487   1        {
1488   2          StartAdr=(Start1+Start2)/2;
1489   2          SPI_Read_nBytes(StartAdr,1,&N);
1490   2          delay_us(100);
1491   2          if(N==0xFF)
1492   2          {
1493   3            Start2=StartAdr;
1494   3          }else
1495   2          {
1496   3            Start1=StartAdr;
1497   3            Start2=Start1+(2<<(12-(uint16_t)j));
1498   3            SPI_Read_nBytes(StartAdr+1,1,&K);
1499   3            if(K==0xFF)
1500   3            {  break;  }
1501   3            else
1502   3            {
1503   4              StartAdr=StartAdr+1;
1504   4              N=K;
1505   4            }
1506   3          }
1507   2        }
1508   1        Run_Count=(StartAdr-1)*8;//¼ÆËãÊ±1¸ö×Ö½Ú±í8
1509   1        for(j=0;j<8;j++)
1510   1        {
1511   2          if(((0x01<<j) & N)!=0)
1512   2          {
1513   3            break;
1514   3          }     
1515   2        }
1516   1        Run_Count=Run_Count+j;      //×î¶à¿É¼ÇÊý44896Ìõ,256ÌõÎª»º³å
1517   1      
1518   1         //Run_Count = 2000;//²âÊÔÊ¹ÓÃ 2014-12-26
1519   1         //SPI_Read_nBytes(8000,1,&N);
1520   1         // DS1302_GetTime(NowTime);
1521   1         // if(NowTime[0]&0x80)         //·¢ÏÖµôµçÔòÖØÐÂ³õÊ¼»¯Ê±¼ä£¬ÊÇ·ñÒªÑ¯ÎÊ
1522   1         //    DS1302_SetTime(initTime);    //³õÊ¼»¯Ê±¼ä
1523   1      //    if(N==1)                    //Ê±¼ä±ØÐë×ÔÐÐÉè¶¨
1524   1      //   {
1525   1      //      DS1302_SetTime(NowTime);
1526   1      //      j=2;
1527   1      //      SPI_Write_nBytes(8000,1,&j);
1528   1      //      delay_ms(10);
1529   1      //   }else if(N==2)
1530   1      //   {
1531   1      
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 26  

1532   1      //   }
1533   1      
1534   1         
1535   1         /* 
1536   1         DISP_TIME_10X16(POS_RT_RH_X-20,10,Run_Count/10000,BLACK18);
1537   1         DISP_TIME_10X16(POS_RT_RH_X-20,18,Run_Count%10000/1000,BLACK18);
1538   1         DISP_TIME_10X16(POS_RT_RH_X-20,26,Run_Count%1000/100,BLACK18);
1539   1         DISP_TIME_10X16(POS_RT_RH_X-20,34,Run_Count%100/10,BLACK18);
1540   1         DISP_TIME_10X16(POS_RT_RH_X-20,42,Run_Count%10,BLACK18);
1541   1         */
1542   1         //DISP_TIME_10X16(POS_RT_RH_X-20,POS_RT_RH_Y+150-90,Enable_Save_Data,BLACK18);
1543   1      }
1544          
1545          static uint8_t  Wire_Mode_Sel_Rem = 0xff;//¼ÇÒä×´Ì¬
1546          static uint8_t  Disp_ERR_VHB80_Code = 0xff;
1547          
1548          void Err_Base_HeaterWire_DISP_Enable(void)//ÆÁ±£Ê±ÖÃÏà¹Ø±êÖ¾,ÒÔ±ãÁÁÆÁÊ±ÏÔÊ¾Ö÷»úºÍÏßµÄÍ¼ÐÎ
1549          {
1550   1        Disp_ERR_VHB80_Code = 0xff;
1551   1        Wire_Mode_Sel_Rem = 0xff;//¼ÇÒä×´Ì¬
1552   1      }
1553          
1554          
1555          void AlarmErrorFunc(void)    //´íÎóÊÂ¼þ
1556          {
1557   1        uint8_t color=0;
1558   1        static uint8_t     Err_Event_Cnt=0;  //¼õÐ¡¹¤×÷´ÎÊý
1559   1        uint8_t     Err_Event_1=0;
1560   1        uint8_t     Err_Event_2=0;
1561   1          
1562   1        static uint8_t AlarmInfoRem = 0;//±¨¾¯×´Ì¬¼ÇÒä
1563   1        {
1564   2          Err_Event_Cnt++;//ÉÁË¸¼ÆÊý¼°¼õÉÙ³ÌÐòÔËÐÐÊ±¼ä
1565   2          if(Err_Event_Cnt > 1)
1566   2          { 
1567   3            Err_Event_Cnt = 0;//ºì  
1568   3          }
1569   2          Err_Event_1 = 0;
1570   2          Err_Event_2 = 1;      
1571   2        
1572   2          //LCD_ShowxNum(POS_RT_RH_X-40,5,16,4,RT_Temp,0x80,BLACK18); //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾
1573   2          //LCD_ShowxNum(POS_RT_RH_X-40,60,16,4,ERR_RT_Temp_Times,0x80,BLACK18); //
1574   2        
1575   2          if(((No_CQKSensor_Times>1000) || (CQK_Sensor_Temp_No_Change_Times > 6000)) //³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â
1576   2            ||(CQKSensor_Hithen800_Times > 250)//Á¬Ðø10S > 80¶È
1577   2            ||(No_ReadData_Temp_Times>20)//¼ÓËÙÏÔÊ¾
1578   2            )
1579   2          {
1580   3            CQK_Sensor_Err=1;
1581   3            CQK_Temp = 0; 
1582   3            LoTemp_CQK_Count  = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1583   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã 
1584   3            Set_bit(ERR_Kind,Alarm_Const_CQK_Sensor);         
1585   3          }
1586   2          else
1587   2          {
1588   3            CQK_Sensor_Err=0;
1589   3            Clear_bit(ERR_Kind,Alarm_Const_CQK_Sensor);         
1590   3          }
1591   2            
1592   2          if((Nochange_Times>900) || (No_ReadData_SHIDU_Times>20) || (RT_Temp_Not_Updated_10mS > 3000))//ÈËÌå¶ËÊª¶
             -È´«¸ÐÆ÷´íÎó¼ì²â
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 27  

1593   2          {
1594   3            SHIDU_Sensor_Err=1;
1595   3            RTD_Sensor_Err=1;
1596   3            RT_SHIDU = 0; 
1597   3            HiTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²â¸ßÎÂ±¨¾¯
1598   3            LoTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1599   3            LoHumity_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÊª±¨¾¯
1600   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1601   3            Set_bit(ERR_Kind,Alarm_Const_RTD_Sensor); 
1602   3          }   
1603   2          else
1604   2          {
1605   3            SHIDU_Sensor_Err=0;
1606   3            Clear_bit(ERR_Kind,Alarm_Const_RTD_Sensor); 
1607   3          }
1608   2            
1609   2          if((Nochange_Times>900) ||  (No_ReadData_Temp_Times>20) 
1610   2          || (ERR_RT_Temp_Times>20) || (RT_Temp_Not_Updated_10mS > 3000))//ÈËÌå¶ËÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â 2014-07-03
1611   2          {
1612   3            RTD_Sensor_Err=1;
1613   3            if(ERR_RT_Temp_Times<10)//¸ßÎÂÒì³£±¨¾¯Ê±ÎÂ¶È²»ÇåÁã
1614   3            {
1615   4              RT_Temp = 0;    
1616   4              Diplay_RTtemp = 0;
1617   4            }
1618   3            HiTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²â¸ßÎÂ±¨¾¯
1619   3            LoTemp_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÎÂ±¨¾¯
1620   3            LoHumity_Count = 0;//´«¸ÐÆ÷´íÎó,²»¿É¼ì²âµÍÊª±¨¾¯
1621   3            Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1622   3          }
1623   2          else
1624   2          {
1625   3            RTD_Sensor_Err=0;
1626   3          }
1627   2            
1628   2          
1629   2          if( (No_HeatSensor_Times>150) || (JRP_Sensor_Temp_No_Change_Times > 600))//¼ÓÈÈÅÌ´«¸ÐÆ÷´íÎó¼ì²â  
1630   2          {     
1631   3            JRP_Sensor_Err=1;
1632   3            Set_bit(ERR_Kind,Alarm_Const_JRP_Sensor); 
1633   3          }
1634   2          else
1635   2          {
1636   3            JRP_Sensor_Err=0;
1637   3            Clear_bit(ERR_Kind,Alarm_Const_JRP_Sensor); 
1638   3          }
1639   2          if(HiTemp_Count>2)  //¸ßÎÂ´íÎó¼ì²â
1640   2          {
1641   3            Set_bit(ERR_Kind,Alarm_Const_HiTemp);
1642   3          }
1643   2          else
1644   2          {
1645   3            Clear_bit(ERR_Kind,Alarm_Const_HiTemp);
1646   3          }
1647   2            
1648   2          
1649   2          if(LoTemp_Count>120)  //µÍÎÂ´íÎó¼ì²â
1650   2          {
1651   3            Set_bit(ERR_Kind,Alarm_Const_LoTemp);
1652   3          } 
1653   2          else
1654   2          {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 28  

1655   3            Clear_bit(ERR_Kind,Alarm_Const_LoTemp);
1656   3          }
1657   2            
1658   2      
1659   2          if(LoHumity_Count>120) //µÍÊª¶È´íÎó¼ì²â
1660   2          {
1661   3            Set_bit(ERR_Kind,Alarm_Const_LoHumity);//ÉèÖÃµÍÊª¶È±¨¾¯±êÖ¾
1662   3          }
1663   2          else
1664   2          {
1665   3            if (Bit_is_one(ERR_Kind,Alarm_Const_LoHumity)!=(uint8_t)0)
1666   3            {
1667   4              Clear_bit(ERR_Kind,Alarm_Const_LoHumity);//Çå³ýµÍÊª¶È±¨¾¯±êÖ¾
1668   4            }
1669   3          }
1670   2      
1671   2        //É«¿é±¨¾¯  VHB15A_FUNCTION_ALARM_COLOR_DISPLAY
1672   2        /*ÈËÌåÌ½Í·³ö´í    ---ºì
1673   2         ³öÆø¿ÚÌ½Í·³ö´í   ---ÂÌ
1674   2         ¼ÓÈÈÅÌÌ½Í·³ö´í   ---À¶
1675   2         ¸ßÎÂ±¨¾¯       ---ºÚ
1676   2         µÍÎÂ±¨¾¯       ---»Ò
1677   2         µÍÊª¶È±¨¾¯     ---»Æ
1678   2         Ë®¹ÞÎ´°²×°ºÃ±¨¾¯   ---Çà
1679   2         ·¢ÈÈÏßÎ´°²×°»ò¿ªÂ· ---×Ï
1680   2         ÎÞË®/¸ÉÉÕ        ---ºÚ
1681   2        */
1682   2        
1683   2          if(Work_State != UI_STATE_SCREENSAVER_MODE)//ÆÁ±£Ê±²»ÏÔÊ¾
1684   2          {
1685   3            if((SHIDU_Sensor_Err==1)||(RTD_Sensor_Err)) //ÈËÌå¶ËÌ½Í·
1686   3            {
1687   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+5,RED18);
1688   4            }
1689   3            if(CQK_Sensor_Err==1)//³öÆø¿ÚÌ½Í·
1690   3            {
1691   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+5,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+10,GREEN18);
1692   4            }
1693   3            if(JRP_Sensor_Err==1)//¼ÓÈÈÅÌÌ½Í·
1694   3            {
1695   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+10,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+15,BLUE18);
1696   4            }
1697   3            if(HiTemp_Count>2)//¸ßÎÂ
1698   3            {
1699   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+15,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+20,BLACK18);
1700   4            }
1701   3            if(LoTemp_Count>120)//µÍÎÂ
1702   3            {
1703   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+20,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+25,GRAY18);
1704   4            }
1705   3            if(LoHumity_Count>120)//µÍÊª¶È
1706   3            {
1707   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+25,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+30,YELLOW18)
             -;
1708   4            }
1709   3            if(HeaterPlate_State==0)//Ë®¹ÞÎ´×°ºÃ»ò·¢ÈÈÅÌ¿ªÂ·
1710   3            {
1711   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+30,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+35,BRIGHT_BL
             -UE18);
1712   4            }
1713   3            if(Wire_Mode_Mismatch == 1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä 
1714   3            {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 29  

1715   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+35,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+40,PURPLE18)
             -;
1716   4            }
1717   3            if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®(¸ÉÉÕ)±¨¾¯
1718   3            {
1719   4              Draw_Rectangle_Real(POS_ALARM_COL_X,POS_ALARM_COL_Y+40,POS_ALARM_COL_X+10,POS_ALARM_COL_Y+45,BLACK18);
1720   4            } 
1721   3          }
1722   2      
1723   2      
1724   2          if(HeaterPlate_State==0)  //Ã»ÓÐ·ÅÈë¹Þ×Ó
1725   2          {
1726   3            AlarmInfoIndex = 1;
1727   3          }
1728   2          else if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®´íÎó
1729   2          {
1730   3            AlarmInfoIndex = 2;
1731   3          }
1732   2          else if(CQK_Sensor_Err || RTD_Sensor_Err || SHIDU_Sensor_Err)
1733   2          {
1734   3            AlarmInfoIndex = 3;
1735   3          } 
1736   2          else if(Bit_is_one(ERR_Kind,Alarm_Const_HiTemp)!=(uint8_t)0) //¸ßÎÂ´íÎó
1737   2          {
1738   3            AlarmInfoIndex = 4;
1739   3          }
1740   2          else if(Bit_is_one(ERR_Kind,Alarm_Const_LoTemp)!=(uint8_t)0) //»¼Õß¶Ë³ÖÐøµÍÎÂ
1741   2          {
1742   3            AlarmInfoIndex = 5;
1743   3          }
1744   2          else if(LoTemp_CQK_Count>120)//³öÆø¿Ú³ÖÐøµÍÎÂ
1745   2          {
1746   3            AlarmInfoIndex = 6;
1747   3          } 
1748   2          else if(Bit_is_one(ERR_Kind,Alarm_Const_LoHumity)!=(uint8_t)0)//³ÖÐøµÍÊª¶È´íÎó
1749   2          {
1750   3            AlarmInfoIndex = 7;
1751   3          }
1752   2          else if(Wire_Mode_Mismatch == 1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä  
1753   2          {
1754   3            AlarmInfoIndex = 8;
1755   3          } 
1756   2          else
1757   2          {
1758   3            AlarmInfoIndex = 0;
1759   3            AlarmSoundPauseStatus = 0;//ÎÞ±¨¾¯£¬²»¿ÉÉùÒôÔÝÍ£
1760   3          }
1761   2      
1762   2          if(AlarmInfoIndex !=  AlarmInfoRem)//±¨¾¯×´Ì¬¸Ä±ä
1763   2          {
1764   3            AlarmSoundPauseStatus = 0;//ÉùÒôÔÝÍ£È¡Ïû
1765   3            Sound_Alarm_Pause_Disable();  
1766   3          } 
1767   2                
1768   2          AlarmInfoRem = AlarmInfoIndex;
1769   2          
1770   2        
1771   2          //´«¸ÐÆ÷´íÎó==============================================================
1772   2          ERR_Kind&=0xFE;  ////Çå³ýµÚÒ»Î»ÊÇ´«¸ÐÆ÷´íÎó
1773   2          if(CQK_Sensor_Err || RTD_Sensor_Err || JRP_Sensor_Err || SHIDU_Sensor_Err)
1774   2          {
1775   3            ERR_Kind|=0x01;//µÚÒ»Î»ÊÇ´«¸ÐÆ÷´íÎó
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 30  

1776   3          } 
1777   2      
1778   2          if(Work_State != UI_STATE_SCREENSAVER_MODE)//·ÇÆÁ±£Ä£Ê½£¬·ñÔòÒªÏÈÍË³öÆÁ±£Ä£Ê½
1779   2          { 
1780   3            if(HeaterPlate_State==0)    //ÎÞ¼ÓÈÈÅÌ£¬ÏÔÊ¾ËùÓÐµÄÍ¼Æ¬   Plate_State==0
1781   3            {
1782   4              Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã
1783   4      
1784   4              if(Work_State != UI_STATE_SCREENSAVER_MODE)
1785   4              {
1786   5                if(Disp_ERR_VHB80_Code!=1)
1787   5                {
1788   6                  Disp_ERR_VHB80_Code=1;
1789   6                  DISP_VHB80_PIC(BLUE18); 
1790   6      
1791   6                  if(Wire_Mode_Sel_Rem != (uint8_t)Wire_Mode_Sel)
1792   6                  {
1793   7                    if(Wire_Mode_Sel == Wire_Sel_None)
1794   7                    { 
1795   8                      if(Err_Event_Cnt == Err_Event_1) //ÎÞ¼ÓÈÈ
1796   8                      { 
1797   9                        Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,GRAY18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²
             -¿
1798   9                        Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,GRAY18); 
1799   9                      }
1800   8                    } 
1801   7      
1802   7                    if((Wire_Mode_Sel==Wire_Sel_In_Only) || (Wire_Mode_Sel== Wire_Sel_None))
1803   7                    {
1804   8                      if(Err_Event_Cnt == Err_Event_1)
1805   8                      {
1806   9                        Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²
             -¿
1807   9                        Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ
             -²¿
1808   9                        Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú         
             -      
1809   9                      }
1810   8                    }
1811   7                  }
1812   6                  Wire_Mode_Sel_Rem = (uint8_t)Wire_Mode_Sel;                
1813   6                }
1814   5                if(Err_Event_Cnt == Err_Event_1)     
1815   5                {
1816   6                  color=RED18;//¸ÄÑÕÉ«
1817   6                }
1818   5                else if(Err_Event_Cnt == Err_Event_2)
1819   5                {
1820   6                  color=GRAY18;
1821   6                }
1822   5                else 
1823   5                {
1824   6                  //do nothing
1825   6                }
1826   5      
1827   5                //         if((Err_Event_Cnt == Err_Event_1)||(Err_Event_Cnt == Err_Event_2))
1828   5                DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color); 
1829   5              }
1830   4              else
1831   4              {
1832   5                Disp_ERR_VHB80_Code = 0;        
1833   5              }     
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 31  

1834   4            }
1835   3            else  if(Bit_is_one(ERR_Kind,Alarm_Const_NoWater)!=(uint8_t)0) //ÎÞË®(¸ÉÉÕ)±¨¾¯
1836   3            // if(0)
1837   3            {
1838   4              //ÏÔÊ¾ÎÞË®´íÎó================================
1839   4              if(Disp_ERR_VHB80_Code!=2)
1840   4              {
1841   5                Disp_ERR_VHB80_Code=2; 
1842   5                DISP_VHB80_PIC(BLUE18);
1843   5              }
1844   4              if(Err_Event_Cnt == Err_Event_1)
1845   4              {
1846   5                color=RED18;          //ÎÞË®´íÎó¸ÄÎªºìÉ«
1847   5              }
1848   4              else if(Err_Event_Cnt == Err_Event_2)
1849   4              {
1850   5                color=WHITE18;
1851   5              }
1852   4              else 
1853   4              {
1854   5                //do nothing
1855   5              }
1856   4              Draw_Rectangle_Real(POS_HEAT_X,POS_HEAT_Y+2,POS_HEAT_X+8,POS_HEAT_Y+33,color);
1857   4                    
1858   4            }
1859   3            else if(CQK_Sensor_Err || RTD_Sensor_Err || SHIDU_Sensor_Err  ||(HiTemp_Count>2) || (LoTemp_Count>120) 
             -||(LoTemp_CQK_Count>120)) //Ì½Í·´íÎó»ò¸ßµÍÎÂ±¨¾¯
1860   3            //   || Heat_ERR
1861   3            //else if(0)
1862   3            {
1863   4              //ÏÔÊ¾Í¼ÐÎ£¬ÉÁË¸´íÎó²¿·Ö==========================================
1864   4              if(Disp_ERR_VHB80_Code!=3)
1865   4              {
1866   5                Disp_ERR_VHB80_Code=3; 
1867   5                DISP_VHB80_PIC(GRAY18);
1868   5              }     
1869   4      
1870   4              if(Err_Event_Cnt == Err_Event_1)
1871   4              {
1872   5                color=RED18;  //ºì
1873   5              }
1874   4              else if(Err_Event_Cnt == Err_Event_2)
1875   4              {
1876   5                color=GRAY18; //»Ò
1877   5              }
1878   4              else
1879   4              {
1880   5                //do nothing
1881   5              }
1882   4      
1883   4      
1884   4              {
1885   5      
1886   5                if(CQK_Sensor_Err||(LoTemp_CQK_Count>120))//ÏÔÊ¾³öÆø¿Ú´íÎó///
1887   5                {
1888   6                  DISP_CQK25X24(POS_CQK_X,POS_CQK_Y,color);
1889   6                }else
1890   5                {
1891   6                  DISP_CQK25X24(POS_CQK_X,POS_CQK_Y,GRAY18);
1892   6                } 
1893   5                if(RTD_Sensor_Err||(HiTemp_Count>2) || (LoTemp_Count>120))  //ÈËÌå¶ËÌ½Í·´íÎó
1894   5                { 
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 32  

1895   6                  DISP_RTD28X24(POS_RTD_X,POS_RTD_Y,color);
1896   6                }else
1897   5                {
1898   6                  DISP_RTD28X24(POS_RTD_X,POS_RTD_Y,GRAY18);
1899   6                } 
1900   5                if(JRP_Sensor_Err) //¼ÓÈÈÅÌÌ½Í·
1901   5                {
1902   6                  //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color);  
1903   6                  DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,GRAY18);
1904   6                  //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,RED18); 
1905   6                }else
1906   5                {
1907   6                  DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,GRAY18); 
1908   6                  //DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,RED18);          
1909   6                } 
1910   5              }
1911   4            }
1912   3            else if(Wire_Mode_Mismatch == 1)//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä  
1913   3              //else if(0)
1914   3            {
1915   4              Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã 
1916   4      
1917   4              {
1918   5                if(Disp_ERR_VHB80_Code!=4)
1919   5                {
1920   6                  Disp_ERR_VHB80_Code=4; 
1921   6                  DISP_VHB80_PIC(BLUE18);
1922   6                }
1923   5      
1924   5                //»­In¼ÓÈÈÏß¶Î
1925   5                if(WireIn_State > 0)//ÓÐIn»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾À¶É«
1926   5                {
1927   6                  color=BLUE18;
1928   6                }
1929   5                else
1930   5                {
1931   6                  color=GRAY18;//ÎÞIn»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾»ÒÉ«
1932   6                }
1933   5                if(Err_Event_Cnt <= Err_Event_1)//ÏÔÊ¾µ±Ç°×´Ì¬£¬ÓÐ»òÕßÎÞ£¬À¶É«»ò»ÒÉ«
1934   5                {//°´ÉÏÃæµÄÑÕÉ«ÏÔÊ¾
1935   6                }               
1936   5                else if(Err_Event_Cnt <= Err_Event_2)//¸ù¾ÝÄ£Ê½È·¶¨ÏÔÊ¾ºìÉ«±¨¾¯»¹ÊÇµ±Ç°×´Ì¬ÑÕÉ«
1937   5                {
1938   6                  if(((WireIn_State == 0)&&(Wire_Mode_Sel == Wire_Sel_None))//ÎÞIn»ØÂ··¢ÈÈË¿ÇÒÊÇNoneÄ£Ê½²»ÐèÒª±¨¾¯
1939   6                    ||((WireIn_State == 1)&&(Wire_Mode_Sel == Wire_Sel_Double))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇË«Ö§Ä£Ê½²»ÐèÒª±¨¾¯
1940   6                    ||((WireIn_State == 1)&&(Wire_Mode_Sel == Wire_Sel_In_Only)))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇµ¥Ö§Ä£Ê½²»ÐèÒª±¨¾¯
1941   6                  
1942   6                  {
1943   7                  }
1944   6                  else//³ýÒÔÉÏÇé¿ö¾ùÐèÒª±¨¾¯:ÈçÎÞInÊ±µ¥/Ë«Ö§/Un,ÓÐInÊ±None/Un
1945   6                  {
1946   7                    color=RED18;
1947   7                  }
1948   6                }
1949   5                else 
1950   5                {
1951   6                  //do nothing
1952   6                }
1953   5                
1954   5                Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,color);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1955   5                Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,color);       
1956   5            
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 33  

1957   5                  
1958   5                 //»­Exp¼ÓÈÈÏß¶Î
1959   5                if(WireOut_State > 0)//ÓÐOut»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾À¶É«
1960   5                {
1961   6                  color=BLUE18;
1962   6                }
1963   5                else
1964   5                {
1965   6                  color=GRAY18;//ÎÞOut»ØÂ··¢ÈÈË¿£¬ÏÔÊ¾»ÒÉ«
1966   6                }
1967   5                if(Err_Event_Cnt <= Err_Event_1)//ÏÔÊ¾µ±Ç°×´Ì¬£¬ÓÐ»òÕßÎÞ£¬À¶É«»ò»ÒÉ«
1968   5                {//°´ÉÏÃæµÄÑÕÉ«ÏÔÊ¾
1969   6                }               
1970   5                else if(Err_Event_Cnt <= Err_Event_2)//¸ù¾ÝÄ£Ê½È·¶¨ÏÔÊ¾ºìÉ«±¨¾¯»¹ÊÇµ±Ç°×´Ì¬ÑÕÉ«
1971   5                {
1972   6                  if(((WireOut_State == 0)&&(Wire_Mode_Sel == Wire_Sel_None))//ÎÞOut»ØÂ··¢ÈÈË¿ÇÒÊÇNoneÄ£Ê½²»ÐèÒª±¨¾¯
1973   6                    ||((WireOut_State == 0)&&(Wire_Mode_Sel == Wire_Sel_In_Only))//ÎÞOut»ØÂ··¢ÈÈË¿ÇÒÊÇµ¥Ö§Ä£Ê½²»ÐèÒª±¨¾
             -¯
1974   6                    ||((WireOut_State == 1)&&(Wire_Mode_Sel == Wire_Sel_Double)))//ÓÐIn»ØÂ··¢ÈÈË¿ÇÒÊÇË«Ö§Ä£Ê½²»ÐèÒª±¨¾¯
             -              
1975   6                  
1976   6                  {
1977   7                  }
1978   6                  else//³ýÒÔÉÏÇé¿ö¾ùÐèÒª±¨¾¯:ÈçÎÞOutÊ±Ë«Ö§/Un,ÓÐOutÊ±µ¥/None/Un
1979   6                  {
1980   7                    color=RED18;
1981   7                  }
1982   6                }
1983   5                else
1984   5                {
1985   6                  //do nothing
1986   6                }
1987   5                  
1988   5                Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,color);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1989   5                Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,color);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
1990   5                Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,color);  //»­·â¿Ú 
1991   5              }        
1992   4            }
1993   3            else if(JRP_Sensor_Err)//¼ÓÈÈÅÌÌ½Í·´íÎó
1994   3            {
1995   4              Working_Normal = 0;//Õý³£¹¤×÷Ê±¼äÇåÁã   
1996   4              //ÏÔÊ¾Í¼ÐÎ£¬ÉÁË¸´íÎó²¿·Ö==========================================
1997   4              if(Disp_ERR_VHB80_Code!=5)
1998   4              {
1999   5                Disp_ERR_VHB80_Code=5; 
2000   5                DISP_VHB80_PIC(GRAY18);
2001   5              } 
2002   4              if(Err_Event_Cnt == Err_Event_1)
2003   4              {
2004   5                  //color=RED18;  //ºì
2005   5                color=BLUE18; //»Ò
2006   5              }
2007   4              //else
2008   4              else if(Err_Event_Cnt == Err_Event_2)
2009   4              {
2010   5                color=GRAY18; //»Ò
2011   5              }
2012   4              else
2013   4              {
2014   5                //do nothing
2015   5              }
2016   4              DISP_HEAT_36X24(POS_HEAT_X,POS_HEAT_Y,color);   
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 34  

2017   4           
2018   4            }
2019   3            else if((Wire_Mode_Sel==Wire_Sel_In_Only) || (Wire_Mode_Sel== Wire_Sel_None))//¾­¹ýÈ·ÈÏºóµÄµ¥Ö§¼ÓÈÈ»òÎÞ
             -¼ÓÈÈ»ØÂ·  
2020   3            { 
2021   4      
2022   4              if(Work_State != UI_STATE_SCREENSAVER_MODE)  //Ã»ÓÐÆÁÄ»±£»¤Ê±²ÅÄÜÏÔÊ¾¼ÓÈÈÄ£Ê½
2023   4              {
2024   5                if(Disp_ERR_VHB80_Code!=6)
2025   5                {
2026   6                  Disp_ERR_VHB80_Code=6; 
2027   6                  DISP_VHB80_PIC(BLUE18);
2028   6                }
2029   5      
2030   5                //»­¼ÓÈÈÏß 
2031   5                if(Err_Event_Cnt == Err_Event_1) //   
2032   5                { 
2033   6                  if(Wire_Mode_Sel_Rem != (uint8_t)Wire_Mode_Sel)
2034   6                  {        
2035   7                    if(Wire_Mode_Sel == Wire_Sel_None)//ÎÞ¼ÓÈÈË¿
2036   7                    { 
2037   8                      Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,GRAY18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2038   8                      Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,GRAY18); 
2039   8                    
2040   8                      Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2041   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²
             -¿
2042   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú        
2043   8                    } 
2044   7                    else if(Wire_Mode_Sel==Wire_Sel_In_Only)
2045   7                    {
2046   8                      Draw_Rectangle_Real(POS_XQGS_X1,POS_XQGS_Y1,POS_XQGS_X2,POS_XQGS_Y2,BLUE18);  //»­ÎüÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2047   8                      Draw_Rectangle_Real(POS_XQGX_X1,POS_XQGX_Y1,POS_XQGX_X2,POS_XQGX_Y2,BLUE18); 
2048   8                      
2049   8                      Draw_Rectangle_Real(POS_CQGS_X1,POS_CQGS_Y1,POS_CQGS_X2,POS_CQGS_Y2,GRAY18);  //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²¿
2050   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGX_X2,POS_CQGX_Y2,GRAY18);   //»­³öÆø¹ÜÉÏ²¿£¬ÏÂ²
             -¿
2051   8                      Draw_Rectangle_Real(POS_CQGX_X1,POS_CQGX_Y1,POS_CQGS_X2,POS_CQGX_Y1+1,GRAY18);  //»­·â¿Ú 
2052   8                    }
2053   7                    else
2054   7                    {
2055   8                      //do nothing
2056   8                    }
2057   7                  }
2058   6                  Wire_Mode_Sel_Rem = (uint8_t)Wire_Mode_Sel;
2059   6                } 
2060   5              }     
2061   4            }
2062   3            else   //Ïû³ýËùÓÐ´íÎóÏÔÊ¾
2063   3            {
2064   4              if(Disp_ERR_VHB80_Code!=0)
2065   4              {
2066   5                Disp_ERR_VHB80_Code=0;
2067   5                DISP_VHB80_PIC(WHITE18);        
2068   5              }     
2069   4            }
2070   3          }
2071   2         //DISP_TIME_10X16(POS_RT_RH_X,POS_RT_RH_Y+145,Disp_ERR_VHB80_Code,BLACK18);
2072   2        }
2073   1      }   
2074          
2075          //void Event_1s(void)       //1ÃëÖÓÊÂ¼þ ÄÚ²¿¶¨Ê±ÖÐ¶ÏÖÃ±êÖ¾
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 35  

2076          void LowTempDet1SFunc(void)
2077          {
2078   1        uint16_t a=0,b=0,c=0;//³öÆø¿ÚÎÂ¶È´ïµ½Éè¶¨ÎÂ¶È-1
2079   1        static uint8_t     No_Water_Times=0;  
2080   1        static uint8_t RT_SHIDU_More_then_90_Cnt = 0;//Á¬Ðø³¬¹ý90%´ïµ½10´Î(1Ãë1´Î)  
2081   1        static uint16_t     Last1s_RThumity=0;
2082   1        static uint16_t     Last1s_RTtemp=0;
2083   1      
2084   1        if(Working_Normal < 65000)
2085   1        {
2086   2          Working_Normal++;
2087   2        }
2088   1      
2089   1      
2090   1        if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == 1))
2091   1        {
2092   2          LCD_ShowxNum(105,180,16,3,RT_Temp_Reach_Set_Cnt,0x80,BLACK18); //
2093   2          LCD_ShowxNum(105,215,16,3,LoTemp_Count,0x80,BLACK18); //  
2094   2        }
2095   1      
2096   1      
2097   1        if(Wire_Warm_Up_Sec < 900)
2098   1        {
2099   2          Wire_Warm_Up_Sec++;
2100   2        }
2101   1      
2102   1        if(Plate_Warm_Up_Sec < 900)
2103   1        {
2104   2          Plate_Warm_Up_Sec++;
2105   2        }
2106   1        Humidity_No_Change_Sec++;//Êª¶È²»¸Ä±äµÄ¼ÆÊý£¬µ±´óÓÚ600Ê±¿ÉÄÜÌ½Í·Ê§Ð§£¬Êª¶È¿ØÖÆÊ§Ð§
2107   1        
2108   1        if(HeaterPlate_State!=(uint8_t)0)  //
2109   1        { 
2110   2          if((Last1s_RThumity==CONTROL_RT_SHIDU) && (Last1s_RTtemp==(uint16_t)RT_Temp)) //ÈËÌå¶ËÎÂ¶ÈºÍÊª¶ÈÍ¬Ê±²»¸Ä
             -±ä
2111   2          {
2112   3            if(Nochange_Times<1000)
2113   3            {
2114   4              Nochange_Times++;
2115   4            }       
2116   3          }
2117   2          else
2118   2          { 
2119   3            Nochange_Times=0;
2120   3          } 
2121   2          
2122   2      
2123   2          //Last1s_RThumity=RT_SHIDU;
2124   2          Last1s_RThumity=CONTROL_RT_SHIDU;
2125   2          Last1s_RTtemp=(uint16_t)RT_Temp;
2126   2        }
2127   1        else
2128   1        {
2129   2          Nochange_Times=0;
2130   2        }
2131   1       
2132   1        //ÎÞË®±¨¾¯,Ó¦Í¨¹ý¼ÓÈÈÅÌµÄ¼ÓÈÈÉÏÉýËÙ¶ÈÅÐ¶ÏË®Á¿======================================
2133   1        //´ÓÓÐË®µ½ÎÞË®£¬ÈËÌå¶ËÎÂ¶ÈÓ¦¸Ã»á½µµÍ,½µµÍµÄ·ù¶È¹À¼ÆÔÚ3¶ÈÒÔÉÏ
2134   1        //ÓÐ¼ÓÈÈË¿µÄÎÞË®ÅÐ¶Ï£¬³öÆø¿ÚÎÂ¶È¸ßÓÚÈËÌå¶ËÎÂ¶È£¬¼ÓÈÈÅÌÎÂ¶ÈÔÚ100¶ÈÒÔÉÏ£¬ÈËÌå¶ËÊª¶ÈµÍÓÚ80%£¬»òÕßÓÐ20%×óÓÒµÄ
             -ÏÂ½µ
2135   1        //ÎÞ¼ÓÈÈË¿µÄÅÐ¶Ï£¬Èç¹ûË®·Ö²»¹»£¬¹À¼ÆÊÇÈËÌå¶ËÎÂ¶È½ÏµÍ£¬¼ÓÈÈÅÌÎÂ¶ÈÔÚ100¶ÈÒÔÉÏ
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 36  

2136   1        if(HeaterPlate_State!=(uint8_t)0)
2137   1        {
2138   2          //do nothing
2139   2        }
2140   1        else
2141   1        {     
2142   2          Clear_bit(ERR_Kind,Alarm_Const_NoWater);    
2143   2        } 
2144   1         
2145   1        if(RT_SHIDU >= 900) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»ÒªÊª¶È´ïµ½90%³ÖÐø10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2146   1        {    
2147   2          RT_SHIDU_More_then_90_Cnt++;
2148   2          if(RT_SHIDU_More_then_90_Cnt >= 10)//Á¬Ðø10Ãë³¬¹ý90%
2149   2          {
2150   3            RT_SHIDU_More_then_90_Cnt = 10;
2151   3          }
2152   2        }
2153   1        else
2154   1        {
2155   2          if(RT_SHIDU_More_then_90_Cnt < 10)//Ð¡ÓÚ90%ÇÒÔÚ10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2156   2          {
2157   3            RT_SHIDU_More_then_90_Cnt = 0;
2158   3          }
2159   2        }    
2160   1      
2161   1        //¸ÉÉÕ±¨¾¯  <60% 
2162   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0) //|| RT_SHIDU_More_then_90_Cnt >= 10)
2163   1        if(Working_Normal >= 1200)
2164   1        {
2165   2          if(RT_SHIDU<600) //Á¬Ðø2·ÖÖÓÉÙÓÚ60%±¨¾¯  ÈÏÎªÊÇ¸ÉÉÕ£¬±ØÐëÖØÆô»úÆ÷
2166   2          {           
2167   3            if(No_Water_Times<240) 
2168   3            {
2169   4              No_Water_Times++;
2170   4            }       
2171   3            if(RTD_Sensor_Err || SHIDU_Sensor_Err) //´«¸ÐÆ÷´íÎó²»¿ÉÒÀÊª¶ÈÀ´¼ì²âÎÞË®±¨¾¯
2172   3            {
2173   4              No_Water_Times = 0;
2174   4            }
2175   3          }
2176   2          else
2177   2          {
2178   3            No_Water_Times=0;
2179   3          }
2180   2          if( No_Water_Times>=120)
2181   2          {
2182   3            Set_bit(ERR_Kind,Alarm_Const_NoWater);
2183   3          } 
2184   2        }
2185   1         
2186   1        if(RT_SHIDU>650)//ÎÂ¶È´óÓÚ65%£¬È¡ÏûÎÞË®±¨¾¯
2187   1        {
2188   2         No_Water_Times=0;
2189   2         Clear_bit(ERR_Kind,Alarm_Const_NoWater);
2190   2        }
2191   1      
2192   1        //============================================================
2193   1        //ÈËÌå¶ËÎÂ¶È´ïµ½Ê¶±ð180S 
2194   1        //if(Work_Mode==Invasive_Mode) //ÓÐ´´Ä£Ê½
2195   1        //if(1) //
2196   1        {
2197   2          if(RT_Temp >= (Set_RT_Temp - 15)) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È-1.5¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 37  

2198   2          {    
2199   3            RT_Temp_Reach_Set_Cnt++;
2200   3            if(RT_Temp_Reach_Set_Cnt >= 180)//Á¬Ðø180Ãë³¬¹ýÉè¶¨-1
2201   3            {
2202   4              RT_Temp_Reach_Set_Cnt = 180;
2203   4            }
2204   3          }
2205   2          else
2206   2          {
2207   3            if(RT_Temp_Reach_Set_Cnt < 180)//Ð¡ÓÚÉè¶¨ÇÒÔÚ10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2208   3            {
2209   4              RT_Temp_Reach_Set_Cnt = 0;
2210   4            }
2211   3          }
2212   2        } 
2213   1          
2214   1        if(Work_Mode==Noninvasive_Mode)//ÎÞ´´Ä£Ê½
2215   1        {
2216   2          a = Const_NoninvasPatientTemp_Max+10;//¸ßÎÂ±¨¾¯ÏÞÖµ
2217   2          if(WireIn_State!=0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2218   2          {
2219   3            b = Const_NoninvasPatientTemp_Min-10;//ÎÞ´´µÍÎÂ±¨¾¯ÏÞÖµ 29¶È
2220   3          }
2221   2          else 
2222   2          {
2223   3            b = 260;//ÎÞ»ØÂ·¼ÓÈÈË¿Ê±ÎÞ´´µÍÎÂ±¨¾¯Îª26¶È
2224   3          }
2225   2          //c = 700;//µÍÊª±¨¾¯ÏÞÖµ V2.0
2226   2          c = 300;//µÍÊª±¨¾¯ÏÞÖµ V2.02 ÎÞ´´Ä£Ê½È¡ÏûµÍÊª¶È±¨¾¯
2227   2        }
2228   1        else if(Work_Mode==Invasive_Mode) //ÓÐ´´Ä£Ê½
2229   1        {
2230   2          a = Const_InvasPatientTemp_Max+10;
2231   2          if(WireIn_State!=0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2232   2          {
2233   3            b = Const_InvasPatientTemp_Min-10;//ÓÐ´´µÍÎÂ±¨¾¯ÏÞÖµ 34¶È
2234   3          }
2235   2          else
2236   2          {
2237   3            b = 290;//ÎÞ»ØÂ·¼ÓÈÈË¿Ê±ÓÐ´´±¨¾¯Îª29¶È
2238   3          }
2239   2      
2240   2          c = 800;//µÍÊª±¨¾¯ÏÞÖµ
2241   2        }
2242   1        else
2243   1        {
2244   2          //do nothing
2245   2        }
2246   1      
2247   1        if(Diplay_RTtemp>a)
2248   1        {
2249   2          if(HiTemp_Count<240)
2250   2          {
2251   3            HiTemp_Count++;
2252   3          }     
2253   2        }else
2254   1        {
2255   2          HiTemp_Count=0;
2256   2        } 
2257   1          
2258   1      /*    
2259   1          ÎªÓ¦¶ÔÈÈ±ÈìÊ£¬Ôö¼ÓÐÂµÄµÍÎÂ±¨¾¯Âß¼­£¬ÐèÒªÍ¬Ê±Âú×ãÒÔÏÂÌõ¼þ´¥·¢µÍÎÂ±¨¾¯
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 38  

2260   1            1£¬ÓÐ´´Ä£Ê½
2261   1            2£¬µ¥Ö§»òË«Ö§¼ÓÈÈ»ØÂ·Ä£Ê½
2262   1            3£¬»¼Õß¶Ë´ïµ½Éè¶¨ÎÂ¶È-1¶È Á¬Ðø180S£¬·ÀÖ¹Îó¶¯×÷
2263   1            4£¬»¼Õß¶ËµÍÓÚÉè¶¨ÎÂ¶È-2¶ÈÇÒ»ØÂ·¼ÓÈÈ¹¦ÂÊÎªÈ«¹¦ÂÊ(190)Á¬Ðø10S*/
2264   1      
2265   1      //ÈËÌå¶ËµÍÎÂ±¨¾¯    
2266   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)// || RT_Temp_Reach_Set_Cnt >= 180)  //ÈËÌåµÍÎÂ±¨¾¯
2267   1        if(Working_Normal >= 1200)//20·ÖÖÓ
2268   1        {
2269   2          if((RT_Temp_Reach_Set_Cnt >= 180)//´ïµ½ÎÂ¶ÈÁ¬Ðø180S
2270   2          //&&(WireIn_State!=0)//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2271   2          &&(Diplay_RTtemp <= ((uint16_t)Set_RT_Temp - 30)))//ÎÂ¶ÈµÍÓÚÉè¶¨ÎÂ¶È3¶È //ÆøÔ´ÖÐ¶Ï»òÌ½Í·ÍÑÂä      
2272   2          {
2273   3            if(((WireIn_State!=0) && (Micro_Temp_In >= 190)))//ÓÐ¼ÓÈÈË¿µ¥Ö§»òË«Ö§
2274   3             //||(WireIn_State==0))//ÎÞ·¢ÈÈË¿²»Ò»¶¨ÊÇÈ«¹¦ÂÊ¼ÓÈÈ ÎÞ·¢ÈÈË¿²»Ê¹ÓÃ 
2275   3      
2276   3            {
2277   4              if(LoTemp_Count<240)
2278   4              {
2279   5                LoTemp_Count+= 12;  //µ±ÎÂ¶È´ïµ½Éè¶¨ÎÂ¶Èºó£¬Á¬Ðø10SÏÂ½µµ½Éè¶¨ÎÂ¶È-2.5¶È£¬µÍÎÂ±¨¾¯ 
2280   5              }         
2281   4            }
2282   3            else 
2283   3            {
2284   4             //if(LoTemp_Count<240) LoTemp_Count++; //µ±ÎÂ¶È´ïµ½Éè¶¨ÎÂ¶Èºó£¬Á¬Ðø10SÏÂ½µµ½Éè¶¨ÎÂ¶È-2.5¶È£¬µÍÎÂ±¨¾¯ 
2285   4            }
2286   3          }
2287   2          else if(Diplay_RTtemp<b)//55·ÖÖÓ¿ªÊ¼¼ì²âÎÂ¶È¹ýµÍ±¨¾¯
2288   2          {
2289   3            if(Working_Normal >= 3300)
2290   3            {
2291   4              if(LoTemp_Count<240) 
2292   4              {
2293   5                LoTemp_Count++;
2294   5              }
2295   4            }
2296   3          }
2297   2          else
2298   2          {
2299   3            LoTemp_Count=0;
2300   3          }
2301   2        }
2302   1        else
2303   1        {
2304   2          LoTemp_Count=0;
2305   2        }
2306   1      
2307   1      //ÈËÌå¶ËµÍÊª±¨¾¯      
2308   1        //if(Work_Min>=20||Work_Day>0 ||Work_Hour>0)// || RT_SHIDU_More_then_90_Cnt >= 10)   //ÈËÌåµÍÊª±¨¾¯
2309   1        if(Working_Normal >= 1200)
2310   1        {
2311   2          if(RT_SHIDU<c)    //2014-07-23    µÍÊª¶È±¨¾¯
2312   2          {
2313   3            if(LoHumity_Count<250) 
2314   3            {
2315   4              LoHumity_Count++;
2316   4            }       
2317   3          }
2318   2          else
2319   2          {
2320   3            LoHumity_Count=0;
2321   3          }
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 39  

2322   2        }
2323   1        else
2324   1        {
2325   2           LoHumity_Count=0;
2326   2        }  
2327   1       
2328   1      //³öÆø¿ÚµÍÎÂ±¨¾¯
2329   1        //if(CQK_Temp >= Set_CQK_Temp - 10) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2330   1        if(CQK_Temp >= 300) //±ãÓÚ¿ìËÙ¼ì²â£¬Ö»Òª´ïµ½Éè¶¨ÎÂ¶È10S£¬È»ºóÁ¬Ðø2·ÖÖÓÐ¡ÓÚ60%Ôò±¨¾¯
2331   1        {    
2332   2          CQK_Temp_Reach_Set_Cnt++;
2333   2          if(CQK_Temp_Reach_Set_Cnt >= 10)//Á¬Ðø10Ãë´ïµ½
2334   2          {
2335   3            CQK_Temp_Reach_Set_Cnt = 10;
2336   3          }
2337   2        }
2338   1        else
2339   1        {
2340   2          if(CQK_Temp_Reach_Set_Cnt < 10)//10´ÎÒÔÄÚÔòÇåÁã,10´ÎÒÔÉÏÔò²»ÇåÁã
2341   2          {
2342   3            CQK_Temp_Reach_Set_Cnt = 0;
2343   3          }
2344   2        } 
2345   1      
2346   1        if(Working_Normal >= 1200)
2347   1        {
2348   2          if((CQK_Temp < (Const_NoninvasChamberTemp_Min - 10))
2349   2           &&(Work_Mode==Invasive_Mode))//ÓÐ´´Ä£Ê½²ÅÓÐ³öÆø¿ÚµÍÎÂ±¨¾¯
2350   2          {
2351   3            if(LoTemp_CQK_Count<240)
2352   3            {
2353   4              if(CQK_Temp_Reach_Set_Cnt>= 10)//Èô´ïµ½¹ýÎÂ¶ÈÔò¼Ó¿ìËÙ¶È
2354   4              {
2355   5                //LoTemp_CQK_Count += 12;
2356   5                LoTemp_CQK_Count++;
2357   5              }
2358   4              else
2359   4              {
2360   5                LoTemp_CQK_Count++;
2361   5              }
2362   4            }
2363   3          }
2364   2          else
2365   2          {
2366   3            LoTemp_CQK_Count=0;
2367   3          }     
2368   2        }
2369   1        else
2370   1        {
2371   2          LoTemp_CQK_Count=0;
2372   2        }
2373   1      }
2374          
2375          void SaveDateToFlashFunc(void)
2376          {
2377   1        static uint8_t     Enable_Save_Data=0;  //±£´æÊý¾Ý¼ÆÊý
2378   1        uint16_t a,b,c;//
2379   1        UINT32 Adress;  
2380   1        if(Enable_Save_Data>=1)
2381   1        {
2382   2          Enable_Save_Data++;
2383   2          if(Enable_Save_Data>=10)
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 40  

2384   2          {
2385   3            Enable_Save_Data=0;
2386   3          }     
2387   2        }
2388   1        if(Enable_Save_Data==2)
2389   1        {
2390   2          if(((Run_Count-1)%256)==0)//Ò»¸öÉÈÇøÎª4K£¬Ã¿´Î´æ´¢µÄÊý¾ÝÎª16×Ö½Ú£¬¼´256×éÊý¾Ý¼´Îª4K 256*16=4096;
2391   2          {
2392   3            //Çå³ýÏÂÃæ256µÄÊý¾Ý
2393   3            Adress=Run_Count-1;  //¼ÙÉèÎª257-1=256
2394   3            Adress=(Adress<<4);  //  256*16= 4096
2395   3            Adress=Adress+0x2000;//ÆðÊ¼µØÖ·Îª0X2000£¬¼´8192Îª±£Áô×Ö½Ú
2396   3            SPI_Erase_Sector(Adress);
2397   3          }
2398   2        }
2399   1        else  if(Enable_Save_Data==3)//´æ·ÅÊý¾Ý
2400   1        {
2401   2          Adress=Run_Count-1;
2402   2          Adress=(Adress<<4);
2403   2          Adress=Adress+0x2000; 
2404   2           
2405   2          {
2406   3            RX8010_GetTime(SaveData);
2407   3      
2408   3            //LCD_ShowxNum(POS_RT_RH_X-40,5,16,3,SaveData[2],0x80,BLACK18); //
2409   3      
2410   3            a = ((SaveData[2]&0x0F)%10) + (((SaveData[2]>>4)& 0x03)*10);
2411   3            SaveData[2] = (uint8_t)a;//×ª»»Îª24Ð¡Ê±ÖÆÐ¡Ê±
2412   3      
2413   3            //LCD_ShowxNum(POS_RT_RH_X-40,45,16,3,SaveData[2],0x80,BLACK18); //
2414   3            
2415   3            if(SaveData[2] >= 12)
2416   3            {
2417   4              a = 0x80 | 0x20;//PM
2418   4              SaveData[2] -= 12;
2419   4            }
2420   3            else
2421   3            {
2422   4              a = 0x80;//AM
2423   4            }
2424   3            b = SaveData[2]/10;
2425   3            c = SaveData[2]%10;
2426   3            SaveData[2] = (uint8_t)(((b << 4) + c) | a);//Ê±¼ä×ª»»ÎªDS1302¸ñÊ½
2427   3             
2428   3             //LCD_ShowxNum(POS_RT_RH_X-40,95,16,3,SaveData[2],0x80,BLACK18); //
2429   3          }
2430   2              
2431   2          SaveData[7]=ERR_Kind;
2432   2          if(RTD_Sensor_Err) 
2433   2          {
2434   3            SaveData[7]|=0x20;
2435   3          }
2436   2          if(CQK_Sensor_Err)
2437   2          {
2438   3            SaveData[7]|=0x40;
2439   3          }     
2440   2          if(JRP_Sensor_Err)
2441   2          {
2442   3            SaveData[7]|=0x80;
2443   3          }             
2444   2          SaveData[8]=(uint8_t)(RT_Temp/256);
2445   2          SaveData[9]=(uint8_t)(RT_Temp%256);
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 41  

2446   2          SaveData[10]=(uint8_t)(RT_SHIDU/256);
2447   2          SaveData[11]=RT_SHIDU%256; 
2448   2          //SaveData[10]=CONTROL_RT_SHIDU/256;  //2015-06-04 ´æ´¢ÕæÊµµÄÊª¶È
2449   2          //SaveData[11]=CONTROL_RT_SHIDU%256; 
2450   2      
2451   2          SaveData[12]=(uint8_t)(CQK_Temp/256);     
2452   2          SaveData[13]=(uint8_t)(CQK_Temp%256);
2453   2          SaveData[14]=(uint8_t)(JEP_Temp/256);
2454   2          SaveData[15]=(uint8_t)(JEP_Temp%256);
2455   2          SPI_Write_nBytes(Adress,16,&SaveData[0]);
2456   2      
2457   2        }
2458   1        else if(Enable_Save_Data==4)  //´æ·ÅÊý¾ÝµØÖ·
2459   1        {
2460   2          Store_Data();      
2461   2        }
2462   1        else if(Enable_Save_Data==5)  //²Áµ÷Êý¾Ý
2463   1        {
2464   2          //Çå³ýËùÓÐÊý¾Ý,ÖØÐÂ¼ÆÊý
2465   2          if(Run_Count>=44896) 
2466   2          {
2467   3            SPI_Erase_Sector(0x000);
2468   3          }
2469   2        }
2470   1        else if(Enable_Save_Data==6)  //²Áµ÷Êý¾Ý
2471   1        {
2472   2          //Çå³ýËùÓÐÊý¾Ý,ÖØÐÂ¼ÆÊý
2473   2          if(Run_Count>=44896) 
2474   2          { 
2475   3            SPI_Erase_Sector(0x1000);        
2476   3            Run_Count=0;
2477   3          }  
2478   2        } 
2479   1        else if(Enable_Save_Data==9)  //²ÁÊý¾Ý
2480   1        {
2481   2          //do nothing
2482   2        } 
2483   1        else
2484   1        {
2485   2          //do nothing
2486   2        }
2487   1      }
2488          
2489          
2490          void  Init_port(void) //³õÊ¼»¯¶Ë¿Ú×´Ì¬--------------------------------
2491          {
2492   1        uint16_t j=0;
2493   1      
2494   1        P1M1=0x08;  //P13Îª¸ß×èÊäÈë Wire_out_FB
2495   1        P1M0=0x0;
2496   1        P2M1=0x70;//P24-P26È«Éè¶¨³É¿ªÂ©Êä³ö
2497   1        P2M0=0xF0;
2498   1        P3M1=0x18;  //P34,P33Îª¸ß×èÊäÈë Wire_In_FB  Plant_FB 
2499   1        P3M0=0x64;  //P35,P36,P32ÎªÇ¿Êä³ö  Heat_Plant_Out  Heat_Wire_In  Heat_JRP_EN_OUT  
2500   1        P4M1=0x00;  //IO Port initialization
2501   1        P4M0=0x09;  //P40,P43ÎªÇ¿Êä³ö
2502   1        P4SW=0x70;  
2503   1      
2504   1        WDT_CONTR = 0x3F; //WDT Enable(4.55S)   
2505   1        LCD_LIGHT_CLOSE;  
2506   1        Rec_Count=0;
2507   1        Buzzer_Port=0;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 42  

2508   1        Heat_JRP_Port=0;
2509   1        Heat_WireIn_Port=0;
2510   1        Heat_WireOut_Port=0;
2511   1        Heat_WIRE_EN_OUT = 1;
2512   1        EX1=1;
2513   1        IT1=1;   
2514   1        LCD_1DIR_L;     
2515   1        JEP_Temp=0;
2516   1        EA=1;  //
2517   1         
2518   1        EUSART_Initialize();//Uart initialization
2519   1        SPI_init();//SPI Flash initialization
2520   1        LCD_Initial();//TFT LCD initialization  
2521   1         
2522   1        //Holding down these two keys for three seconds at boot time will enter service mode. 
2523   1        if((KEY_LEFT_UP_IN==0)&&(KEY_LEFT_DOWN_IN==0))
2524   1        {
2525   2          Work_State = UI_STATE_SERVICE_MODE;
2526   2        }
2527   1        else
2528   1        {
2529   2          Work_State = UI_STATE_POST_MODE;
2530   2        }
2531   1        
2532   1      //Holding down these two keys for three seconds at boot time will enter Data Reading Interface. 
2533   1        if((KEY_LEFT_DOWN_IN==0) &&(KEY_RIGHT_DOWN_IN==0))
2534   1        {
2535   2          Work_State = UI_STATE_DATAREADER_MODE;//Êý¾Ý´«Êä½çÃæ
2536   2          ET0=0;
2537   2          TR0=0;
2538   2          Back_Color=WHITE18; 
2539   2      
2540   2          Draw_Rectangle_Real(0,0,239,319,WHITE18);
2541   2      //Display Data Reading Interface=============== DATA OUTPUT...
2542   2          for(j=4;j<8;j++)
2543   2          {
2544   3              DISP_FNT10X24(115,100+((j-4)*12),(uint8_t)j,BLUE18);
2545   3          }
2546   2          for(j=j;j<14;j++)
2547   2          {
2548   3              DISP_FNT10X24(115,100+((j-3)*12),(uint8_t)j,BLUE18);
2549   3          }   
2550   2          DISP_FNT10X24(115,100+(11*12),14,BLUE18);
2551   2          DISP_FNT10X24(115,100+(12*12),14,BLUE18);
2552   2          DISP_FNT10X24(115,100+(13*12),14,BLUE18); 
2553   2      
2554   2      //Display soft version
2555   2          LCD_Show_Verion();  
2556   2          LCD_LIGHT_OPEN;
2557   2        }
2558   1        
2559   1        Test_Mode_Dis_Jrp_Ctl = DISPLAY_TEST_DATA_EN_DIS_DEF; //LCD Displays Working Data at Runningtime
2560   1      }
2561          
2562          void  Main_Init(void) //Ö÷³ÌÐò³õÊ¼»¯
2563          {
2564   1        Get_RunCount();  //µÃµ½´æ·ÅÊý¾ÝµÄÌõÊý  
2565   1      
2566   1        Diplay_RTtemp = (uint16_t)RT_Temp;
2567   1        
2568   1        CQK_Sensor_Err=0;
2569   1        RTD_Sensor_Err=0;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 43  

2570   1        JRP_Sensor_Err=0;
2571   1        SHIDU_Sensor_Err=0;
2572   1      
2573   1        Back_Color=BRIGHT_BLUE18 ;
2574   1      
2575   1        WireOut_State=0;
2576   1        WireIn_State=0;   
2577   1      
2578   1        Wire_Mode_Sel = Wire_Sel_Double;//Ä¬ÈÏÎªË«Ö§¼ÓÈÈ»ØÂ·
2579   1        Wire_Mode_Mismatch = 0;//»ØÂ··¢ÈÈË¿Ä£Ê½ºÍÊµ¼Ê²»Æ¥Åä±êÖ¾
2580   1      
2581   1        Wire_Warm_Up_Sec = 0; //µ±<=300Ê±ÏÞÖÆ×î´ó¼ÓÈÈ¹¦ÂÊ
2582   1        Plate_Warm_Up_Sec = 0;
2583   1      
2584   1        Set_CQK_Temp_Comp = 360;//³õÊ¼»¯
2585   1        Humidity_No_Change_Sec = 0;//Êª¶È²»¸Ä±äµÄ¼ÆÊý 
2586   1        
2587   1        JEP_Temp_Aim = (INT)(Set_CQK_Temp + 100);     //¼ÓÈÈÅÌÄ¿±êÎÂ¶È 400 - 530
2588   1        Controler_temp3.Sum_error = 0;
2589   1        Controler_temp3.Ek = 0;
2590   1        Controler_temp3.Ek1 = 0;
2591   1        Controler_temp3.Ek2 = 0;
2592   1      }
2593          
2594          
2595          
2596          //²âÊÔÄ£Ê½Ê±ÏÔÊ¾ÎÂ¶È
2597          //ºÍÕý³£¹¤×÷Ê±µÄÇø±ðÔÚÓÚÊµÊ±ÐÔ
2598          void ServiceMode_TempHumidy_Disp(void)
2599          {
2600   1        uint16_t Disp,color;
2601   1      //  bit Disp_Err;
2602   1        Back_Color=WHITE18; 
2603   1      //  Disp_Err=0;   
2604   1      
2605   1        if((CQK_Temp>=0x0FFF) || (No_CQKSensor_Times>20) ) //³öÆø¿ÚÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â
2606   1        {
2607   2          CQK_Sensor_Err=1;
2608   2          CQK_Temp = 0;
2609   2        }
2610   1        else
2611   1        {
2612   2          CQK_Sensor_Err=0;
2613   2        }
2614   1          
2615   1        if(No_ReadData_SHIDU_Times>10)//ÈËÌå¶ËÊª¶È´«¸ÐÆ÷´íÎó¼ì²â
2616   1        {
2617   2          SHIDU_Sensor_Err=1;
2618   2          RT_SHIDU = 0; 
2619   2        }   
2620   1        else
2621   1        {
2622   2          SHIDU_Sensor_Err=0;
2623   2        }
2624   1      
2625   1        if((No_ReadData_Temp_Times>20) || (ERR_RT_Temp_Times>10))//ÈËÌå¶ËÎÂ¶È´«¸ÐÆ÷´íÎó¼ì²â 2014-07-03
2626   1        {    
2627   2          RTD_Sensor_Err=1;
2628   2          RT_Temp = 0;    
2629   2          Diplay_RTtemp = 0;
2630   2        }
2631   1        else
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 44  

2632   1        {
2633   2          RTD_Sensor_Err=0;
2634   2        }
2635   1          
2636   1            
2637   1        if( No_HeatSensor_Times>20)//¼ÓÈÈÅÌ´«¸ÐÆ÷´íÎó¼ì²â
2638   1        {
2639   2          JRP_Sensor_Err=1;
2640   2          JEP_Temp = 0;
2641   2        }
2642   1        else
2643   1        {
2644   2          JRP_Sensor_Err=0;
2645   2        }
2646   1          
2647   1      
2648   1        //ÈËÌå¶ËÎÂ¶È
2649   1        {
2650   2          Disp=(uint16_t)RT_Temp;
2651   2      //    Disp_Err=RTD_Sensor_Err;      
2652   2        }
2653   1        color=BLACK18;   
2654   1      
2655   1        if(Disp>=1000)
2656   1        {
2657   2          DISP_TEMP_30X56((POS_RT_TEMP_X-8),POS_RT_TEMP_Y,(Disp/1000)%10,(uint8_t)color);  
2658   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+34,(uint8_t)((Disp%1000)/100),(uint8_t)color);   
2659   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+73,(Disp%100)/10,(uint8_t)color);    
2660   2          Draw_Rectangle_Real(POS_RT_TEMP_X+1-8,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8-8,POS_RT_TEMP_Y+71,WHITE18); //È¥
             -µôÐ¡Êýµã
2661   2        }
2662   1        else
2663   1        {
2664   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y,(Disp/100)%10,(uint8_t)color);  
2665   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+34,Disp%100/10,(uint8_t)color);   
2666   2          DISP_TEMP_30X56(POS_RT_TEMP_X-8,POS_RT_TEMP_Y+(34*2)+5,Disp%10,(uint8_t)color);    
2667   2          Draw_Rectangle_Real(POS_RT_TEMP_X+1-8,POS_RT_TEMP_Y+67,POS_RT_TEMP_X+8-8,POS_RT_TEMP_Y+71,(uint8_t)color
             -); //»­µã
2668   2        }     
2669   1      
2670   1        //³öÆø¿ÚÎÂ¶È
2671   1        Disp=(uint16_t)CQK_Temp; 
2672   1        if(Disp>=1000)
2673   1        {
2674   2          DISP_RH_17X40(55,POS_RT_TEMP_Y,(Disp/1000)%10,(uint8_t)color);  
2675   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+20,(uint8_t)((Disp%1000)/100),(uint8_t)color);   
2676   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+(20*2)+5,(Disp%100)/10,(uint8_t)color);    
2677   2          Draw_Rectangle_Real(56,POS_RT_TEMP_Y+40,61,POS_RT_TEMP_Y+43,WHITE18); //È¥µôÐ¡Êýµã
2678   2        }
2679   1        else
2680   1        {
2681   2          DISP_RH_17X40(55,POS_RT_TEMP_Y,(Disp/100)%10,(uint8_t)color);  
2682   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+20,Disp%100/10,(uint8_t)color);   
2683   2          DISP_RH_17X40(55,POS_RT_TEMP_Y+(20*2)+5,Disp%10,(uint8_t)color);    
2684   2          Draw_Rectangle_Real(56,POS_RT_TEMP_Y+40,61,POS_RT_TEMP_Y+43,(uint8_t)color); //»­µã
2685   2        }
2686   1         
2687   1        //¼ÓÈÈÅÌÎÂ¶È
2688   1        Disp=(uint16_t)JEP_Temp;
2689   1        if(Disp>=1000)
2690   1        {
2691   2          DISP_RH_17X40(5,POS_RT_TEMP_Y,(Disp/1000)%10,(uint8_t)color);  
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 45  

2692   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+20,(uint8_t)((Disp%1000)/100),(uint8_t)color);   
2693   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+(20*2)+5,(Disp%100)/10,(uint8_t)color);    
2694   2          Draw_Rectangle_Real(51,POS_RT_TEMP_Y+40,56,POS_RT_TEMP_Y+43,WHITE18); //È¥µôÐ¡Êýµã
2695   2        }
2696   1        else
2697   1        {
2698   2          DISP_RH_17X40(5,POS_RT_TEMP_Y,(Disp/100)%10,(uint8_t)color);  
2699   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+20,Disp%100/10,(uint8_t)color);   
2700   2          DISP_RH_17X40(5,POS_RT_TEMP_Y+(20*2)+5,Disp%10,(uint8_t)color);    
2701   2          Draw_Rectangle_Real(6,POS_RT_TEMP_Y+40,11,POS_RT_TEMP_Y+43,(uint8_t)color); //»­µã
2702   2        } 
2703   1      
2704   1        //ÏÔÊ¾Êª¶È
2705   1        { 
2706   2          DISP_RH_17X40(POS_RT_RH_X+2,POS_RT_RH_Y,(uint8_t)(RT_SHIDU%1000/100),(uint8_t)color);
2707   2          DISP_RH_17X40(POS_RT_RH_X+2,POS_RT_RH_Y+19,RT_SHIDU%100/10,(uint8_t)color);
2708   2        }   
2709   1      }
2710          
2711          //½«Éè¶¨µÄ²ÎÊýÐ´Èëµ½STC EEPROM
2712          //×¢Òâ£º¿ª»úÊ±±ØÐë°ÑFLASHµÄÊý¾Ý¶ÁÈëµ½RAMÄÚ
2713          void Setting_write_to_flash(void)
2714          { 
2715   1        STC_IAP_Sector_Erase(DATA_FLASH_ADDRESS_Set_RT_YCTemp);           //²Á³ýÕû¸öÉÈÇø
2716   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_First, data_flash.First);//½« DEBUG_DATA Ð´Èë EEPROM
2717   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Work_Mode, data_flash.Work_Mode);//
2718   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_RT_WCTemp, data_flash.Set_RT_WCTemp);//
2719   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_RT_YCTemp, data_flash.Set_RT_YCTemp);//
2720   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_In_Exp_Ratio, data_flash.In_Exp_Ratio);//
2721   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_CQK_WCTemp, data_flash.Set_CQK_WCTemp);//
2722   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Set_CQK_YCTemp, data_flash.Set_CQK_YCTemp);//
2723   1        STC_IAP_Byte_Program(DATA_FLASH_ADDRESS_Language, data_flash.Language);//
2724   1      }
2725          
2726          //½«Ä¬ÈÏµÄ²ÎÊýÐ´Èëµ½STC EEPROM
2727          static void Write_Default_Setting_to_flash(void) //°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2728          {
2729   1        data_flash.First = 'Z';
2730   1        data_flash.Work_Mode = Invasive_Mode;//ÓÐ´´
2731   1        data_flash.Set_RT_WCTemp = (340/5);//
2732   1        data_flash.Set_RT_YCTemp = (390/5);//
2733   1        data_flash.In_Exp_Ratio = 4;//1:1.3
2734   1        data_flash.Set_CQK_WCTemp = (310/5);//
2735   1        data_flash.Set_CQK_YCTemp = (360/5);//
2736   1        //data_flash.Language = Lan_English;
2737   1      
2738   1        Setting_write_to_flash();//Ð´Èëµ½FLASH
2739   1      }
2740          
2741          
2742          void Mem_Flash_Recall(void) //¶ÁÈ¡ÉÏ´ÎµÄ¼ÇÒä²¢ÑéÖ¤Êý¾Ý
2743          {
2744   1        data_flash.First = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_First);    //¶ÁEEPROMµÄÖµ
2745   1        data_flash.Work_Mode = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Work_Mode);    
2746   1        data_flash.Set_RT_WCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_RT_WCTemp);    
2747   1        data_flash.Set_RT_YCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_RT_YCTemp);    
2748   1        data_flash.In_Exp_Ratio = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_In_Exp_Ratio);  
2749   1        data_flash.Set_CQK_WCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_CQK_WCTemp);    
2750   1        data_flash.Set_CQK_YCTemp = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Set_CQK_YCTemp); 
2751   1        data_flash.Language = STC_IAP_Byte_Read(DATA_FLASH_ADDRESS_Language); 
2752   1        
2753   1        if( //Ð£ÑéÊý¾ÝÊÇ·ñÕýÈ·
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 46  

2754   1            (data_flash.First != 'Z')
2755   1            ||(data_flash.Work_Mode > 1) 
2756   1            ||(data_flash.Set_RT_WCTemp > (Const_NoninvasPatientTemp_Max/5)) //370/5 = 74;  
2757   1            ||(data_flash.Set_RT_WCTemp < (Const_NoninvasPatientTemp_Min/5)) //300/5 = 60;  
2758   1            ||(data_flash.Set_RT_YCTemp > (Const_InvasPatientTemp_Max/5)) //400/5 = 80; 
2759   1            ||(data_flash.Set_RT_YCTemp < (Const_InvasPatientTemp_Min/5)) //350/5 = 70;
2760   1            ||(data_flash.In_Exp_Ratio > 6)
2761   1            ||(data_flash.In_Exp_Ratio < 1)
2762   1            ||(data_flash.Set_CQK_WCTemp > (Const_NoninvasChamberTemp_Max/5)) //360/5 = 74;  
2763   1            ||(data_flash.Set_CQK_WCTemp < (Const_NoninvasChamberTemp_Min/5)) //310/5 = 60;  
2764   1            ||(data_flash.Set_CQK_YCTemp > (Const_InvasChamberTemp_Max/5))  //400/5 = 80; 
2765   1            ||(data_flash.Set_CQK_YCTemp < (Const_InvasChamberTemp_Min/5))  //350/5 = 70;
2766   1            ||(data_flash.Language > Lan_French)//×î¶à4ÖÖÓïÑÔ
2767   1          )
2768   1        {
2769   2          data_flash.Language = Lan_English;
2770   2          Write_Default_Setting_to_flash();//°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2771   2        }
2772   1      }
2773          
2774          
2775          
2776          void Load_Settings_Before_Choice(void)//ÔÚÑ¡Ôñ·½¿ò³öÏÖÖ®Ç°£¬Òª´¦ÀíµÄÊý¾Ý£¬ÒÔÍ¬Ê±¼æÈÝÓÐÎÞÑ¡Ôñ¼ÇÒä½çÃæ³ÌÐò
2777          {
2778   1        if(defalut_mode == Load_Fac_MODE)  //ÈôÊÇ¹¤³§Ä¬ÈÏÉè¶¨  
2779   1        {
2780   2          Write_Default_Setting_to_flash();//°ÑÄ¬ÈÏ³ö³§Éè¶¨Ð´ÈëFLASH
2781   2        }
2782   1      
2783   1        Work_Mode = data_flash.Work_Mode;  //¹¤×÷Ä£Ê½
2784   1        Set_RT_WCTemp = data_flash.Set_RT_WCTemp * 5;//
2785   1        Set_RT_YCTemp = data_flash.Set_RT_YCTemp * 5;//
2786   1        Set_CQK_WCTemp = data_flash.Set_CQK_WCTemp * 5;//
2787   1        Set_CQK_YCTemp = data_flash.Set_CQK_YCTemp * 5;//
2788   1        In_Exp_Ratio = data_flash.In_Exp_Ratio;  //
2789   1      
2790   1        if(Work_Mode==0)  
2791   1        {     
2792   2          Set_RT_Temp=(INT)Set_RT_WCTemp;
2793   2          Set_CQK_Temp=Set_CQK_WCTemp;
2794   2        }
2795   1        else
2796   1        {
2797   2          Set_RT_Temp=(INT)Set_RT_YCTemp; 
2798   2          Set_CQK_Temp=Set_CQK_YCTemp; 
2799   2        }
2800   1      }
2801          
2802          /*µÍ¹¦ÂÊÄ£Ê½
2803          ¹¦ÄÜ---½øÈë´ý»úÄ£Ê½Ê±£¬a,¼ÓÈÈÅÌ¼ÓÈÈÊ±³¤±»ÏÞ¶¨ÔÚ50ÇÒÎÂ¶È²»³¬¹ý50¶È
2804                                 b,»ØÂ··¢ÈÈË¿¼ÓÈÈÊ±³¤±»ÏÞ¶¨ÔÚ40
2805          Ä¿µÄ---µ±³öÏÖÈËÌå¶Ë»ò³öÆø¿ÚµÍÎÂ±¨¾¯Ê±£¬³ýÁËÆøÔ´£¬»ØÂ·±»¶ÂµÈÔ­ÒòÍâ£¬»¹ÓÐ¿ÉÄÜÊÇÌ½Í·ÍÑÂä£¬
2806                  ÈôÍêÈ«²»¼ÓÈÈ£¬ÔòÔÚÓÃ»§Î´¸ÉÔ¤Ê±ÍêÈ«²»¼ÓÈÈÖÁÀäÈ´µ½ÊÒÎÂ£¬ÓÃ»§¿ÉÄÜ»áÈÏÎª»úÆ÷ÓÐÑÏÖØ¹ÊÕÏ
2807                  Èô°´Õý³£Ä£Ê½¼ÓÈÈ£¬Ôò¿ÉÄÜ»áÓÉÓÚÌ½Í·ÍÑÂäµ¼ÖÂ´ó¹¦ÂÊ¼ÓÈÈ£¬ÒýÆð³¬ÎÂ¶ø²úÉú·çÏÕ¡£
2808          ½øÈë´ý»úÄ£Ê½Ìõ¼þ---ÈËÌå¶Ë»ò³öÆø¿Ú³öÏÖµÍÎÂ±¨¾¯£¬ÇÒÓÐ±¨¾¯ÒôÊ±
2809          ÍË³ö´ý»úÄ£Ê½Ìõ¼þ---µÍÎÂ±¨¾¯½â³ý£¬»ò°´ÏûÒô¼ü¿ÉÔÝÊ±ÍË³ö90S
2810          */
2811          void LowPowerModeFunc(void)  
2812          { 
2813   1        if(((LoTemp_Count > 120) || (LoTemp_CQK_Count > 120))||(Bit_is_one(ERR_Kind,Alarm_Const_NoWater))) //ÎÞË®
             -(¸ÉÉÕ)±¨¾¯
2814   1        {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 47  

2815   2          if(   
2816   2               ((ERR_Kind & 0x01)!=0)//´«¸ÐÆ÷´íÎó
2817   2            || ((ERR_Kind & 0x02)!=0)//¸ßÎÂ
2818   2            || (Wire_Mode_Mismatch == 1)  //·¢ÈÈË¿Î´Ñ¡
2819   2            || (HeaterPlate_State==0))//Ë®¹ÞÎ´×°ºÃ
2820   2          { 
2821   3          }
2822   2          else  
2823   2          {     
2824   3            if(AlarmSoundPauseStatus == 0)//Î´°´ÏÂ¾²Òô¼ü
2825   3            {
2826   4              Low_Power_Mode_Flag = 1;//µÍ¹¦ÂÊÄ£Ê½±êÖ¾
2827   4              if(JEP_Temp<=450)
2828   4              {       
2829   5                Micro_Temp_Val=50;  //Í£Ö¹¼ÓÈÈ
2830   5              }
2831   4              else
2832   4              {
2833   5                Micro_Temp_Val=0;  //Í£Ö¹¼ÓÈÈ
2834   5              }
2835   4              Micro_Temp_In=40;
2836   4              Micro_Temp_Out=Micro_Temp_In;     
2837   4              Micro_Adj_Mode_Test = 4;//¼ÓÈÈÄ£Ê½²âÊÔ
2838   4            }
2839   3            else
2840   3            {
2841   4              Low_Power_Mode_Flag = 0;
2842   4            }
2843   3          }
2844   2        }
2845   1        else
2846   1        {
2847   2          Low_Power_Mode_Flag = 0;
2848   2        }
2849   1          
2850   1      }
2851          
2852          
2853          //ÔöÁ¿ControlerËã·¨
2854          //¦¤U = U(k)-U(k-1) = Kp*[e(k)-e(k-1)]+Ki*e(k)+Kd*[e(k)-2*e(k-1)+e(k-2)]
2855          //* ÆäÖÐ£ºKp¡¢Ki¡¢Kd·Ö±ðÎª±ÈÀý¡¢»ý·ÖºÍÎ¢·Ö·Å´óÏµÊý£¬u(k)±íÊ¾µÚk¸ö²ÉÑùÊ±¿Ì
2856          //µÄ¿ØÖÆÁ¿,e(k)±íÊ¾µÚk¸ö²ÉÑùÊ±¿ÌµÄº½ÏòÊäÈëÆ«²î.
2857          //PIE_UK = Kp*(Ek-Ek1)+Ki*EK+Kd*(Ek+Ek2-EK1)
2858          
2859          //struct Controler
2860          //    {
2861          //      int Uk; //×ÜµÄ¿ØÖÆÁ¿
2862          //      int Uk1;//ÉÏ´ÎµÄ×Ü¿ØÖÆÁ¿
2863          //      int Sum_error;//Îó²î×ÜÁ¿
2864          //      int Ek;//µ±Ç°µÄ×ÜÎó²îÁ¿
2865          //      int Ek1;//Ç°Ò»´ÎµÄÎó²îÁ¿
2866          //      int Ek2;//Ç°¶þ´ÎµÄÎó²îÁ¿       
2867          //       }Controler_temp;//
2868          
2869          //ÓÐ·¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶È¿ØÖÆControlerËã·¨---¸ù¾Ý»¼Õß¶ËÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈ»ØÂ·Çý¶¯Öµ  Ã¿1Ãë¹¤×÷Ò
             -»´Î
2870          static void Controler_Calc(void) //Éè¶¨ÎÂ¶È×î¸ß400,×îµÍ000,Êµ¼Ê0-800,  
2871          {
2872   1      
2873   1        INT Vlaue1,tmp;
2874   1        static const INT Controler_Kp = 40;//±ÈÀýÏµÊý 5¶ÈÎª1500;1¶ÈÎª300;0.1¶ÈÎª30
2875   1        static const INT Controler_Ki = 8;//»ý·ÖÏµÊý
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 48  

2876   1        static const INT Controler_Kd = 20;//Î¢·ÖÏµÊý   
2877   1      
2878   1        if(Controler_temp.Ek > 100)//10¶ÈÎª¼«ÏÞ 
2879   1        {
2880   2          Controler_temp.Ek = 100;
2881   2        }
2882   1        if(Controler_temp.Ek < -100)
2883   1        {
2884   2          Controler_temp.Ek = -100;
2885   2        }
2886   1        
2887   1        Controler_temp.Sum_error += Controler_temp.Ek;//Îó²î×ÜÁ¿
2888   1        if(Controler_temp.Sum_error > 3500) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
2889   1        {
2890   2          Controler_temp.Sum_error = 3500;
2891   2        }
2892   1        if(Controler_temp.Sum_error < -3500)
2893   1        {
2894   2          
2895   2        }
2896   1        Vlaue1 = Controler_Kp * Controler_temp.Ek;//±ÈÀý ×î´ó100*30=3000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=1250)
2897   1        
2898   1        tmp = Controler_temp.Sum_error * Controler_Ki / 50; //»ý·Ö ×î´ó3000*2/100=60,Ò»¸ö¼ÓÈÈÖÜÆÚÊÇ250´Î  250*5/1
             -5*3=250;
2899   1        Vlaue1 += tmp;
2900   1        tmp = (Controler_temp.Ek - (2 * Controler_temp.Ek1) + Controler_temp.Ek2) * Controler_Kd;//Î¢·Ö 
2901   1        Controler_temp.Sum_error = Controler_temp.Sum_error + tmp;//2015-06-16 °ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
2902   1        Vlaue1 += tmp;
2903   1        Controler_temp.Uk = Vlaue1;// Controler_temp.Uk1 + Vlaue1;       // ½á¹û /100×î´óÎª250´Î
2904   1        if(Controler_temp.Uk > 780) 
2905   1        {
2906   2          Controler_temp.Uk = 780;
2907   2        }
2908   1        else if(Controler_temp.Uk < 0)
2909   1        {
2910   2          Controler_temp.Uk = 0;//²»ÄÜÎª¸ºÊý
2911   2        }
2912   1        else
2913   1        {
2914   2          //do nothing
2915   2        }
2916   1      
2917   1        Controler_temp.Uk /= 4;//×î¸ß190;   
2918   1          
2919   1        Controler_temp.Ek2 = Controler_temp.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
2920   1        Controler_temp.Ek1 = Controler_temp.Ek;
2921   1      }
2922          
2923          
2924          //¼ÓÈÈÅÌÇý¶¯µÄControlerËã·¨--- ¸ù¾Ý¼ÓÈÈÅÌµÄÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈ»ØÂ·Çý¶¯Öµ  Ã¿1Ãë¹¤×÷Ò»´Î
2925          static void HeatPlate_Controler_Calc(void) //Éè¶¨ÎÂ¶È×î¸ß400,×îµÍ000,Êµ¼Ê0-800,  
2926          {
2927   1      
2928   1        INT Vlaue1,tmp;
2929   1      //  uint16_t  Val_Calc;
2930   1        static const INT Controler_Kp2 = 38;//±ÈÀýÏµÊý //±ÈÀýÏµÊý 10¶ÈÎª4000/20=200;1¶ÈÎª400/20=20;0.1¶ÈÎª2
2931   1        static const INT Controler_Ki2 = 8;//»ý·ÖÏµÊý
2932   1        static const INT Controler_Kd2 = 20;//Î¢·ÖÏµÊý  
2933   1      
2934   1        if(Controler_temp2.Ek > 100)//10¶ÈÎª¼«ÏÞ 
2935   1        {
2936   2          Controler_temp2.Ek = 100;
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 49  

2937   2        }
2938   1        if(Controler_temp2.Ek < -100)
2939   1        {
2940   2          Controler_temp2.Ek = -100;
2941   2        }
2942   1        
2943   1        Controler_temp2.Sum_error += Controler_temp2.Ek;//Îó²î×ÜÁ¿
2944   1        if(Controler_temp2.Sum_error > 3500) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
2945   1        {
2946   2          Controler_temp2.Sum_error = 3500;
2947   2        }
2948   1        if(Controler_temp2.Sum_error < -3500)
2949   1        {
2950   2          Controler_temp2.Sum_error = -3500;
2951   2        }   
2952   1      
2953   1        Vlaue1 = Controler_Kp2 * Controler_temp2.Ek;//±ÈÀý ×î´ó100*30=3000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=125
             -0)
2954   1        
2955   1        tmp = Controler_temp2.Sum_error * Controler_Ki2/50; //»ý·Ö ×î´ó3000*2/100=60,Ò»¸ö¼ÓÈÈÖÜÆÚÊÇ250´Î  250*5/1
             -5*3=250;
2956   1        Vlaue1 += tmp;
2957   1        tmp = (Controler_temp2.Ek - (2 * Controler_temp2.Ek1) + Controler_temp2.Ek2) * Controler_Kd2;//Î¢·Ö 
2958   1        Controler_temp2.Sum_error = Controler_temp2.Sum_error + tmp;//2015-06-16 °ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
2959   1        Vlaue1 += tmp;
2960   1        Controler_temp2.Uk = Vlaue1;//;       // ½á¹û /100×î´óÎª250´Î
2961   1        if(Controler_temp2.Uk > 780) 
2962   1        {
2963   2          Controler_temp2.Uk = 780;
2964   2        }
2965   1        else if(Controler_temp2.Uk < 0)
2966   1        {
2967   2          Controler_temp2.Uk = 0;//²»ÄÜÎª¸ºÊý
2968   2        }
2969   1        else 
2970   1        {
2971   2          //do nothing
2972   2        }
2973   1      
2974   1        Controler_temp2.Uk /= 4;//×î¸ß195;    
2975   1      
2976   1        Controler_temp2.Ek2 = Controler_temp2.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
2977   1        Controler_temp2.Ek1 = Controler_temp2.Ek;
2978   1      }
2979          
2980          
2981          //¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈµÄControlerËã·¨--- ¸ù¾Ý³öÆø¿ÚµÄÄ¿±êÎÂ¶ÈºÍÊµ¼ÊÎÂ¶È£¬¼ÆËã³ö¼ÓÈÈÅÌÄ¿±êÎÂ¶ÈµÄÆ«²î, Ã¿20Ãë¹¤×÷Ò
             -»´Î
2982          static void HeatPlateTemp_Aim_Controler_Calc(void) // 
2983          {
2984   1        INT Vlaue1,tmp;
2985   1      //  uint16_t  Val_Calc;
2986   1        static const INT Controler_Kp3 = 40;//±ÈÀýÏµÊý 10¶ÈÎª4000/100=40;1¶ÈÎª400/100=4;0.1¶ÈÎª0.4
2987   1        static const INT Controler_Ki3 = 1;//»ý·ÖÏµÊý
2988   1        static const INT Controler_Kd3 = 80;//Î¢·ÖÏµÊý  
2989   1      
2990   1        if(Controler_temp3.Ek > 100)//10¶ÈÎª¼«ÏÞ 
2991   1        {
2992   2          Controler_temp3.Ek = 100;
2993   2        }
2994   1        if(Controler_temp3.Ek < -100)
2995   1        {
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 50  

2996   2          Controler_temp3.Ek = -100;
2997   2        }
2998   1        
2999   1        Controler_temp3.Sum_error += Controler_temp3.Ek;//Îó²î×ÜÁ¿
3000   1        if(Controler_temp3.Sum_error > 1000) //0.1¶ÈÄÚ×î¶àÊÇ250Ò»ÖÜÆÚ
3001   1        {
3002   2          Controler_temp3.Sum_error = 1000;
3003   2        }
3004   1        if(Controler_temp3.Sum_error < -1000)
3005   1        {
3006   2          Controler_temp3.Sum_error = -1000;
3007   2        }   
3008   1      
3009   1        Vlaue1 = Controler_Kp3 * Controler_temp3.Ek;//±ÈÀý ×î´ó100*40=4000;  Îó²î*±ÈÀýÏµÊý(¼Ù¶¨Ïà²î5¶È¼´50*25=125
             -0)
3010   1      
3011   1        
3012   1        tmp = Controler_temp3.Sum_error * Controler_Ki3; //»ý·Ö ×î´ó3500*8/100=280
3013   1        Vlaue1 += tmp;
3014   1        //tmp = (Controler_temp3.Ek - (2 * Controler_temp3.Ek1) + Controler_temp3.Ek2) * Controler_Kd3;//Î¢·Ö 
3015   1        tmp = ((2 * Controler_temp3.Ek) - Controler_temp3.Ek1 - Controler_temp3.Ek2) * Controler_Kd3;//Î¢·Ö 
3016   1        Controler_temp3.Sum_error = Controler_temp3.Sum_error + tmp;//°ÑÎ¢·Ö¼ÆÈë»ý·ÖºÍ
3017   1        Vlaue1 += tmp;
3018   1        Controler_temp3.Uk = Vlaue1;// Controler_temp.Uk1 + Vlaue1;       // ½á¹û /100×î´óÎª250´Î
3019   1        if(Controler_temp3.Uk > 5000) 
3020   1        {
3021   2          Controler_temp3.Uk = 5000;
3022   2        }
3023   1        else if(Controler_temp3.Uk < -5000)
3024   1        {
3025   2          Controler_temp3.Uk = -5000;//¸ºÊý
3026   2        }
3027   1        else 
3028   1        {
3029   2          //do nothing
3030   2        }
3031   1      
3032   1        Controler_temp3.Uk /= 100;//×î¸ß50;     
3033   1      
3034   1        Controler_temp3.Ek2 = Controler_temp3.Ek1;        // ±£´æÐÂµÄK-1´ÎÊäÈëÖµ
3035   1        Controler_temp3.Ek1 = Controler_temp3.Ek;
3036   1      }
3037          
3038          
3039          //ÎÞ»ØÂ··¢ÈÈË¿Ê±µÄ»¼Õß¶ËÎÂ¶Èµ÷½Ú
3040          static uint16_t NoneWire_Warm_Up_Sec=0;
3041          static void PatientTemp_NoneHeatWire_Adj(void)
3042          {
3043   1        static INT err_sum=0;
3044   1        static INT RT_Temp_Mem = 0;
3045   1        //  static uint16_t WarmUpstate=0;
3046   1        INT Calc_int=0;
3047   1        uint16_t Val_Calc;      
3048   1      
3049   1        {
3050   2          if(CQK_Temp < 330)//Èô³öÆø¿ÚÎÂ¶ÈµÍÓÚ33¶ÈÔòÈ«¹¦ÂÊ¼ÓÈÈ
3051   2          {
3052   3            //Micro_Temp_Val = 190;
3053   3            //ÒÔÏÂÎª·¢ÈÈÅÌÎÂ¶ÈµÄControler¿ØÖÆ
3054   3            
3055   3            Controler_temp2.Ek = 980 - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
3056   3            HeatPlate_Controler_Calc(); 
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 51  

3057   3            Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
3058   3            Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
3059   3            
3060   3            Temp2_Int = JEP_Temp;
3061   3            
3062   3          }
3063   2          else
3064   2          { 
3065   3            NoneWire_Warm_Up_Sec++;
3066   3            if(NoneWire_Warm_Up_Sec > 2000)
3067   3            {
3068   4              NoneWire_Warm_Up_Sec = 2000;
3069   4            }
3070   3            if(NoneWire_Warm_Up_Sec < 3)//00)//10·ÖÖÓÄÚÉè¶¨
3071   3            {
3072   4              //Temp2_Int = 500 + Set_RT_Temp - 300;//·¢ÈÈÅÌÎÂ¶ÈÉè¶¨ÔÚ50¶È-60¶È
3073   4              if(Temp2_Int < (550 + ((Set_RT_Temp - 300)*2)))//·¢ÈÈÅÌÎÂ¶ÈÉè¶¨ÔÚ50¶È-60¶È
3074   4              {
3075   5                Temp2_Int = 550 + ((Set_RT_Temp - 300)*2);
3076   5              } 
3077   4              RT_Temp_Mem = RT_Temp;
3078   4            }
3079   3            else
3080   3            { 
3081   4              err_sum = err_sum + Set_RT_Temp - RT_Temp;//»ý·Ö
3082   4              if(err_sum > 180)
3083   4              {
3084   5                err_sum=180;
3085   5              }
3086   4              else if(err_sum < -180)
3087   4              {
3088   5                err_sum=-180;//Ã¿Ãë10¶È(100)£¬30000/100=300,¼´Îª5·ÖÖÓÊý¾Ý
3089   5              }
3090   4              else 
3091   4              {
3092   5                //do nothing
3093   5              }
3094   4              //if((RT_Temp - Set_RT_Temp) >= 1){if(err_sum > 0)err_sum = 0;}//´ïµ½Éè¶¨ÎÂ¶È£¬Îó²î²»ÄÜÎªÕý
3095   4              //else if((Set_RT_Temp - RT_Temp) >= 1){if(err_sum < 0)err_sum = 0;}//Î´´ïµ½Éè¶¨ÎÂ¶È£¬Îó²î²»ÄÜÎª¸º
3096   4              
3097   4              if((Work_State != UI_STATE_SCREENSAVER_MODE)&&(Test_Mode_Dis_Jrp_Ctl == 1))
3098   4              { //8±íÊ¾¸ßÎ»Îª0Ò²ÏÔÊ¾,0±íÊ¾·Çµþ¼ÓÏÔÊ¾ ³öÆø¿Ú
3099   5                Back_Color=WHITE18;
3100   5                if(err_sum >=0)
3101   5                {
3102   6                  LCD_ShowxNum(220,10,16,1,1,0x80,BLACK18); //1-±íÊ¾ÎªÕýÊý
3103   6                }
3104   5                else
3105   5                {
3106   6                  LCD_ShowxNum(220,10,16,1,0,0x80,BLACK18); //0-±íÊ¾Îª¸ºÊý
3107   6                }           
3108   5                LCD_ShowxNum(220,20,16,5,(u32)(abs(err_sum)),0x80,BLACK18); //·¢ÈÈÅÌ¼ÓÈÈµÄÄ£Ê½ÏÔÊ¾
3109   5              }           
3110   4      
3111   4              NoneWire_Heat_Sec++;
3112   4              if(NoneWire_Heat_Sec >= 180)//3·ÖÖÓµ÷ÕûÒ»´ÎÎÂ¶È
3113   4              {
3114   5                NoneWire_Heat_Sec = 0;//-Temp2_Int
3115   5                
3116   5                Calc_int = err_sum;
3117   5                //if(Calc_int > 6000)Calc_int=6000;
3118   5                //else if(Calc_int< -6000)Calc_int=-6000;//Ã¿Ãë5¶È(50)£¬2·ÖÖÓÊý¾ÝÎª6000
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 52  

3119   5                
3120   5                Temp2_Int = Temp2_Int + ((Set_RT_Temp - RT_Temp)/6) + ((RT_Temp_Mem-RT_Temp)/2) + (Calc_int/40);//(40
             -0-300)/10
3121   5                //if(Temp2_Int > 1050)Temp2_Int = 1050;
3122   5                if(Temp2_Int > 980)
3123   5                {
3124   6                  Temp2_Int = 980;
3125   6                }
3126   5      
3127   5                RT_Temp_Mem = RT_Temp;
3128   5              }
3129   4            }           
3130   3      
3131   3            //ÒÔÏÂÎª·¢ÈÈÅÌÎÂ¶ÈµÄControler¿ØÖÆ
3132   3            Controler_temp2.Ek = Temp2_Int - JEP_Temp;//µ±Ç°µÄÎó²îÁ¿ Éè¶¨ÎÂ¶È-µ±Ç°Êµ¼ÊÎÂ¶È
3133   3            HeatPlate_Controler_Calc(); 
3134   3            Val_Calc = (uint8_t)Controler_temp2.Uk; //¼ÆËã³ö¼ÓÈÈÊ±¼ä
3135   3            if(RT_Temp > (Set_RT_Temp + 10))
3136   3            {
3137   4              Micro_Temp_Val = 0;//³¬¹ý1¶È 
3138   4              
3139   4            }
3140   3            else  
3141   3            {
3142   4              Micro_Temp_Val = (uint8_t)Val_Calc;//±ãÓÚ¼ÆËã£¬ÒÔÃâ³¬¹ý190½øÈëÖÐ¶Ï  
3143   4            }
3144   3          }       
3145   2        }
3146   1      }
3147          
3148          //Õý³£ÔËÐÐ½çÃæ,°´ÏÂÈ·ÈÏ¼üÈ·¶¨»ØÂ·µÄÄ£Ê½
3149          void WireInOut_State_Confirm(void)
3150          {
3151   1        if((WireIn_State > 0) && (WireOut_State > 0)) //Ë«¹Ü¼ÓÈÈÄ£Ê½
3152   1        {
3153   2          Wire_Mode_Sel = Wire_Sel_Double;  
3154   2        } 
3155   1        else if((WireIn_State > 0) && (WireOut_State == 0)) //µ¥¹Ü¼ÓÈÈÄ£Ê½
3156   1        {
3157   2          Wire_Mode_Sel = Wire_Sel_In_Only; 
3158   2        }
3159   1        else if((WireIn_State == 0) && (WireOut_State == 0)) //ÎÞ¼ÓÈÈË¿Ä£Ê½
3160   1        {
3161   2          Wire_Mode_Sel = Wire_Sel_None;  
3162   2        } 
3163   1        else 
3164   1        {
3165   2          //do nothing
3166   2        }
3167   1      }
3168          
3169          void HeaterPlateWireDriveFbTask(void)//16
3170          {
3171   1        static uint8_t Micro_Temp_CLK = 0;
3172   1        static uint8_t    Check_WireInTimes = 0;
3173   1        static uint8_t    Check_WireOutTimes =0 ;
3174   1        static uint8_t WireIn_FB_Count = 0;     //¼ì²â¼ÓÈÈÏßIn·´À¡ÐÅºÅ
3175   1        static uint8_t WireOut_FB_Count = 0;     //¼ì²â¼ÓÈÈÏßOut·´À¡ÐÅºÅ
3176   1        static uint8_t NoHpCheck_Times = 0;//ÎÞ¼ÓÈÈÅÌµÄ´ÎÊý.
3177   1        
3178   1        Micro_Temp_CLK++;
3179   1        if(Micro_Temp_CLK > 200)//Ê±»ù
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 53  

3180   1        {   
3181   2          Micro_Temp_CLK = 0;
3182   2      
3183   2          //Ã¿¸öÖÜÆÚ¼ì²â¼ÓÈÈÅÌÊÇ·ñ´æÔÚ
3184   2           HP_CNT_Int_End_Rem = HP_CNT_Int;
3185   2          if(HP_CNT_Int < 1)//Î´¼ì²âµ½
3186   2          {
3187   3            NoHpCheck_Times++;
3188   3            if(NoHpCheck_Times >=2)
3189   3            {
3190   4              NoHpCheck_Times = 2;
3191   4              HeaterPlate_State=0; //Î´¼ì²âµ½¼ÓÈÈÅÌ
3192   4            }
3193   3          }
3194   2          else
3195   2          {
3196   3            NoHpCheck_Times = 0;
3197   3            HeaterPlate_State=1; //¼ì²â¼ÓÈÈÅÌ´æÔÚ         
3198   3          }
3199   2          HP_CNT_Int = 0;//ÇåÁã
3200   2        }
3201   1         
3202   1      //¼ÓÈÈÅÌÇý¶¯  
3203   1        if (Micro_Temp_Val>Micro_Temp_CLK)
3204   1        {
3205   2          Heat_JRP_Port=1;
3206   2        }  
3207   1        else
3208   1        {
3209   2          Heat_JRP_Port=0;
3210   2        }
3211   1        
3212   1      //INSP½øÖ§Æø¼ÓÈÈÇý¶¯ºÍ¼ì²â
3213   1        if (Micro_Temp_In>Micro_Temp_CLK)
3214   1        {
3215   2          Heat_WireIn_Port=1;
3216   2          Heat_WIRE_EN_OUT=0;//·ÀÖ¹µ¥Ò»¹ÊÕÏ 
3217   2        }
3218   1        else  //²»¼ÓÈÈÊ±µÄ¼ì²â
3219   1        {     
3220   2          if(Heat_WireIn_Port!=0)
3221   2          {
3222   3            Heat_WireIn_Port=0;
3223   3            Heat_WIRE_EN_OUT=1;//·ÀÖ¹µ¥Ò»¹ÊÕÏ     
3224   3            Check_WireInTimes=0;
3225   3            WireIn_FB_Count=0;
3226   3          }
3227   2          else
3228   2          {
3229   3            Check_WireInTimes++;
3230   3            if(WireIn_Exist_Port==0)
3231   3            {
3232   4              WireIn_FB_Count++;
3233   4            }       
3234   3            if(Check_WireInTimes>4)
3235   3            {
3236   4              if(WireIn_FB_Count<3)   //Á¬Ðø¼ì²âµ½Îå´Î²»¼ÓÈÈ±¨´í
3237   4              {
3238   5                WireIn_State=0; //Î´¼ì²âµ½·¢ÈÈË¿             
3239   5              }
3240   4              else
3241   4              {            
C51 COMPILER V9.52.0.0   ACTIVITYFUNCTIONS                                                 04/04/2019 16:25:01 PAGE 54  

3242   5                WireIn_State=1; //Ã»¼ÓÈÈ£¬´ú±í¼ì²âµ½·¢ÈÈË¿
3243   5              }
3244   4              Check_WireInTimes=0;
3245   4              WireIn_FB_Count=0;
3246   4            }
3247   3          }
3248   2        }     
3249   1        
3250   1      //EXP³öÖ§Æø¼ÓÈÈÇý¶¯ºÍ¼ì²â
3251   1        if (Micro_Temp_Out>Micro_Temp_CLK)
3252   1        {
3253   2          Heat_WireOut_Port=1;
3254   2          Heat_WIRE_EN_OUT = 0;//·ÀÖ¹µ¥Ò»¹ÊÕÏ   
3255   2        }
3256   1        else
3257   1        {
3258   2          if(Heat_WireOut_Port!=0)
3259   2          {
3260   3            Heat_WireOut_Port=0;
3261   3            Heat_WIRE_EN_OUT = 1;//·ÀÖ¹µ¥Ò»¹ÊÕÏ   
3262   3            Check_WireOutTimes=0;
3263   3            WireOut_FB_Count=0;
3264   3          }
3265   2          else
3266   2          {
3267   3            Check_WireOutTimes++;
3268   3            if(WireOut_Exist_Port==0)
3269   3            {
3270   4              WireOut_FB_Count++;
3271   4            }       
3272   3            if(Check_WireOutTimes>4  )
3273   3            {
3274   4              if(WireOut_FB_Count<3)   //Á¬Ðø¼ì²âµ½Îå´Î²»¼ÓÈÈ±¨´í
3275   4              {
3276   5                WireOut_State=0; //Ã»¼ÓÈÈ£¬´ú±í¼ì²âµ½·¢ÈÈË¿
3277   5              }
3278   4              else
3279   4              {
3280   5                WireOut_State=1;
3281   5              }
3282   4              Check_WireOutTimes=0;
3283   4              WireOut_FB_Count=0;
3284   4            }
3285   3          }
3286   2        }  
3287   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  16303    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    270      75
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5       3
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
